2022-02-07 18:55:22.486791 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 18:55:22.506968 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 18:55:22.525981 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 18:55:22.544423 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_order_cnt_week".
2022-02-07 18:55:22.582072 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_customer_history".
2022-02-07 18:55:22.599170 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 18:55:22.767887 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 18:55:22.804545 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 18:55:22.855302 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 18:55:22.891165 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 18:55:22.915045 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 18:55:22.927810 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 18:55:24.105730 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.prestage

2022-02-07 18:55:24.354046 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 18:55:24.355611 (MainThread): Found 17 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 6 seed files, 4 sources, 0 exposures
2022-02-07 18:55:24.358168 (MainThread): 
2022-02-07 18:55:24.358875 (MainThread): Acquiring new postgres connection "master".
2022-02-07 18:55:24.368365 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 18:55:24.391971 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 18:55:24.392210 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 18:55:24.392326 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 18:55:24.457315 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.06 seconds
2022-02-07 18:55:24.460306 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 18:55:24.491324 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 18:55:24.510940 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 18:55:24.511241 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 18:55:24.511427 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 18:55:24.543533 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.03 seconds
2022-02-07 18:55:24.544268 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 18:55:24.544547 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 18:55:24.575102 (ThreadPoolExecutor-1_0): SQL status: SELECT 24 in 0.03 seconds
2022-02-07 18:55:24.604935 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 18:55:24.606355 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 18:55:24.657111 (MainThread): Using postgres connection "master".
2022-02-07 18:55:24.657389 (MainThread): On master: BEGIN
2022-02-07 18:55:24.657566 (MainThread): Opening a new connection, currently in state init
2022-02-07 18:55:24.675755 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 18:55:24.676087 (MainThread): Using postgres connection "master".
2022-02-07 18:55:24.676286 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 18:55:25.053763 (MainThread): SQL status: SELECT 14 in 0.38 seconds
2022-02-07 18:55:25.073856 (MainThread): On master: ROLLBACK
2022-02-07 18:55:25.075530 (MainThread): Using postgres connection "master".
2022-02-07 18:55:25.075749 (MainThread): On master: BEGIN
2022-02-07 18:55:25.079313 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 18:55:25.079641 (MainThread): On master: COMMIT
2022-02-07 18:55:25.079830 (MainThread): Using postgres connection "master".
2022-02-07 18:55:25.079987 (MainThread): On master: COMMIT
2022-02-07 18:55:25.081055 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 18:55:25.081322 (MainThread): On master: Close
2022-02-07 18:55:25.081938 (MainThread): 21:55:25 | Concurrency: 2 threads (target='dev')
2022-02-07 18:55:25.082287 (MainThread): 21:55:25 | 
2022-02-07 18:55:25.098548 (Thread-1): Began running node seed.project_otus_dbt.source_customers
2022-02-07 18:55:25.098963 (Thread-2): Began running node seed.project_otus_dbt.source_customers_crm
2022-02-07 18:55:25.101023 (Thread-1): 21:55:25 | 1 of 6 START seed file public.source_customers....................... [RUN]
2022-02-07 18:55:25.103210 (Thread-2): 21:55:25 | 2 of 6 START seed file public.source_customers_crm................... [RUN]
2022-02-07 18:55:25.104563 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_customers".
2022-02-07 18:55:25.105685 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_customers_crm".
2022-02-07 18:55:25.106579 (Thread-1): finished collecting timing info
2022-02-07 18:55:25.107902 (Thread-2): finished collecting timing info
2022-02-07 18:55:25.210984 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_customers_crm".
2022-02-07 18:55:25.212814 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_customers".
2022-02-07 18:55:25.213248 (Thread-2): On seed.project_otus_dbt.source_customers_crm: BEGIN
2022-02-07 18:55:25.213801 (Thread-1): On seed.project_otus_dbt.source_customers: BEGIN
2022-02-07 18:55:25.214435 (Thread-2): Opening a new connection, currently in state init
2022-02-07 18:55:25.214963 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 18:55:25.231628 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 18:55:25.231904 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_customers".
2022-02-07 18:55:25.232058 (Thread-1): On seed.project_otus_dbt.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_customers"} */
truncate table "postgres"."public"."source_customers"
2022-02-07 18:55:25.252164 (Thread-1): SQL status: TRUNCATE TABLE in 0.02 seconds
2022-02-07 18:55:25.252611 (Thread-2): SQL status: BEGIN in 0.04 seconds
2022-02-07 18:55:25.269046 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_customers_crm".
2022-02-07 18:55:25.283375 (Thread-2): On seed.project_otus_dbt.source_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_customers_crm"} */
truncate table "postgres"."public"."source_customers_crm"
2022-02-07 18:55:25.287972 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-07 18:55:25.293122 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_customers".
2022-02-07 18:55:25.293371 (Thread-1): On seed.project_otus_dbt.source_customers: 
            insert into "postgres"."public"."source_customers" (id, first_name, last_name, email) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%...
2022-02-07 18:55:25.297417 (Thread-2): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 18:55:25.303588 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_customers_crm".
2022-02-07 18:55:25.303994 (Thread-1): SQL status: INSERT 0 135 in 0.01 seconds
2022-02-07 18:55:25.304221 (Thread-2): On seed.project_otus_dbt.source_customers_crm: 
            insert into "postgres"."public"."source_customers_crm" (id, country, age) values
            (%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s)...
2022-02-07 18:55:25.310946 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_customers"
2022-02-07 18:55:25.320854 (Thread-2): SQL status: INSERT 0 78 in 0.01 seconds
2022-02-07 18:55:25.325261 (Thread-1): On seed.project_otus_dbt.source_customers: COMMIT
2022-02-07 18:55:25.325923 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_customers_crm"
2022-02-07 18:55:25.326224 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_customers".
2022-02-07 18:55:25.326706 (Thread-1): On seed.project_otus_dbt.source_customers: COMMIT
2022-02-07 18:55:25.329971 (Thread-2): On seed.project_otus_dbt.source_customers_crm: COMMIT
2022-02-07 18:55:25.330193 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_customers_crm".
2022-02-07 18:55:25.330276 (Thread-2): On seed.project_otus_dbt.source_customers_crm: COMMIT
2022-02-07 18:55:25.334335 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 18:55:25.334653 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 18:55:25.337546 (Thread-2): finished collecting timing info
2022-02-07 18:55:25.342630 (Thread-1): finished collecting timing info
2022-02-07 18:55:25.343154 (Thread-2): On seed.project_otus_dbt.source_customers_crm: Close
2022-02-07 18:55:25.343459 (Thread-1): On seed.project_otus_dbt.source_customers: Close
2022-02-07 18:55:25.344704 (Thread-1): 21:55:25 | 1 of 6 OK loaded seed file public.source_customers................... [INSERT 135 in 0.24s]
2022-02-07 18:55:25.345890 (Thread-2): 21:55:25 | 2 of 6 OK loaded seed file public.source_customers_crm............... [INSERT 78 in 0.24s]
2022-02-07 18:55:25.346328 (Thread-1): Finished running node seed.project_otus_dbt.source_customers
2022-02-07 18:55:25.346891 (Thread-2): Finished running node seed.project_otus_dbt.source_customers_crm
2022-02-07 18:55:25.347425 (Thread-1): Began running node seed.project_otus_dbt.source_orders
2022-02-07 18:55:25.348446 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 18:55:25.351451 (Thread-1): 21:55:25 | 3 of 6 START seed file public.source_orders.......................... [RUN]
2022-02-07 18:55:25.353669 (Thread-2): 21:55:25 | 4 of 6 START seed file public.source_wheat_msk....................... [RUN]
2022-02-07 18:55:25.354655 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_orders".
2022-02-07 18:55:25.355442 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 18:55:25.355808 (Thread-1): finished collecting timing info
2022-02-07 18:55:25.356368 (Thread-2): finished collecting timing info
2022-02-07 18:55:25.454738 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_orders".
2022-02-07 18:55:25.455018 (Thread-1): On seed.project_otus_dbt.source_orders: BEGIN
2022-02-07 18:55:25.455368 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 18:55:25.497407 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 18:55:25.497701 (Thread-1): SQL status: BEGIN in 0.04 seconds
2022-02-07 18:55:25.497900 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: BEGIN
2022-02-07 18:55:25.498119 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_orders".
2022-02-07 18:55:25.498408 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 18:55:25.498700 (Thread-1): On seed.project_otus_dbt.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_orders"} */
truncate table "postgres"."public"."source_orders"
2022-02-07 18:55:25.507794 (Thread-1): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 18:55:25.513192 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_orders".
2022-02-07 18:55:25.513558 (Thread-1): On seed.project_otus_dbt.source_orders: 
            insert into "postgres"."public"."source_orders" (id, user_id, order_date, status) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s...
2022-02-07 18:55:25.518147 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 18:55:25.518721 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 18:55:25.519399 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_msk"} */
truncate table "postgres"."public"."source_wheat_msk"
2022-02-07 18:55:25.520299 (Thread-1): SQL status: INSERT 0 99 in 0.01 seconds
2022-02-07 18:55:25.521127 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_orders"
2022-02-07 18:55:25.526159 (Thread-1): On seed.project_otus_dbt.source_orders: COMMIT
2022-02-07 18:55:25.526515 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_orders".
2022-02-07 18:55:25.526862 (Thread-1): On seed.project_otus_dbt.source_orders: COMMIT
2022-02-07 18:55:25.531267 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 18:55:25.534635 (Thread-1): finished collecting timing info
2022-02-07 18:55:25.535620 (Thread-2): SQL status: TRUNCATE TABLE in 0.02 seconds
2022-02-07 18:55:25.536015 (Thread-1): On seed.project_otus_dbt.source_orders: Close
2022-02-07 18:55:25.552484 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 18:55:25.554068 (Thread-1): 21:55:25 | 3 of 6 OK loaded seed file public.source_orders...................... [INSERT 99 in 0.20s]
2022-02-07 18:55:25.554439 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: 
            insert into "postgres"."public"."source_wheat_msk" (BOARDID, SECID, TRADEDATE, SHORTNAME, NAME, CLOSE, OPEN, HIGH, LOW, VALUE, DURATION, YIELD, DECIMALS, CAPITALIZATION, CURRENCYID, DIVISOR, TRADINGSESSION, VOLUME) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%...
2022-02-07 18:55:25.555104 (Thread-1): Finished running node seed.project_otus_dbt.source_orders
2022-02-07 18:55:25.560937 (Thread-1): Began running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 18:55:25.563493 (Thread-1): 21:55:25 | 5 of 6 START seed file public.source_wheat_usa....................... [RUN]
2022-02-07 18:55:25.564335 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 18:55:25.564757 (Thread-1): finished collecting timing info
2022-02-07 18:55:25.616182 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 18:55:25.616583 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: BEGIN
2022-02-07 18:55:25.616868 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 18:55:25.631098 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 18:55:25.631344 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 18:55:25.631474 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_usa"} */
truncate table "postgres"."public"."source_wheat_usa"
2022-02-07 18:55:25.636169 (Thread-1): SQL status: TRUNCATE TABLE in 0.00 seconds
2022-02-07 18:55:25.653595 (Thread-2): SQL status: INSERT 0 216 in 0.10 seconds
2022-02-07 18:55:25.657553 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 18:55:25.658198 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_msk"
2022-02-07 18:55:25.658500 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: 
            insert into "postgres"."public"."source_wheat_usa" (BOARDID, SECID, TRADEDATE, SHORTNAME, NAME, CLOSE, OPEN, HIGH, LOW, VALUE, DURATION, YIELD, DECIMALS, CAPITALIZATION, CURRENCYID, DIVISOR, TRADINGSESSION, VOLUME) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%...
2022-02-07 18:55:25.668872 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 18:55:25.669124 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 18:55:25.669249 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 18:55:25.672979 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 18:55:25.676411 (Thread-2): finished collecting timing info
2022-02-07 18:55:25.676913 (Thread-1): Postgres error: column "boardid" of relation "source_wheat_usa" does not exist
LINE 2: ...sert into "postgres"."public"."source_wheat_usa" (BOARDID, S...
                                                             ^

2022-02-07 18:55:25.677195 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: Close
2022-02-07 18:55:25.677509 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: ROLLBACK
2022-02-07 18:55:25.679236 (Thread-2): 21:55:25 | 4 of 6 OK loaded seed file public.source_wheat_msk................... [INSERT 216 in 0.32s]
2022-02-07 18:55:25.679900 (Thread-1): finished collecting timing info
2022-02-07 18:55:25.681020 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 18:55:25.681479 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: Close
2022-02-07 18:55:25.681954 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_usa_old
2022-02-07 18:55:25.685531 (Thread-2): 21:55:25 | 6 of 6 START seed file public.source_wheat_usa_old................... [RUN]
2022-02-07 18:55:25.688238 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_usa_old".
2022-02-07 18:55:25.688709 (Thread-2): finished collecting timing info
2022-02-07 18:55:25.724977 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa_old".
2022-02-07 18:55:25.725287 (Thread-2): On seed.project_otus_dbt.source_wheat_usa_old: BEGIN
2022-02-07 18:55:25.725478 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 18:55:25.686687 (Thread-1): Database Error in seed source_wheat_usa (data/source_wheat_usa.csv)
  column "boardid" of relation "source_wheat_usa" does not exist
  LINE 2: ...sert into "postgres"."public"."source_wheat_usa" (BOARDID, S...
                                                               ^
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "boardid" of relation "source_wheat_usa" does not exist
LINE 2: ...sert into "postgres"."public"."source_wheat_usa" (BOARDID, S...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 89, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 21, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 23, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 111, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/impl.py", line 63, in add_query
    return self.connections.add_query(sql, auto_begin, bindings,
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in seed source_wheat_usa (data/source_wheat_usa.csv)
  column "boardid" of relation "source_wheat_usa" does not exist
  LINE 2: ...sert into "postgres"."public"."source_wheat_usa" (BOARDID, S...
                                                               ^
2022-02-07 18:55:25.736135 (Thread-1): 21:55:25 | 5 of 6 ERROR loading seed file public.source_wheat_usa............... [ERROR in 0.17s]
2022-02-07 18:55:25.736633 (Thread-1): Finished running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 18:55:25.738596 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 18:55:25.738905 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa_old".
2022-02-07 18:55:25.739081 (Thread-2): On seed.project_otus_dbt.source_wheat_usa_old: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_usa_old"} */

    create table "postgres"."public"."source_wheat_usa_old" (Дата text,Цена integer,Откр integer,Макс integer,Мин integer,Объём text,Изм integer)
  
2022-02-07 18:55:25.761023 (Thread-2): SQL status: CREATE TABLE in 0.02 seconds
2022-02-07 18:55:25.769814 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa_old".
2022-02-07 18:55:25.770046 (Thread-2): On seed.project_otus_dbt.source_wheat_usa_old: 
            insert into "postgres"."public"."source_wheat_usa_old" (Дата, Цена, Откр, Макс, Мин, Объём, Изм) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s...
2022-02-07 18:55:25.778915 (Thread-2): SQL status: INSERT 0 283 in 0.01 seconds
2022-02-07 18:55:25.779681 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_usa_old"
2022-02-07 18:55:25.783135 (Thread-2): On seed.project_otus_dbt.source_wheat_usa_old: COMMIT
2022-02-07 18:55:25.783516 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa_old".
2022-02-07 18:55:25.783595 (Thread-2): On seed.project_otus_dbt.source_wheat_usa_old: COMMIT
2022-02-07 18:55:25.786233 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 18:55:25.788537 (Thread-2): finished collecting timing info
2022-02-07 18:55:25.788856 (Thread-2): On seed.project_otus_dbt.source_wheat_usa_old: Close
2022-02-07 18:55:25.789681 (Thread-2): 21:55:25 | 6 of 6 OK loaded seed file public.source_wheat_usa_old............... [INSERT 283 in 0.10s]
2022-02-07 18:55:25.789935 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_usa_old
2022-02-07 18:55:25.793345 (MainThread): Acquiring new postgres connection "master".
2022-02-07 18:55:25.793796 (MainThread): Using postgres connection "master".
2022-02-07 18:55:25.793908 (MainThread): On master: BEGIN
2022-02-07 18:55:25.794027 (MainThread): Opening a new connection, currently in state closed
2022-02-07 18:55:25.806655 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 18:55:25.806899 (MainThread): On master: COMMIT
2022-02-07 18:55:25.807006 (MainThread): Using postgres connection "master".
2022-02-07 18:55:25.807109 (MainThread): On master: COMMIT
2022-02-07 18:55:25.808183 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 18:55:25.808488 (MainThread): On master: Close
2022-02-07 18:55:25.809112 (MainThread): 21:55:25 | 
2022-02-07 18:55:25.809531 (MainThread): 21:55:25 | Finished running 6 seeds in 1.45s.
2022-02-07 18:55:25.809877 (MainThread): Connection 'master' was properly closed.
2022-02-07 18:55:25.810081 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_usa' was properly closed.
2022-02-07 18:55:25.810288 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_usa_old' was properly closed.
2022-02-07 18:55:25.941246 (MainThread): 
2022-02-07 18:55:25.941504 (MainThread): Completed with 1 error and 0 warnings:
2022-02-07 18:55:25.941686 (MainThread): 
2022-02-07 18:55:25.941877 (MainThread): Database Error in seed source_wheat_usa (data/source_wheat_usa.csv)
2022-02-07 18:55:25.942091 (MainThread):   column "boardid" of relation "source_wheat_usa" does not exist
2022-02-07 18:55:25.942289 (MainThread):   LINE 2: ...sert into "postgres"."public"."source_wheat_usa" (BOARDID, S...
2022-02-07 18:55:25.942526 (MainThread):                                                                ^
2022-02-07 18:55:25.942804 (MainThread): 
Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
2022-02-07 18:55:25.943117 (MainThread): Flushing usage events
2022-02-07 19:02:25.411439 (MainThread): Running with dbt=0.19.0
2022-02-07 19:02:25.502194 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-02-07 19:02:25.503066 (MainThread): Tracking: do not track
2022-02-07 19:02:25.628720 (MainThread): Partial parsing not enabled
2022-02-07 19:02:25.630440 (MainThread): Parsing macros/adapters.sql
2022-02-07 19:02:25.669398 (MainThread): Parsing macros/catalog.sql
2022-02-07 19:02:25.673000 (MainThread): Parsing macros/relations.sql
2022-02-07 19:02:25.674962 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 19:02:25.681657 (MainThread): Parsing macros/core.sql
2022-02-07 19:02:25.691508 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 19:02:25.738700 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 19:02:25.741643 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 19:02:25.744307 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 19:02:25.754546 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 19:02:25.756347 (MainThread): Parsing macros/etc/query.sql
2022-02-07 19:02:25.757718 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 19:02:25.760045 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 19:02:25.773587 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 19:02:25.809585 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 19:02:25.811968 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 19:02:25.866221 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 19:02:25.895969 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 19:02:25.906533 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 19:02:25.909509 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 19:02:25.933173 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 19:02:25.942758 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 19:02:25.951601 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 19:02:25.959567 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 19:02:25.962302 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 19:02:25.965682 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 19:02:25.968326 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 19:02:25.973437 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 19:02:25.975457 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 19:02:25.977752 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 19:02:25.979145 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 19:02:25.992046 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 19:02:25.994328 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 19:02:25.996470 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 19:02:26.000382 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 19:02:26.001648 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 19:02:26.004008 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 19:02:26.007894 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 19:02:26.009933 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 19:02:26.012017 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 19:02:26.015288 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 19:02:26.025099 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 19:02:26.028771 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 19:02:26.033191 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 19:02:26.034946 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 19:02:26.036864 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 19:02:26.039142 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 19:02:26.041253 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 19:02:26.047024 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 19:02:26.049929 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 19:02:26.052627 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 19:02:26.056271 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 19:02:26.060644 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 19:02:26.063620 (MainThread): Parsing macros/sql/star.sql
2022-02-07 19:02:26.070203 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 19:02:26.072664 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 19:02:26.078276 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 19:02:26.081766 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 19:02:26.091132 (MainThread): Parsing macros/sql/union.sql
2022-02-07 19:02:26.101314 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 19:02:26.103472 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 19:02:26.108562 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 19:02:26.113499 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 19:02:26.119664 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 19:02:26.127667 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 19:02:26.134778 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 19:02:26.138629 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 19:02:26.143444 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 19:02:26.147121 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 19:02:26.153241 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 19:02:26.155343 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 19:02:26.158712 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 19:02:26.160882 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 19:02:26.206827 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 19:02:26.211383 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 19:02:26.216750 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 19:02:26.221539 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 19:02:26.226295 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 19:02:26.239192 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 19:02:26.246818 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 19:02:26.252474 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 19:02:26.255176 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 19:02:26.257786 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 19:02:26.261645 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 19:02:26.267749 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 19:02:26.271432 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 19:02:26.278158 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 19:02:26.282328 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 19:02:26.287353 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 19:02:26.288652 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 19:02:26.291529 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 19:02:26.295625 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 19:02:26.301755 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 19:02:26.312570 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 19:02:26.316739 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 19:02:26.317481 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 19:02:26.329210 (MainThread): Parsing macros/tables/link.sql
2022-02-07 19:02:26.341059 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 19:02:26.357492 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 19:02:26.367204 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 19:02:26.372944 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 19:02:26.390897 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 19:02:26.401345 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 19:02:26.426126 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 19:02:26.427997 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 19:02:26.454433 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 19:02:26.460617 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 19:02:26.470185 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 19:02:26.472312 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 19:02:26.478464 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 19:02:26.483795 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 19:02:26.495114 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 19:02:26.551450 (MainThread): Partial parsing not enabled
2022-02-07 19:02:26.695263 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_customer_order".
2022-02-07 19:02:26.803499 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:02:26.860192 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:02:26.888342 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:02:26.911068 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:02:26.950303 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:02:26.972011 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:02:26.992699 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:02:27.011442 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_order_cnt_week".
2022-02-07 19:02:27.048514 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_customer_history".
2022-02-07 19:02:27.064792 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:02:27.194050 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:02:27.236681 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:02:27.282204 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:02:27.326862 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:02:27.367726 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 19:02:27.380535 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 19:02:28.364165 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.prestage

2022-02-07 19:02:28.532833 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 19:02:28.533625 (MainThread): Found 17 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 5 seed files, 4 sources, 0 exposures
2022-02-07 19:02:28.537894 (MainThread): 
2022-02-07 19:02:28.538942 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:02:28.546027 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 19:02:28.562431 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 19:02:28.562772 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 19:02:28.562956 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 19:02:28.580877 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 19:02:28.584286 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 19:02:28.619068 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 19:02:28.629911 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:02:28.630194 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 19:02:28.630314 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 19:02:28.644586 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:02:28.645131 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:02:28.645308 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 19:02:28.650632 (ThreadPoolExecutor-1_0): SQL status: SELECT 25 in 0.01 seconds
2022-02-07 19:02:28.669696 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 19:02:28.672034 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 19:02:28.709555 (MainThread): Using postgres connection "master".
2022-02-07 19:02:28.709788 (MainThread): On master: BEGIN
2022-02-07 19:02:28.709882 (MainThread): Opening a new connection, currently in state init
2022-02-07 19:02:28.725974 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:02:28.726247 (MainThread): Using postgres connection "master".
2022-02-07 19:02:28.726413 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 19:02:29.079970 (MainThread): SQL status: SELECT 14 in 0.35 seconds
2022-02-07 19:02:29.105879 (MainThread): On master: ROLLBACK
2022-02-07 19:02:29.107532 (MainThread): Using postgres connection "master".
2022-02-07 19:02:29.107789 (MainThread): On master: BEGIN
2022-02-07 19:02:29.109960 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:02:29.110405 (MainThread): On master: COMMIT
2022-02-07 19:02:29.110682 (MainThread): Using postgres connection "master".
2022-02-07 19:02:29.110854 (MainThread): On master: COMMIT
2022-02-07 19:02:29.113030 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:02:29.113615 (MainThread): On master: Close
2022-02-07 19:02:29.115056 (MainThread): 22:02:29 | Concurrency: 2 threads (target='dev')
2022-02-07 19:02:29.115596 (MainThread): 22:02:29 | 
2022-02-07 19:02:29.125611 (Thread-1): Began running node seed.project_otus_dbt.source_customers
2022-02-07 19:02:29.126008 (Thread-2): Began running node seed.project_otus_dbt.source_customers_crm
2022-02-07 19:02:29.128491 (Thread-1): 22:02:29 | 1 of 5 START seed file public.source_customers....................... [RUN]
2022-02-07 19:02:29.130512 (Thread-2): 22:02:29 | 2 of 5 START seed file public.source_customers_crm................... [RUN]
2022-02-07 19:02:29.131516 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_customers".
2022-02-07 19:02:29.132494 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_customers_crm".
2022-02-07 19:02:29.133413 (Thread-1): finished collecting timing info
2022-02-07 19:02:29.134342 (Thread-2): finished collecting timing info
2022-02-07 19:02:29.258690 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_customers".
2022-02-07 19:02:29.261206 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_customers_crm".
2022-02-07 19:02:29.261707 (Thread-1): On seed.project_otus_dbt.source_customers: BEGIN
2022-02-07 19:02:29.262239 (Thread-2): On seed.project_otus_dbt.source_customers_crm: BEGIN
2022-02-07 19:02:29.262977 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:02:29.263779 (Thread-2): Opening a new connection, currently in state init
2022-02-07 19:02:29.299538 (Thread-2): SQL status: BEGIN in 0.04 seconds
2022-02-07 19:02:29.299972 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_customers_crm".
2022-02-07 19:02:29.300202 (Thread-2): On seed.project_otus_dbt.source_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_customers_crm"} */
truncate table "postgres"."public"."source_customers_crm"
2022-02-07 19:02:29.310871 (Thread-2): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 19:02:29.319611 (Thread-1): SQL status: BEGIN in 0.06 seconds
2022-02-07 19:02:29.319951 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_customers".
2022-02-07 19:02:29.325383 (Thread-1): On seed.project_otus_dbt.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_customers"} */
truncate table "postgres"."public"."source_customers"
2022-02-07 19:02:29.351910 (Thread-2): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-07 19:02:29.355541 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_customers_crm".
2022-02-07 19:02:29.356354 (Thread-2): On seed.project_otus_dbt.source_customers_crm: 
            insert into "postgres"."public"."source_customers_crm" (id, country, age) values
            (%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s)...
2022-02-07 19:02:29.359265 (Thread-1): SQL status: TRUNCATE TABLE in 0.02 seconds
2022-02-07 19:02:29.372217 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_customers".
2022-02-07 19:02:29.372881 (Thread-2): SQL status: INSERT 0 78 in 0.02 seconds
2022-02-07 19:02:29.373417 (Thread-1): On seed.project_otus_dbt.source_customers: 
            insert into "postgres"."public"."source_customers" (id, first_name, last_name, email) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%...
2022-02-07 19:02:29.379886 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_customers_crm"
2022-02-07 19:02:29.396222 (Thread-1): SQL status: INSERT 0 135 in 0.02 seconds
2022-02-07 19:02:29.400247 (Thread-2): On seed.project_otus_dbt.source_customers_crm: COMMIT
2022-02-07 19:02:29.400936 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_customers"
2022-02-07 19:02:29.401376 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_customers_crm".
2022-02-07 19:02:29.401943 (Thread-2): On seed.project_otus_dbt.source_customers_crm: COMMIT
2022-02-07 19:02:29.406698 (Thread-1): On seed.project_otus_dbt.source_customers: COMMIT
2022-02-07 19:02:29.407257 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_customers".
2022-02-07 19:02:29.407893 (Thread-1): On seed.project_otus_dbt.source_customers: COMMIT
2022-02-07 19:02:29.415443 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 19:02:29.415782 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 19:02:29.419908 (Thread-1): finished collecting timing info
2022-02-07 19:02:29.422578 (Thread-2): finished collecting timing info
2022-02-07 19:02:29.423167 (Thread-1): On seed.project_otus_dbt.source_customers: Close
2022-02-07 19:02:29.423599 (Thread-2): On seed.project_otus_dbt.source_customers_crm: Close
2022-02-07 19:02:29.425975 (Thread-2): 22:02:29 | 2 of 5 OK loaded seed file public.source_customers_crm............... [INSERT 78 in 0.29s]
2022-02-07 19:02:29.427615 (Thread-1): 22:02:29 | 1 of 5 OK loaded seed file public.source_customers................... [INSERT 135 in 0.30s]
2022-02-07 19:02:29.428472 (Thread-2): Finished running node seed.project_otus_dbt.source_customers_crm
2022-02-07 19:02:29.429293 (Thread-2): Began running node seed.project_otus_dbt.source_orders
2022-02-07 19:02:29.430421 (Thread-1): Finished running node seed.project_otus_dbt.source_customers
2022-02-07 19:02:29.432980 (Thread-2): 22:02:29 | 3 of 5 START seed file public.source_orders.......................... [RUN]
2022-02-07 19:02:29.433863 (Thread-1): Began running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 19:02:29.435713 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_orders".
2022-02-07 19:02:29.437876 (Thread-1): 22:02:29 | 4 of 5 START seed file public.source_wheat_msk....................... [RUN]
2022-02-07 19:02:29.438428 (Thread-2): finished collecting timing info
2022-02-07 19:02:29.439621 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 19:02:29.449676 (Thread-1): finished collecting timing info
2022-02-07 19:02:29.533904 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_orders".
2022-02-07 19:02:29.534261 (Thread-2): On seed.project_otus_dbt.source_orders: BEGIN
2022-02-07 19:02:29.553716 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 19:02:29.602242 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 19:02:29.602546 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: BEGIN
2022-02-07 19:02:29.602629 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:02:29.606324 (Thread-2): SQL status: BEGIN in 0.05 seconds
2022-02-07 19:02:29.606629 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_orders".
2022-02-07 19:02:29.606740 (Thread-2): On seed.project_otus_dbt.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_orders"} */
truncate table "postgres"."public"."source_orders"
2022-02-07 19:02:29.615111 (Thread-2): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 19:02:29.619824 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_orders".
2022-02-07 19:02:29.620086 (Thread-2): On seed.project_otus_dbt.source_orders: 
            insert into "postgres"."public"."source_orders" (id, user_id, order_date, status) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s...
2022-02-07 19:02:29.625535 (Thread-2): SQL status: INSERT 0 99 in 0.01 seconds
2022-02-07 19:02:29.627544 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_orders"
2022-02-07 19:02:29.632169 (Thread-2): On seed.project_otus_dbt.source_orders: COMMIT
2022-02-07 19:02:29.632439 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_orders".
2022-02-07 19:02:29.632545 (Thread-2): On seed.project_otus_dbt.source_orders: COMMIT
2022-02-07 19:02:29.636633 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:02:29.639715 (Thread-2): finished collecting timing info
2022-02-07 19:02:29.640104 (Thread-2): On seed.project_otus_dbt.source_orders: Close
2022-02-07 19:02:29.641149 (Thread-2): 22:02:29 | 3 of 5 OK loaded seed file public.source_orders...................... [INSERT 99 in 0.21s]
2022-02-07 19:02:29.641629 (Thread-2): Finished running node seed.project_otus_dbt.source_orders
2022-02-07 19:02:29.642179 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 19:02:29.646346 (Thread-2): 22:02:29 | 5 of 5 START seed file public.source_wheat_usa....................... [RUN]
2022-02-07 19:02:29.647317 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 19:02:29.647855 (Thread-2): finished collecting timing info
2022-02-07 19:02:29.689787 (Thread-1): SQL status: BEGIN in 0.09 seconds
2022-02-07 19:02:29.695505 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 19:02:29.701071 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_msk"} */
truncate table "postgres"."public"."source_wheat_msk"
2022-02-07 19:02:29.710032 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 19:02:29.710463 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: BEGIN
2022-02-07 19:02:29.710740 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 19:02:29.726066 (Thread-1): SQL status: TRUNCATE TABLE in 0.02 seconds
2022-02-07 19:02:29.743342 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 19:02:29.743921 (Thread-2): SQL status: BEGIN in 0.03 seconds
2022-02-07 19:02:29.744278 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: 
            insert into "postgres"."public"."source_wheat_msk" (BOARDID, SECID, TRADEDATE, SHORTNAME, NAME, CLOSE, OPEN, HIGH, LOW, VALUE, DURATION, YIELD, DECIMALS, CAPITALIZATION, CURRENCYID, DIVISOR, TRADINGSESSION, VOLUME) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%...
2022-02-07 19:02:29.744802 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 19:02:29.750927 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_usa"} */
truncate table "postgres"."public"."source_wheat_usa"
2022-02-07 19:02:29.770543 (Thread-2): SQL status: TRUNCATE TABLE in 0.02 seconds
2022-02-07 19:02:29.787776 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 19:02:29.788908 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: 
            insert into "postgres"."public"."source_wheat_usa" (BOARDID, SECID, TRADEDATE, SHORTNAME, NAME, CLOSE, OPEN, HIGH, LOW, VALUE, DURATION, YIELD, DECIMALS, CAPITALIZATION, CURRENCYID, DIVISOR, TRADINGSESSION, VOLUME) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%...
2022-02-07 19:02:29.825115 (Thread-1): SQL status: INSERT 0 216 in 0.08 seconds
2022-02-07 19:02:29.826237 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_msk"
2022-02-07 19:02:29.833399 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 19:02:29.833723 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 19:02:29.833862 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 19:02:29.838029 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:02:29.842420 (Thread-1): finished collecting timing info
2022-02-07 19:02:29.843191 (Thread-2): Postgres error: column "boardid" of relation "source_wheat_usa" does not exist
LINE 2: ...sert into "postgres"."public"."source_wheat_usa" (BOARDID, S...
                                                             ^

2022-02-07 19:02:29.843634 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: Close
2022-02-07 19:02:29.844634 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: ROLLBACK
2022-02-07 19:02:29.847262 (Thread-1): 22:02:29 | 4 of 5 OK loaded seed file public.source_wheat_msk................... [INSERT 216 in 0.41s]
2022-02-07 19:02:29.847902 (Thread-1): Finished running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 19:02:29.848458 (Thread-2): finished collecting timing info
2022-02-07 19:02:29.850275 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: Close
2022-02-07 19:02:29.851340 (Thread-2): Database Error in seed source_wheat_usa (data/source_wheat_usa.csv)
  column "boardid" of relation "source_wheat_usa" does not exist
  LINE 2: ...sert into "postgres"."public"."source_wheat_usa" (BOARDID, S...
                                                               ^
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "boardid" of relation "source_wheat_usa" does not exist
LINE 2: ...sert into "postgres"."public"."source_wheat_usa" (BOARDID, S...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 89, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 21, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 23, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 111, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/impl.py", line 63, in add_query
    return self.connections.add_query(sql, auto_begin, bindings,
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in seed source_wheat_usa (data/source_wheat_usa.csv)
  column "boardid" of relation "source_wheat_usa" does not exist
  LINE 2: ...sert into "postgres"."public"."source_wheat_usa" (BOARDID, S...
                                                               ^
2022-02-07 19:02:29.856182 (Thread-2): 22:02:29 | 5 of 5 ERROR loading seed file public.source_wheat_usa............... [ERROR in 0.21s]
2022-02-07 19:02:29.856552 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 19:02:29.859784 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:02:29.860203 (MainThread): Using postgres connection "master".
2022-02-07 19:02:29.860441 (MainThread): On master: BEGIN
2022-02-07 19:02:29.860725 (MainThread): Opening a new connection, currently in state closed
2022-02-07 19:02:29.877873 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:02:29.878183 (MainThread): On master: COMMIT
2022-02-07 19:02:29.878275 (MainThread): Using postgres connection "master".
2022-02-07 19:02:29.878421 (MainThread): On master: COMMIT
2022-02-07 19:02:29.880400 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:02:29.881413 (MainThread): On master: Close
2022-02-07 19:02:29.882759 (MainThread): 22:02:29 | 
2022-02-07 19:02:29.883176 (MainThread): 22:02:29 | Finished running 5 seeds in 1.34s.
2022-02-07 19:02:29.883500 (MainThread): Connection 'master' was properly closed.
2022-02-07 19:02:29.883735 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_msk' was properly closed.
2022-02-07 19:02:29.883913 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_usa' was properly closed.
2022-02-07 19:02:30.020887 (MainThread): 
2022-02-07 19:02:30.021331 (MainThread): Completed with 1 error and 0 warnings:
2022-02-07 19:02:30.021734 (MainThread): 
2022-02-07 19:02:30.022104 (MainThread): Database Error in seed source_wheat_usa (data/source_wheat_usa.csv)
2022-02-07 19:02:30.022528 (MainThread):   column "boardid" of relation "source_wheat_usa" does not exist
2022-02-07 19:02:30.022958 (MainThread):   LINE 2: ...sert into "postgres"."public"."source_wheat_usa" (BOARDID, S...
2022-02-07 19:02:30.023309 (MainThread):                                                                ^
2022-02-07 19:02:30.023821 (MainThread): 
Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
2022-02-07 19:02:30.024569 (MainThread): Flushing usage events
2022-02-07 19:26:25.768023 (MainThread): Running with dbt=0.19.0
2022-02-07 19:26:25.876543 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-02-07 19:26:25.878584 (MainThread): Tracking: do not track
2022-02-07 19:26:26.007431 (MainThread): Partial parsing not enabled
2022-02-07 19:26:26.008936 (MainThread): Parsing macros/adapters.sql
2022-02-07 19:26:26.032616 (MainThread): Parsing macros/catalog.sql
2022-02-07 19:26:26.035224 (MainThread): Parsing macros/relations.sql
2022-02-07 19:26:26.036886 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 19:26:26.039488 (MainThread): Parsing macros/core.sql
2022-02-07 19:26:26.043179 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 19:26:26.080290 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 19:26:26.082285 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 19:26:26.084073 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 19:26:26.092335 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 19:26:26.093953 (MainThread): Parsing macros/etc/query.sql
2022-02-07 19:26:26.095020 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 19:26:26.095966 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 19:26:26.110424 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 19:26:26.144283 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 19:26:26.146768 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 19:26:26.183692 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 19:26:26.200024 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 19:26:26.205644 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 19:26:26.207514 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 19:26:26.219888 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 19:26:26.224431 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 19:26:26.230997 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 19:26:26.237073 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 19:26:26.238945 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 19:26:26.240547 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 19:26:26.242432 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 19:26:26.246660 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 19:26:26.248857 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 19:26:26.251198 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 19:26:26.252474 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 19:26:26.262473 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 19:26:26.264840 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 19:26:26.266758 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 19:26:26.269726 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 19:26:26.271019 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 19:26:26.273438 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 19:26:26.277001 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 19:26:26.279403 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 19:26:26.282681 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 19:26:26.285205 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 19:26:26.292068 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 19:26:26.295469 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 19:26:26.298337 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 19:26:26.300028 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 19:26:26.301888 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 19:26:26.303375 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 19:26:26.304884 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 19:26:26.310793 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 19:26:26.312219 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 19:26:26.313835 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 19:26:26.315814 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 19:26:26.318775 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 19:26:26.320654 (MainThread): Parsing macros/sql/star.sql
2022-02-07 19:26:26.324609 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 19:26:26.326580 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 19:26:26.331361 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 19:26:26.333341 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 19:26:26.340717 (MainThread): Parsing macros/sql/union.sql
2022-02-07 19:26:26.349320 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 19:26:26.351540 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 19:26:26.356086 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 19:26:26.359803 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 19:26:26.363339 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 19:26:26.369658 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 19:26:26.374309 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 19:26:26.376428 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 19:26:26.378906 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 19:26:26.381522 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 19:26:26.385865 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 19:26:26.387568 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 19:26:26.389114 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 19:26:26.390670 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 19:26:26.413304 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 19:26:26.415336 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 19:26:26.418566 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 19:26:26.420879 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 19:26:26.423106 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 19:26:26.429218 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 19:26:26.433244 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 19:26:26.443795 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 19:26:26.446884 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 19:26:26.450182 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 19:26:26.453214 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 19:26:26.456951 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 19:26:26.459718 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 19:26:26.466353 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 19:26:26.469950 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 19:26:26.474568 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 19:26:26.475945 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 19:26:26.480550 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 19:26:26.485644 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 19:26:26.492575 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 19:26:26.512276 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 19:26:26.519018 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 19:26:26.520213 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 19:26:26.538942 (MainThread): Parsing macros/tables/link.sql
2022-02-07 19:26:26.554404 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 19:26:26.571974 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 19:26:26.586219 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 19:26:26.594262 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 19:26:26.613637 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 19:26:26.621737 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 19:26:26.643583 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 19:26:26.645313 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 19:26:26.667223 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 19:26:26.675045 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 19:26:26.683135 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 19:26:26.684836 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 19:26:26.692595 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 19:26:26.695627 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 19:26:26.708261 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 19:26:26.719187 (MainThread): Partial parsing not enabled
2022-02-07 19:26:26.835411 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_customer_order".
2022-02-07 19:26:26.925054 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:26:27.007740 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:26:27.049580 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:26:27.080795 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:26:27.122899 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:26:27.158311 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:26:27.185312 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:26:27.212370 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_order_cnt_week".
2022-02-07 19:26:27.263481 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_customer_history".
2022-02-07 19:26:27.286276 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:26:27.391662 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:26:27.411865 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:26:27.431395 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:26:27.453228 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:26:27.473817 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 19:26:27.484086 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 19:26:28.313962 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.prestage

2022-02-07 19:26:28.529290 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 19:26:28.530303 (MainThread): Found 17 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 5 seed files, 4 sources, 0 exposures
2022-02-07 19:26:28.534128 (MainThread): 
2022-02-07 19:26:28.535206 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:26:28.545620 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 19:26:28.560597 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 19:26:28.560843 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 19:26:28.560945 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 19:26:28.579388 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 19:26:28.585018 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 19:26:28.615775 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 19:26:28.622914 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:26:28.623200 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 19:26:28.623306 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 19:26:28.641183 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:26:28.641642 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:26:28.641923 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 19:26:28.650305 (ThreadPoolExecutor-1_0): SQL status: SELECT 22 in 0.01 seconds
2022-02-07 19:26:28.687785 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 19:26:28.689624 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 19:26:28.763883 (MainThread): Using postgres connection "master".
2022-02-07 19:26:28.764160 (MainThread): On master: BEGIN
2022-02-07 19:26:28.764283 (MainThread): Opening a new connection, currently in state init
2022-02-07 19:26:28.780293 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:26:28.780713 (MainThread): Using postgres connection "master".
2022-02-07 19:26:28.780978 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 19:26:29.190916 (MainThread): SQL status: SELECT 13 in 0.41 seconds
2022-02-07 19:26:29.206852 (MainThread): On master: ROLLBACK
2022-02-07 19:26:29.208527 (MainThread): Using postgres connection "master".
2022-02-07 19:26:29.208774 (MainThread): On master: BEGIN
2022-02-07 19:26:29.211320 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:26:29.211585 (MainThread): On master: COMMIT
2022-02-07 19:26:29.211760 (MainThread): Using postgres connection "master".
2022-02-07 19:26:29.211921 (MainThread): On master: COMMIT
2022-02-07 19:26:29.213138 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:26:29.213375 (MainThread): On master: Close
2022-02-07 19:26:29.214048 (MainThread): 22:26:29 | Concurrency: 2 threads (target='dev')
2022-02-07 19:26:29.214343 (MainThread): 22:26:29 | 
2022-02-07 19:26:29.222962 (Thread-1): Began running node seed.project_otus_dbt.source_customers
2022-02-07 19:26:29.225086 (Thread-1): 22:26:29 | 1 of 5 START seed file public.source_customers....................... [RUN]
2022-02-07 19:26:29.225876 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_customers".
2022-02-07 19:26:29.227306 (Thread-2): Began running node seed.project_otus_dbt.source_customers_crm
2022-02-07 19:26:29.227829 (Thread-1): finished collecting timing info
2022-02-07 19:26:29.230421 (Thread-2): 22:26:29 | 2 of 5 START seed file public.source_customers_crm................... [RUN]
2022-02-07 19:26:29.241966 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_customers_crm".
2022-02-07 19:26:29.247655 (Thread-2): finished collecting timing info
2022-02-07 19:26:29.284659 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_customers".
2022-02-07 19:26:29.285146 (Thread-1): On seed.project_otus_dbt.source_customers: BEGIN
2022-02-07 19:26:29.285419 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:26:29.298495 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_customers_crm".
2022-02-07 19:26:29.299220 (Thread-2): On seed.project_otus_dbt.source_customers_crm: BEGIN
2022-02-07 19:26:29.299872 (Thread-2): Opening a new connection, currently in state init
2022-02-07 19:26:29.302992 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:26:29.303348 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_customers".
2022-02-07 19:26:29.303552 (Thread-1): On seed.project_otus_dbt.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_customers"} */
truncate table "postgres"."public"."source_customers"
2022-02-07 19:26:29.312769 (Thread-1): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 19:26:29.321320 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:26:29.334601 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-07 19:26:29.334992 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_customers_crm".
2022-02-07 19:26:29.338798 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_customers".
2022-02-07 19:26:29.339680 (Thread-2): On seed.project_otus_dbt.source_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_customers_crm"} */
truncate table "postgres"."public"."source_customers_crm"
2022-02-07 19:26:29.340129 (Thread-1): On seed.project_otus_dbt.source_customers: 
            insert into "postgres"."public"."source_customers" (id, first_name, last_name, email) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%...
2022-02-07 19:26:29.349072 (Thread-1): SQL status: INSERT 0 135 in 0.01 seconds
2022-02-07 19:26:29.349737 (Thread-2): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 19:26:29.354890 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_customers"
2022-02-07 19:26:29.361904 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_customers_crm".
2022-02-07 19:26:29.362834 (Thread-2): On seed.project_otus_dbt.source_customers_crm: 
            insert into "postgres"."public"."source_customers_crm" (id, country, age) values
            (%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s)...
2022-02-07 19:26:29.372908 (Thread-2): SQL status: INSERT 0 78 in 0.01 seconds
2022-02-07 19:26:29.376258 (Thread-1): On seed.project_otus_dbt.source_customers: COMMIT
2022-02-07 19:26:29.377265 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_customers_crm"
2022-02-07 19:26:29.377628 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_customers".
2022-02-07 19:26:29.378460 (Thread-1): On seed.project_otus_dbt.source_customers: COMMIT
2022-02-07 19:26:29.385301 (Thread-2): On seed.project_otus_dbt.source_customers_crm: COMMIT
2022-02-07 19:26:29.385824 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 19:26:29.386287 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_customers_crm".
2022-02-07 19:26:29.389038 (Thread-1): finished collecting timing info
2022-02-07 19:26:29.389787 (Thread-2): On seed.project_otus_dbt.source_customers_crm: COMMIT
2022-02-07 19:26:29.390266 (Thread-1): On seed.project_otus_dbt.source_customers: Close
2022-02-07 19:26:29.391792 (Thread-1): 22:26:29 | 1 of 5 OK loaded seed file public.source_customers................... [INSERT 135 in 0.17s]
2022-02-07 19:26:29.392171 (Thread-1): Finished running node seed.project_otus_dbt.source_customers
2022-02-07 19:26:29.392628 (Thread-1): Began running node seed.project_otus_dbt.source_orders
2022-02-07 19:26:29.395858 (Thread-1): 22:26:29 | 3 of 5 START seed file public.source_orders.......................... [RUN]
2022-02-07 19:26:29.396152 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 19:26:29.397007 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_orders".
2022-02-07 19:26:29.400784 (Thread-2): finished collecting timing info
2022-02-07 19:26:29.401604 (Thread-1): finished collecting timing info
2022-02-07 19:26:29.402123 (Thread-2): On seed.project_otus_dbt.source_customers_crm: Close
2022-02-07 19:26:29.490610 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_orders".
2022-02-07 19:26:29.491229 (Thread-1): On seed.project_otus_dbt.source_orders: BEGIN
2022-02-07 19:26:29.491446 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:26:29.492333 (Thread-2): 22:26:29 | 2 of 5 OK loaded seed file public.source_customers_crm............... [INSERT 78 in 0.25s]
2022-02-07 19:26:29.493130 (Thread-2): Finished running node seed.project_otus_dbt.source_customers_crm
2022-02-07 19:26:29.493462 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 19:26:29.496196 (Thread-2): 22:26:29 | 4 of 5 START seed file public.source_wheat_msk....................... [RUN]
2022-02-07 19:26:29.497224 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 19:26:29.497709 (Thread-2): finished collecting timing info
2022-02-07 19:26:29.521463 (Thread-1): SQL status: BEGIN in 0.03 seconds
2022-02-07 19:26:29.527133 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_orders".
2022-02-07 19:26:29.532623 (Thread-1): On seed.project_otus_dbt.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_orders"} */
truncate table "postgres"."public"."source_orders"
2022-02-07 19:26:29.550970 (Thread-1): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 19:26:29.558626 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 19:26:29.563324 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_orders".
2022-02-07 19:26:29.563834 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: BEGIN
2022-02-07 19:26:29.564347 (Thread-1): On seed.project_otus_dbt.source_orders: 
            insert into "postgres"."public"."source_orders" (id, user_id, order_date, status) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s...
2022-02-07 19:26:29.564802 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 19:26:29.569644 (Thread-1): SQL status: INSERT 0 99 in 0.00 seconds
2022-02-07 19:26:29.570862 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_orders"
2022-02-07 19:26:29.578747 (Thread-1): On seed.project_otus_dbt.source_orders: COMMIT
2022-02-07 19:26:29.579291 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_orders".
2022-02-07 19:26:29.579891 (Thread-1): On seed.project_otus_dbt.source_orders: COMMIT
2022-02-07 19:26:29.581867 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:26:29.582270 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 19:26:29.582493 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_msk"} */
truncate table "postgres"."public"."source_wheat_msk"
2022-02-07 19:26:29.584263 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:26:29.588134 (Thread-1): finished collecting timing info
2022-02-07 19:26:29.588671 (Thread-1): On seed.project_otus_dbt.source_orders: Close
2022-02-07 19:26:29.590520 (Thread-1): 22:26:29 | 3 of 5 OK loaded seed file public.source_orders...................... [INSERT 99 in 0.19s]
2022-02-07 19:26:29.590895 (Thread-2): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 19:26:29.591505 (Thread-1): Finished running node seed.project_otus_dbt.source_orders
2022-02-07 19:26:29.602834 (Thread-1): Began running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 19:26:29.610942 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 19:26:29.613338 (Thread-1): 22:26:29 | 5 of 5 START seed file public.source_wheat_usa....................... [RUN]
2022-02-07 19:26:29.613874 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: 
            insert into "postgres"."public"."source_wheat_msk" (BOARDID, SECID, TRADEDATE, SHORTNAME, NAME, CLOSE, OPEN, HIGH, LOW, VALUE, DURATION, YIELD, DECIMALS, CAPITALIZATION, CURRENCYID, DIVISOR, TRADINGSESSION, VOLUME) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%...
2022-02-07 19:26:29.614813 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 19:26:29.620577 (Thread-1): finished collecting timing info
2022-02-07 19:26:29.651475 (Thread-2): SQL status: INSERT 0 216 in 0.04 seconds
2022-02-07 19:26:29.657646 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_msk"
2022-02-07 19:26:29.667270 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 19:26:29.667821 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: BEGIN
2022-02-07 19:26:29.668146 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:26:29.671650 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 19:26:29.672321 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 19:26:29.672587 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 19:26:29.677190 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:26:29.680566 (Thread-2): finished collecting timing info
2022-02-07 19:26:29.681983 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: Close
2022-02-07 19:26:29.683931 (Thread-2): 22:26:29 | 4 of 5 OK loaded seed file public.source_wheat_msk................... [INSERT 216 in 0.19s]
2022-02-07 19:26:29.685877 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 19:26:29.686991 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:26:29.687855 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 19:26:29.688200 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_usa"} */

    create table "postgres"."public"."source_wheat_usa" (TRADEDATE text,VALUE integer,OPEN integer,HIGH integer,LOW integer,VOLUME text,CHANGEPERC integer)
  
2022-02-07 19:26:29.709750 (Thread-1): SQL status: CREATE TABLE in 0.02 seconds
2022-02-07 19:26:29.719388 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 19:26:29.719713 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: 
            insert into "postgres"."public"."source_wheat_usa" (TRADEDATE, VALUE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-07 19:26:29.729042 (Thread-1): SQL status: INSERT 0 283 in 0.01 seconds
2022-02-07 19:26:29.729696 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_usa"
2022-02-07 19:26:29.733753 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-07 19:26:29.733999 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 19:26:29.734075 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-07 19:26:29.737451 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:26:29.739583 (Thread-1): finished collecting timing info
2022-02-07 19:26:29.739947 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: Close
2022-02-07 19:26:29.740846 (Thread-1): 22:26:29 | 5 of 5 OK loaded seed file public.source_wheat_usa................... [INSERT 283 in 0.13s]
2022-02-07 19:26:29.741149 (Thread-1): Finished running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 19:26:29.744103 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:26:29.744497 (MainThread): Using postgres connection "master".
2022-02-07 19:26:29.744799 (MainThread): On master: BEGIN
2022-02-07 19:26:29.745049 (MainThread): Opening a new connection, currently in state closed
2022-02-07 19:26:29.757868 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:26:29.758179 (MainThread): On master: COMMIT
2022-02-07 19:26:29.758308 (MainThread): Using postgres connection "master".
2022-02-07 19:26:29.758440 (MainThread): On master: COMMIT
2022-02-07 19:26:29.759718 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:26:29.759990 (MainThread): On master: Close
2022-02-07 19:26:29.760692 (MainThread): 22:26:29 | 
2022-02-07 19:26:29.761033 (MainThread): 22:26:29 | Finished running 5 seeds in 1.23s.
2022-02-07 19:26:29.761289 (MainThread): Connection 'master' was properly closed.
2022-02-07 19:26:29.761443 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_usa' was properly closed.
2022-02-07 19:26:29.761593 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_msk' was properly closed.
2022-02-07 19:26:29.909743 (MainThread): 
2022-02-07 19:26:29.910049 (MainThread): Completed successfully
2022-02-07 19:26:29.910240 (MainThread): 
Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
2022-02-07 19:26:29.910620 (MainThread): Flushing usage events
2022-02-07 19:29:32.347693 (MainThread): Running with dbt=0.19.0
2022-02-07 19:29:32.429249 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:stage'], partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 19:29:32.431113 (MainThread): Tracking: do not track
2022-02-07 19:29:32.507258 (MainThread): Partial parsing not enabled
2022-02-07 19:29:32.509024 (MainThread): Parsing macros/adapters.sql
2022-02-07 19:29:32.535047 (MainThread): Parsing macros/catalog.sql
2022-02-07 19:29:32.537378 (MainThread): Parsing macros/relations.sql
2022-02-07 19:29:32.538964 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 19:29:32.541459 (MainThread): Parsing macros/core.sql
2022-02-07 19:29:32.545476 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 19:29:32.594631 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 19:29:32.596660 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 19:29:32.598318 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 19:29:32.607741 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 19:29:32.609515 (MainThread): Parsing macros/etc/query.sql
2022-02-07 19:29:32.610825 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 19:29:32.611999 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 19:29:32.621745 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 19:29:32.642378 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 19:29:32.644431 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 19:29:32.677403 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 19:29:32.700198 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 19:29:32.707416 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 19:29:32.709887 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 19:29:32.724878 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 19:29:32.732023 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 19:29:32.741121 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 19:29:32.751863 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 19:29:32.755036 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 19:29:32.757638 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 19:29:32.760769 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 19:29:32.766701 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 19:29:32.769681 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 19:29:32.772824 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 19:29:32.775021 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 19:29:32.789793 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 19:29:32.793076 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 19:29:32.796308 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 19:29:32.800318 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 19:29:32.802000 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 19:29:32.805695 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 19:29:32.811134 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 19:29:32.814104 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 19:29:32.817185 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 19:29:32.820950 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 19:29:32.830075 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 19:29:32.833464 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 19:29:32.835889 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 19:29:32.837245 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 19:29:32.838941 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 19:29:32.840393 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 19:29:32.842283 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 19:29:32.847213 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 19:29:32.848572 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 19:29:32.850208 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 19:29:32.852458 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 19:29:32.855324 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 19:29:32.857253 (MainThread): Parsing macros/sql/star.sql
2022-02-07 19:29:32.860930 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 19:29:32.862749 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 19:29:32.866680 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 19:29:32.868503 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 19:29:32.875822 (MainThread): Parsing macros/sql/union.sql
2022-02-07 19:29:32.883805 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 19:29:32.886166 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 19:29:32.890597 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 19:29:32.894162 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 19:29:32.897784 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 19:29:32.903786 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 19:29:32.908851 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 19:29:32.910599 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 19:29:32.912413 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 19:29:32.915135 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 19:29:32.919196 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 19:29:32.921047 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 19:29:32.922502 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 19:29:32.923836 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 19:29:32.949407 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 19:29:32.951682 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 19:29:32.955061 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 19:29:32.957914 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 19:29:32.960133 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 19:29:32.966273 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 19:29:32.970732 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 19:29:32.973625 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 19:29:32.975558 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 19:29:32.977517 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 19:29:32.979942 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 19:29:32.983313 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 19:29:32.985696 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 19:29:32.991979 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 19:29:32.996744 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 19:29:33.006913 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 19:29:33.009274 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 19:29:33.016231 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 19:29:33.025489 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 19:29:33.038319 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 19:29:33.054867 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 19:29:33.059856 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 19:29:33.060637 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 19:29:33.074149 (MainThread): Parsing macros/tables/link.sql
2022-02-07 19:29:33.098687 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 19:29:33.125459 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 19:29:33.145479 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 19:29:33.150316 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 19:29:33.168733 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 19:29:33.177387 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 19:29:33.198561 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 19:29:33.200253 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 19:29:33.246662 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 19:29:33.256521 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 19:29:33.266165 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 19:29:33.270204 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 19:29:33.288807 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 19:29:33.295663 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 19:29:33.312102 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 19:29:33.324008 (MainThread): Partial parsing not enabled
2022-02-07 19:29:33.448262 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_customer_order".
2022-02-07 19:29:33.551356 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:29:33.624485 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:29:33.648334 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:29:33.671592 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:29:33.710950 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:29:33.731555 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:29:33.751310 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:29:33.768386 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_order_cnt_week".
2022-02-07 19:29:33.802389 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_customer_history".
2022-02-07 19:29:33.817906 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:29:33.957782 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:29:33.987626 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:29:34.010502 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:29:34.029783 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:29:34.048456 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 19:29:34.060500 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 19:29:34.887195 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.prestage

2022-02-07 19:29:35.113363 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 19:29:35.114872 (MainThread): Found 17 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 5 seed files, 4 sources, 0 exposures
2022-02-07 19:29:35.119330 (MainThread): 
2022-02-07 19:29:35.120617 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:29:35.136940 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 19:29:35.153700 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 19:29:35.153997 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 19:29:35.154146 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 19:29:35.174474 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 19:29:35.180048 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 19:29:35.225235 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 19:29:35.234108 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:29:35.234468 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 19:29:35.234687 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 19:29:35.247708 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:29:35.248045 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:29:35.248240 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 19:29:35.253041 (ThreadPoolExecutor-1_0): SQL status: SELECT 23 in 0.00 seconds
2022-02-07 19:29:35.271650 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 19:29:35.273249 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 19:29:35.308398 (MainThread): Using postgres connection "master".
2022-02-07 19:29:35.308682 (MainThread): On master: BEGIN
2022-02-07 19:29:35.308812 (MainThread): Opening a new connection, currently in state init
2022-02-07 19:29:35.321229 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:29:35.321605 (MainThread): Using postgres connection "master".
2022-02-07 19:29:35.321817 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 19:29:35.608919 (MainThread): SQL status: SELECT 13 in 0.29 seconds
2022-02-07 19:29:35.625096 (MainThread): On master: ROLLBACK
2022-02-07 19:29:35.626564 (MainThread): Using postgres connection "master".
2022-02-07 19:29:35.626787 (MainThread): On master: BEGIN
2022-02-07 19:29:35.628887 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:29:35.629135 (MainThread): On master: COMMIT
2022-02-07 19:29:35.629473 (MainThread): Using postgres connection "master".
2022-02-07 19:29:35.629639 (MainThread): On master: COMMIT
2022-02-07 19:29:35.630829 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:29:35.631070 (MainThread): On master: Close
2022-02-07 19:29:35.631701 (MainThread): 22:29:35 | Concurrency: 2 threads (target='dev')
2022-02-07 19:29:35.631989 (MainThread): 22:29:35 | 
2022-02-07 19:29:35.675086 (Thread-1): Began running node model.project_otus_dbt.v_stg_customers
2022-02-07 19:29:35.675597 (Thread-2): Began running node model.project_otus_dbt.v_stg_customers_crm
2022-02-07 19:29:35.678536 (Thread-1): 22:29:35 | 1 of 5 START view model public.v_stg_customers....................... [RUN]
2022-02-07 19:29:35.681231 (Thread-2): 22:29:35 | 2 of 5 START view model public.v_stg_customers_crm................... [RUN]
2022-02-07 19:29:35.682988 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:29:35.684561 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:29:35.685110 (Thread-1): Compiling model.project_otus_dbt.v_stg_customers
2022-02-07 19:29:35.685719 (Thread-2): Compiling model.project_otus_dbt.v_stg_customers_crm
2022-02-07 19:29:35.835292 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:29:35.830404 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:29:35.835998 (Thread-1): On model.project_otus_dbt.v_stg_customers: BEGIN
2022-02-07 19:29:35.836582 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: BEGIN
2022-02-07 19:29:35.837150 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:29:35.837660 (Thread-2): Opening a new connection, currently in state init
2022-02-07 19:29:35.861455 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:29:35.861975 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:29:35.862445 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers_crm'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:29:35.894095 (Thread-1): SQL status: BEGIN in 0.06 seconds
2022-02-07 19:29:35.894703 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:29:35.895138 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:29:35.907155 (Thread-2): SQL status: SELECT 3 in 0.04 seconds
2022-02-07 19:29:35.928788 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:29:35.929519 (Thread-1): SQL status: SELECT 4 in 0.03 seconds
2022-02-07 19:29:35.930062 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers_crm'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:29:36.030027 (Thread-2): SQL status: SELECT 3 in 0.09 seconds
2022-02-07 19:29:36.048758 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:29:36.057627 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_customers_crm"
2022-02-07 19:29:36.058059 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:29:36.067713 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 19:29:36.079683 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_customers"
2022-02-07 19:29:36.094245 (Thread-2): finished collecting timing info
2022-02-07 19:29:36.111842 (Thread-1): finished collecting timing info
2022-02-07 19:29:36.210945 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:29:36.212747 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:29:36.213187 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */
drop view if exists "postgres"."public"."v_stg_customers_crm__dbt_tmp" cascade
2022-02-07 19:29:36.213732 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */
drop view if exists "postgres"."public"."v_stg_customers__dbt_tmp" cascade
2022-02-07 19:29:36.220968 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 19:29:36.221421 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 19:29:36.228056 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:29:36.238040 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:29:36.238494 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */
drop view if exists "postgres"."public"."v_stg_customers__dbt_backup" cascade
2022-02-07 19:29:36.239040 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */
drop view if exists "postgres"."public"."v_stg_customers_crm__dbt_backup" cascade
2022-02-07 19:29:36.242319 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:29:36.242846 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:29:36.256646 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_customers_crm"
2022-02-07 19:29:36.254209 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_customers"
2022-02-07 19:29:36.258402 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:29:36.258926 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */

  create view "postgres"."public"."v_stg_customers_crm__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    country,
    age

    FROM "postgres"."public"."source_customers_crm"
),

derived_columns AS (

    SELECT

    id,
    country,
    age,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS_CRM'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    country,
    age,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(age AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(country AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    country,
    age,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 19:29:36.259421 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:29:36.260304 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */

  create view "postgres"."public"."v_stg_customers__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    first_name,
    last_name,
    email

    FROM "postgres"."public"."source_customers"
),

derived_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(email AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(first_name AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(last_name AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 19:29:36.279105 (Thread-1): SQL status: CREATE VIEW in 0.02 seconds
2022-02-07 19:29:36.279651 (Thread-2): SQL status: CREATE VIEW in 0.02 seconds
2022-02-07 19:29:36.316370 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:29:36.316969 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:29:36.317369 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */
alter table "postgres"."public"."v_stg_customers_crm" rename to "v_stg_customers_crm__dbt_backup"
2022-02-07 19:29:36.317891 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */
alter table "postgres"."public"."v_stg_customers" rename to "v_stg_customers__dbt_backup"
2022-02-07 19:29:36.327212 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 19:29:36.327686 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 19:29:36.335382 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:29:36.342525 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:29:36.342987 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */
alter table "postgres"."public"."v_stg_customers__dbt_tmp" rename to "v_stg_customers"
2022-02-07 19:29:36.343564 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */
alter table "postgres"."public"."v_stg_customers_crm__dbt_tmp" rename to "v_stg_customers_crm"
2022-02-07 19:29:36.348110 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:29:36.348611 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:29:36.370451 (Thread-1): On model.project_otus_dbt.v_stg_customers: COMMIT
2022-02-07 19:29:36.376483 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:29:36.376900 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: COMMIT
2022-02-07 19:29:36.377346 (Thread-1): On model.project_otus_dbt.v_stg_customers: COMMIT
2022-02-07 19:29:36.377891 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:29:36.378851 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: COMMIT
2022-02-07 19:29:36.384325 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 19:29:36.391572 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 19:29:36.395220 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:29:36.400371 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:29:36.400986 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */
drop view if exists "postgres"."public"."v_stg_customers__dbt_backup" cascade
2022-02-07 19:29:36.401458 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */
drop view if exists "postgres"."public"."v_stg_customers_crm__dbt_backup" cascade
2022-02-07 19:29:36.411335 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 19:29:36.417312 (Thread-1): finished collecting timing info
2022-02-07 19:29:36.417955 (Thread-2): SQL status: DROP VIEW in 0.02 seconds
2022-02-07 19:29:36.418708 (Thread-1): On model.project_otus_dbt.v_stg_customers: Close
2022-02-07 19:29:36.425463 (Thread-2): finished collecting timing info
2022-02-07 19:29:36.426635 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: Close
2022-02-07 19:29:36.431168 (Thread-1): 22:29:36 | 1 of 5 OK created view model public.v_stg_customers.................. [CREATE VIEW in 0.75s]
2022-02-07 19:29:36.432356 (Thread-1): Finished running node model.project_otus_dbt.v_stg_customers
2022-02-07 19:29:36.433100 (Thread-1): Began running node model.project_otus_dbt.v_stg_orders
2022-02-07 19:29:36.437579 (Thread-1): 22:29:36 | 3 of 5 START view model public.v_stg_orders.......................... [RUN]
2022-02-07 19:29:36.442811 (Thread-2): 22:29:36 | 2 of 5 OK created view model public.v_stg_customers_crm.............. [CREATE VIEW in 0.76s]
2022-02-07 19:29:36.443819 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:29:36.444448 (Thread-2): Finished running node model.project_otus_dbt.v_stg_customers_crm
2022-02-07 19:29:36.444988 (Thread-1): Compiling model.project_otus_dbt.v_stg_orders
2022-02-07 19:29:36.445999 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 19:29:36.460348 (Thread-2): 22:29:36 | 4 of 5 START view model public.v_stg_wheat_msk....................... [RUN]
2022-02-07 19:29:36.472265 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:29:36.478361 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 19:29:36.494246 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:29:36.500180 (Thread-1): On model.project_otus_dbt.v_stg_orders: BEGIN
2022-02-07 19:29:36.506065 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:29:36.525620 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:29:36.526099 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 19:29:36.526510 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 19:29:36.532856 (Thread-1): SQL status: BEGIN in 0.03 seconds
2022-02-07 19:29:36.533369 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:29:36.533734 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:29:36.578261 (Thread-1): SQL status: SELECT 4 in 0.04 seconds
2022-02-07 19:29:36.585139 (Thread-2): SQL status: BEGIN in 0.06 seconds
2022-02-07 19:29:36.591034 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:29:36.592948 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:29:36.593385 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:29:36.593922 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:29:36.603472 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 19:29:36.617622 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_orders"
2022-02-07 19:29:36.618169 (Thread-2): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 19:29:36.635865 (Thread-1): finished collecting timing info
2022-02-07 19:29:36.637448 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:29:36.648666 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:29:36.666323 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:29:36.666832 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 19:29:36.667229 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */
drop view if exists "postgres"."public"."v_stg_orders__dbt_tmp" cascade
2022-02-07 19:29:36.685377 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 19:29:36.685837 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 19:29:36.691676 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:29:36.692371 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */
drop view if exists "postgres"."public"."v_stg_orders__dbt_backup" cascade
2022-02-07 19:29:36.693416 (Thread-2): finished collecting timing info
2022-02-07 19:29:36.705553 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 19:29:36.712395 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_orders"
2022-02-07 19:29:36.719026 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:29:36.719848 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 19:29:36.720613 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:29:36.720900 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */

  create view "postgres"."public"."v_stg_orders__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    user_id,
    order_date,
    status

    FROM "postgres"."public"."source_orders"
),

derived_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    user_id::TEXT AS CUSTOMER_KEY,
    id::TEXT AS ORDER_KEY,
    'CSV_ORDERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS ORDER_PK,
    CAST(MD5(NULLIF(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS TEXT) AS LINK_CUSTOMER_ORDER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(order_date AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(status AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS ORDER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    ORDER_PK,
    LINK_CUSTOMER_ORDER_PK,
    ORDER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 19:29:36.722590 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:29:36.731421 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:29:36.731806 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 19:29:36.732116 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 19:29:36.739158 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:29:36.739848 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */
alter table "postgres"."public"."v_stg_orders" rename to "v_stg_orders__dbt_backup"
2022-02-07 19:29:36.741247 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:29:36.743987 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 19:29:36.744512 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:29:36.749816 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:29:36.750102 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */
alter table "postgres"."public"."v_stg_orders__dbt_tmp" rename to "v_stg_orders"
2022-02-07 19:29:36.750389 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:29:36.750861 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 19:29:36.752609 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:29:36.754380 (Thread-1): On model.project_otus_dbt.v_stg_orders: COMMIT
2022-02-07 19:29:36.754798 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:29:36.755011 (Thread-1): On model.project_otus_dbt.v_stg_orders: COMMIT
2022-02-07 19:29:36.757975 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:29:36.761457 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:29:36.761753 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */
drop view if exists "postgres"."public"."v_stg_orders__dbt_backup" cascade
2022-02-07 19:29:36.767150 (Thread-2): SQL status: CREATE VIEW in 0.02 seconds
2022-02-07 19:29:36.772784 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:29:36.773555 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-07 19:29:36.773855 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 19:29:36.777291 (Thread-1): finished collecting timing info
2022-02-07 19:29:36.777654 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:29:36.777921 (Thread-1): On model.project_otus_dbt.v_stg_orders: Close
2022-02-07 19:29:36.781353 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:29:36.781927 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 19:29:36.784707 (Thread-1): 22:29:36 | 3 of 5 OK created view model public.v_stg_orders..................... [CREATE VIEW in 0.34s]
2022-02-07 19:29:36.785007 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:29:36.785470 (Thread-1): Finished running node model.project_otus_dbt.v_stg_orders
2022-02-07 19:29:36.787402 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 19:29:36.787968 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 19:29:36.788426 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:29:36.790057 (Thread-1): 22:29:36 | 5 of 5 START view model public.v_stg_wheat_usa....................... [RUN]
2022-02-07 19:29:36.790493 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 19:29:36.791131 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:29:36.791684 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 19:29:36.800205 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 19:29:36.808676 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:29:36.810855 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:29:36.811143 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 19:29:36.811414 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 19:29:36.811837 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:29:36.817638 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 19:29:36.821796 (Thread-2): finished collecting timing info
2022-02-07 19:29:36.822482 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 19:29:36.825653 (Thread-2): 22:29:36 | 4 of 5 OK created view model public.v_stg_wheat_msk.................. [CREATE VIEW in 0.35s]
2022-02-07 19:29:36.826016 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:29:36.826538 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 19:29:36.827044 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:29:36.828170 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:29:36.837846 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 19:29:36.844856 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:29:36.845136 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:29:36.850793 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 19:29:36.856803 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 19:29:36.857457 (Thread-1): finished collecting timing info
2022-02-07 19:29:36.864975 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:29:36.865230 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 19:29:36.866852 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:29:36.870528 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:29:36.870752 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 19:29:36.872077 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:29:36.873452 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 19:29:36.874041 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:29:36.874181 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    value,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    value,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    value,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    value,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 19:29:36.878361 (Thread-1): Postgres error: column "close" does not exist
LINE 66:         COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))),...
                                                 ^

2022-02-07 19:29:36.878650 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: ROLLBACK
2022-02-07 19:29:36.879948 (Thread-1): finished collecting timing info
2022-02-07 19:29:36.880418 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 19:29:36.881083 (Thread-1): Database Error in model v_stg_wheat_usa (models/stage/v_stg_wheat_usa.sql)
  column "close" does not exist
  LINE 66:         COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))),...
                                                   ^
  compiled SQL at target/run/project_otus_dbt/models/stage/v_stg_wheat_usa.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "close" does not exist
LINE 66:         COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))),...
                                                 ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model v_stg_wheat_usa (models/stage/v_stg_wheat_usa.sql)
  column "close" does not exist
  LINE 66:         COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))),...
                                                   ^
  compiled SQL at target/run/project_otus_dbt/models/stage/v_stg_wheat_usa.sql
2022-02-07 19:29:36.887656 (Thread-1): 22:29:36 | 5 of 5 ERROR creating view model public.v_stg_wheat_usa.............. [ERROR in 0.10s]
2022-02-07 19:29:36.888014 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 19:29:36.890858 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:29:36.891171 (MainThread): Using postgres connection "master".
2022-02-07 19:29:36.891236 (MainThread): On master: BEGIN
2022-02-07 19:29:36.891338 (MainThread): Opening a new connection, currently in state closed
2022-02-07 19:29:36.902110 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:29:36.902405 (MainThread): On master: COMMIT
2022-02-07 19:29:36.902470 (MainThread): Using postgres connection "master".
2022-02-07 19:29:36.902556 (MainThread): On master: COMMIT
2022-02-07 19:29:36.903598 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:29:36.903846 (MainThread): On master: Close
2022-02-07 19:29:36.904619 (MainThread): 22:29:36 | 
2022-02-07 19:29:36.904958 (MainThread): 22:29:36 | Finished running 5 view models in 1.78s.
2022-02-07 19:29:36.905198 (MainThread): Connection 'master' was properly closed.
2022-02-07 19:29:36.905373 (MainThread): Connection 'model.project_otus_dbt.v_stg_wheat_usa' was properly closed.
2022-02-07 19:29:36.905494 (MainThread): Connection 'model.project_otus_dbt.v_stg_wheat_msk' was properly closed.
2022-02-07 19:29:37.020164 (MainThread): 
2022-02-07 19:29:37.020469 (MainThread): Completed with 1 error and 0 warnings:
2022-02-07 19:29:37.020744 (MainThread): 
2022-02-07 19:29:37.021077 (MainThread): Database Error in model v_stg_wheat_usa (models/stage/v_stg_wheat_usa.sql)
2022-02-07 19:29:37.021488 (MainThread):   column "close" does not exist
2022-02-07 19:29:37.021834 (MainThread):   LINE 66:         COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))),...
2022-02-07 19:29:37.022121 (MainThread):                                                    ^
2022-02-07 19:29:37.022364 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/stage/v_stg_wheat_usa.sql
2022-02-07 19:29:37.022996 (MainThread): 
Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
2022-02-07 19:29:37.023682 (MainThread): Flushing usage events
2022-02-07 19:30:59.682273 (MainThread): Running with dbt=0.19.0
2022-02-07 19:30:59.774944 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:stage'], partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 19:30:59.775856 (MainThread): Tracking: do not track
2022-02-07 19:30:59.877495 (MainThread): Partial parsing not enabled
2022-02-07 19:30:59.878893 (MainThread): Parsing macros/adapters.sql
2022-02-07 19:30:59.928923 (MainThread): Parsing macros/catalog.sql
2022-02-07 19:30:59.937272 (MainThread): Parsing macros/relations.sql
2022-02-07 19:30:59.939823 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 19:30:59.943443 (MainThread): Parsing macros/core.sql
2022-02-07 19:30:59.952610 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 19:30:59.999931 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 19:31:00.004977 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 19:31:00.008444 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 19:31:00.016824 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 19:31:00.018651 (MainThread): Parsing macros/etc/query.sql
2022-02-07 19:31:00.019865 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 19:31:00.020959 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 19:31:00.029177 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 19:31:00.063262 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 19:31:00.067574 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 19:31:00.114841 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 19:31:00.152918 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 19:31:00.161512 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 19:31:00.163853 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 19:31:00.190245 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 19:31:00.198225 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 19:31:00.208739 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 19:31:00.219126 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 19:31:00.222321 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 19:31:00.225052 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 19:31:00.228402 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 19:31:00.236299 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 19:31:00.239948 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 19:31:00.243755 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 19:31:00.245842 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 19:31:00.259912 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 19:31:00.263459 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 19:31:00.266951 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 19:31:00.272088 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 19:31:00.273970 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 19:31:00.278005 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 19:31:00.283331 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 19:31:00.285999 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 19:31:00.288819 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 19:31:00.292285 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 19:31:00.304430 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 19:31:00.308147 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 19:31:00.311007 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 19:31:00.312828 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 19:31:00.314942 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 19:31:00.316621 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 19:31:00.318335 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 19:31:00.324142 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 19:31:00.325855 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 19:31:00.327783 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 19:31:00.330077 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 19:31:00.333115 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 19:31:00.335036 (MainThread): Parsing macros/sql/star.sql
2022-02-07 19:31:00.339202 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 19:31:00.341402 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 19:31:00.346260 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 19:31:00.348434 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 19:31:00.356276 (MainThread): Parsing macros/sql/union.sql
2022-02-07 19:31:00.370614 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 19:31:00.373859 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 19:31:00.380507 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 19:31:00.385115 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 19:31:00.389804 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 19:31:00.397043 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 19:31:00.402137 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 19:31:00.403911 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 19:31:00.405957 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 19:31:00.409233 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 19:31:00.419208 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 19:31:00.422229 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 19:31:00.424739 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 19:31:00.427163 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 19:31:00.455010 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 19:31:00.457256 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 19:31:00.460112 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 19:31:00.462559 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 19:31:00.464678 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 19:31:00.471899 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 19:31:00.475889 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 19:31:00.478735 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 19:31:00.480538 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 19:31:00.482344 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 19:31:00.484604 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 19:31:00.487895 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 19:31:00.489881 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 19:31:00.495089 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 19:31:00.497765 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 19:31:00.501537 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 19:31:00.502578 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 19:31:00.505070 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 19:31:00.508612 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 19:31:00.521290 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 19:31:00.537618 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 19:31:00.540826 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 19:31:00.541395 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 19:31:00.551246 (MainThread): Parsing macros/tables/link.sql
2022-02-07 19:31:00.561178 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 19:31:00.587631 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 19:31:00.605936 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 19:31:00.613082 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 19:31:00.642258 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 19:31:00.662016 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 19:31:00.710428 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 19:31:00.712124 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 19:31:00.735759 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 19:31:00.743582 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 19:31:00.752895 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 19:31:00.755067 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 19:31:00.763106 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 19:31:00.766085 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 19:31:00.779162 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 19:31:00.790916 (MainThread): Partial parsing not enabled
2022-02-07 19:31:00.898086 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_customer_order".
2022-02-07 19:31:00.981603 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:31:01.065806 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:31:01.091958 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:31:01.138501 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:31:01.175962 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:31:01.192814 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:31:01.209664 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:31:01.224352 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_order_cnt_week".
2022-02-07 19:31:01.295851 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_customer_history".
2022-02-07 19:31:01.328818 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:01.524863 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:01.544833 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:01.566904 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:01.592371 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:01.625162 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 19:31:01.636183 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 19:31:02.415002 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.prestage

2022-02-07 19:31:02.585205 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 19:31:02.586459 (MainThread): Found 17 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 5 seed files, 4 sources, 0 exposures
2022-02-07 19:31:02.590065 (MainThread): 
2022-02-07 19:31:02.590925 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:31:02.600680 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 19:31:02.618415 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 19:31:02.618930 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 19:31:02.619653 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 19:31:02.634697 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 19:31:02.640894 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 19:31:02.667980 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 19:31:02.680776 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:31:02.681089 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 19:31:02.681240 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 19:31:02.696605 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:31:02.696862 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:31:02.696956 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 19:31:02.701806 (ThreadPoolExecutor-1_0): SQL status: SELECT 23 in 0.00 seconds
2022-02-07 19:31:02.721331 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 19:31:02.723057 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 19:31:02.761259 (MainThread): Using postgres connection "master".
2022-02-07 19:31:02.761573 (MainThread): On master: BEGIN
2022-02-07 19:31:02.761704 (MainThread): Opening a new connection, currently in state init
2022-02-07 19:31:02.778081 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:31:02.778329 (MainThread): Using postgres connection "master".
2022-02-07 19:31:02.778409 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 19:31:03.076021 (MainThread): SQL status: SELECT 13 in 0.30 seconds
2022-02-07 19:31:03.097160 (MainThread): On master: ROLLBACK
2022-02-07 19:31:03.099031 (MainThread): Using postgres connection "master".
2022-02-07 19:31:03.099521 (MainThread): On master: BEGIN
2022-02-07 19:31:03.102254 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:31:03.102690 (MainThread): On master: COMMIT
2022-02-07 19:31:03.102979 (MainThread): Using postgres connection "master".
2022-02-07 19:31:03.103220 (MainThread): On master: COMMIT
2022-02-07 19:31:03.104894 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:31:03.105252 (MainThread): On master: Close
2022-02-07 19:31:03.106053 (MainThread): 22:31:03 | Concurrency: 2 threads (target='dev')
2022-02-07 19:31:03.106726 (MainThread): 22:31:03 | 
2022-02-07 19:31:03.112105 (Thread-1): Began running node model.project_otus_dbt.v_stg_customers
2022-02-07 19:31:03.112600 (Thread-2): Began running node model.project_otus_dbt.v_stg_customers_crm
2022-02-07 19:31:03.115751 (Thread-1): 22:31:03 | 1 of 5 START view model public.v_stg_customers....................... [RUN]
2022-02-07 19:31:03.117959 (Thread-2): 22:31:03 | 2 of 5 START view model public.v_stg_customers_crm................... [RUN]
2022-02-07 19:31:03.119103 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:03.120160 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:03.120830 (Thread-1): Compiling model.project_otus_dbt.v_stg_customers
2022-02-07 19:31:03.121391 (Thread-2): Compiling model.project_otus_dbt.v_stg_customers_crm
2022-02-07 19:31:03.199296 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:03.200876 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:03.201222 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: BEGIN
2022-02-07 19:31:03.201524 (Thread-1): On model.project_otus_dbt.v_stg_customers: BEGIN
2022-02-07 19:31:03.201800 (Thread-2): Opening a new connection, currently in state init
2022-02-07 19:31:03.202072 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:31:03.216165 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:31:03.216434 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:31:03.216656 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:03.216916 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:03.217202 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:03.217555 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers_crm'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:03.228921 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 19:31:03.229203 (Thread-2): SQL status: SELECT 3 in 0.01 seconds
2022-02-07 19:31:03.238875 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:03.250527 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:03.252032 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:03.252463 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers_crm'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:03.256943 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 19:31:03.321032 (Thread-2): SQL status: SELECT 3 in 0.07 seconds
2022-02-07 19:31:03.329162 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_customers_crm"
2022-02-07 19:31:03.367495 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_customers"
2022-02-07 19:31:03.368042 (Thread-2): finished collecting timing info
2022-02-07 19:31:03.390741 (Thread-1): finished collecting timing info
2022-02-07 19:31:03.426011 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:03.430591 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:03.430902 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */
drop view if exists "postgres"."public"."v_stg_customers_crm__dbt_tmp" cascade
2022-02-07 19:31:03.431210 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */
drop view if exists "postgres"."public"."v_stg_customers__dbt_tmp" cascade
2022-02-07 19:31:03.433352 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:03.433749 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:03.437304 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:03.442196 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:03.442661 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */
drop view if exists "postgres"."public"."v_stg_customers__dbt_backup" cascade
2022-02-07 19:31:03.442979 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */
drop view if exists "postgres"."public"."v_stg_customers_crm__dbt_backup" cascade
2022-02-07 19:31:03.445075 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:03.445439 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:03.452684 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_customers"
2022-02-07 19:31:03.454810 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_customers_crm"
2022-02-07 19:31:03.456057 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:03.456446 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:03.456899 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */

  create view "postgres"."public"."v_stg_customers__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    first_name,
    last_name,
    email

    FROM "postgres"."public"."source_customers"
),

derived_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(email AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(first_name AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(last_name AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 19:31:03.457278 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */

  create view "postgres"."public"."v_stg_customers_crm__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    country,
    age

    FROM "postgres"."public"."source_customers_crm"
),

derived_columns AS (

    SELECT

    id,
    country,
    age,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS_CRM'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    country,
    age,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(age AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(country AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    country,
    age,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 19:31:03.472095 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 19:31:03.472432 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 19:31:03.493097 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:03.494518 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:03.494747 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */
alter table "postgres"."public"."v_stg_customers_crm" rename to "v_stg_customers_crm__dbt_backup"
2022-02-07 19:31:03.495043 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */
alter table "postgres"."public"."v_stg_customers" rename to "v_stg_customers__dbt_backup"
2022-02-07 19:31:03.498262 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:03.498539 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:03.501866 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:03.506027 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */
alter table "postgres"."public"."v_stg_customers_crm__dbt_tmp" rename to "v_stg_customers_crm"
2022-02-07 19:31:03.505536 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:03.506520 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */
alter table "postgres"."public"."v_stg_customers__dbt_tmp" rename to "v_stg_customers"
2022-02-07 19:31:03.510343 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:03.510619 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:03.519122 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: COMMIT
2022-02-07 19:31:03.520819 (Thread-1): On model.project_otus_dbt.v_stg_customers: COMMIT
2022-02-07 19:31:03.521182 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:03.521431 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:03.521680 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: COMMIT
2022-02-07 19:31:03.521923 (Thread-1): On model.project_otus_dbt.v_stg_customers: COMMIT
2022-02-07 19:31:03.525344 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:31:03.531745 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 19:31:03.533158 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:03.536118 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:03.536770 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */
drop view if exists "postgres"."public"."v_stg_customers__dbt_backup" cascade
2022-02-07 19:31:03.537187 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */
drop view if exists "postgres"."public"."v_stg_customers_crm__dbt_backup" cascade
2022-02-07 19:31:03.542394 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:03.546720 (Thread-1): finished collecting timing info
2022-02-07 19:31:03.547273 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 19:31:03.547649 (Thread-1): On model.project_otus_dbt.v_stg_customers: Close
2022-02-07 19:31:03.551194 (Thread-2): finished collecting timing info
2022-02-07 19:31:03.551947 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: Close
2022-02-07 19:31:03.554366 (Thread-1): 22:31:03 | 1 of 5 OK created view model public.v_stg_customers.................. [CREATE VIEW in 0.43s]
2022-02-07 19:31:03.556841 (Thread-2): 22:31:03 | 2 of 5 OK created view model public.v_stg_customers_crm.............. [CREATE VIEW in 0.44s]
2022-02-07 19:31:03.557592 (Thread-1): Finished running node model.project_otus_dbt.v_stg_customers
2022-02-07 19:31:03.558430 (Thread-2): Finished running node model.project_otus_dbt.v_stg_customers_crm
2022-02-07 19:31:03.558910 (Thread-1): Began running node model.project_otus_dbt.v_stg_orders
2022-02-07 19:31:03.559896 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 19:31:03.561710 (Thread-1): 22:31:03 | 3 of 5 START view model public.v_stg_orders.......................... [RUN]
2022-02-07 19:31:03.563556 (Thread-2): 22:31:03 | 4 of 5 START view model public.v_stg_wheat_msk....................... [RUN]
2022-02-07 19:31:03.564476 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:03.565390 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:03.565816 (Thread-1): Compiling model.project_otus_dbt.v_stg_orders
2022-02-07 19:31:03.566369 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 19:31:03.595550 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:03.601358 (Thread-1): On model.project_otus_dbt.v_stg_orders: BEGIN
2022-02-07 19:31:03.604332 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:03.604705 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:31:03.605002 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 19:31:03.605594 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 19:31:03.619927 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:31:03.620201 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:03.620278 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:03.624288 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:31:03.624705 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:03.624954 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:03.633380 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 19:31:03.641717 (Thread-1): SQL status: SELECT 4 in 0.02 seconds
2022-02-07 19:31:03.654729 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:03.660408 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:03.664901 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:03.666157 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:03.676453 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 19:31:03.683502 (Thread-1): SQL status: SELECT 4 in 0.02 seconds
2022-02-07 19:31:03.707104 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 19:31:03.713818 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_orders"
2022-02-07 19:31:03.714468 (Thread-2): finished collecting timing info
2022-02-07 19:31:03.726113 (Thread-1): finished collecting timing info
2022-02-07 19:31:03.740096 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:03.746084 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 19:31:03.754527 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:03.754982 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:03.755408 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */
drop view if exists "postgres"."public"."v_stg_orders__dbt_tmp" cascade
2022-02-07 19:31:03.762513 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:03.763499 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 19:31:03.765728 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:03.766302 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:03.769106 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 19:31:03.776108 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:03.776952 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */
drop view if exists "postgres"."public"."v_stg_orders__dbt_backup" cascade
2022-02-07 19:31:03.777925 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:03.778376 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 19:31:03.779698 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:03.782722 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_orders"
2022-02-07 19:31:03.783668 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:03.784016 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */

  create view "postgres"."public"."v_stg_orders__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    user_id,
    order_date,
    status

    FROM "postgres"."public"."source_orders"
),

derived_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    user_id::TEXT AS CUSTOMER_KEY,
    id::TEXT AS ORDER_KEY,
    'CSV_ORDERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS ORDER_PK,
    CAST(MD5(NULLIF(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS TEXT) AS LINK_CUSTOMER_ORDER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(order_date AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(status AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS ORDER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    ORDER_PK,
    LINK_CUSTOMER_ORDER_PK,
    ORDER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 19:31:03.798163 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 19:31:03.798521 (Thread-2): SQL status: CREATE VIEW in 0.02 seconds
2022-02-07 19:31:03.808254 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:03.819715 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */
alter table "postgres"."public"."v_stg_orders" rename to "v_stg_orders__dbt_backup"
2022-02-07 19:31:03.821790 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:03.822485 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-07 19:31:03.825561 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:03.826036 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:03.833180 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:03.840485 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:03.840958 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 19:31:03.841518 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */
alter table "postgres"."public"."v_stg_orders__dbt_tmp" rename to "v_stg_orders"
2022-02-07 19:31:03.845387 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:03.845918 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:03.848803 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 19:31:03.852113 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:03.851514 (Thread-1): On model.project_otus_dbt.v_stg_orders: COMMIT
2022-02-07 19:31:03.852447 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 19:31:03.852959 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:03.853707 (Thread-1): On model.project_otus_dbt.v_stg_orders: COMMIT
2022-02-07 19:31:03.857823 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:31:03.863559 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:03.864089 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 19:31:03.864550 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 19:31:03.869831 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:03.870912 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */
drop view if exists "postgres"."public"."v_stg_orders__dbt_backup" cascade
2022-02-07 19:31:03.880183 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 19:31:03.886256 (Thread-1): finished collecting timing info
2022-02-07 19:31:03.886914 (Thread-2): SQL status: DROP VIEW in 0.02 seconds
2022-02-07 19:31:03.887525 (Thread-1): On model.project_otus_dbt.v_stg_orders: Close
2022-02-07 19:31:03.893514 (Thread-2): finished collecting timing info
2022-02-07 19:31:03.894505 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 19:31:03.898404 (Thread-1): 22:31:03 | 3 of 5 OK created view model public.v_stg_orders..................... [CREATE VIEW in 0.33s]
2022-02-07 19:31:03.902901 (Thread-2): 22:31:03 | 4 of 5 OK created view model public.v_stg_wheat_msk.................. [CREATE VIEW in 0.34s]
2022-02-07 19:31:03.903713 (Thread-1): Finished running node model.project_otus_dbt.v_stg_orders
2022-02-07 19:31:03.904754 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 19:31:03.905643 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 19:31:03.910533 (Thread-1): 22:31:03 | 5 of 5 START view model public.v_stg_wheat_usa....................... [RUN]
2022-02-07 19:31:03.911869 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:03.912321 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 19:31:03.944947 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:03.945456 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 19:31:03.945690 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:31:03.965842 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:31:03.966261 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:03.966522 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:03.984051 (Thread-1): SQL status: SELECT 7 in 0.02 seconds
2022-02-07 19:31:03.996569 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:03.996994 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:04.006181 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 19:31:04.021489 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 19:31:04.022399 (Thread-1): finished collecting timing info
2022-02-07 19:31:04.042193 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:04.042703 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 19:31:04.045524 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:04.049753 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:04.049991 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 19:31:04.057164 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 19:31:04.058914 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 19:31:04.059703 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:04.059891 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    value,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    value,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    value,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    value,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 19:31:04.062706 (Thread-1): Postgres error: column "name" does not exist
LINE 69:         COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ...
                                                 ^

2022-02-07 19:31:04.063069 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: ROLLBACK
2022-02-07 19:31:04.065163 (Thread-1): finished collecting timing info
2022-02-07 19:31:04.065975 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 19:31:04.067267 (Thread-1): Database Error in model v_stg_wheat_usa (models/stage/v_stg_wheat_usa.sql)
  column "name" does not exist
  LINE 69:         COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ...
                                                   ^
  compiled SQL at target/run/project_otus_dbt/models/stage/v_stg_wheat_usa.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "name" does not exist
LINE 69:         COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ...
                                                 ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model v_stg_wheat_usa (models/stage/v_stg_wheat_usa.sql)
  column "name" does not exist
  LINE 69:         COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ...
                                                   ^
  compiled SQL at target/run/project_otus_dbt/models/stage/v_stg_wheat_usa.sql
2022-02-07 19:31:04.072635 (Thread-1): 22:31:04 | 5 of 5 ERROR creating view model public.v_stg_wheat_usa.............. [ERROR in 0.16s]
2022-02-07 19:31:04.073148 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 19:31:04.076002 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:31:04.076349 (MainThread): Using postgres connection "master".
2022-02-07 19:31:04.076448 (MainThread): On master: BEGIN
2022-02-07 19:31:04.076572 (MainThread): Opening a new connection, currently in state closed
2022-02-07 19:31:04.091608 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:31:04.091865 (MainThread): On master: COMMIT
2022-02-07 19:31:04.091932 (MainThread): Using postgres connection "master".
2022-02-07 19:31:04.091987 (MainThread): On master: COMMIT
2022-02-07 19:31:04.093419 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:31:04.093662 (MainThread): On master: Close
2022-02-07 19:31:04.094178 (MainThread): 22:31:04 | 
2022-02-07 19:31:04.094430 (MainThread): 22:31:04 | Finished running 5 view models in 1.50s.
2022-02-07 19:31:04.094680 (MainThread): Connection 'master' was properly closed.
2022-02-07 19:31:04.094837 (MainThread): Connection 'model.project_otus_dbt.v_stg_wheat_usa' was properly closed.
2022-02-07 19:31:04.094902 (MainThread): Connection 'model.project_otus_dbt.v_stg_wheat_msk' was properly closed.
2022-02-07 19:31:04.232381 (MainThread): 
2022-02-07 19:31:04.233053 (MainThread): Completed with 1 error and 0 warnings:
2022-02-07 19:31:04.233990 (MainThread): 
2022-02-07 19:31:04.235375 (MainThread): Database Error in model v_stg_wheat_usa (models/stage/v_stg_wheat_usa.sql)
2022-02-07 19:31:04.236518 (MainThread):   column "name" does not exist
2022-02-07 19:31:04.237156 (MainThread):   LINE 69:         COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ...
2022-02-07 19:31:04.237440 (MainThread):                                                    ^
2022-02-07 19:31:04.237643 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/stage/v_stg_wheat_usa.sql
2022-02-07 19:31:04.237866 (MainThread): 
Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
2022-02-07 19:31:04.238277 (MainThread): Flushing usage events
2022-02-07 19:31:28.981681 (MainThread): Running with dbt=0.19.0
2022-02-07 19:31:29.097499 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:stage'], partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 19:31:29.099720 (MainThread): Tracking: do not track
2022-02-07 19:31:29.250638 (MainThread): Partial parsing not enabled
2022-02-07 19:31:29.254910 (MainThread): Parsing macros/adapters.sql
2022-02-07 19:31:29.298275 (MainThread): Parsing macros/catalog.sql
2022-02-07 19:31:29.306785 (MainThread): Parsing macros/relations.sql
2022-02-07 19:31:29.311946 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 19:31:29.320616 (MainThread): Parsing macros/core.sql
2022-02-07 19:31:29.328251 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 19:31:29.377092 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 19:31:29.379244 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 19:31:29.381010 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 19:31:29.389124 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 19:31:29.390922 (MainThread): Parsing macros/etc/query.sql
2022-02-07 19:31:29.392003 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 19:31:29.392994 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 19:31:29.401686 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 19:31:29.422515 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 19:31:29.424432 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 19:31:29.454420 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 19:31:29.471199 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 19:31:29.476987 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 19:31:29.479002 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 19:31:29.491596 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 19:31:29.496281 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 19:31:29.502504 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 19:31:29.508743 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 19:31:29.510549 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 19:31:29.512057 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 19:31:29.513828 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 19:31:29.517449 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 19:31:29.519400 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 19:31:29.521503 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 19:31:29.522884 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 19:31:29.531948 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 19:31:29.533958 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 19:31:29.535597 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 19:31:29.538039 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 19:31:29.539092 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 19:31:29.541219 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 19:31:29.543950 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 19:31:29.545631 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 19:31:29.547437 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 19:31:29.549744 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 19:31:29.556440 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 19:31:29.559836 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 19:31:29.562397 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 19:31:29.563804 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 19:31:29.565520 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 19:31:29.566919 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 19:31:29.568405 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 19:31:29.579386 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 19:31:29.582375 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 19:31:29.586204 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 19:31:29.591315 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 19:31:29.597823 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 19:31:29.602207 (MainThread): Parsing macros/sql/star.sql
2022-02-07 19:31:29.611142 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 19:31:29.615670 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 19:31:29.627112 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 19:31:29.631951 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 19:31:29.653940 (MainThread): Parsing macros/sql/union.sql
2022-02-07 19:31:29.685777 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 19:31:29.692316 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 19:31:29.703440 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 19:31:29.708940 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 19:31:29.715680 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 19:31:29.724147 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 19:31:29.734404 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 19:31:29.737164 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 19:31:29.740493 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 19:31:29.744756 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 19:31:29.749695 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 19:31:29.751798 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 19:31:29.754001 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 19:31:29.755947 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 19:31:29.792291 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 19:31:29.795499 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 19:31:29.799732 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 19:31:29.803293 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 19:31:29.806620 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 19:31:29.816846 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 19:31:29.823404 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 19:31:29.826591 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 19:31:29.828340 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 19:31:29.830283 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 19:31:29.832481 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 19:31:29.835622 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 19:31:29.837512 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 19:31:29.843215 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 19:31:29.845820 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 19:31:29.849701 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 19:31:29.850652 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 19:31:29.853026 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 19:31:29.856172 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 19:31:29.863198 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 19:31:29.873340 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 19:31:29.876879 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 19:31:29.877471 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 19:31:29.887508 (MainThread): Parsing macros/tables/link.sql
2022-02-07 19:31:29.897890 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 19:31:29.910252 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 19:31:29.918417 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 19:31:29.923159 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 19:31:29.937901 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 19:31:29.945018 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 19:31:29.965833 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 19:31:29.967290 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 19:31:30.015948 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 19:31:30.028296 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 19:31:30.046459 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 19:31:30.050438 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 19:31:30.067396 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 19:31:30.073788 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 19:31:30.096413 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 19:31:30.107339 (MainThread): Partial parsing not enabled
2022-02-07 19:31:30.206938 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_customer_order".
2022-02-07 19:31:30.305857 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:31:30.386092 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:31:30.414421 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:31:30.438660 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:31:30.471581 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:31:30.488601 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:31:30.505029 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:31:30.519801 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_order_cnt_week".
2022-02-07 19:31:30.550239 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_customer_history".
2022-02-07 19:31:30.564518 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:30.703324 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:30.724132 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:30.744870 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:30.765383 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:30.784604 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 19:31:30.794970 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 19:31:31.694405 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.prestage

2022-02-07 19:31:31.891578 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 19:31:31.893024 (MainThread): Found 17 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 5 seed files, 4 sources, 0 exposures
2022-02-07 19:31:31.896218 (MainThread): 
2022-02-07 19:31:31.897368 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:31:31.905879 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 19:31:31.915810 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 19:31:31.916023 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 19:31:31.916168 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 19:31:31.932233 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 19:31:31.934927 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 19:31:31.962183 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 19:31:31.968770 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:31:31.969005 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 19:31:31.969098 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 19:31:31.978545 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:31:31.978783 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:31:31.978968 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 19:31:31.982313 (ThreadPoolExecutor-1_0): SQL status: SELECT 23 in 0.00 seconds
2022-02-07 19:31:31.996768 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 19:31:31.998904 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 19:31:32.027325 (MainThread): Using postgres connection "master".
2022-02-07 19:31:32.027555 (MainThread): On master: BEGIN
2022-02-07 19:31:32.027639 (MainThread): Opening a new connection, currently in state init
2022-02-07 19:31:32.037077 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:31:32.037351 (MainThread): Using postgres connection "master".
2022-02-07 19:31:32.037451 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 19:31:32.307761 (MainThread): SQL status: SELECT 13 in 0.27 seconds
2022-02-07 19:31:32.320585 (MainThread): On master: ROLLBACK
2022-02-07 19:31:32.321852 (MainThread): Using postgres connection "master".
2022-02-07 19:31:32.322048 (MainThread): On master: BEGIN
2022-02-07 19:31:32.323981 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:31:32.324369 (MainThread): On master: COMMIT
2022-02-07 19:31:32.324603 (MainThread): Using postgres connection "master".
2022-02-07 19:31:32.324819 (MainThread): On master: COMMIT
2022-02-07 19:31:32.326449 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:31:32.326687 (MainThread): On master: Close
2022-02-07 19:31:32.327227 (MainThread): 22:31:32 | Concurrency: 2 threads (target='dev')
2022-02-07 19:31:32.327534 (MainThread): 22:31:32 | 
2022-02-07 19:31:32.334520 (Thread-1): Began running node model.project_otus_dbt.v_stg_customers
2022-02-07 19:31:32.335023 (Thread-2): Began running node model.project_otus_dbt.v_stg_customers_crm
2022-02-07 19:31:32.337237 (Thread-1): 22:31:32 | 1 of 5 START view model public.v_stg_customers....................... [RUN]
2022-02-07 19:31:32.339835 (Thread-2): 22:31:32 | 2 of 5 START view model public.v_stg_customers_crm................... [RUN]
2022-02-07 19:31:32.340770 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:32.342000 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:32.342496 (Thread-1): Compiling model.project_otus_dbt.v_stg_customers
2022-02-07 19:31:32.342826 (Thread-2): Compiling model.project_otus_dbt.v_stg_customers_crm
2022-02-07 19:31:32.417653 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:32.420250 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:32.420669 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: BEGIN
2022-02-07 19:31:32.421043 (Thread-1): On model.project_otus_dbt.v_stg_customers: BEGIN
2022-02-07 19:31:32.421469 (Thread-2): Opening a new connection, currently in state init
2022-02-07 19:31:32.421735 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:31:32.436787 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:31:32.437216 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:31:32.437509 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:32.437873 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:32.438669 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:32.438325 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers_crm'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:32.446939 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 19:31:32.458984 (Thread-2): SQL status: SELECT 3 in 0.02 seconds
2022-02-07 19:31:32.472083 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:32.476510 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:32.476979 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:32.477418 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers_crm'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:32.481735 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 19:31:32.553663 (Thread-2): SQL status: SELECT 3 in 0.08 seconds
2022-02-07 19:31:32.559345 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_customers_crm"
2022-02-07 19:31:32.586930 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_customers"
2022-02-07 19:31:32.587924 (Thread-2): finished collecting timing info
2022-02-07 19:31:32.593943 (Thread-1): finished collecting timing info
2022-02-07 19:31:32.706926 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:32.709547 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:32.710088 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */
drop view if exists "postgres"."public"."v_stg_customers_crm__dbt_tmp" cascade
2022-02-07 19:31:32.710783 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */
drop view if exists "postgres"."public"."v_stg_customers__dbt_tmp" cascade
2022-02-07 19:31:32.714036 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:32.714412 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:32.721853 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:32.729133 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:32.729451 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */
drop view if exists "postgres"."public"."v_stg_customers_crm__dbt_backup" cascade
2022-02-07 19:31:32.729897 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */
drop view if exists "postgres"."public"."v_stg_customers__dbt_backup" cascade
2022-02-07 19:31:32.731821 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:32.732222 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:32.737191 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_customers_crm"
2022-02-07 19:31:32.739985 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_customers"
2022-02-07 19:31:32.740952 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:32.741163 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */

  create view "postgres"."public"."v_stg_customers__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    first_name,
    last_name,
    email

    FROM "postgres"."public"."source_customers"
),

derived_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(email AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(first_name AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(last_name AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 19:31:32.741657 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:32.742193 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */

  create view "postgres"."public"."v_stg_customers_crm__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    country,
    age

    FROM "postgres"."public"."source_customers_crm"
),

derived_columns AS (

    SELECT

    id,
    country,
    age,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS_CRM'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    country,
    age,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(age AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(country AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    country,
    age,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 19:31:32.779101 (Thread-1): SQL status: CREATE VIEW in 0.04 seconds
2022-02-07 19:31:32.793224 (Thread-2): SQL status: CREATE VIEW in 0.05 seconds
2022-02-07 19:31:32.800303 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:32.811079 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:32.811429 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */
alter table "postgres"."public"."v_stg_customers" rename to "v_stg_customers__dbt_backup"
2022-02-07 19:31:32.811944 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */
alter table "postgres"."public"."v_stg_customers_crm" rename to "v_stg_customers_crm__dbt_backup"
2022-02-07 19:31:32.814479 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:32.819141 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:32.819594 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 19:31:32.819969 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */
alter table "postgres"."public"."v_stg_customers__dbt_tmp" rename to "v_stg_customers"
2022-02-07 19:31:32.823866 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:32.824507 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */
alter table "postgres"."public"."v_stg_customers_crm__dbt_tmp" rename to "v_stg_customers_crm"
2022-02-07 19:31:32.826245 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:32.826507 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:32.833291 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: COMMIT
2022-02-07 19:31:32.834980 (Thread-1): On model.project_otus_dbt.v_stg_customers: COMMIT
2022-02-07 19:31:32.835465 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:32.835584 (Thread-1): On model.project_otus_dbt.v_stg_customers: COMMIT
2022-02-07 19:31:32.835296 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:32.836168 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: COMMIT
2022-02-07 19:31:32.838640 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:31:32.843266 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:32.843515 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 19:31:32.843956 (Thread-1): On model.project_otus_dbt.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers"} */
drop view if exists "postgres"."public"."v_stg_customers__dbt_backup" cascade
2022-02-07 19:31:32.846798 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:32.847215 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_customers_crm"} */
drop view if exists "postgres"."public"."v_stg_customers_crm__dbt_backup" cascade
2022-02-07 19:31:32.852047 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:32.852390 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 19:31:32.855560 (Thread-1): finished collecting timing info
2022-02-07 19:31:32.859139 (Thread-2): finished collecting timing info
2022-02-07 19:31:32.859667 (Thread-1): On model.project_otus_dbt.v_stg_customers: Close
2022-02-07 19:31:32.859920 (Thread-2): On model.project_otus_dbt.v_stg_customers_crm: Close
2022-02-07 19:31:32.863655 (Thread-1): 22:31:32 | 1 of 5 OK created view model public.v_stg_customers.................. [CREATE VIEW in 0.52s]
2022-02-07 19:31:32.865584 (Thread-2): 22:31:32 | 2 of 5 OK created view model public.v_stg_customers_crm.............. [CREATE VIEW in 0.52s]
2022-02-07 19:31:32.866023 (Thread-1): Finished running node model.project_otus_dbt.v_stg_customers
2022-02-07 19:31:32.866380 (Thread-2): Finished running node model.project_otus_dbt.v_stg_customers_crm
2022-02-07 19:31:32.867172 (Thread-1): Began running node model.project_otus_dbt.v_stg_orders
2022-02-07 19:31:32.868109 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 19:31:32.870726 (Thread-1): 22:31:32 | 3 of 5 START view model public.v_stg_orders.......................... [RUN]
2022-02-07 19:31:32.872998 (Thread-2): 22:31:32 | 4 of 5 START view model public.v_stg_wheat_msk....................... [RUN]
2022-02-07 19:31:32.874318 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:32.875217 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:32.875689 (Thread-1): Compiling model.project_otus_dbt.v_stg_orders
2022-02-07 19:31:32.876119 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 19:31:32.905280 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:32.910958 (Thread-1): On model.project_otus_dbt.v_stg_orders: BEGIN
2022-02-07 19:31:32.916258 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:32.916507 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:31:32.916796 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 19:31:32.917323 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 19:31:32.931929 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:31:32.932358 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:32.932539 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:32.934393 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:31:32.934667 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:32.934795 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:32.941308 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 19:31:32.947553 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:32.947921 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 19:31:32.948148 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:32.954628 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:32.955059 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:32.958788 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 19:31:32.964016 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_orders"
2022-02-07 19:31:32.964309 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 19:31:32.971320 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 19:31:32.971867 (Thread-1): finished collecting timing info
2022-02-07 19:31:32.979979 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:32.980244 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */
drop view if exists "postgres"."public"."v_stg_orders__dbt_tmp" cascade
2022-02-07 19:31:32.980476 (Thread-2): finished collecting timing info
2022-02-07 19:31:32.987406 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 19:31:32.990219 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:32.992924 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:32.993436 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 19:31:32.993773 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */
drop view if exists "postgres"."public"."v_stg_orders__dbt_backup" cascade
2022-02-07 19:31:32.995693 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:32.995929 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:32.999283 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:33.000722 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_orders"
2022-02-07 19:31:33.001024 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 19:31:33.001666 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:33.001850 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */

  create view "postgres"."public"."v_stg_orders__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    user_id,
    order_date,
    status

    FROM "postgres"."public"."source_orders"
),

derived_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    user_id::TEXT AS CUSTOMER_KEY,
    id::TEXT AS ORDER_KEY,
    'CSV_ORDERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS ORDER_PK,
    CAST(MD5(NULLIF(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS TEXT) AS LINK_CUSTOMER_ORDER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(order_date AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(status AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS ORDER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    ORDER_PK,
    LINK_CUSTOMER_ORDER_PK,
    ORDER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 19:31:33.003515 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:33.004962 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 19:31:33.005615 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:33.005827 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 19:31:33.007682 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 19:31:33.013092 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:33.013415 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */
alter table "postgres"."public"."v_stg_orders" rename to "v_stg_orders__dbt_backup"
2022-02-07 19:31:33.015012 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 19:31:33.015323 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:33.022186 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:33.025290 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:33.025674 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-07 19:31:33.025872 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */
alter table "postgres"."public"."v_stg_orders__dbt_tmp" rename to "v_stg_orders"
2022-02-07 19:31:33.028371 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:33.028699 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:33.032054 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:33.034057 (Thread-1): On model.project_otus_dbt.v_stg_orders: COMMIT
2022-02-07 19:31:33.034340 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 19:31:33.034561 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:33.034943 (Thread-1): On model.project_otus_dbt.v_stg_orders: COMMIT
2022-02-07 19:31:33.036674 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:33.038422 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 19:31:33.038678 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:31:33.038889 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:33.041745 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:33.042132 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 19:31:33.042405 (Thread-1): On model.project_otus_dbt.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_orders"} */
drop view if exists "postgres"."public"."v_stg_orders__dbt_backup" cascade
2022-02-07 19:31:33.045194 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:31:33.048188 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:33.048470 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 19:31:33.048746 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 19:31:33.051604 (Thread-1): finished collecting timing info
2022-02-07 19:31:33.052237 (Thread-1): On model.project_otus_dbt.v_stg_orders: Close
2022-02-07 19:31:33.054822 (Thread-1): 22:31:33 | 3 of 5 OK created view model public.v_stg_orders..................... [CREATE VIEW in 0.18s]
2022-02-07 19:31:33.055273 (Thread-1): Finished running node model.project_otus_dbt.v_stg_orders
2022-02-07 19:31:33.055604 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 19:31:33.057835 (Thread-1): 22:31:33 | 5 of 5 START view model public.v_stg_wheat_usa....................... [RUN]
2022-02-07 19:31:33.058198 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 19:31:33.058968 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:33.061928 (Thread-2): finished collecting timing info
2022-02-07 19:31:33.062560 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 19:31:33.062948 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 19:31:33.077449 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:33.080119 (Thread-2): 22:31:33 | 4 of 5 OK created view model public.v_stg_wheat_msk.................. [CREATE VIEW in 0.20s]
2022-02-07 19:31:33.080459 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 19:31:33.080866 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 19:31:33.081141 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:31:33.091611 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:31:33.091934 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:33.092074 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:33.100117 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 19:31:33.105365 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:33.106009 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:31:33.111164 (Thread-1): SQL status: SELECT 7 in 0.00 seconds
2022-02-07 19:31:33.117354 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 19:31:33.117882 (Thread-1): finished collecting timing info
2022-02-07 19:31:33.125525 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:33.125775 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 19:31:33.127210 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:33.130313 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:33.130528 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 19:31:33.131714 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:33.133005 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 19:31:33.133488 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:33.133605 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    value,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    value,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    value,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    value,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 19:31:33.139746 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 19:31:33.142834 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:33.143082 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-07 19:31:33.145253 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 19:31:33.146501 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 19:31:33.146671 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:33.146742 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 19:31:33.150207 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:31:33.152575 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:33.152779 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 19:31:33.154318 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 19:31:33.156832 (Thread-1): finished collecting timing info
2022-02-07 19:31:33.157144 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 19:31:33.159209 (Thread-1): 22:31:33 | 5 of 5 OK created view model public.v_stg_wheat_usa.................. [CREATE VIEW in 0.10s]
2022-02-07 19:31:33.159659 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 19:31:33.162193 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:31:33.162788 (MainThread): Using postgres connection "master".
2022-02-07 19:31:33.163006 (MainThread): On master: BEGIN
2022-02-07 19:31:33.163159 (MainThread): Opening a new connection, currently in state closed
2022-02-07 19:31:33.173508 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:31:33.173800 (MainThread): On master: COMMIT
2022-02-07 19:31:33.173929 (MainThread): Using postgres connection "master".
2022-02-07 19:31:33.174047 (MainThread): On master: COMMIT
2022-02-07 19:31:33.175317 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:31:33.175629 (MainThread): On master: Close
2022-02-07 19:31:33.176479 (MainThread): 22:31:33 | 
2022-02-07 19:31:33.176814 (MainThread): 22:31:33 | Finished running 5 view models in 1.28s.
2022-02-07 19:31:33.177041 (MainThread): Connection 'master' was properly closed.
2022-02-07 19:31:33.177197 (MainThread): Connection 'model.project_otus_dbt.v_stg_wheat_usa' was properly closed.
2022-02-07 19:31:33.177359 (MainThread): Connection 'model.project_otus_dbt.v_stg_wheat_msk' was properly closed.
2022-02-07 19:31:33.282818 (MainThread): 
2022-02-07 19:31:33.283474 (MainThread): Completed successfully
2022-02-07 19:31:33.284129 (MainThread): 
Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
2022-02-07 19:31:33.284838 (MainThread): Flushing usage events
2022-02-07 19:31:55.976050 (MainThread): Running with dbt=0.19.0
2022-02-07 19:31:56.149007 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:hub'], partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 19:31:56.150359 (MainThread): Tracking: do not track
2022-02-07 19:31:56.221738 (MainThread): Partial parsing not enabled
2022-02-07 19:31:56.222755 (MainThread): Parsing macros/adapters.sql
2022-02-07 19:31:56.254044 (MainThread): Parsing macros/catalog.sql
2022-02-07 19:31:56.258188 (MainThread): Parsing macros/relations.sql
2022-02-07 19:31:56.264238 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 19:31:56.267645 (MainThread): Parsing macros/core.sql
2022-02-07 19:31:56.273019 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 19:31:56.321354 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 19:31:56.323954 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 19:31:56.326457 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 19:31:56.336601 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 19:31:56.338684 (MainThread): Parsing macros/etc/query.sql
2022-02-07 19:31:56.340275 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 19:31:56.342057 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 19:31:56.364918 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 19:31:56.399426 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 19:31:56.402580 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 19:31:56.442811 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 19:31:56.465771 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 19:31:56.473264 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 19:31:56.475726 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 19:31:56.489693 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 19:31:56.494747 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 19:31:56.501807 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 19:31:56.508730 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 19:31:56.510558 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 19:31:56.512121 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 19:31:56.514003 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 19:31:56.517873 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 19:31:56.520004 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 19:31:56.522178 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 19:31:56.523358 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 19:31:56.533178 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 19:31:56.535510 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 19:31:56.537832 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 19:31:56.541222 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 19:31:56.542486 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 19:31:56.545312 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 19:31:56.549242 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 19:31:56.551955 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 19:31:56.553985 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 19:31:56.556404 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 19:31:56.564306 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 19:31:56.568006 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 19:31:56.570667 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 19:31:56.572101 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 19:31:56.573822 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 19:31:56.575299 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 19:31:56.576933 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 19:31:56.582583 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 19:31:56.584018 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 19:31:56.585669 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 19:31:56.587725 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 19:31:56.590629 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 19:31:56.592460 (MainThread): Parsing macros/sql/star.sql
2022-02-07 19:31:56.596112 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 19:31:56.598237 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 19:31:56.605362 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 19:31:56.607465 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 19:31:56.618369 (MainThread): Parsing macros/sql/union.sql
2022-02-07 19:31:56.627748 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 19:31:56.630979 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 19:31:56.637850 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 19:31:56.642744 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 19:31:56.646878 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 19:31:56.653931 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 19:31:56.658872 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 19:31:56.660749 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 19:31:56.665479 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 19:31:56.672131 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 19:31:56.681240 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 19:31:56.684579 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 19:31:56.687875 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 19:31:56.691357 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 19:31:56.728970 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 19:31:56.734182 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 19:31:56.739617 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 19:31:56.744726 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 19:31:56.750958 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 19:31:56.770219 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 19:31:56.781355 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 19:31:56.787894 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 19:31:56.792329 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 19:31:56.797106 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 19:31:56.803301 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 19:31:56.812050 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 19:31:56.821094 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 19:31:56.840166 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 19:31:56.847872 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 19:31:56.857546 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 19:31:56.860327 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 19:31:56.867860 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 19:31:56.879829 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 19:31:56.893272 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 19:31:56.917170 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 19:31:56.920870 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 19:31:56.921776 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 19:31:56.932578 (MainThread): Parsing macros/tables/link.sql
2022-02-07 19:31:56.956396 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 19:31:56.972425 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 19:31:56.981171 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 19:31:56.985908 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 19:31:57.017810 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 19:31:57.045440 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 19:31:57.146309 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 19:31:57.151414 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 19:31:57.174870 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 19:31:57.186336 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 19:31:57.193962 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 19:31:57.195602 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 19:31:57.205775 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 19:31:57.208878 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 19:31:57.224020 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 19:31:57.238969 (MainThread): Partial parsing not enabled
2022-02-07 19:31:57.356133 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_customer_order".
2022-02-07 19:31:57.439520 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:31:57.488192 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:31:57.518402 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:31:57.537457 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:31:57.578799 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:31:57.610374 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:31:57.650365 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:31:57.690313 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_order_cnt_week".
2022-02-07 19:31:57.751318 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_customer_history".
2022-02-07 19:31:57.793359 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:31:57.950262 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:31:57.998417 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:31:58.038469 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:31:58.059340 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:31:58.078032 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 19:31:58.088081 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 19:31:58.938056 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.prestage

2022-02-07 19:31:59.184458 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 19:31:59.185436 (MainThread): Found 17 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 5 seed files, 4 sources, 0 exposures
2022-02-07 19:31:59.188312 (MainThread): 
2022-02-07 19:31:59.189151 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:31:59.198105 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 19:31:59.214417 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 19:31:59.214769 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 19:31:59.215094 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 19:31:59.232947 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 19:31:59.236091 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 19:31:59.270357 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 19:31:59.279273 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:31:59.279641 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 19:31:59.279871 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 19:31:59.295448 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:31:59.295843 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:31:59.296037 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 19:31:59.300171 (ThreadPoolExecutor-1_0): SQL status: SELECT 24 in 0.00 seconds
2022-02-07 19:31:59.316957 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 19:31:59.319068 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 19:31:59.361930 (MainThread): Using postgres connection "master".
2022-02-07 19:31:59.362272 (MainThread): On master: BEGIN
2022-02-07 19:31:59.362384 (MainThread): Opening a new connection, currently in state init
2022-02-07 19:31:59.374630 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:31:59.374907 (MainThread): Using postgres connection "master".
2022-02-07 19:31:59.374991 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 19:31:59.639923 (MainThread): SQL status: SELECT 14 in 0.26 seconds
2022-02-07 19:31:59.655883 (MainThread): On master: ROLLBACK
2022-02-07 19:31:59.657471 (MainThread): Using postgres connection "master".
2022-02-07 19:31:59.657833 (MainThread): On master: BEGIN
2022-02-07 19:31:59.660466 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:31:59.660771 (MainThread): On master: COMMIT
2022-02-07 19:31:59.660929 (MainThread): Using postgres connection "master".
2022-02-07 19:31:59.661080 (MainThread): On master: COMMIT
2022-02-07 19:31:59.662364 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:31:59.662844 (MainThread): On master: Close
2022-02-07 19:31:59.663883 (MainThread): 22:31:59 | Concurrency: 2 threads (target='dev')
2022-02-07 19:31:59.664471 (MainThread): 22:31:59 | 
2022-02-07 19:31:59.669230 (Thread-1): Began running node model.project_otus_dbt.hub_customer
2022-02-07 19:31:59.669655 (Thread-2): Began running node model.project_otus_dbt.hub_order
2022-02-07 19:31:59.672440 (Thread-1): 22:31:59 | 1 of 4 START incremental model public.hub_customer................... [RUN]
2022-02-07 19:31:59.673925 (Thread-2): 22:31:59 | 2 of 4 START incremental model public.hub_order...................... [RUN]
2022-02-07 19:31:59.674875 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:31:59.675683 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:31:59.676106 (Thread-1): Compiling model.project_otus_dbt.hub_customer
2022-02-07 19:31:59.676505 (Thread-2): Compiling model.project_otus_dbt.hub_order
2022-02-07 19:31:59.731027 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_order"
2022-02-07 19:31:59.735558 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_customer"
2022-02-07 19:31:59.736326 (Thread-2): finished collecting timing info
2022-02-07 19:31:59.779574 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:31:59.779842 (Thread-2): On model.project_otus_dbt.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_order"} */

    

  create temporary table "hub_order__dbt_tmp223159771548"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT ORDER_PK, ORDER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_orders"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_PK, a.ORDER_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_order" AS d
    ON a.ORDER_PK = d.ORDER_PK
    WHERE d.ORDER_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 19:31:59.779971 (Thread-2): Opening a new connection, currently in state init
2022-02-07 19:31:59.780527 (Thread-1): finished collecting timing info
2022-02-07 19:31:59.790566 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:31:59.790850 (Thread-1): On model.project_otus_dbt.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_customer"} */

    

  create temporary table "hub_customer__dbt_tmp223159788322"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_customers"

) as h
WHERE row_number = 1
),

row_rank_2 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_orders"

) as h
WHERE row_number = 1
),

row_rank_3 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_customers_crm"

) as h
WHERE row_number = 1
),

stage_union AS (
    SELECT * FROM row_rank_1
    UNION ALL
    SELECT * FROM row_rank_2
    UNION ALL
    SELECT * FROM row_rank_3
),

row_rank_union AS (

SELECT * FROM (

    SELECT *,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE, RECORD_SOURCE ASC
           ) AS row_rank_number
    FROM stage_union
    WHERE CUSTOMER_PK IS NOT NULL
) as h 
WHERE row_rank_number = 1
),

records_to_insert AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_union AS a
    LEFT JOIN "postgres"."public"."hub_customer" AS d
    ON a.CUSTOMER_PK = d.CUSTOMER_PK
    WHERE d.CUSTOMER_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 19:31:59.791050 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:31:59.823993 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 19:31:59.831220 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 19:31:59.912983 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:31:59.913248 (Thread-2): On model.project_otus_dbt.hub_order: BEGIN
2022-02-07 19:31:59.933531 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:31:59.936743 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:31:59.937085 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:31:59.937389 (Thread-1): On model.project_otus_dbt.hub_customer: BEGIN
2022-02-07 19:31:59.937697 (Thread-2): On model.project_otus_dbt.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_order__dbt_tmp223159771548'
        
      order by ordinal_position

  
2022-02-07 19:31:59.939754 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:31:59.940074 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:31:59.940160 (Thread-1): On model.project_otus_dbt.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_customer"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_customer__dbt_tmp223159788322'
        
      order by ordinal_position

  
2022-02-07 19:31:59.946562 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 19:31:59.993977 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:31:59.994509 (Thread-2): SQL status: SELECT 4 in 0.06 seconds
2022-02-07 19:31:59.994907 (Thread-1): On model.project_otus_dbt.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_customer"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_customer'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:32:00.005058 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:32:00.006924 (Thread-2): On model.project_otus_dbt.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_order'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:32:00.017080 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 19:32:00.017702 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 19:32:00.050846 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:32:00.061835 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:32:00.062347 (Thread-2): On model.project_otus_dbt.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_order'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:32:00.062922 (Thread-1): On model.project_otus_dbt.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_customer"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_customer'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:32:00.075330 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 19:32:00.078604 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_customer"
2022-02-07 19:32:00.079293 (Thread-2): SQL status: SELECT 4 in 0.02 seconds
2022-02-07 19:32:00.083490 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_order"
2022-02-07 19:32:00.084882 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:32:00.085745 (Thread-1): On model.project_otus_dbt.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_customer"} */

      

    insert into "postgres"."public"."hub_customer" ("customer_pk", "customer_key", "load_date", "record_source")
    (
       select "customer_pk", "customer_key", "load_date", "record_source"
       from "hub_customer__dbt_tmp223159788322"
    );
  
2022-02-07 19:32:00.087193 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:32:00.087840 (Thread-2): On model.project_otus_dbt.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_order"} */

      

    insert into "postgres"."public"."hub_order" ("order_pk", "order_key", "load_date", "record_source")
    (
       select "order_pk", "order_key", "load_date", "record_source"
       from "hub_order__dbt_tmp223159771548"
    );
  
2022-02-07 19:32:00.089135 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 19:32:00.096219 (Thread-2): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-07 19:32:00.103992 (Thread-2): On model.project_otus_dbt.hub_order: COMMIT
2022-02-07 19:32:00.104708 (Thread-1): On model.project_otus_dbt.hub_customer: COMMIT
2022-02-07 19:32:00.104987 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:32:00.105387 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:32:00.105667 (Thread-2): On model.project_otus_dbt.hub_order: COMMIT
2022-02-07 19:32:00.105964 (Thread-1): On model.project_otus_dbt.hub_customer: COMMIT
2022-02-07 19:32:00.111644 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 19:32:00.111951 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 19:32:00.114587 (Thread-1): finished collecting timing info
2022-02-07 19:32:00.117111 (Thread-2): finished collecting timing info
2022-02-07 19:32:00.117829 (Thread-1): On model.project_otus_dbt.hub_customer: Close
2022-02-07 19:32:00.118368 (Thread-2): On model.project_otus_dbt.hub_order: Close
2022-02-07 19:32:00.122569 (Thread-2): 22:32:00 | 2 of 4 OK created incremental model public.hub_order................. [INSERT 0 0 in 0.44s]
2022-02-07 19:32:00.125988 (Thread-1): 22:32:00 | 1 of 4 OK created incremental model public.hub_customer.............. [INSERT 0 0 in 0.45s]
2022-02-07 19:32:00.127167 (Thread-2): Finished running node model.project_otus_dbt.hub_order
2022-02-07 19:32:00.128023 (Thread-1): Finished running node model.project_otus_dbt.hub_customer
2022-02-07 19:32:00.128676 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 19:32:00.130217 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 19:32:00.132592 (Thread-2): 22:32:00 | 3 of 4 START incremental model public.hub_wheat_msk.................. [RUN]
2022-02-07 19:32:00.134176 (Thread-1): 22:32:00 | 4 of 4 START incremental model public.hub_wheat_usa.................. [RUN]
2022-02-07 19:32:00.134985 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:32:00.135670 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:32:00.135958 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-07 19:32:00.136238 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-07 19:32:00.166362 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 19:32:00.170466 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 19:32:00.171460 (Thread-1): finished collecting timing info
2022-02-07 19:32:00.182522 (Thread-2): finished collecting timing info
2022-02-07 19:32:00.185155 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:32:00.196018 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp223200180439"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 19:32:00.199342 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:32:00.199665 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:32:00.199968 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp223200197694"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 19:32:00.200581 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 19:32:00.246010 (Thread-1): SQL status: SELECT 0 in 0.05 seconds
2022-02-07 19:32:00.252490 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:32:00.252822 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-07 19:32:00.254533 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:32:00.254918 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:32:00.255204 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp223200180439'
        
      order by ordinal_position

  
2022-02-07 19:32:00.280680 (Thread-2): SQL status: SELECT 0 in 0.08 seconds
2022-02-07 19:32:00.287225 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:32:00.287598 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-07 19:32:00.289252 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:32:00.289949 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:32:00.290231 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp223200197694'
        
      order by ordinal_position

  
2022-02-07 19:32:00.305593 (Thread-1): SQL status: SELECT 4 in 0.05 seconds
2022-02-07 19:32:00.312028 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:32:00.312388 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:32:00.317764 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 19:32:00.327389 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:32:00.327707 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:32:00.333424 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 19:32:00.335511 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 19:32:00.335915 (Thread-2): SQL status: SELECT 4 in 0.05 seconds
2022-02-07 19:32:00.341857 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:32:00.342172 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:32:00.342626 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:32:00.342974 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp223200180439"
    );
  
2022-02-07 19:32:00.344761 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 19:32:00.346770 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 19:32:00.347120 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:32:00.347347 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 19:32:00.350532 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:32:00.354103 (Thread-1): finished collecting timing info
2022-02-07 19:32:00.354589 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-07 19:32:00.357684 (Thread-1): 22:32:00 | 4 of 4 OK created incremental model public.hub_wheat_usa............. [INSERT 0 0 in 0.22s]
2022-02-07 19:32:00.358308 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 19:32:00.386072 (Thread-2): SQL status: SELECT 4 in 0.04 seconds
2022-02-07 19:32:00.394189 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:32:00.394599 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:32:00.401287 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 19:32:00.403397 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 19:32:00.404607 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:32:00.404901 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp223200197694"
    );
  
2022-02-07 19:32:00.406610 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 19:32:00.408101 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 19:32:00.408282 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:32:00.408354 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 19:32:00.411179 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:32:00.413194 (Thread-2): finished collecting timing info
2022-02-07 19:32:00.413515 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-07 19:32:00.416091 (Thread-2): 22:32:00 | 3 of 4 OK created incremental model public.hub_wheat_msk............. [INSERT 0 0 in 0.28s]
2022-02-07 19:32:00.416711 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 19:32:00.420055 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:32:00.421068 (MainThread): Using postgres connection "master".
2022-02-07 19:32:00.421446 (MainThread): On master: BEGIN
2022-02-07 19:32:00.421801 (MainThread): Opening a new connection, currently in state closed
2022-02-07 19:32:00.437043 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:32:00.437335 (MainThread): On master: COMMIT
2022-02-07 19:32:00.437467 (MainThread): Using postgres connection "master".
2022-02-07 19:32:00.437596 (MainThread): On master: COMMIT
2022-02-07 19:32:00.438863 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:32:00.439367 (MainThread): On master: Close
2022-02-07 19:32:00.440458 (MainThread): 22:32:00 | 
2022-02-07 19:32:00.441000 (MainThread): 22:32:00 | Finished running 4 incremental models in 1.25s.
2022-02-07 19:32:00.441393 (MainThread): Connection 'master' was properly closed.
2022-02-07 19:32:00.441798 (MainThread): Connection 'model.project_otus_dbt.hub_wheat_usa' was properly closed.
2022-02-07 19:32:00.442371 (MainThread): Connection 'model.project_otus_dbt.hub_wheat_msk' was properly closed.
2022-02-07 19:32:00.672835 (MainThread): 
2022-02-07 19:32:00.673452 (MainThread): Completed successfully
2022-02-07 19:32:00.674177 (MainThread): 
Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
2022-02-07 19:32:00.674996 (MainThread): Flushing usage events
2022-02-07 19:38:04.082048 (MainThread): Running with dbt=0.19.0
2022-02-07 19:38:04.198067 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:sat'], partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 19:38:04.199147 (MainThread): Tracking: do not track
2022-02-07 19:38:04.275715 (MainThread): Partial parsing not enabled
2022-02-07 19:38:04.276716 (MainThread): Parsing macros/adapters.sql
2022-02-07 19:38:04.295976 (MainThread): Parsing macros/catalog.sql
2022-02-07 19:38:04.298381 (MainThread): Parsing macros/relations.sql
2022-02-07 19:38:04.299822 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 19:38:04.302172 (MainThread): Parsing macros/core.sql
2022-02-07 19:38:04.305919 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 19:38:04.342998 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 19:38:04.345056 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 19:38:04.346638 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 19:38:04.354754 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 19:38:04.356399 (MainThread): Parsing macros/etc/query.sql
2022-02-07 19:38:04.357519 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 19:38:04.358725 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 19:38:04.366709 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 19:38:04.387409 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 19:38:04.389735 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 19:38:04.433507 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 19:38:04.470926 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 19:38:04.481732 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 19:38:04.484530 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 19:38:04.503995 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 19:38:04.510512 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 19:38:04.518691 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 19:38:04.526480 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 19:38:04.529920 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 19:38:04.532661 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 19:38:04.536459 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 19:38:04.542826 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 19:38:04.545779 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 19:38:04.549132 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 19:38:04.551013 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 19:38:04.560034 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 19:38:04.562257 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 19:38:04.564171 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 19:38:04.567728 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 19:38:04.568774 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 19:38:04.570964 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 19:38:04.574047 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 19:38:04.575908 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 19:38:04.577922 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 19:38:04.580838 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 19:38:04.588356 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 19:38:04.591934 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 19:38:04.594675 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 19:38:04.596067 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 19:38:04.598047 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 19:38:04.599652 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 19:38:04.601262 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 19:38:04.606726 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 19:38:04.608062 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 19:38:04.609762 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 19:38:04.611825 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 19:38:04.614676 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 19:38:04.616465 (MainThread): Parsing macros/sql/star.sql
2022-02-07 19:38:04.620167 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 19:38:04.622031 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 19:38:04.626065 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 19:38:04.628027 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 19:38:04.635241 (MainThread): Parsing macros/sql/union.sql
2022-02-07 19:38:04.643331 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 19:38:04.645446 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 19:38:04.650457 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 19:38:04.654272 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 19:38:04.658071 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 19:38:04.666183 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 19:38:04.670864 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 19:38:04.672507 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 19:38:04.674493 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 19:38:04.677086 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 19:38:04.680568 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 19:38:04.681911 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 19:38:04.683385 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 19:38:04.684829 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 19:38:04.707595 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 19:38:04.711544 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 19:38:04.717405 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 19:38:04.722577 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 19:38:04.727737 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 19:38:04.742524 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 19:38:04.751774 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 19:38:04.757909 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 19:38:04.761599 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 19:38:04.764489 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 19:38:04.767900 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 19:38:04.775140 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 19:38:04.778499 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 19:38:04.788035 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 19:38:04.791699 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 19:38:04.796013 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 19:38:04.797035 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 19:38:04.800282 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 19:38:04.805912 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 19:38:04.812128 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 19:38:04.843460 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 19:38:04.848317 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 19:38:04.849315 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 19:38:04.865381 (MainThread): Parsing macros/tables/link.sql
2022-02-07 19:38:04.879966 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 19:38:04.895897 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 19:38:04.907723 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 19:38:04.914264 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 19:38:04.932361 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 19:38:04.941192 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 19:38:04.961727 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 19:38:04.964057 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 19:38:04.983933 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 19:38:04.989566 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 19:38:04.996385 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 19:38:04.997891 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 19:38:05.003760 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 19:38:05.006179 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 19:38:05.016582 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 19:38:05.025813 (MainThread): Partial parsing not enabled
2022-02-07 19:38:05.156511 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_customer_order".
2022-02-07 19:38:05.246575 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:38:05.375352 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 19:38:05.413970 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 19:38:05.435682 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:38:05.461229 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:38:05.483304 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:38:05.513622 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:38:05.528852 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:38:05.551389 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:38:05.573763 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_order_cnt_week".
2022-02-07 19:38:05.606641 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_customer_history".
2022-02-07 19:38:05.622139 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:38:05.763732 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:38:05.785314 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:38:05.806131 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:38:05.826165 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:38:05.845529 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 19:38:05.856928 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 19:38:06.596036 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.prestage

2022-02-07 19:38:06.834965 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 19:38:06.836618 (MainThread): Found 19 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 5 seed files, 4 sources, 0 exposures
2022-02-07 19:38:06.838742 (MainThread): The selector 'tag:sat' does not match any nodes and will be ignored
2022-02-07 19:38:06.841958 (MainThread): WARNING: Nothing to do. Try checking your model configs and model specification args
2022-02-07 19:38:06.842802 (MainThread): Flushing usage events
2022-02-07 19:38:06.843173 (MainThread): Connection 'model.project_otus_dbt.dim_week' was properly closed.
2022-02-07 19:38:36.129551 (MainThread): Running with dbt=0.19.0
2022-02-07 19:38:36.253907 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:satellite'], partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 19:38:36.254854 (MainThread): Tracking: do not track
2022-02-07 19:38:36.326834 (MainThread): Partial parsing not enabled
2022-02-07 19:38:36.328175 (MainThread): Parsing macros/adapters.sql
2022-02-07 19:38:36.353932 (MainThread): Parsing macros/catalog.sql
2022-02-07 19:38:36.358416 (MainThread): Parsing macros/relations.sql
2022-02-07 19:38:36.361975 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 19:38:36.366716 (MainThread): Parsing macros/core.sql
2022-02-07 19:38:36.374849 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 19:38:36.466916 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 19:38:36.471613 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 19:38:36.475479 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 19:38:36.488513 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 19:38:36.491171 (MainThread): Parsing macros/etc/query.sql
2022-02-07 19:38:36.494157 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 19:38:36.496001 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 19:38:36.508770 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 19:38:36.531922 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 19:38:36.535086 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 19:38:36.586359 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 19:38:36.613895 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 19:38:36.621019 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 19:38:36.623217 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 19:38:36.640352 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 19:38:36.648895 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 19:38:36.655781 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 19:38:36.664938 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 19:38:36.667302 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 19:38:36.669265 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 19:38:36.671687 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 19:38:36.677399 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 19:38:36.680189 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 19:38:36.682432 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 19:38:36.683722 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 19:38:36.694555 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 19:38:36.697359 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 19:38:36.699166 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 19:38:36.702299 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 19:38:36.703365 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 19:38:36.705580 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 19:38:36.710187 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 19:38:36.712717 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 19:38:36.714789 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 19:38:36.717593 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 19:38:36.724911 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 19:38:36.729641 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 19:38:36.732738 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 19:38:36.734307 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 19:38:36.736145 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 19:38:36.737621 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 19:38:36.739116 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 19:38:36.745977 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 19:38:36.747925 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 19:38:36.749781 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 19:38:36.751847 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 19:38:36.754871 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 19:38:36.757098 (MainThread): Parsing macros/sql/star.sql
2022-02-07 19:38:36.761968 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 19:38:36.764311 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 19:38:36.768558 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 19:38:36.770523 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 19:38:36.779257 (MainThread): Parsing macros/sql/union.sql
2022-02-07 19:38:36.788400 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 19:38:36.790521 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 19:38:36.796087 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 19:38:36.800162 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 19:38:36.804266 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 19:38:36.812092 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 19:38:36.817830 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 19:38:36.819714 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 19:38:36.821801 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 19:38:36.824800 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 19:38:36.829063 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 19:38:36.830846 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 19:38:36.832612 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 19:38:36.834278 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 19:38:36.866125 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 19:38:36.868633 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 19:38:36.871660 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 19:38:36.874194 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 19:38:36.877213 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 19:38:36.883838 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 19:38:36.888356 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 19:38:36.891601 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 19:38:36.894430 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 19:38:36.896766 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 19:38:36.899160 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 19:38:36.904458 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 19:38:36.907958 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 19:38:36.917362 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 19:38:36.921987 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 19:38:36.928749 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 19:38:36.930425 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 19:38:36.934588 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 19:38:36.945614 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 19:38:36.964575 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 19:38:36.982141 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 19:38:36.986433 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 19:38:36.987355 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 19:38:37.013590 (MainThread): Parsing macros/tables/link.sql
2022-02-07 19:38:37.048569 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 19:38:37.072309 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 19:38:37.085932 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 19:38:37.092786 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 19:38:37.118074 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 19:38:37.129937 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 19:38:37.155433 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 19:38:37.157423 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 19:38:37.186524 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 19:38:37.194526 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 19:38:37.206628 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 19:38:37.208789 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 19:38:37.220128 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 19:38:37.224353 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 19:38:37.241028 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 19:38:37.260168 (MainThread): Partial parsing not enabled
2022-02-07 19:38:37.368438 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_customer_order".
2022-02-07 19:38:37.457990 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:38:37.522055 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 19:38:37.545681 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 19:38:37.574077 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:38:37.604540 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:38:37.630818 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:38:37.665307 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:38:37.687314 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:38:37.707258 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:38:37.723979 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_order_cnt_week".
2022-02-07 19:38:37.768842 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_customer_history".
2022-02-07 19:38:37.801541 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:38:37.931316 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:38:37.956724 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:38:37.984042 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:38:38.008229 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:38:38.045207 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 19:38:38.063801 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 19:38:39.250654 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.prestage

2022-02-07 19:38:39.446080 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 19:38:39.447364 (MainThread): Found 19 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 5 seed files, 4 sources, 0 exposures
2022-02-07 19:38:39.452237 (MainThread): 
2022-02-07 19:38:39.453888 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:38:39.475757 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 19:38:39.510281 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 19:38:39.510864 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 19:38:39.511292 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 19:38:39.540214 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.03 seconds
2022-02-07 19:38:39.548067 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 19:38:39.632205 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 19:38:39.649382 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:38:39.649868 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 19:38:39.650214 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 19:38:39.670331 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:38:39.670766 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:38:39.671022 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 19:38:39.678396 (ThreadPoolExecutor-1_0): SQL status: SELECT 24 in 0.01 seconds
2022-02-07 19:38:39.717738 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 19:38:39.720255 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 19:38:39.772118 (MainThread): Using postgres connection "master".
2022-02-07 19:38:39.772398 (MainThread): On master: BEGIN
2022-02-07 19:38:39.772496 (MainThread): Opening a new connection, currently in state init
2022-02-07 19:38:39.785633 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:38:39.785926 (MainThread): Using postgres connection "master".
2022-02-07 19:38:39.786039 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 19:38:40.297297 (MainThread): SQL status: SELECT 14 in 0.51 seconds
2022-02-07 19:38:40.314892 (MainThread): On master: ROLLBACK
2022-02-07 19:38:40.316365 (MainThread): Using postgres connection "master".
2022-02-07 19:38:40.316687 (MainThread): On master: BEGIN
2022-02-07 19:38:40.318753 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:38:40.319067 (MainThread): On master: COMMIT
2022-02-07 19:38:40.319217 (MainThread): Using postgres connection "master".
2022-02-07 19:38:40.319357 (MainThread): On master: COMMIT
2022-02-07 19:38:40.320563 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:38:40.320879 (MainThread): On master: Close
2022-02-07 19:38:40.321711 (MainThread): 22:38:40 | Concurrency: 2 threads (target='dev')
2022-02-07 19:38:40.322076 (MainThread): 22:38:40 | 
2022-02-07 19:38:40.326100 (Thread-1): Began running node model.project_otus_dbt.sat_customer_crm_details
2022-02-07 19:38:40.326449 (Thread-2): Began running node model.project_otus_dbt.sat_customer_details
2022-02-07 19:38:40.363694 (Thread-1): 22:38:40 | 1 of 5 START incremental model public.sat_customer_crm_details....... [RUN]
2022-02-07 19:38:40.366772 (Thread-2): 22:38:40 | 2 of 5 START incremental model public.sat_customer_details........... [RUN]
2022-02-07 19:38:40.368141 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:38:40.369067 (Thread-1): Compiling model.project_otus_dbt.sat_customer_crm_details
2022-02-07 19:38:40.370073 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:38:40.386257 (Thread-2): Compiling model.project_otus_dbt.sat_customer_details
2022-02-07 19:38:40.506654 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_customer_crm_details"
2022-02-07 19:38:40.511316 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_customer_details"
2022-02-07 19:38:40.512233 (Thread-1): finished collecting timing info
2022-02-07 19:38:40.523517 (Thread-2): finished collecting timing info
2022-02-07 19:38:40.605740 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:38:40.609248 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:38:40.609648 (Thread-2): On model.project_otus_dbt.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_details"} */

    

  create temporary table "sat_customer_details__dbt_tmp223840577456"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.first_name, a.last_name, a.email, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_customers" AS a
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.first_name, a.last_name, a.email, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_customer_details" as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.first_name, e.last_name, e.email, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 19:38:40.609951 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_crm_details"} */

    

  create temporary table "sat_customer_crm_details__dbt_tmp223840580920"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.country, a.age, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_customers_crm" AS a
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.country, a.age, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_customer_crm_details" as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.country, e.age, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 19:38:40.610240 (Thread-2): Opening a new connection, currently in state init
2022-02-07 19:38:40.610653 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:38:40.639500 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 19:38:40.647578 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 19:38:40.658114 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:38:40.660189 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:38:40.660416 (Thread-2): On model.project_otus_dbt.sat_customer_details: BEGIN
2022-02-07 19:38:40.660670 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: BEGIN
2022-02-07 19:38:40.662129 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:38:40.662387 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:38:40.662608 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:38:40.662824 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:38:40.663047 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_crm_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_crm_details__dbt_tmp223840580920'
        
      order by ordinal_position

  
2022-02-07 19:38:40.663243 (Thread-2): On model.project_otus_dbt.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details__dbt_tmp223840577456'
        
      order by ordinal_position

  
2022-02-07 19:38:40.671741 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 19:38:40.672016 (Thread-2): SQL status: SELECT 8 in 0.01 seconds
2022-02-07 19:38:40.678995 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:38:40.683491 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:38:40.684200 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_crm_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_crm_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:38:40.684507 (Thread-2): On model.project_otus_dbt.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:38:40.690231 (Thread-2): SQL status: SELECT 8 in 0.01 seconds
2022-02-07 19:38:40.690641 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 19:38:40.698623 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:38:40.704702 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:38:40.704945 (Thread-2): On model.project_otus_dbt.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:38:40.705187 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_crm_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_crm_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:38:40.709416 (Thread-2): SQL status: SELECT 8 in 0.00 seconds
2022-02-07 19:38:40.709784 (Thread-1): SQL status: SELECT 7 in 0.00 seconds
2022-02-07 19:38:40.711170 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_customer_details"
2022-02-07 19:38:40.712410 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_customer_crm_details"
2022-02-07 19:38:40.713242 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:38:40.713410 (Thread-2): On model.project_otus_dbt.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_details"} */

      

    insert into "postgres"."public"."sat_customer_details" ("customer_pk", "customer_hashdiff", "first_name", "last_name", "email", "effective_from", "load_date", "record_source")
    (
       select "customer_pk", "customer_hashdiff", "first_name", "last_name", "email", "effective_from", "load_date", "record_source"
       from "sat_customer_details__dbt_tmp223840577456"
    );
  
2022-02-07 19:38:40.713890 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:38:40.714298 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_crm_details"} */

      

    insert into "postgres"."public"."sat_customer_crm_details" ("customer_pk", "customer_hashdiff", "country", "age", "effective_from", "load_date", "record_source")
    (
       select "customer_pk", "customer_hashdiff", "country", "age", "effective_from", "load_date", "record_source"
       from "sat_customer_crm_details__dbt_tmp223840580920"
    );
  
2022-02-07 19:38:40.715686 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 19:38:40.716050 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 19:38:40.722997 (Thread-2): On model.project_otus_dbt.sat_customer_details: COMMIT
2022-02-07 19:38:40.724459 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: COMMIT
2022-02-07 19:38:40.724794 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:38:40.725027 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:38:40.725240 (Thread-2): On model.project_otus_dbt.sat_customer_details: COMMIT
2022-02-07 19:38:40.725435 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: COMMIT
2022-02-07 19:38:40.732110 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 19:38:40.732614 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 19:38:40.737324 (Thread-2): finished collecting timing info
2022-02-07 19:38:40.742199 (Thread-1): finished collecting timing info
2022-02-07 19:38:40.743203 (Thread-2): On model.project_otus_dbt.sat_customer_details: Close
2022-02-07 19:38:40.743778 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: Close
2022-02-07 19:38:40.754690 (Thread-1): 22:38:40 | 1 of 5 OK created incremental model public.sat_customer_crm_details.. [INSERT 0 0 in 0.38s]
2022-02-07 19:38:40.755547 (Thread-2): 22:38:40 | 2 of 5 OK created incremental model public.sat_customer_details...... [INSERT 0 0 in 0.38s]
2022-02-07 19:38:40.756288 (Thread-1): Finished running node model.project_otus_dbt.sat_customer_crm_details
2022-02-07 19:38:40.757124 (Thread-2): Finished running node model.project_otus_dbt.sat_customer_details
2022-02-07 19:38:40.757895 (Thread-1): Began running node model.project_otus_dbt.sat_order_details
2022-02-07 19:38:40.758779 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 19:38:40.762228 (Thread-1): 22:38:40 | 3 of 5 START incremental model public.sat_order_details.............. [RUN]
2022-02-07 19:38:40.765923 (Thread-2): 22:38:40 | 4 of 5 START incremental model public.sat_wheat_msk_details.......... [RUN]
2022-02-07 19:38:40.767713 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:38:40.768845 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 19:38:40.769362 (Thread-1): Compiling model.project_otus_dbt.sat_order_details
2022-02-07 19:38:40.770149 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 19:38:40.816191 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_order_details"
2022-02-07 19:38:40.826118 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 19:38:40.827024 (Thread-1): finished collecting timing info
2022-02-07 19:38:40.837355 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:38:40.837745 (Thread-2): finished collecting timing info
2022-02-07 19:38:40.838345 (Thread-1): On model.project_otus_dbt.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_order_details"} */

    

  create temporary table "sat_order_details__dbt_tmp223840835718"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.order_date, a.status, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_orders" AS a
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.order_date, a.status, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_order_details" as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.order_date, e.status, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 19:38:40.847830 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 19:38:40.848292 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:38:40.849135 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 19:38:40.850135 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-07 19:38:40.850305 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 19:38:40.870415 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:38:40.870868 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 19:38:40.871360 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

  create  table "postgres"."public"."sat_wheat_msk_details"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.first_name, a.last_name, a.email, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.first_name, e.last_name, e.email, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 19:38:40.876209 (Thread-2): Postgres error: column a.first_name does not exist
LINE 10:     SELECT a.DATE_PK, a.DATE_HASHDIFF, a.first_name, a.last_...
                                                ^

2022-02-07 19:38:40.876502 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: ROLLBACK
2022-02-07 19:38:40.878075 (Thread-2): finished collecting timing info
2022-02-07 19:38:40.878596 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-07 19:38:40.879319 (Thread-2): Database Error in model sat_wheat_msk_details (models/raw_vault/sats/sat_wheat_msk_details.sql)
  column a.first_name does not exist
  LINE 10:     SELECT a.DATE_PK, a.DATE_HASHDIFF, a.first_name, a.last_...
                                                  ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/sats/sat_wheat_msk_details.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column a.first_name does not exist
LINE 10:     SELECT a.DATE_PK, a.DATE_HASHDIFF, a.first_name, a.last_...
                                                ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 132, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model sat_wheat_msk_details (models/raw_vault/sats/sat_wheat_msk_details.sql)
  column a.first_name does not exist
  LINE 10:     SELECT a.DATE_PK, a.DATE_HASHDIFF, a.first_name, a.last_...
                                                  ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/sats/sat_wheat_msk_details.sql
2022-02-07 19:38:40.883566 (Thread-2): 22:38:40 | 4 of 5 ERROR creating incremental model public.sat_wheat_msk_details. [ERROR in 0.11s]
2022-02-07 19:38:40.883921 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 19:38:40.884157 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 19:38:40.885947 (Thread-2): 22:38:40 | 5 of 5 START incremental model public.sat_wheat_usa_details.......... [RUN]
2022-02-07 19:38:40.886883 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 19:38:40.887846 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 19:38:40.899072 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 19:38:40.901485 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:38:40.912441 (Thread-1): On model.project_otus_dbt.sat_order_details: BEGIN
2022-02-07 19:38:40.924600 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 19:38:40.925029 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:38:40.925548 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:38:40.925850 (Thread-1): On model.project_otus_dbt.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details__dbt_tmp223840835718'
        
      order by ordinal_position

  
2022-02-07 19:38:40.926107 (Thread-2): finished collecting timing info
2022-02-07 19:38:40.941282 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 19:38:40.942430 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 19:38:40.942882 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-07 19:38:40.943367 (Thread-1): SQL status: SELECT 7 in 0.02 seconds
2022-02-07 19:38:40.943894 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 19:38:40.954701 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:38:40.955845 (Thread-1): On model.project_otus_dbt.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:38:40.965760 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 19:38:40.978785 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:38:40.979801 (Thread-1): On model.project_otus_dbt.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:38:40.983204 (Thread-2): SQL status: BEGIN in 0.04 seconds
2022-02-07 19:38:40.983633 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 19:38:40.983917 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

  create  table "postgres"."public"."sat_wheat_usa_details"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.first_name, a.last_name, a.email, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.first_name, e.last_name, e.email, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 19:38:40.990599 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 19:38:40.991045 (Thread-2): Postgres error: column a.first_name does not exist
LINE 10:     SELECT a.DATE_PK, a.DATE_HASHDIFF, a.first_name, a.last_...
                                                ^

2022-02-07 19:38:40.993264 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_order_details"
2022-02-07 19:38:40.994053 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: ROLLBACK
2022-02-07 19:38:40.995744 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:38:40.996274 (Thread-1): On model.project_otus_dbt.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_order_details"} */

      

    insert into "postgres"."public"."sat_order_details" ("order_pk", "order_hashdiff", "order_date", "status", "effective_from", "load_date", "record_source")
    (
       select "order_pk", "order_hashdiff", "order_date", "status", "effective_from", "load_date", "record_source"
       from "sat_order_details__dbt_tmp223840835718"
    );
  
2022-02-07 19:38:40.997690 (Thread-2): finished collecting timing info
2022-02-07 19:38:40.998638 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-07 19:38:40.999999 (Thread-2): Database Error in model sat_wheat_usa_details (models/raw_vault/sats/sat_wheat_usa_details.sql)
  column a.first_name does not exist
  LINE 10:     SELECT a.DATE_PK, a.DATE_HASHDIFF, a.first_name, a.last_...
                                                  ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/sats/sat_wheat_usa_details.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column a.first_name does not exist
LINE 10:     SELECT a.DATE_PK, a.DATE_HASHDIFF, a.first_name, a.last_...
                                                ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 132, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model sat_wheat_usa_details (models/raw_vault/sats/sat_wheat_usa_details.sql)
  column a.first_name does not exist
  LINE 10:     SELECT a.DATE_PK, a.DATE_HASHDIFF, a.first_name, a.last_...
                                                  ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/sats/sat_wheat_usa_details.sql
2022-02-07 19:38:41.001295 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 19:38:41.004450 (Thread-2): 22:38:40 | 5 of 5 ERROR creating incremental model public.sat_wheat_usa_details. [ERROR in 0.11s]
2022-02-07 19:38:41.007284 (Thread-1): On model.project_otus_dbt.sat_order_details: COMMIT
2022-02-07 19:38:41.008051 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 19:38:41.008464 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:38:41.010196 (Thread-1): On model.project_otus_dbt.sat_order_details: COMMIT
2022-02-07 19:38:41.015592 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:38:41.023066 (Thread-1): finished collecting timing info
2022-02-07 19:38:41.024293 (Thread-1): On model.project_otus_dbt.sat_order_details: Close
2022-02-07 19:38:41.031357 (Thread-1): 22:38:41 | 3 of 5 OK created incremental model public.sat_order_details......... [INSERT 0 0 in 0.26s]
2022-02-07 19:38:41.032171 (Thread-1): Finished running node model.project_otus_dbt.sat_order_details
2022-02-07 19:38:41.036863 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:38:41.037418 (MainThread): Using postgres connection "master".
2022-02-07 19:38:41.037775 (MainThread): On master: BEGIN
2022-02-07 19:38:41.038077 (MainThread): Opening a new connection, currently in state closed
2022-02-07 19:38:41.058815 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:38:41.059422 (MainThread): On master: COMMIT
2022-02-07 19:38:41.059937 (MainThread): Using postgres connection "master".
2022-02-07 19:38:41.060196 (MainThread): On master: COMMIT
2022-02-07 19:38:41.062516 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:38:41.063001 (MainThread): On master: Close
2022-02-07 19:38:41.064528 (MainThread): 22:38:41 | 
2022-02-07 19:38:41.065265 (MainThread): 22:38:41 | Finished running 5 incremental models in 1.61s.
2022-02-07 19:38:41.066060 (MainThread): Connection 'master' was properly closed.
2022-02-07 19:38:41.066662 (MainThread): Connection 'model.project_otus_dbt.sat_order_details' was properly closed.
2022-02-07 19:38:41.067261 (MainThread): Connection 'model.project_otus_dbt.sat_wheat_usa_details' was properly closed.
2022-02-07 19:38:41.366789 (MainThread): 
2022-02-07 19:38:41.367389 (MainThread): Completed with 2 errors and 0 warnings:
2022-02-07 19:38:41.367981 (MainThread): 
2022-02-07 19:38:41.368628 (MainThread): Database Error in model sat_wheat_msk_details (models/raw_vault/sats/sat_wheat_msk_details.sql)
2022-02-07 19:38:41.369326 (MainThread):   column a.first_name does not exist
2022-02-07 19:38:41.369984 (MainThread):   LINE 10:     SELECT a.DATE_PK, a.DATE_HASHDIFF, a.first_name, a.last_...
2022-02-07 19:38:41.370748 (MainThread):                                                   ^
2022-02-07 19:38:41.371299 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/raw_vault/sats/sat_wheat_msk_details.sql
2022-02-07 19:38:41.371815 (MainThread): 
2022-02-07 19:38:41.372431 (MainThread): Database Error in model sat_wheat_usa_details (models/raw_vault/sats/sat_wheat_usa_details.sql)
2022-02-07 19:38:41.374560 (MainThread):   column a.first_name does not exist
2022-02-07 19:38:41.375931 (MainThread):   LINE 10:     SELECT a.DATE_PK, a.DATE_HASHDIFF, a.first_name, a.last_...
2022-02-07 19:38:41.377800 (MainThread):                                                   ^
2022-02-07 19:38:41.380232 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/raw_vault/sats/sat_wheat_usa_details.sql
2022-02-07 19:38:41.381141 (MainThread): 
Done. PASS=3 WARN=0 ERROR=2 SKIP=0 TOTAL=5
2022-02-07 19:38:41.382545 (MainThread): Flushing usage events
2022-02-07 19:44:01.050197 (MainThread): Running with dbt=0.19.0
2022-02-07 19:44:01.163650 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:satellite'], partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 19:44:01.165703 (MainThread): Tracking: do not track
2022-02-07 19:44:01.278506 (MainThread): Partial parsing not enabled
2022-02-07 19:44:01.279906 (MainThread): Parsing macros/adapters.sql
2022-02-07 19:44:01.299013 (MainThread): Parsing macros/catalog.sql
2022-02-07 19:44:01.301382 (MainThread): Parsing macros/relations.sql
2022-02-07 19:44:01.302718 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 19:44:01.305028 (MainThread): Parsing macros/core.sql
2022-02-07 19:44:01.308680 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 19:44:01.350166 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 19:44:01.353809 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 19:44:01.356936 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 19:44:01.377031 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 19:44:01.380569 (MainThread): Parsing macros/etc/query.sql
2022-02-07 19:44:01.383198 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 19:44:01.386089 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 19:44:01.406137 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 19:44:01.444053 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 19:44:01.445962 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 19:44:01.473681 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 19:44:01.491414 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 19:44:01.497556 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 19:44:01.499598 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 19:44:01.512372 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 19:44:01.516962 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 19:44:01.532933 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 19:44:01.552037 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 19:44:01.557642 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 19:44:01.562208 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 19:44:01.566782 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 19:44:01.576701 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 19:44:01.579349 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 19:44:01.582302 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 19:44:01.584125 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 19:44:01.595504 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 19:44:01.598982 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 19:44:01.601451 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 19:44:01.604387 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 19:44:01.605573 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 19:44:01.607990 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 19:44:01.614250 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 19:44:01.616275 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 19:44:01.618369 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 19:44:01.620811 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 19:44:01.627468 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 19:44:01.631424 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 19:44:01.634224 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 19:44:01.635821 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 19:44:01.637585 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 19:44:01.639108 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 19:44:01.640680 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 19:44:01.646295 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 19:44:01.647670 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 19:44:01.649277 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 19:44:01.651278 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 19:44:01.654190 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 19:44:01.658672 (MainThread): Parsing macros/sql/star.sql
2022-02-07 19:44:01.663961 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 19:44:01.665918 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 19:44:01.669953 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 19:44:01.671740 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 19:44:01.684134 (MainThread): Parsing macros/sql/union.sql
2022-02-07 19:44:01.706315 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 19:44:01.710826 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 19:44:01.718293 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 19:44:01.723745 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 19:44:01.729534 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 19:44:01.737957 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 19:44:01.744798 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 19:44:01.747560 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 19:44:01.749884 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 19:44:01.752778 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 19:44:01.759918 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 19:44:01.763397 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 19:44:01.767164 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 19:44:01.770478 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 19:44:01.793970 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 19:44:01.795947 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 19:44:01.798382 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 19:44:01.803691 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 19:44:01.808822 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 19:44:01.825568 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 19:44:01.836389 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 19:44:01.842879 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 19:44:01.846733 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 19:44:01.851806 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 19:44:01.857028 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 19:44:01.865602 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 19:44:01.870965 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 19:44:01.885809 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 19:44:01.892541 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 19:44:01.903108 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 19:44:01.905510 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 19:44:01.912242 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 19:44:01.921508 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 19:44:01.933314 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 19:44:01.943077 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 19:44:01.946525 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 19:44:01.947222 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 19:44:01.958060 (MainThread): Parsing macros/tables/link.sql
2022-02-07 19:44:01.969172 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 19:44:01.982225 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 19:44:01.991057 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 19:44:01.995640 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 19:44:02.011292 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 19:44:02.029244 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 19:44:02.073768 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 19:44:02.075357 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 19:44:02.093128 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 19:44:02.098693 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 19:44:02.106809 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 19:44:02.110989 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 19:44:02.128217 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 19:44:02.133816 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 19:44:02.155854 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 19:44:02.173585 (MainThread): Partial parsing not enabled
2022-02-07 19:44:02.351156 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_customer_order".
2022-02-07 19:44:02.442625 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:44:02.505628 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 19:44:02.548642 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 19:44:02.569075 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:44:02.608897 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:44:02.637276 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 19:44:02.681373 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_order".
2022-02-07 19:44:02.699947 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_customer".
2022-02-07 19:44:02.724997 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 19:44:02.745202 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_order_cnt_week".
2022-02-07 19:44:02.780721 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_customer_history".
2022-02-07 19:44:02.801585 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 19:44:02.915718 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers_crm".
2022-02-07 19:44:02.943100 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_orders".
2022-02-07 19:44:02.965055 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 19:44:02.986186 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_customers".
2022-02-07 19:44:03.005476 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 19:44:03.017926 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 19:44:03.791041 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.prestage

2022-02-07 19:44:04.035470 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 19:44:04.036580 (MainThread): Found 19 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 5 seed files, 4 sources, 0 exposures
2022-02-07 19:44:04.040200 (MainThread): 
2022-02-07 19:44:04.041105 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:44:04.055478 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 19:44:04.076273 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 19:44:04.076566 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 19:44:04.076696 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 19:44:04.096972 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 19:44:04.103199 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 19:44:04.162823 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 19:44:04.181903 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:44:04.182299 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 19:44:04.182502 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 19:44:04.205197 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:44:04.205617 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 19:44:04.205871 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 19:44:04.213157 (ThreadPoolExecutor-1_0): SQL status: SELECT 24 in 0.01 seconds
2022-02-07 19:44:04.253602 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 19:44:04.256411 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 19:44:04.285080 (MainThread): Using postgres connection "master".
2022-02-07 19:44:04.285345 (MainThread): On master: BEGIN
2022-02-07 19:44:04.285434 (MainThread): Opening a new connection, currently in state init
2022-02-07 19:44:04.298847 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 19:44:04.299086 (MainThread): Using postgres connection "master".
2022-02-07 19:44:04.299156 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 19:44:04.587127 (MainThread): SQL status: SELECT 14 in 0.29 seconds
2022-02-07 19:44:04.601328 (MainThread): On master: ROLLBACK
2022-02-07 19:44:04.603627 (MainThread): Using postgres connection "master".
2022-02-07 19:44:04.603885 (MainThread): On master: BEGIN
2022-02-07 19:44:04.606461 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:44:04.606741 (MainThread): On master: COMMIT
2022-02-07 19:44:04.606916 (MainThread): Using postgres connection "master".
2022-02-07 19:44:04.607126 (MainThread): On master: COMMIT
2022-02-07 19:44:04.608384 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:44:04.608636 (MainThread): On master: Close
2022-02-07 19:44:04.609311 (MainThread): 22:44:04 | Concurrency: 2 threads (target='dev')
2022-02-07 19:44:04.609682 (MainThread): 22:44:04 | 
2022-02-07 19:44:04.652765 (Thread-1): Began running node model.project_otus_dbt.sat_customer_crm_details
2022-02-07 19:44:04.653482 (Thread-2): Began running node model.project_otus_dbt.sat_customer_details
2022-02-07 19:44:04.657738 (Thread-1): 22:44:04 | 1 of 5 START incremental model public.sat_customer_crm_details....... [RUN]
2022-02-07 19:44:04.660668 (Thread-2): 22:44:04 | 2 of 5 START incremental model public.sat_customer_details........... [RUN]
2022-02-07 19:44:04.662246 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:44:04.663566 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:44:04.666213 (Thread-2): Compiling model.project_otus_dbt.sat_customer_details
2022-02-07 19:44:04.665325 (Thread-1): Compiling model.project_otus_dbt.sat_customer_crm_details
2022-02-07 19:44:04.844868 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_customer_details"
2022-02-07 19:44:04.848929 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_customer_crm_details"
2022-02-07 19:44:04.850193 (Thread-2): finished collecting timing info
2022-02-07 19:44:04.850918 (Thread-1): finished collecting timing info
2022-02-07 19:44:04.993820 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:44:04.989507 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:44:04.994287 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_crm_details"} */

    

  create temporary table "sat_customer_crm_details__dbt_tmp224404958908"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.country, a.age, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_customers_crm" AS a
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.country, a.age, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_customer_crm_details" as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.country, e.age, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 19:44:04.994832 (Thread-2): On model.project_otus_dbt.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_details"} */

    

  create temporary table "sat_customer_details__dbt_tmp224404974306"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.first_name, a.last_name, a.email, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_customers" AS a
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.first_name, a.last_name, a.email, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_customer_details" as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.first_name, e.last_name, e.email, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 19:44:04.995400 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:44:04.995982 (Thread-2): Opening a new connection, currently in state init
2022-02-07 19:44:05.065437 (Thread-1): SQL status: SELECT 0 in 0.07 seconds
2022-02-07 19:44:05.073266 (Thread-2): SQL status: SELECT 0 in 0.08 seconds
2022-02-07 19:44:05.098585 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:44:05.104772 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: BEGIN
2022-02-07 19:44:05.107496 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:44:05.108195 (Thread-2): On model.project_otus_dbt.sat_customer_details: BEGIN
2022-02-07 19:44:05.111199 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:44:05.111621 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:44:05.112075 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:44:05.112498 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:44:05.112834 (Thread-2): On model.project_otus_dbt.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details__dbt_tmp224404974306'
        
      order by ordinal_position

  
2022-02-07 19:44:05.113142 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_crm_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_crm_details__dbt_tmp224404958908'
        
      order by ordinal_position

  
2022-02-07 19:44:05.126410 (Thread-2): SQL status: SELECT 8 in 0.01 seconds
2022-02-07 19:44:05.136570 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:44:05.136914 (Thread-2): On model.project_otus_dbt.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:44:05.137243 (Thread-1): SQL status: SELECT 7 in 0.02 seconds
2022-02-07 19:44:05.147763 (Thread-2): SQL status: SELECT 8 in 0.01 seconds
2022-02-07 19:44:05.149332 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:44:05.159782 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:44:05.160204 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_crm_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_crm_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:44:05.160587 (Thread-2): On model.project_otus_dbt.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:44:05.166413 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 19:44:05.174358 (Thread-2): SQL status: SELECT 8 in 0.01 seconds
2022-02-07 19:44:05.178504 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:44:05.180648 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_customer_details"
2022-02-07 19:44:05.181167 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_crm_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_crm_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:44:05.182302 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:44:05.182848 (Thread-2): On model.project_otus_dbt.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_details"} */

      

    insert into "postgres"."public"."sat_customer_details" ("customer_pk", "customer_hashdiff", "first_name", "last_name", "email", "effective_from", "load_date", "record_source")
    (
       select "customer_pk", "customer_hashdiff", "first_name", "last_name", "email", "effective_from", "load_date", "record_source"
       from "sat_customer_details__dbt_tmp224404974306"
    );
  
2022-02-07 19:44:05.185441 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 19:44:05.193527 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 19:44:05.195818 (Thread-2): On model.project_otus_dbt.sat_customer_details: COMMIT
2022-02-07 19:44:05.198562 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_customer_crm_details"
2022-02-07 19:44:05.199087 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_customer_details".
2022-02-07 19:44:05.199895 (Thread-2): On model.project_otus_dbt.sat_customer_details: COMMIT
2022-02-07 19:44:05.200732 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:44:05.201113 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_customer_crm_details"} */

      

    insert into "postgres"."public"."sat_customer_crm_details" ("customer_pk", "customer_hashdiff", "country", "age", "effective_from", "load_date", "record_source")
    (
       select "customer_pk", "customer_hashdiff", "country", "age", "effective_from", "load_date", "record_source"
       from "sat_customer_crm_details__dbt_tmp224404958908"
    );
  
2022-02-07 19:44:05.203446 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 19:44:05.206384 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: COMMIT
2022-02-07 19:44:05.206875 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_customer_crm_details".
2022-02-07 19:44:05.207211 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: COMMIT
2022-02-07 19:44:05.219915 (Thread-2): SQL status: COMMIT in 0.02 seconds
2022-02-07 19:44:05.224835 (Thread-2): finished collecting timing info
2022-02-07 19:44:05.225496 (Thread-1): SQL status: COMMIT in 0.02 seconds
2022-02-07 19:44:05.225972 (Thread-2): On model.project_otus_dbt.sat_customer_details: Close
2022-02-07 19:44:05.231216 (Thread-1): finished collecting timing info
2022-02-07 19:44:05.232471 (Thread-1): On model.project_otus_dbt.sat_customer_crm_details: Close
2022-02-07 19:44:05.248724 (Thread-1): 22:44:05 | 1 of 5 OK created incremental model public.sat_customer_crm_details.. [INSERT 0 0 in 0.57s]
2022-02-07 19:44:05.249053 (Thread-2): 22:44:05 | 2 of 5 OK created incremental model public.sat_customer_details...... [INSERT 0 0 in 0.58s]
2022-02-07 19:44:05.249788 (Thread-1): Finished running node model.project_otus_dbt.sat_customer_crm_details
2022-02-07 19:44:05.250768 (Thread-2): Finished running node model.project_otus_dbt.sat_customer_details
2022-02-07 19:44:05.251516 (Thread-1): Began running node model.project_otus_dbt.sat_order_details
2022-02-07 19:44:05.252667 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 19:44:05.255674 (Thread-1): 22:44:05 | 3 of 5 START incremental model public.sat_order_details.............. [RUN]
2022-02-07 19:44:05.258462 (Thread-2): 22:44:05 | 4 of 5 START incremental model public.sat_wheat_msk_details.......... [RUN]
2022-02-07 19:44:05.259875 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:44:05.261633 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 19:44:05.262311 (Thread-1): Compiling model.project_otus_dbt.sat_order_details
2022-02-07 19:44:05.262874 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 19:44:05.343064 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_order_details"
2022-02-07 19:44:05.347697 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 19:44:05.349068 (Thread-2): finished collecting timing info
2022-02-07 19:44:05.360838 (Thread-1): finished collecting timing info
2022-02-07 19:44:05.372772 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 19:44:05.391221 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:44:05.391679 (Thread-1): On model.project_otus_dbt.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_order_details"} */

    

  create temporary table "sat_order_details__dbt_tmp224405384897"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.order_date, a.status, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_orders" AS a
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.order_date, a.status, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_order_details" as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.order_date, e.status, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 19:44:05.392183 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 19:44:05.392667 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 19:44:05.393198 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-07 19:44:05.394272 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 19:44:05.418465 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:44:05.419168 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 19:44:05.419753 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

  create  table "postgres"."public"."sat_wheat_msk_details"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 19:44:05.424432 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 19:44:05.430804 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:44:05.431090 (Thread-1): On model.project_otus_dbt.sat_order_details: BEGIN
2022-02-07 19:44:05.433041 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 19:44:05.433330 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:44:05.433427 (Thread-1): On model.project_otus_dbt.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details__dbt_tmp224405384897'
        
      order by ordinal_position

  
2022-02-07 19:44:05.441748 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 19:44:05.452277 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:44:05.452722 (Thread-2): SQL status: SELECT 216 in 0.03 seconds
2022-02-07 19:44:05.453164 (Thread-1): On model.project_otus_dbt.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:44:05.455775 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 19:44:05.456431 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 19:44:05.456871 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 19:44:05.461359 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:44:05.465993 (Thread-2): finished collecting timing info
2022-02-07 19:44:05.466658 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 19:44:05.467137 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-07 19:44:05.477462 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:44:05.481731 (Thread-2): 22:44:05 | 4 of 5 OK created incremental model public.sat_wheat_msk_details..... [SELECT 216 in 0.22s]
2022-02-07 19:44:05.482255 (Thread-1): On model.project_otus_dbt.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 19:44:05.483257 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 19:44:05.484468 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 19:44:05.488209 (Thread-2): 22:44:05 | 5 of 5 START incremental model public.sat_wheat_usa_details.......... [RUN]
2022-02-07 19:44:05.489392 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 19:44:05.490188 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 19:44:05.500201 (Thread-1): SQL status: SELECT 7 in 0.02 seconds
2022-02-07 19:44:05.507640 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_order_details"
2022-02-07 19:44:05.535833 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:44:05.538344 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 19:44:05.538803 (Thread-1): On model.project_otus_dbt.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_order_details"} */

      

    insert into "postgres"."public"."sat_order_details" ("order_pk", "order_hashdiff", "order_date", "status", "effective_from", "load_date", "record_source")
    (
       select "order_pk", "order_hashdiff", "order_date", "status", "effective_from", "load_date", "record_source"
       from "sat_order_details__dbt_tmp224405384897"
    );
  
2022-02-07 19:44:05.540772 (Thread-2): finished collecting timing info
2022-02-07 19:44:05.553217 (Thread-1): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-07 19:44:05.557814 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 19:44:05.560469 (Thread-1): On model.project_otus_dbt.sat_order_details: COMMIT
2022-02-07 19:44:05.561486 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_order_details".
2022-02-07 19:44:05.561954 (Thread-1): On model.project_otus_dbt.sat_order_details: COMMIT
2022-02-07 19:44:05.562617 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 19:44:05.563094 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-07 19:44:05.563504 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 19:44:05.567311 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:44:05.574643 (Thread-1): finished collecting timing info
2022-02-07 19:44:05.575658 (Thread-1): On model.project_otus_dbt.sat_order_details: Close
2022-02-07 19:44:05.583406 (Thread-1): 22:44:05 | 3 of 5 OK created incremental model public.sat_order_details......... [INSERT 0 0 in 0.32s]
2022-02-07 19:44:05.585379 (Thread-1): Finished running node model.project_otus_dbt.sat_order_details
2022-02-07 19:44:05.592518 (Thread-2): SQL status: BEGIN in 0.03 seconds
2022-02-07 19:44:05.593187 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 19:44:05.593654 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

  create  table "postgres"."public"."sat_wheat_usa_details"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 19:44:05.625676 (Thread-2): SQL status: SELECT 283 in 0.03 seconds
2022-02-07 19:44:05.628171 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 19:44:05.628511 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 19:44:05.628762 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 19:44:05.636008 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 19:44:05.640961 (Thread-2): finished collecting timing info
2022-02-07 19:44:05.641610 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-07 19:44:05.646296 (Thread-2): 22:44:05 | 5 of 5 OK created incremental model public.sat_wheat_usa_details..... [SELECT 283 in 0.15s]
2022-02-07 19:44:05.646977 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 19:44:05.652124 (MainThread): Acquiring new postgres connection "master".
2022-02-07 19:44:05.652935 (MainThread): Using postgres connection "master".
2022-02-07 19:44:05.653224 (MainThread): On master: BEGIN
2022-02-07 19:44:05.653557 (MainThread): Opening a new connection, currently in state closed
2022-02-07 19:44:05.675513 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 19:44:05.675956 (MainThread): On master: COMMIT
2022-02-07 19:44:05.676214 (MainThread): Using postgres connection "master".
2022-02-07 19:44:05.676472 (MainThread): On master: COMMIT
2022-02-07 19:44:05.678655 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 19:44:05.679138 (MainThread): On master: Close
2022-02-07 19:44:05.680318 (MainThread): 22:44:05 | 
2022-02-07 19:44:05.680991 (MainThread): 22:44:05 | Finished running 5 incremental models in 1.64s.
2022-02-07 19:44:05.681549 (MainThread): Connection 'master' was properly closed.
2022-02-07 19:44:05.681895 (MainThread): Connection 'model.project_otus_dbt.sat_order_details' was properly closed.
2022-02-07 19:44:05.682253 (MainThread): Connection 'model.project_otus_dbt.sat_wheat_usa_details' was properly closed.
2022-02-07 19:44:05.902183 (MainThread): 
2022-02-07 19:44:05.902697 (MainThread): Completed successfully
2022-02-07 19:44:05.903146 (MainThread): 
Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
2022-02-07 19:44:05.903863 (MainThread): Flushing usage events
2022-02-07 20:50:09.637045 (MainThread): Running with dbt=0.19.0
2022-02-07 20:50:09.790234 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-02-07 20:50:09.791389 (MainThread): Tracking: do not track
2022-02-07 20:50:09.897834 (MainThread): Partial parsing not enabled
2022-02-07 20:50:09.899731 (MainThread): Parsing macros/adapters.sql
2022-02-07 20:50:09.932343 (MainThread): Parsing macros/catalog.sql
2022-02-07 20:50:09.935056 (MainThread): Parsing macros/relations.sql
2022-02-07 20:50:09.939249 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 20:50:09.946638 (MainThread): Parsing macros/core.sql
2022-02-07 20:50:09.955828 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 20:50:10.019233 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 20:50:10.022557 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 20:50:10.025365 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 20:50:10.034658 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 20:50:10.037792 (MainThread): Parsing macros/etc/query.sql
2022-02-07 20:50:10.040493 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 20:50:10.042436 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 20:50:10.056235 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 20:50:10.082412 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 20:50:10.085120 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 20:50:10.123845 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 20:50:10.155415 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 20:50:10.166778 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 20:50:10.168850 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 20:50:10.195935 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 20:50:10.206340 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 20:50:10.221156 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 20:50:10.240755 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 20:50:10.248238 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 20:50:10.251914 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 20:50:10.255994 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 20:50:10.264616 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 20:50:10.268335 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 20:50:10.273000 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 20:50:10.275865 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 20:50:10.296420 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 20:50:10.300870 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 20:50:10.304440 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 20:50:10.311747 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 20:50:10.314333 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 20:50:10.319252 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 20:50:10.324135 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 20:50:10.325857 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 20:50:10.327699 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 20:50:10.330050 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 20:50:10.336321 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 20:50:10.339987 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 20:50:10.342407 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 20:50:10.343770 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 20:50:10.345804 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 20:50:10.347412 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 20:50:10.348977 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 20:50:10.354623 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 20:50:10.356472 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 20:50:10.358630 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 20:50:10.361334 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 20:50:10.364066 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 20:50:10.366014 (MainThread): Parsing macros/sql/star.sql
2022-02-07 20:50:10.369916 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 20:50:10.372054 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 20:50:10.376083 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 20:50:10.377950 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 20:50:10.385045 (MainThread): Parsing macros/sql/union.sql
2022-02-07 20:50:10.396281 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 20:50:10.398376 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 20:50:10.404013 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 20:50:10.409406 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 20:50:10.415652 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 20:50:10.423094 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 20:50:10.427640 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 20:50:10.429259 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 20:50:10.431127 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 20:50:10.434077 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 20:50:10.439473 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 20:50:10.441380 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 20:50:10.443412 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 20:50:10.445346 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 20:50:10.470224 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 20:50:10.472302 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 20:50:10.474659 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 20:50:10.476686 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 20:50:10.478665 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 20:50:10.484934 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 20:50:10.488790 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 20:50:10.491560 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 20:50:10.493305 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 20:50:10.495155 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 20:50:10.497562 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 20:50:10.501144 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 20:50:10.503189 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 20:50:10.548958 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 20:50:10.556508 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 20:50:10.566642 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 20:50:10.569293 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 20:50:10.575777 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 20:50:10.585241 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 20:50:10.600075 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 20:50:10.626162 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 20:50:10.629656 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 20:50:10.630796 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 20:50:10.641123 (MainThread): Parsing macros/tables/link.sql
2022-02-07 20:50:10.652855 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 20:50:10.664727 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 20:50:10.675262 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 20:50:10.686281 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 20:50:10.724809 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 20:50:10.735023 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 20:50:10.786815 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 20:50:10.789170 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 20:50:10.811866 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 20:50:10.817566 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 20:50:10.824833 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 20:50:10.827024 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 20:50:10.832988 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 20:50:10.835709 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 20:50:10.846508 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 20:50:10.855915 (MainThread): Partial parsing not enabled
2022-02-07 20:50:10.965460 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 20:50:11.076849 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_customer_order".
2022-02-07 20:50:11.094215 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 20:50:11.158620 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 20:50:11.182668 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 20:50:11.231931 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 20:50:11.261906 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 20:50:11.356755 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 20:50:11.378387 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 20:50:11.395864 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_order_cnt_week".
2022-02-07 20:50:11.436261 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_customer_history".
2022-02-07 20:50:11.455757 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 20:50:11.594740 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 20:50:11.617023 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 20:50:11.635907 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 20:50:11.655122 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 20:50:11.665409 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 20:50:12.947014 (MainThread): Flushing usage events
2022-02-07 20:50:12.947593 (MainThread): Connection 'model.project_otus_dbt.dim_week' was properly closed.
2022-02-07 20:50:12.947922 (MainThread): Encountered an error:
2022-02-07 20:50:12.948437 (MainThread): Compilation Error in model link_customer_order (models/raw_vault/links/link_customer_order.sql)
  Model 'model.project_otus_dbt.link_customer_order' (models/raw_vault/links/link_customer_order.sql) depends on a node named 'v_stg_orders' which was not found
2022-02-07 20:50:12.968595 (MainThread): Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/main.py", line 125, in main
    results, succeeded = handle_and_check(args)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/main.py", line 203, in handle_and_check
    task, res = run_from_args(parsed)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/main.py", line 256, in run_from_args
    results = task.run()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/runnable.py", line 406, in run
    self._runtime_initialize()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/runnable.py", line 122, in _runtime_initialize
    super()._runtime_initialize()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/runnable.py", line 79, in _runtime_initialize
    self.load_manifest()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/runnable.py", line 66, in load_manifest
    self.manifest = get_full_manifest(self.config)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/perf_utils.py", line 28, in get_full_manifest
    return load_manifest(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 854, in load_manifest
    return ManifestLoader.load_all(config, macro_manifest, macro_hook)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 436, in load_all
    manifest = loader.create_manifest()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 414, in create_manifest
    self.process_manifest(manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 380, in process_manifest
    process_refs(manifest, project_name)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 750, in process_refs
    _process_refs_for_node(manifest, current_project, node)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 732, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 475, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/exceptions.py", line 566, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/exceptions.py", line 435, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model link_customer_order (models/raw_vault/links/link_customer_order.sql)
  Model 'model.project_otus_dbt.link_customer_order' (models/raw_vault/links/link_customer_order.sql) depends on a node named 'v_stg_orders' which was not found

2022-02-07 20:50:34.136915 (MainThread): Running with dbt=0.19.0
2022-02-07 20:50:34.249823 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-02-07 20:50:34.251235 (MainThread): Tracking: do not track
2022-02-07 20:50:34.367337 (MainThread): Partial parsing not enabled
2022-02-07 20:50:34.368296 (MainThread): Parsing macros/adapters.sql
2022-02-07 20:50:34.387162 (MainThread): Parsing macros/catalog.sql
2022-02-07 20:50:34.389492 (MainThread): Parsing macros/relations.sql
2022-02-07 20:50:34.390866 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 20:50:34.393191 (MainThread): Parsing macros/core.sql
2022-02-07 20:50:34.397415 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 20:50:34.436604 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 20:50:34.438613 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 20:50:34.440312 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 20:50:34.449057 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 20:50:34.450790 (MainThread): Parsing macros/etc/query.sql
2022-02-07 20:50:34.451880 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 20:50:34.452816 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 20:50:34.461144 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 20:50:34.487230 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 20:50:34.491535 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 20:50:34.520135 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 20:50:34.551941 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 20:50:34.559198 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 20:50:34.561509 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 20:50:34.579374 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 20:50:34.594531 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 20:50:34.606333 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 20:50:34.615097 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 20:50:34.617175 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 20:50:34.618989 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 20:50:34.621532 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 20:50:34.627080 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 20:50:34.630680 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 20:50:34.633855 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 20:50:34.635934 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 20:50:34.649356 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 20:50:34.652639 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 20:50:34.657254 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 20:50:34.664991 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 20:50:34.667350 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 20:50:34.672016 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 20:50:34.677905 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 20:50:34.681199 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 20:50:34.684490 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 20:50:34.688894 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 20:50:34.697433 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 20:50:34.703403 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 20:50:34.707220 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 20:50:34.709250 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 20:50:34.712083 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 20:50:34.714429 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 20:50:34.717440 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 20:50:34.724230 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 20:50:34.726206 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 20:50:34.728489 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 20:50:34.731360 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 20:50:34.735668 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 20:50:34.738070 (MainThread): Parsing macros/sql/star.sql
2022-02-07 20:50:34.743304 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 20:50:34.746150 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 20:50:34.751835 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 20:50:34.754400 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 20:50:34.763985 (MainThread): Parsing macros/sql/union.sql
2022-02-07 20:50:34.774242 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 20:50:34.776709 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 20:50:34.782535 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 20:50:34.787054 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 20:50:34.791629 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 20:50:34.805628 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 20:50:34.811862 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 20:50:34.815823 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 20:50:34.820852 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 20:50:34.824430 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 20:50:34.829780 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 20:50:34.832856 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 20:50:34.835215 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 20:50:34.837047 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 20:50:34.866262 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 20:50:34.868874 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 20:50:34.872086 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 20:50:34.874773 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 20:50:34.877903 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 20:50:34.885303 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 20:50:34.890134 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 20:50:34.894059 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 20:50:34.896332 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 20:50:34.898755 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 20:50:34.901695 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 20:50:34.905869 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 20:50:34.908330 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 20:50:34.917494 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 20:50:34.922597 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 20:50:34.929198 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 20:50:34.930877 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 20:50:34.934455 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 20:50:34.942602 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 20:50:34.951442 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 20:50:34.966813 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 20:50:34.973446 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 20:50:34.975159 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 20:50:34.992314 (MainThread): Parsing macros/tables/link.sql
2022-02-07 20:50:35.009923 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 20:50:35.029282 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 20:50:35.041640 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 20:50:35.049120 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 20:50:35.074991 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 20:50:35.085514 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 20:50:35.114713 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 20:50:35.117588 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 20:50:35.149914 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 20:50:35.159564 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 20:50:35.171428 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 20:50:35.174117 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 20:50:35.184085 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 20:50:35.187817 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 20:50:35.204746 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 20:50:35.218394 (MainThread): Partial parsing not enabled
2022-02-07 20:50:35.331820 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 20:50:35.432986 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 20:50:35.502318 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 20:50:35.523608 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 20:50:35.543486 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 20:50:35.566916 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 20:50:35.604179 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 20:50:35.643117 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 20:50:35.681906 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_order_cnt_week".
2022-02-07 20:50:35.716909 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.rep_customer_history".
2022-02-07 20:50:35.733366 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 20:50:35.873910 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 20:50:35.898983 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 20:50:35.918542 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 20:50:35.956016 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 20:50:35.970934 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 20:50:36.687875 (MainThread): Flushing usage events
2022-02-07 20:50:36.688380 (MainThread): Connection 'model.project_otus_dbt.dim_week' was properly closed.
2022-02-07 20:50:36.688686 (MainThread): Encountered an error:
2022-02-07 20:50:36.689161 (MainThread): Compilation Error in model rep_order_cnt_week (models/report/rep_order_cnt_week.sql)
  Model 'model.project_otus_dbt.rep_order_cnt_week' (models/report/rep_order_cnt_week.sql) depends on a node named 'hub_order' which was not found
2022-02-07 20:50:36.691366 (MainThread): Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/main.py", line 125, in main
    results, succeeded = handle_and_check(args)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/main.py", line 203, in handle_and_check
    task, res = run_from_args(parsed)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/main.py", line 256, in run_from_args
    results = task.run()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/runnable.py", line 406, in run
    self._runtime_initialize()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/runnable.py", line 122, in _runtime_initialize
    super()._runtime_initialize()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/runnable.py", line 79, in _runtime_initialize
    self.load_manifest()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/runnable.py", line 66, in load_manifest
    self.manifest = get_full_manifest(self.config)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/perf_utils.py", line 28, in get_full_manifest
    return load_manifest(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 854, in load_manifest
    return ManifestLoader.load_all(config, macro_manifest, macro_hook)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 436, in load_all
    manifest = loader.create_manifest()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 414, in create_manifest
    self.process_manifest(manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 380, in process_manifest
    process_refs(manifest, project_name)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 750, in process_refs
    _process_refs_for_node(manifest, current_project, node)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 732, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 475, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/exceptions.py", line 566, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/exceptions.py", line 435, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model rep_order_cnt_week (models/report/rep_order_cnt_week.sql)
  Model 'model.project_otus_dbt.rep_order_cnt_week' (models/report/rep_order_cnt_week.sql) depends on a node named 'hub_order' which was not found

2022-02-07 20:51:07.657410 (MainThread): Running with dbt=0.19.0
2022-02-07 20:51:07.758680 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-02-07 20:51:07.759533 (MainThread): Tracking: do not track
2022-02-07 20:51:07.842357 (MainThread): Partial parsing not enabled
2022-02-07 20:51:07.843498 (MainThread): Parsing macros/adapters.sql
2022-02-07 20:51:07.862982 (MainThread): Parsing macros/catalog.sql
2022-02-07 20:51:07.865360 (MainThread): Parsing macros/relations.sql
2022-02-07 20:51:07.866809 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 20:51:07.869340 (MainThread): Parsing macros/core.sql
2022-02-07 20:51:07.874106 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 20:51:07.917675 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 20:51:07.923690 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 20:51:07.927183 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 20:51:07.938971 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 20:51:07.941093 (MainThread): Parsing macros/etc/query.sql
2022-02-07 20:51:07.942396 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 20:51:07.943562 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 20:51:07.953146 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 20:51:07.974029 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 20:51:07.976003 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 20:51:08.005462 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 20:51:08.025001 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 20:51:08.031176 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 20:51:08.033287 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 20:51:08.046479 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 20:51:08.052245 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 20:51:08.058606 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 20:51:08.065179 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 20:51:08.067098 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 20:51:08.068714 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 20:51:08.070675 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 20:51:08.074402 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 20:51:08.076149 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 20:51:08.079172 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 20:51:08.080915 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 20:51:08.091081 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 20:51:08.093261 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 20:51:08.095324 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 20:51:08.098126 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 20:51:08.099112 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 20:51:08.101270 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 20:51:08.104196 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 20:51:08.105959 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 20:51:08.108107 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 20:51:08.110907 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 20:51:08.117703 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 20:51:08.120948 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 20:51:08.123403 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 20:51:08.126364 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 20:51:08.129272 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 20:51:08.130799 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 20:51:08.132202 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 20:51:08.137171 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 20:51:08.138435 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 20:51:08.140076 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 20:51:08.142279 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 20:51:08.145157 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 20:51:08.146960 (MainThread): Parsing macros/sql/star.sql
2022-02-07 20:51:08.150610 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 20:51:08.152396 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 20:51:08.156369 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 20:51:08.158513 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 20:51:08.166438 (MainThread): Parsing macros/sql/union.sql
2022-02-07 20:51:08.176642 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 20:51:08.181082 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 20:51:08.191732 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 20:51:08.201044 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 20:51:08.209407 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 20:51:08.220992 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 20:51:08.230811 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 20:51:08.233396 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 20:51:08.236363 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 20:51:08.240248 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 20:51:08.244947 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 20:51:08.246979 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 20:51:08.248821 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 20:51:08.250525 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 20:51:08.275464 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 20:51:08.278269 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 20:51:08.280821 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 20:51:08.282816 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 20:51:08.285127 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 20:51:08.291338 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 20:51:08.296668 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 20:51:08.303139 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 20:51:08.306937 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 20:51:08.311514 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 20:51:08.317951 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 20:51:08.327222 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 20:51:08.330520 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 20:51:08.338005 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 20:51:08.341969 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 20:51:08.346441 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 20:51:08.347792 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 20:51:08.350776 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 20:51:08.354296 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 20:51:08.359938 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 20:51:08.369194 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 20:51:08.372328 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 20:51:08.373233 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 20:51:08.383103 (MainThread): Parsing macros/tables/link.sql
2022-02-07 20:51:08.393298 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 20:51:08.404879 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 20:51:08.412863 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 20:51:08.416848 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 20:51:08.442151 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 20:51:08.449420 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 20:51:08.468782 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 20:51:08.470858 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 20:51:08.500793 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 20:51:08.506456 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 20:51:08.513021 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 20:51:08.514405 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 20:51:08.527339 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 20:51:08.534206 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 20:51:08.564462 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 20:51:08.588763 (MainThread): Partial parsing not enabled
2022-02-07 20:51:08.713232 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 20:51:08.826955 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 20:51:08.877319 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 20:51:08.902530 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 20:51:08.922124 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 20:51:08.950458 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 20:51:08.979828 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 20:51:08.994922 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 20:51:09.020831 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 20:51:09.155325 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 20:51:09.199263 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 20:51:09.237039 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 20:51:09.268893 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 20:51:09.279848 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 20:51:10.072737 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.report
- models.project_otus_dbt.prestage

2022-02-07 20:51:10.269038 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 20:51:10.271078 (MainThread): Found 14 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 20:51:10.275693 (MainThread): 
2022-02-07 20:51:10.277064 (MainThread): Acquiring new postgres connection "master".
2022-02-07 20:51:10.288581 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 20:51:10.307555 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 20:51:10.307911 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 20:51:10.308026 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 20:51:10.478956 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.17 seconds
2022-02-07 20:51:10.484035 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 20:51:10.522560 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 20:51:10.539870 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 20:51:10.540259 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 20:51:10.540459 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 20:51:10.569379 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.03 seconds
2022-02-07 20:51:10.570114 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 20:51:10.570429 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 20:51:10.613331 (ThreadPoolExecutor-1_0): SQL status: SELECT 26 in 0.04 seconds
2022-02-07 20:51:10.658377 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 20:51:10.661447 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 20:51:10.727123 (MainThread): Using postgres connection "master".
2022-02-07 20:51:10.727550 (MainThread): On master: BEGIN
2022-02-07 20:51:10.727860 (MainThread): Opening a new connection, currently in state init
2022-02-07 20:51:10.791340 (MainThread): SQL status: BEGIN in 0.06 seconds
2022-02-07 20:51:10.791765 (MainThread): Using postgres connection "master".
2022-02-07 20:51:10.792056 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 20:51:11.138414 (MainThread): SQL status: SELECT 14 in 0.35 seconds
2022-02-07 20:51:11.167897 (MainThread): On master: ROLLBACK
2022-02-07 20:51:11.169737 (MainThread): Using postgres connection "master".
2022-02-07 20:51:11.170103 (MainThread): On master: BEGIN
2022-02-07 20:51:11.172978 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 20:51:11.173583 (MainThread): On master: COMMIT
2022-02-07 20:51:11.173950 (MainThread): Using postgres connection "master".
2022-02-07 20:51:11.174262 (MainThread): On master: COMMIT
2022-02-07 20:51:11.176168 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 20:51:11.176555 (MainThread): On master: Close
2022-02-07 20:51:11.177514 (MainThread): 23:51:11 | Concurrency: 2 threads (target='dev')
2022-02-07 20:51:11.178325 (MainThread): 23:51:11 | 
2022-02-07 20:51:11.192212 (Thread-1): Began running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-07 20:51:11.192727 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_gbp
2022-02-07 20:51:11.195368 (Thread-1): 23:51:11 | 1 of 4 START seed file public.source_rate_gbp_usd.................... [RUN]
2022-02-07 20:51:11.198259 (Thread-2): 23:51:11 | 2 of 4 START seed file public.source_wheat_gbp....................... [RUN]
2022-02-07 20:51:11.199586 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 20:51:11.200701 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 20:51:11.201231 (Thread-1): finished collecting timing info
2022-02-07 20:51:11.202183 (Thread-2): finished collecting timing info
2022-02-07 20:51:11.459414 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-07 20:51:11.464819 (Thread-2): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-07 20:51:11.535277 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 20:51:11.536994 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 20:51:11.537565 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: BEGIN
2022-02-07 20:51:11.538198 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: BEGIN
2022-02-07 20:51:11.538867 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 20:51:11.539557 (Thread-2): Opening a new connection, currently in state init
2022-02-07 20:51:11.569789 (Thread-1): SQL status: BEGIN in 0.03 seconds
2022-02-07 20:51:11.570332 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 20:51:11.570636 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_rate_gbp_usd"} */

    create table "postgres"."public"."source_rate_gbp_usd" (TRADEDATE text,PRICE integer,OPEN integer,HIGH integer,LOW integer,CHANGEPERC integer)
  
2022-02-07 20:51:11.579158 (Thread-2): SQL status: BEGIN in 0.04 seconds
2022-02-07 20:51:11.579829 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 20:51:11.580180 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_gbp"} */

    create table "postgres"."public"."source_wheat_gbp" (TRADEDATE text,PRICE integer,OPEN integer,HIGH integer,LOW integer,VOLUME text,CHANGEPERC integer)
  
2022-02-07 20:51:11.640780 (Thread-1): SQL status: CREATE TABLE in 0.07 seconds
2022-02-07 20:51:11.641232 (Thread-2): SQL status: CREATE TABLE in 0.06 seconds
2022-02-07 20:51:11.770412 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 20:51:11.773917 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 20:51:11.774872 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: 
            insert into "postgres"."public"."source_wheat_gbp" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-07 20:51:11.774339 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: 
            insert into "postgres"."public"."source_rate_gbp_usd" (TRADEDATE, PRICE, OPEN, HIGH, LOW, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s...
2022-02-07 20:51:11.846413 (Thread-2): SQL status: INSERT 0 531 in 0.07 seconds
2022-02-07 20:51:11.857650 (Thread-1): SQL status: INSERT 0 548 in 0.04 seconds
2022-02-07 20:51:11.861682 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_gbp"
2022-02-07 20:51:11.862814 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_rate_gbp_usd"
2022-02-07 20:51:11.900563 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-07 20:51:11.903834 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-07 20:51:11.904338 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 20:51:11.904898 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 20:51:11.905404 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-07 20:51:11.905919 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-07 20:51:11.911988 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 20:51:11.912478 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 20:51:11.916832 (Thread-2): finished collecting timing info
2022-02-07 20:51:11.921468 (Thread-1): finished collecting timing info
2022-02-07 20:51:11.922377 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: Close
2022-02-07 20:51:11.923001 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: Close
2022-02-07 20:51:11.924951 (Thread-2): 23:51:11 | 2 of 4 OK loaded seed file public.source_wheat_gbp................... [INSERT 531 in 0.72s]
2022-02-07 20:51:11.927211 (Thread-1): 23:51:11 | 1 of 4 OK loaded seed file public.source_rate_gbp_usd................ [INSERT 548 in 0.73s]
2022-02-07 20:51:11.928224 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_gbp
2022-02-07 20:51:11.929100 (Thread-1): Finished running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-07 20:51:11.930224 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 20:51:11.931608 (Thread-1): Began running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 20:51:11.935419 (Thread-2): 23:51:11 | 3 of 4 START seed file public.source_wheat_msk....................... [RUN]
2022-02-07 20:51:11.938260 (Thread-1): 23:51:11 | 4 of 4 START seed file public.source_wheat_usa....................... [RUN]
2022-02-07 20:51:11.939912 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 20:51:11.941479 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 20:51:11.942081 (Thread-2): finished collecting timing info
2022-02-07 20:51:11.943012 (Thread-1): finished collecting timing info
2022-02-07 20:51:12.089504 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 20:51:12.095394 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: BEGIN
2022-02-07 20:51:12.177092 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 20:51:12.180376 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 20:51:12.181022 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: BEGIN
2022-02-07 20:51:12.181323 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 20:51:12.233239 (Thread-1): SQL status: BEGIN in 0.06 seconds
2022-02-07 20:51:12.233725 (Thread-2): SQL status: BEGIN in 0.05 seconds
2022-02-07 20:51:12.234168 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 20:51:12.234664 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 20:51:12.235249 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_usa"} */
truncate table "postgres"."public"."source_wheat_usa"
2022-02-07 20:51:12.235870 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_msk"} */
truncate table "postgres"."public"."source_wheat_msk"
2022-02-07 20:51:12.253829 (Thread-1): SQL status: TRUNCATE TABLE in 0.02 seconds
2022-02-07 20:51:12.263052 (Thread-2): SQL status: TRUNCATE TABLE in 0.03 seconds
2022-02-07 20:51:12.285535 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 20:51:12.291423 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: 
            insert into "postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-07 20:51:12.310559 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 20:51:12.311074 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: 
            insert into "postgres"."public"."source_wheat_msk" (BOARDID, SECID, TRADEDATE, SHORTNAME, NAME, CLOSE, OPEN, HIGH, LOW, VALUE, DURATION, YIELD, DECIMALS, CAPITALIZATION, CURRENCYID, DIVISOR, TRADINGSESSION, VOLUME) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%...
2022-02-07 20:51:12.343954 (Thread-1): Postgres error: column "price" of relation "source_wheat_usa" does not exist
LINE 2: ...postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPE...
                                                             ^

2022-02-07 20:51:12.344534 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: ROLLBACK
2022-02-07 20:51:12.347281 (Thread-1): finished collecting timing info
2022-02-07 20:51:12.348121 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: Close
2022-02-07 20:51:12.362206 (Thread-2): SQL status: INSERT 0 216 in 0.05 seconds
2022-02-07 20:51:12.363313 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_msk"
2022-02-07 20:51:12.349282 (Thread-1): Database Error in seed source_wheat_usa (data/source_wheat_usa.csv)
  column "price" of relation "source_wheat_usa" does not exist
  LINE 2: ...postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPE...
                                                               ^
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "price" of relation "source_wheat_usa" does not exist
LINE 2: ...postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPE...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 89, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 21, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 23, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 111, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/impl.py", line 63, in add_query
    return self.connections.add_query(sql, auto_begin, bindings,
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in seed source_wheat_usa (data/source_wheat_usa.csv)
  column "price" of relation "source_wheat_usa" does not exist
  LINE 2: ...postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPE...
                                                               ^
2022-02-07 20:51:12.365695 (Thread-1): 23:51:12 | 4 of 4 ERROR loading seed file public.source_wheat_usa............... [ERROR in 0.42s]
2022-02-07 20:51:12.371830 (Thread-1): Finished running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 20:51:12.373007 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 20:51:12.374378 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 20:51:12.374763 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 20:51:12.384263 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 20:51:12.388410 (Thread-2): finished collecting timing info
2022-02-07 20:51:12.389720 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: Close
2022-02-07 20:51:12.392311 (Thread-2): 23:51:12 | 3 of 4 OK loaded seed file public.source_wheat_msk................... [INSERT 216 in 0.45s]
2022-02-07 20:51:12.392964 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 20:51:12.398327 (MainThread): Acquiring new postgres connection "master".
2022-02-07 20:51:12.399003 (MainThread): Using postgres connection "master".
2022-02-07 20:51:12.399421 (MainThread): On master: BEGIN
2022-02-07 20:51:12.399943 (MainThread): Opening a new connection, currently in state closed
2022-02-07 20:51:12.422548 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 20:51:12.422998 (MainThread): On master: COMMIT
2022-02-07 20:51:12.423461 (MainThread): Using postgres connection "master".
2022-02-07 20:51:12.423857 (MainThread): On master: COMMIT
2022-02-07 20:51:12.426477 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 20:51:12.427045 (MainThread): On master: Close
2022-02-07 20:51:12.428267 (MainThread): 23:51:12 | 
2022-02-07 20:51:12.429028 (MainThread): 23:51:12 | Finished running 4 seeds in 2.15s.
2022-02-07 20:51:12.429706 (MainThread): Connection 'master' was properly closed.
2022-02-07 20:51:12.430199 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_usa' was properly closed.
2022-02-07 20:51:12.430583 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_msk' was properly closed.
2022-02-07 20:51:12.711182 (MainThread): 
2022-02-07 20:51:12.711711 (MainThread): Completed with 1 error and 0 warnings:
2022-02-07 20:51:12.712144 (MainThread): 
2022-02-07 20:51:12.712600 (MainThread): Database Error in seed source_wheat_usa (data/source_wheat_usa.csv)
2022-02-07 20:51:12.713082 (MainThread):   column "price" of relation "source_wheat_usa" does not exist
2022-02-07 20:51:12.713718 (MainThread):   LINE 2: ...postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPE...
2022-02-07 20:51:12.714264 (MainThread):                                                                ^
2022-02-07 20:51:12.714813 (MainThread): 
Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
2022-02-07 20:51:12.715514 (MainThread): Flushing usage events
2022-02-07 20:52:17.584905 (MainThread): Running with dbt=0.19.0
2022-02-07 20:52:17.696707 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-02-07 20:52:17.697637 (MainThread): Tracking: do not track
2022-02-07 20:52:17.758589 (MainThread): Partial parsing not enabled
2022-02-07 20:52:17.759726 (MainThread): Parsing macros/adapters.sql
2022-02-07 20:52:17.785932 (MainThread): Parsing macros/catalog.sql
2022-02-07 20:52:17.788381 (MainThread): Parsing macros/relations.sql
2022-02-07 20:52:17.789929 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 20:52:17.792289 (MainThread): Parsing macros/core.sql
2022-02-07 20:52:17.795917 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 20:52:17.833696 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 20:52:17.836288 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 20:52:17.837964 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 20:52:17.846132 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 20:52:17.847784 (MainThread): Parsing macros/etc/query.sql
2022-02-07 20:52:17.848963 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 20:52:17.850114 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 20:52:17.859176 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 20:52:17.878696 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 20:52:17.880696 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 20:52:17.908873 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 20:52:17.925196 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 20:52:17.931566 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 20:52:17.933581 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 20:52:17.946363 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 20:52:17.951170 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 20:52:17.957297 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 20:52:17.963559 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 20:52:17.965349 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 20:52:17.966832 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 20:52:17.968597 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 20:52:17.972433 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 20:52:17.974264 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 20:52:17.976206 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 20:52:17.977463 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 20:52:17.986412 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 20:52:17.988477 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 20:52:17.990329 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 20:52:17.992775 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 20:52:17.993916 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 20:52:17.995963 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 20:52:17.998835 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 20:52:18.000847 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 20:52:18.002810 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 20:52:18.005093 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 20:52:18.011985 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 20:52:18.015461 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 20:52:18.018031 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 20:52:18.019400 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 20:52:18.021268 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 20:52:18.022773 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 20:52:18.024594 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 20:52:18.029723 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 20:52:18.031071 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 20:52:18.032670 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 20:52:18.034614 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 20:52:18.037286 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 20:52:18.039080 (MainThread): Parsing macros/sql/star.sql
2022-02-07 20:52:18.042970 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 20:52:18.044835 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 20:52:18.048915 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 20:52:18.050905 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 20:52:18.061258 (MainThread): Parsing macros/sql/union.sql
2022-02-07 20:52:18.076534 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 20:52:18.078626 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 20:52:18.083433 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 20:52:18.087173 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 20:52:18.091380 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 20:52:18.098066 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 20:52:18.103164 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 20:52:18.105498 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 20:52:18.107716 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 20:52:18.110605 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 20:52:18.114238 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 20:52:18.115680 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 20:52:18.117204 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 20:52:18.118615 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 20:52:18.142437 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 20:52:18.144417 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 20:52:18.146714 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 20:52:18.148758 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 20:52:18.150955 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 20:52:18.167507 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 20:52:18.177328 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 20:52:18.183751 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 20:52:18.187483 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 20:52:18.192963 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 20:52:18.199737 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 20:52:18.205423 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 20:52:18.208546 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 20:52:18.215919 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 20:52:18.219339 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 20:52:18.223544 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 20:52:18.224595 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 20:52:18.227346 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 20:52:18.230908 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 20:52:18.237010 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 20:52:18.246377 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 20:52:18.249585 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 20:52:18.250520 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 20:52:18.260466 (MainThread): Parsing macros/tables/link.sql
2022-02-07 20:52:18.274774 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 20:52:18.295453 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 20:52:18.303790 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 20:52:18.307753 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 20:52:18.322498 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 20:52:18.329135 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 20:52:18.352115 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 20:52:18.355004 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 20:52:18.390699 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 20:52:18.399138 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 20:52:18.408124 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 20:52:18.411595 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 20:52:18.427806 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 20:52:18.431407 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 20:52:18.445085 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 20:52:18.505053 (MainThread): Partial parsing not enabled
2022-02-07 20:52:18.653588 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 20:52:18.762640 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 20:52:18.886313 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 20:52:18.907427 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 20:52:18.927963 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 20:52:18.954501 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 20:52:19.007319 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 20:52:19.043450 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 20:52:19.074312 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 20:52:19.246704 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 20:52:19.267135 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 20:52:19.287193 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 20:52:19.306279 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 20:52:19.331044 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 20:52:20.136582 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.report
- models.project_otus_dbt.prestage

2022-02-07 20:52:20.291858 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 20:52:20.293398 (MainThread): Found 14 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 20:52:20.296544 (MainThread): 
2022-02-07 20:52:20.297392 (MainThread): Acquiring new postgres connection "master".
2022-02-07 20:52:20.305223 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 20:52:20.324676 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 20:52:20.325331 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 20:52:20.325684 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 20:52:20.341050 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 20:52:20.344768 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 20:52:20.375414 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 20:52:20.392002 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 20:52:20.392298 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 20:52:20.392403 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 20:52:20.404812 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 20:52:20.405313 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 20:52:20.405452 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 20:52:20.409795 (ThreadPoolExecutor-1_0): SQL status: SELECT 28 in 0.00 seconds
2022-02-07 20:52:20.440940 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 20:52:20.442602 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 20:52:20.478992 (MainThread): Using postgres connection "master".
2022-02-07 20:52:20.479318 (MainThread): On master: BEGIN
2022-02-07 20:52:20.479418 (MainThread): Opening a new connection, currently in state init
2022-02-07 20:52:20.497003 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 20:52:20.497467 (MainThread): Using postgres connection "master".
2022-02-07 20:52:20.497712 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 20:52:20.851353 (MainThread): SQL status: SELECT 14 in 0.35 seconds
2022-02-07 20:52:20.863699 (MainThread): On master: ROLLBACK
2022-02-07 20:52:20.865017 (MainThread): Using postgres connection "master".
2022-02-07 20:52:20.865221 (MainThread): On master: BEGIN
2022-02-07 20:52:20.867171 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 20:52:20.867469 (MainThread): On master: COMMIT
2022-02-07 20:52:20.867635 (MainThread): Using postgres connection "master".
2022-02-07 20:52:20.867789 (MainThread): On master: COMMIT
2022-02-07 20:52:20.869050 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 20:52:20.869370 (MainThread): On master: Close
2022-02-07 20:52:20.870357 (MainThread): 23:52:20 | Concurrency: 2 threads (target='dev')
2022-02-07 20:52:20.870838 (MainThread): 23:52:20 | 
2022-02-07 20:52:20.876198 (Thread-1): Began running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-07 20:52:20.876611 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_gbp
2022-02-07 20:52:20.878640 (Thread-1): 23:52:20 | 1 of 4 START seed file public.source_rate_gbp_usd.................... [RUN]
2022-02-07 20:52:20.880247 (Thread-2): 23:52:20 | 2 of 4 START seed file public.source_wheat_gbp....................... [RUN]
2022-02-07 20:52:20.917037 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 20:52:20.917343 (Thread-1): finished collecting timing info
2022-02-07 20:52:20.918284 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 20:52:20.929820 (Thread-2): finished collecting timing info
2022-02-07 20:52:21.010182 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 20:52:21.014073 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 20:52:21.014407 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: BEGIN
2022-02-07 20:52:21.014708 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: BEGIN
2022-02-07 20:52:21.015048 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 20:52:21.015314 (Thread-2): Opening a new connection, currently in state init
2022-02-07 20:52:21.028380 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 20:52:21.028641 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 20:52:21.028869 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 20:52:21.029093 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 20:52:21.029324 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_gbp"} */
truncate table "postgres"."public"."source_wheat_gbp"
2022-02-07 20:52:21.029614 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_rate_gbp_usd"} */
truncate table "postgres"."public"."source_rate_gbp_usd"
2022-02-07 20:52:21.037203 (Thread-1): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 20:52:21.051027 (Thread-2): SQL status: TRUNCATE TABLE in 0.02 seconds
2022-02-07 20:52:21.085687 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-07 20:52:21.088802 (Thread-2): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-07 20:52:21.119192 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 20:52:21.124951 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: 
            insert into "postgres"."public"."source_rate_gbp_usd" (TRADEDATE, PRICE, OPEN, HIGH, LOW, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s...
2022-02-07 20:52:21.137268 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 20:52:21.137732 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: 
            insert into "postgres"."public"."source_wheat_gbp" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-07 20:52:21.154907 (Thread-1): SQL status: INSERT 0 548 in 0.02 seconds
2022-02-07 20:52:21.159932 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_rate_gbp_usd"
2022-02-07 20:52:21.160478 (Thread-2): SQL status: INSERT 0 531 in 0.02 seconds
2022-02-07 20:52:21.161327 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_gbp"
2022-02-07 20:52:21.170572 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-07 20:52:21.173111 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-07 20:52:21.173395 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 20:52:21.173724 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 20:52:21.173943 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-07 20:52:21.174202 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-07 20:52:21.179119 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 20:52:21.181251 (Thread-2): finished collecting timing info
2022-02-07 20:52:21.181594 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 20:52:21.181808 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: Close
2022-02-07 20:52:21.183815 (Thread-1): finished collecting timing info
2022-02-07 20:52:21.184481 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: Close
2022-02-07 20:52:21.186187 (Thread-2): 23:52:21 | 2 of 4 OK loaded seed file public.source_wheat_gbp................... [INSERT 531 in 0.27s]
2022-02-07 20:52:21.188148 (Thread-1): 23:52:21 | 1 of 4 OK loaded seed file public.source_rate_gbp_usd................ [INSERT 548 in 0.27s]
2022-02-07 20:52:21.188540 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_gbp
2022-02-07 20:52:21.189736 (Thread-1): Finished running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-07 20:52:21.190201 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 20:52:21.191007 (Thread-1): Began running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 20:52:21.193071 (Thread-2): 23:52:21 | 3 of 4 START seed file public.source_wheat_msk....................... [RUN]
2022-02-07 20:52:21.196093 (Thread-1): 23:52:21 | 4 of 4 START seed file public.source_wheat_usa....................... [RUN]
2022-02-07 20:52:21.197322 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 20:52:21.198373 (Thread-2): finished collecting timing info
2022-02-07 20:52:21.199899 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 20:52:21.210160 (Thread-1): finished collecting timing info
2022-02-07 20:52:21.332175 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 20:52:21.338001 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: BEGIN
2022-02-07 20:52:21.338400 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 20:52:21.348030 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 20:52:21.348755 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: BEGIN
2022-02-07 20:52:21.349388 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 20:52:21.368112 (Thread-1): SQL status: BEGIN in 0.03 seconds
2022-02-07 20:52:21.368418 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 20:52:21.368514 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_usa"} */
truncate table "postgres"."public"."source_wheat_usa"
2022-02-07 20:52:21.393952 (Thread-1): SQL status: TRUNCATE TABLE in 0.03 seconds
2022-02-07 20:52:21.416363 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 20:52:21.416789 (Thread-2): SQL status: BEGIN in 0.07 seconds
2022-02-07 20:52:21.417204 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: 
            insert into "postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-07 20:52:21.417713 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 20:52:21.423615 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_msk"} */
truncate table "postgres"."public"."source_wheat_msk"
2022-02-07 20:52:21.429545 (Thread-1): Postgres error: column "price" of relation "source_wheat_usa" does not exist
LINE 2: ...postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPE...
                                                             ^

2022-02-07 20:52:21.430039 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: ROLLBACK
2022-02-07 20:52:21.432727 (Thread-1): finished collecting timing info
2022-02-07 20:52:21.433717 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: Close
2022-02-07 20:52:21.434890 (Thread-1): Database Error in seed source_wheat_usa (data/source_wheat_usa.csv)
  column "price" of relation "source_wheat_usa" does not exist
  LINE 2: ...postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPE...
                                                               ^
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "price" of relation "source_wheat_usa" does not exist
LINE 2: ...postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPE...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 89, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 21, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 23, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 111, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/impl.py", line 63, in add_query
    return self.connections.add_query(sql, auto_begin, bindings,
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in seed source_wheat_usa (data/source_wheat_usa.csv)
  column "price" of relation "source_wheat_usa" does not exist
  LINE 2: ...postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPE...
                                                               ^
2022-02-07 20:52:21.440505 (Thread-2): SQL status: TRUNCATE TABLE in 0.02 seconds
2022-02-07 20:52:21.441488 (Thread-1): 23:52:21 | 4 of 4 ERROR loading seed file public.source_wheat_usa............... [ERROR in 0.24s]
2022-02-07 20:52:21.458804 (Thread-1): Finished running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 20:52:21.477238 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 20:52:21.477783 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: 
            insert into "postgres"."public"."source_wheat_msk" (BOARDID, SECID, TRADEDATE, SHORTNAME, NAME, CLOSE, OPEN, HIGH, LOW, VALUE, DURATION, YIELD, DECIMALS, CAPITALIZATION, CURRENCYID, DIVISOR, TRADINGSESSION, VOLUME) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%...
2022-02-07 20:52:21.513061 (Thread-2): SQL status: INSERT 0 216 in 0.03 seconds
2022-02-07 20:52:21.514100 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_msk"
2022-02-07 20:52:21.520306 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 20:52:21.520693 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 20:52:21.520948 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 20:52:21.526852 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 20:52:21.532222 (Thread-2): finished collecting timing info
2022-02-07 20:52:21.532888 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: Close
2022-02-07 20:52:21.534989 (Thread-2): 23:52:21 | 3 of 4 OK loaded seed file public.source_wheat_msk................... [INSERT 216 in 0.34s]
2022-02-07 20:52:21.535706 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 20:52:21.540533 (MainThread): Acquiring new postgres connection "master".
2022-02-07 20:52:21.541154 (MainThread): Using postgres connection "master".
2022-02-07 20:52:21.541433 (MainThread): On master: BEGIN
2022-02-07 20:52:21.541699 (MainThread): Opening a new connection, currently in state closed
2022-02-07 20:52:21.563284 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 20:52:21.563848 (MainThread): On master: COMMIT
2022-02-07 20:52:21.564207 (MainThread): Using postgres connection "master".
2022-02-07 20:52:21.564516 (MainThread): On master: COMMIT
2022-02-07 20:52:21.566971 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 20:52:21.567627 (MainThread): On master: Close
2022-02-07 20:52:21.569120 (MainThread): 23:52:21 | 
2022-02-07 20:52:21.569957 (MainThread): 23:52:21 | Finished running 4 seeds in 1.27s.
2022-02-07 20:52:21.570595 (MainThread): Connection 'master' was properly closed.
2022-02-07 20:52:21.571037 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_usa' was properly closed.
2022-02-07 20:52:21.571440 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_msk' was properly closed.
2022-02-07 20:52:21.747993 (MainThread): 
2022-02-07 20:52:21.748674 (MainThread): Completed with 1 error and 0 warnings:
2022-02-07 20:52:21.749513 (MainThread): 
2022-02-07 20:52:21.749938 (MainThread): Database Error in seed source_wheat_usa (data/source_wheat_usa.csv)
2022-02-07 20:52:21.750187 (MainThread):   column "price" of relation "source_wheat_usa" does not exist
2022-02-07 20:52:21.750384 (MainThread):   LINE 2: ...postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPE...
2022-02-07 20:52:21.750785 (MainThread):                                                                ^
2022-02-07 20:52:21.751073 (MainThread): 
Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
2022-02-07 20:52:21.751603 (MainThread): Flushing usage events
2022-02-07 20:58:43.623934 (MainThread): Running with dbt=0.19.0
2022-02-07 20:58:43.740515 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-02-07 20:58:43.741854 (MainThread): Tracking: do not track
2022-02-07 20:58:43.857584 (MainThread): Partial parsing not enabled
2022-02-07 20:58:43.859036 (MainThread): Parsing macros/adapters.sql
2022-02-07 20:58:43.886471 (MainThread): Parsing macros/catalog.sql
2022-02-07 20:58:43.890072 (MainThread): Parsing macros/relations.sql
2022-02-07 20:58:43.891908 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 20:58:43.895178 (MainThread): Parsing macros/core.sql
2022-02-07 20:58:43.899659 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 20:58:43.938641 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 20:58:43.940703 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 20:58:43.942485 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 20:58:43.950563 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 20:58:43.952268 (MainThread): Parsing macros/etc/query.sql
2022-02-07 20:58:43.953409 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 20:58:43.954384 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 20:58:43.962525 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 20:58:44.006069 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 20:58:44.009223 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 20:58:44.046956 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 20:58:44.063714 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 20:58:44.069333 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 20:58:44.071135 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 20:58:44.083573 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 20:58:44.088109 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 20:58:44.094313 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 20:58:44.100362 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 20:58:44.102025 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 20:58:44.103588 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 20:58:44.105362 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 20:58:44.116805 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 20:58:44.121058 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 20:58:44.125948 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 20:58:44.128426 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 20:58:44.147872 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 20:58:44.151420 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 20:58:44.155051 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 20:58:44.161353 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 20:58:44.163800 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 20:58:44.168774 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 20:58:44.176848 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 20:58:44.181090 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 20:58:44.186244 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 20:58:44.193621 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 20:58:44.211551 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 20:58:44.219838 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 20:58:44.226456 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 20:58:44.229967 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 20:58:44.234853 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 20:58:44.238853 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 20:58:44.242429 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 20:58:44.254082 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 20:58:44.256444 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 20:58:44.259298 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 20:58:44.262922 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 20:58:44.267677 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 20:58:44.270647 (MainThread): Parsing macros/sql/star.sql
2022-02-07 20:58:44.276138 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 20:58:44.278858 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 20:58:44.284602 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 20:58:44.287095 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 20:58:44.295964 (MainThread): Parsing macros/sql/union.sql
2022-02-07 20:58:44.305095 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 20:58:44.307063 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 20:58:44.311434 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 20:58:44.319190 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 20:58:44.327425 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 20:58:44.343301 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 20:58:44.352986 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 20:58:44.355838 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 20:58:44.358897 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 20:58:44.363216 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 20:58:44.368867 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 20:58:44.370791 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 20:58:44.372686 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 20:58:44.374631 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 20:58:44.402800 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 20:58:44.404764 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 20:58:44.407065 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 20:58:44.410621 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 20:58:44.414722 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 20:58:44.427999 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 20:58:44.434978 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 20:58:44.439636 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 20:58:44.442570 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 20:58:44.445346 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 20:58:44.448803 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 20:58:44.453437 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 20:58:44.456262 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 20:58:44.464176 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 20:58:44.467462 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 20:58:44.472728 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 20:58:44.474855 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 20:58:44.480170 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 20:58:44.487755 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 20:58:44.494136 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 20:58:44.506506 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 20:58:44.513828 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 20:58:44.514519 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 20:58:44.532815 (MainThread): Parsing macros/tables/link.sql
2022-02-07 20:58:44.543544 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 20:58:44.555011 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 20:58:44.563012 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 20:58:44.566956 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 20:58:44.600133 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 20:58:44.606852 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 20:58:44.623987 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 20:58:44.625331 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 20:58:44.643368 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 20:58:44.648925 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 20:58:44.655534 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 20:58:44.656925 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 20:58:44.662796 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 20:58:44.665451 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 20:58:44.675683 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 20:58:44.699798 (MainThread): Partial parsing not enabled
2022-02-07 20:58:44.823537 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 20:58:44.894301 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 20:58:44.969976 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 20:58:44.997695 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 20:58:45.023382 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 20:58:45.045765 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 20:58:45.076792 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 20:58:45.096743 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 20:58:45.113404 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 20:58:45.243187 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 20:58:45.261428 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 20:58:45.279542 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 20:58:45.312199 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 20:58:45.331725 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 20:58:46.227857 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.report
- models.project_otus_dbt.prestage

2022-02-07 20:58:46.373088 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 20:58:46.374206 (MainThread): Found 14 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 20:58:46.377570 (MainThread): 
2022-02-07 20:58:46.378585 (MainThread): Acquiring new postgres connection "master".
2022-02-07 20:58:46.389503 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 20:58:46.404244 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 20:58:46.404529 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 20:58:46.404621 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 20:58:46.425698 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 20:58:46.427984 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 20:58:46.466398 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 20:58:46.479896 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 20:58:46.480211 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 20:58:46.480445 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 20:58:46.496180 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-02-07 20:58:46.496606 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 20:58:46.496897 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 20:58:46.502478 (ThreadPoolExecutor-1_0): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 20:58:46.509932 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 20:58:46.511442 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 20:58:46.560322 (MainThread): Using postgres connection "master".
2022-02-07 20:58:46.560577 (MainThread): On master: BEGIN
2022-02-07 20:58:46.560712 (MainThread): Opening a new connection, currently in state init
2022-02-07 20:58:46.577406 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 20:58:46.577976 (MainThread): Using postgres connection "master".
2022-02-07 20:58:46.578284 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 20:58:46.708481 (MainThread): SQL status: SELECT 6 in 0.13 seconds
2022-02-07 20:58:46.725220 (MainThread): On master: ROLLBACK
2022-02-07 20:58:46.727186 (MainThread): Using postgres connection "master".
2022-02-07 20:58:46.727452 (MainThread): On master: BEGIN
2022-02-07 20:58:46.730686 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 20:58:46.730963 (MainThread): On master: COMMIT
2022-02-07 20:58:46.731057 (MainThread): Using postgres connection "master".
2022-02-07 20:58:46.731167 (MainThread): On master: COMMIT
2022-02-07 20:58:46.732862 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 20:58:46.733134 (MainThread): On master: Close
2022-02-07 20:58:46.733650 (MainThread): 23:58:46 | Concurrency: 2 threads (target='dev')
2022-02-07 20:58:46.733953 (MainThread): 23:58:46 | 
2022-02-07 20:58:46.740060 (Thread-1): Began running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-07 20:58:46.741131 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_gbp
2022-02-07 20:58:46.743926 (Thread-1): 23:58:46 | 1 of 4 START seed file public.source_rate_gbp_usd.................... [RUN]
2022-02-07 20:58:46.746693 (Thread-2): 23:58:46 | 2 of 4 START seed file public.source_wheat_gbp....................... [RUN]
2022-02-07 20:58:46.747771 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 20:58:46.748801 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 20:58:46.749307 (Thread-1): finished collecting timing info
2022-02-07 20:58:46.750295 (Thread-2): finished collecting timing info
2022-02-07 20:58:46.860525 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-07 20:58:46.867102 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 20:58:46.867366 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: BEGIN
2022-02-07 20:58:46.867506 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 20:58:46.892437 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 20:58:46.898149 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 20:58:46.908994 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_rate_gbp_usd"} */

    create table "postgres"."public"."source_rate_gbp_usd" (TRADEDATE text,PRICE integer,OPEN integer,HIGH integer,LOW integer,CHANGEPERC integer)
  
2022-02-07 20:58:46.924623 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 20:58:46.924965 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: BEGIN
2022-02-07 20:58:46.925105 (Thread-2): Opening a new connection, currently in state init
2022-02-07 20:58:46.938468 (Thread-1): SQL status: CREATE TABLE in 0.02 seconds
2022-02-07 20:58:46.951573 (Thread-2): SQL status: BEGIN in 0.03 seconds
2022-02-07 20:58:46.957013 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 20:58:46.962438 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_gbp"} */

    create table "postgres"."public"."source_wheat_gbp" (TRADEDATE text,PRICE integer,OPEN integer,HIGH integer,LOW integer,VOLUME text,CHANGEPERC integer)
  
2022-02-07 20:58:46.980111 (Thread-2): SQL status: CREATE TABLE in 0.01 seconds
2022-02-07 20:58:46.994893 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 20:58:47.000447 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: 
            insert into "postgres"."public"."source_rate_gbp_usd" (TRADEDATE, PRICE, OPEN, HIGH, LOW, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s...
2022-02-07 20:58:47.011012 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 20:58:47.011272 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: 
            insert into "postgres"."public"."source_wheat_gbp" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-07 20:58:47.023200 (Thread-1): SQL status: INSERT 0 548 in 0.02 seconds
2022-02-07 20:58:47.027852 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_rate_gbp_usd"
2022-02-07 20:58:47.028245 (Thread-2): SQL status: INSERT 0 531 in 0.02 seconds
2022-02-07 20:58:47.029333 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_gbp"
2022-02-07 20:58:47.043839 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-07 20:58:47.049258 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 20:58:47.051970 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-07 20:58:47.052253 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-07 20:58:47.052594 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 20:58:47.053016 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-07 20:58:47.057044 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 20:58:47.057343 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 20:58:47.059982 (Thread-1): finished collecting timing info
2022-02-07 20:58:47.063759 (Thread-2): finished collecting timing info
2022-02-07 20:58:47.064371 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: Close
2022-02-07 20:58:47.064794 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: Close
2022-02-07 20:58:47.066089 (Thread-1): 23:58:47 | 1 of 4 OK loaded seed file public.source_rate_gbp_usd................ [INSERT 548 in 0.32s]
2022-02-07 20:58:47.068337 (Thread-2): 23:58:47 | 2 of 4 OK loaded seed file public.source_wheat_gbp................... [INSERT 531 in 0.32s]
2022-02-07 20:58:47.069036 (Thread-1): Finished running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-07 20:58:47.069905 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_gbp
2022-02-07 20:58:47.070333 (Thread-1): Began running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 20:58:47.071035 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 20:58:47.073611 (Thread-1): 23:58:47 | 3 of 4 START seed file public.source_wheat_msk....................... [RUN]
2022-02-07 20:58:47.074780 (Thread-2): 23:58:47 | 4 of 4 START seed file public.source_wheat_usa....................... [RUN]
2022-02-07 20:58:47.075772 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 20:58:47.076327 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 20:58:47.076675 (Thread-1): finished collecting timing info
2022-02-07 20:58:47.077371 (Thread-2): finished collecting timing info
2022-02-07 20:58:47.122735 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 20:58:47.128174 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: BEGIN
2022-02-07 20:58:47.133597 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 20:58:47.157941 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 20:58:47.158162 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: BEGIN
2022-02-07 20:58:47.158259 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 20:58:47.159798 (Thread-2): SQL status: BEGIN in 0.03 seconds
2022-02-07 20:58:47.160038 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 20:58:47.160151 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_usa"} */

    create table "postgres"."public"."source_wheat_usa" (TRADEDATE text,PRICE integer,OPEN integer,HIGH integer,LOW integer,VOLUME text,CHANGEPERC integer)
  
2022-02-07 20:58:47.166654 (Thread-2): SQL status: CREATE TABLE in 0.01 seconds
2022-02-07 20:58:47.174243 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 20:58:47.174463 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: 
            insert into "postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-07 20:58:47.176591 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 20:58:47.177114 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 20:58:47.177357 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_msk"} */

    create table "postgres"."public"."source_wheat_msk" (BOARDID text,SECID text,TRADEDATE date,SHORTNAME text,NAME text,CLOSE float8,OPEN float8,HIGH float8,LOW float8,VALUE float8,DURATION integer,YIELD integer,DECIMALS integer,CAPITALIZATION float8,CURRENCYID text,DIVISOR integer,TRADINGSESSION integer,VOLUME integer)
  
2022-02-07 20:58:47.181153 (Thread-2): SQL status: INSERT 0 283 in 0.01 seconds
2022-02-07 20:58:47.181947 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_usa"
2022-02-07 20:58:47.187041 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-07 20:58:47.187368 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 20:58:47.187634 (Thread-1): SQL status: CREATE TABLE in 0.01 seconds
2022-02-07 20:58:47.187864 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-07 20:58:47.207763 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 20:58:47.207574 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 20:58:47.209946 (Thread-2): finished collecting timing info
2022-02-07 20:58:47.210539 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: 
            insert into "postgres"."public"."source_wheat_msk" (BOARDID, SECID, TRADEDATE, SHORTNAME, NAME, CLOSE, OPEN, HIGH, LOW, VALUE, DURATION, YIELD, DECIMALS, CAPITALIZATION, CURRENCYID, DIVISOR, TRADINGSESSION, VOLUME) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%...
2022-02-07 20:58:47.210871 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: Close
2022-02-07 20:58:47.217147 (Thread-2): 23:58:47 | 4 of 4 OK loaded seed file public.source_wheat_usa................... [INSERT 283 in 0.14s]
2022-02-07 20:58:47.217551 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 20:58:47.230661 (Thread-1): SQL status: INSERT 0 216 in 0.02 seconds
2022-02-07 20:58:47.231270 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_msk"
2022-02-07 20:58:47.234622 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 20:58:47.234836 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 20:58:47.234920 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 20:58:47.237810 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 20:58:47.241147 (Thread-1): finished collecting timing info
2022-02-07 20:58:47.242415 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: Close
2022-02-07 20:58:47.243506 (Thread-1): 23:58:47 | 3 of 4 OK loaded seed file public.source_wheat_msk................... [INSERT 216 in 0.17s]
2022-02-07 20:58:47.243857 (Thread-1): Finished running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 20:58:47.246271 (MainThread): Acquiring new postgres connection "master".
2022-02-07 20:58:47.246506 (MainThread): Using postgres connection "master".
2022-02-07 20:58:47.246630 (MainThread): On master: BEGIN
2022-02-07 20:58:47.246719 (MainThread): Opening a new connection, currently in state closed
2022-02-07 20:58:47.256220 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 20:58:47.256460 (MainThread): On master: COMMIT
2022-02-07 20:58:47.256535 (MainThread): Using postgres connection "master".
2022-02-07 20:58:47.256594 (MainThread): On master: COMMIT
2022-02-07 20:58:47.257763 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 20:58:47.258068 (MainThread): On master: Close
2022-02-07 20:58:47.258869 (MainThread): 23:58:47 | 
2022-02-07 20:58:47.259412 (MainThread): 23:58:47 | Finished running 4 seeds in 0.88s.
2022-02-07 20:58:47.259903 (MainThread): Connection 'master' was properly closed.
2022-02-07 20:58:47.260145 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_msk' was properly closed.
2022-02-07 20:58:47.260333 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_usa' was properly closed.
2022-02-07 20:58:47.411572 (MainThread): 
2022-02-07 20:58:47.411901 (MainThread): Completed successfully
2022-02-07 20:58:47.412185 (MainThread): 
Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
2022-02-07 20:58:47.412625 (MainThread): Flushing usage events
2022-02-07 21:04:29.405578 (MainThread): Running with dbt=0.19.0
2022-02-07 21:04:29.484475 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-02-07 21:04:29.485236 (MainThread): Tracking: do not track
2022-02-07 21:04:29.552795 (MainThread): Partial parsing not enabled
2022-02-07 21:04:29.553751 (MainThread): Parsing macros/adapters.sql
2022-02-07 21:04:29.573583 (MainThread): Parsing macros/catalog.sql
2022-02-07 21:04:29.575912 (MainThread): Parsing macros/relations.sql
2022-02-07 21:04:29.577341 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 21:04:29.579816 (MainThread): Parsing macros/core.sql
2022-02-07 21:04:29.583396 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 21:04:29.648206 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 21:04:29.652060 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 21:04:29.654779 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 21:04:29.677458 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 21:04:29.681390 (MainThread): Parsing macros/etc/query.sql
2022-02-07 21:04:29.683520 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 21:04:29.685909 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 21:04:29.698275 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 21:04:29.722031 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 21:04:29.724012 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 21:04:29.751695 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 21:04:29.767635 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 21:04:29.781093 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 21:04:29.784950 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 21:04:29.802602 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 21:04:29.807690 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 21:04:29.814038 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 21:04:29.820274 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 21:04:29.821952 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 21:04:29.823382 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 21:04:29.825170 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 21:04:29.828807 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 21:04:29.830535 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 21:04:29.832628 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 21:04:29.833955 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 21:04:29.842909 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 21:04:29.845055 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 21:04:29.846795 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 21:04:29.849948 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 21:04:29.851074 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 21:04:29.853316 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 21:04:29.856386 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 21:04:29.858300 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 21:04:29.861442 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 21:04:29.867432 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 21:04:29.883107 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 21:04:29.891125 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 21:04:29.897177 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 21:04:29.899070 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 21:04:29.901153 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 21:04:29.902827 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 21:04:29.904483 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 21:04:29.910026 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 21:04:29.911538 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 21:04:29.913406 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 21:04:29.915640 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 21:04:29.918658 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 21:04:29.920716 (MainThread): Parsing macros/sql/star.sql
2022-02-07 21:04:29.924635 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 21:04:29.926703 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 21:04:29.931495 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 21:04:29.933532 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 21:04:29.941334 (MainThread): Parsing macros/sql/union.sql
2022-02-07 21:04:29.950117 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 21:04:29.952315 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 21:04:29.957029 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 21:04:29.961982 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 21:04:29.967716 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 21:04:29.977966 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 21:04:29.985324 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 21:04:29.987856 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 21:04:29.990855 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 21:04:29.994206 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 21:04:29.998420 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 21:04:29.999916 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 21:04:30.001371 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 21:04:30.002785 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 21:04:30.028026 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 21:04:30.030088 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 21:04:30.032501 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 21:04:30.034517 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 21:04:30.036543 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 21:04:30.043150 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 21:04:30.046943 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 21:04:30.049900 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 21:04:30.051718 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 21:04:30.053584 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 21:04:30.056117 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 21:04:30.059420 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 21:04:30.061330 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 21:04:30.066613 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 21:04:30.069204 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 21:04:30.072852 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 21:04:30.073750 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 21:04:30.076152 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 21:04:30.079247 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 21:04:30.084071 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 21:04:30.093047 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 21:04:30.096116 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 21:04:30.096694 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 21:04:30.111272 (MainThread): Parsing macros/tables/link.sql
2022-02-07 21:04:30.136114 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 21:04:30.161177 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 21:04:30.182578 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 21:04:30.193155 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 21:04:30.221176 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 21:04:30.231666 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 21:04:30.253498 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 21:04:30.255006 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 21:04:30.273451 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 21:04:30.278950 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 21:04:30.285589 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 21:04:30.287038 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 21:04:30.292725 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 21:04:30.295007 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 21:04:30.305241 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 21:04:30.314719 (MainThread): Partial parsing not enabled
2022-02-07 21:04:30.435305 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:04:30.561382 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:04:30.629322 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:04:30.680619 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:04:30.743909 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:04:30.781339 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:04:30.821434 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:04:30.838770 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:04:30.856005 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:04:30.954019 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:04:30.988990 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:04:31.020842 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:04:31.046157 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:04:31.057416 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:04:31.826717 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.report
- models.project_otus_dbt.prestage

2022-02-07 21:04:31.951830 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 21:04:31.952732 (MainThread): Found 14 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 21:04:31.954331 (MainThread): 
2022-02-07 21:04:31.955012 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:04:31.959754 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 21:04:31.976886 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 21:04:31.977197 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 21:04:31.977406 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 21:04:31.995305 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 21:04:32.000668 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 21:04:32.029085 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 21:04:32.035749 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:04:32.035978 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 21:04:32.036085 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 21:04:32.047778 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:04:32.048040 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:04:32.048156 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 21:04:32.051947 (ThreadPoolExecutor-1_0): SQL status: SELECT 8 in 0.00 seconds
2022-02-07 21:04:32.058284 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 21:04:32.059655 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 21:04:32.087424 (MainThread): Using postgres connection "master".
2022-02-07 21:04:32.087699 (MainThread): On master: BEGIN
2022-02-07 21:04:32.087884 (MainThread): Opening a new connection, currently in state init
2022-02-07 21:04:32.102028 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:04:32.102258 (MainThread): Using postgres connection "master".
2022-02-07 21:04:32.102344 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 21:04:32.237858 (MainThread): SQL status: SELECT 6 in 0.14 seconds
2022-02-07 21:04:32.243926 (MainThread): On master: ROLLBACK
2022-02-07 21:04:32.245232 (MainThread): Using postgres connection "master".
2022-02-07 21:04:32.245445 (MainThread): On master: BEGIN
2022-02-07 21:04:32.247534 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:04:32.247780 (MainThread): On master: COMMIT
2022-02-07 21:04:32.247918 (MainThread): Using postgres connection "master".
2022-02-07 21:04:32.248042 (MainThread): On master: COMMIT
2022-02-07 21:04:32.249241 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:04:32.249540 (MainThread): On master: Close
2022-02-07 21:04:32.250019 (MainThread): 00:04:32 | Concurrency: 2 threads (target='dev')
2022-02-07 21:04:32.250268 (MainThread): 00:04:32 | 
2022-02-07 21:04:32.254555 (Thread-1): Began running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-07 21:04:32.254888 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_gbp
2022-02-07 21:04:32.256338 (Thread-1): 00:04:32 | 1 of 4 START seed file public.source_rate_gbp_usd.................... [RUN]
2022-02-07 21:04:32.258022 (Thread-2): 00:04:32 | 2 of 4 START seed file public.source_wheat_gbp....................... [RUN]
2022-02-07 21:04:32.258835 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 21:04:32.259680 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 21:04:32.260108 (Thread-1): finished collecting timing info
2022-02-07 21:04:32.260756 (Thread-2): finished collecting timing info
2022-02-07 21:04:32.376964 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 21:04:32.379147 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: BEGIN
2022-02-07 21:04:32.382198 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 21:04:32.382441 (Thread-2): Opening a new connection, currently in state init
2022-02-07 21:04:32.382675 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: BEGIN
2022-02-07 21:04:32.383339 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:04:32.396033 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:04:32.396337 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:04:32.396654 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 21:04:32.396884 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 21:04:32.397162 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_rate_gbp_usd"} */
truncate table "postgres"."public"."source_rate_gbp_usd"
2022-02-07 21:04:32.397384 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_gbp"} */
truncate table "postgres"."public"."source_wheat_gbp"
2022-02-07 21:04:32.404139 (Thread-2): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 21:04:32.410658 (Thread-1): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 21:04:32.433707 (Thread-2): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-07 21:04:32.434287 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-07 21:04:32.454439 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 21:04:32.459984 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: 
            insert into "postgres"."public"."source_wheat_gbp" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-07 21:04:32.463155 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 21:04:32.467630 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: 
            insert into "postgres"."public"."source_rate_gbp_usd" (TRADEDATE, PRICE, OPEN, HIGH, LOW, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s...
2022-02-07 21:04:32.479212 (Thread-2): SQL status: INSERT 0 531 in 0.02 seconds
2022-02-07 21:04:32.483897 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_gbp"
2022-02-07 21:04:32.484285 (Thread-1): SQL status: INSERT 0 548 in 0.02 seconds
2022-02-07 21:04:32.485070 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_rate_gbp_usd"
2022-02-07 21:04:32.493304 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-07 21:04:32.493562 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 21:04:32.493676 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-07 21:04:32.496704 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-07 21:04:32.496932 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 21:04:32.497016 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-07 21:04:32.499987 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:04:32.503983 (Thread-2): finished collecting timing info
2022-02-07 21:04:32.504553 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:04:32.504965 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: Close
2022-02-07 21:04:32.508900 (Thread-1): finished collecting timing info
2022-02-07 21:04:32.509901 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: Close
2022-02-07 21:04:32.511032 (Thread-2): 00:04:32 | 2 of 4 OK loaded seed file public.source_wheat_gbp................... [INSERT 531 in 0.25s]
2022-02-07 21:04:32.511651 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_gbp
2022-02-07 21:04:32.513561 (Thread-1): 00:04:32 | 1 of 4 OK loaded seed file public.source_rate_gbp_usd................ [INSERT 548 in 0.25s]
2022-02-07 21:04:32.514040 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 21:04:32.514702 (Thread-1): Finished running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-07 21:04:32.517092 (Thread-2): 00:04:32 | 3 of 4 START seed file public.source_wheat_msk....................... [RUN]
2022-02-07 21:04:32.517692 (Thread-1): Began running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 21:04:32.518645 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 21:04:32.520335 (Thread-1): 00:04:32 | 4 of 4 START seed file public.source_wheat_usa....................... [RUN]
2022-02-07 21:04:32.520755 (Thread-2): finished collecting timing info
2022-02-07 21:04:32.521486 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 21:04:32.531299 (Thread-1): finished collecting timing info
2022-02-07 21:04:32.567894 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 21:04:32.573456 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: BEGIN
2022-02-07 21:04:32.578992 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:04:32.663192 (Thread-2): SQL status: BEGIN in 0.08 seconds
2022-02-07 21:04:32.672626 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 21:04:32.672935 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 21:04:32.673245 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: BEGIN
2022-02-07 21:04:32.673581 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_msk"} */
truncate table "postgres"."public"."source_wheat_msk"
2022-02-07 21:04:32.673881 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:04:32.681562 (Thread-2): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 21:04:32.697782 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:04:32.698066 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 21:04:32.698329 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 21:04:32.698699 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: 
            insert into "postgres"."public"."source_wheat_msk" (BOARDID, SECID, TRADEDATE, SHORTNAME, NAME, CLOSE, OPEN, HIGH, LOW, VALUE, DURATION, YIELD, DECIMALS, CAPITALIZATION, CURRENCYID, DIVISOR, TRADINGSESSION, VOLUME) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%...
2022-02-07 21:04:32.699019 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_usa"} */
truncate table "postgres"."public"."source_wheat_usa"
2022-02-07 21:04:32.710158 (Thread-1): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 21:04:32.723503 (Thread-2): SQL status: INSERT 0 216 in 0.02 seconds
2022-02-07 21:04:32.726545 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 21:04:32.727094 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_msk"
2022-02-07 21:04:32.727360 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: 
            insert into "postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-07 21:04:32.735034 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 21:04:32.735342 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 21:04:32.735513 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 21:04:32.739088 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:04:32.739519 (Thread-1): SQL status: INSERT 0 547 in 0.01 seconds
2022-02-07 21:04:32.741404 (Thread-2): finished collecting timing info
2022-02-07 21:04:32.742069 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_usa"
2022-02-07 21:04:32.742325 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: Close
2022-02-07 21:04:32.743391 (Thread-2): 00:04:32 | 3 of 4 OK loaded seed file public.source_wheat_msk................... [INSERT 216 in 0.22s]
2022-02-07 21:04:32.746181 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-07 21:04:32.746565 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 21:04:32.746824 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 21:04:32.747592 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-07 21:04:32.751507 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:04:32.753934 (Thread-1): finished collecting timing info
2022-02-07 21:04:32.754367 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: Close
2022-02-07 21:04:32.755443 (Thread-1): 00:04:32 | 4 of 4 OK loaded seed file public.source_wheat_usa................... [INSERT 547 in 0.23s]
2022-02-07 21:04:32.755714 (Thread-1): Finished running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 21:04:32.758147 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:04:32.758451 (MainThread): Using postgres connection "master".
2022-02-07 21:04:32.758603 (MainThread): On master: BEGIN
2022-02-07 21:04:32.758766 (MainThread): Opening a new connection, currently in state closed
2022-02-07 21:04:32.769959 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:04:32.770223 (MainThread): On master: COMMIT
2022-02-07 21:04:32.770357 (MainThread): Using postgres connection "master".
2022-02-07 21:04:32.770485 (MainThread): On master: COMMIT
2022-02-07 21:04:32.771491 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:04:32.771730 (MainThread): On master: Close
2022-02-07 21:04:32.772250 (MainThread): 00:04:32 | 
2022-02-07 21:04:32.772571 (MainThread): 00:04:32 | Finished running 4 seeds in 0.82s.
2022-02-07 21:04:32.772813 (MainThread): Connection 'master' was properly closed.
2022-02-07 21:04:32.773025 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_usa' was properly closed.
2022-02-07 21:04:32.773165 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_msk' was properly closed.
2022-02-07 21:04:32.876499 (MainThread): 
2022-02-07 21:04:32.876775 (MainThread): Completed successfully
2022-02-07 21:04:32.876990 (MainThread): 
Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
2022-02-07 21:04:32.877278 (MainThread): Flushing usage events
2022-02-07 21:05:13.116095 (MainThread): Running with dbt=0.19.0
2022-02-07 21:05:13.188179 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 21:05:13.189016 (MainThread): Tracking: do not track
2022-02-07 21:05:13.261652 (MainThread): Partial parsing not enabled
2022-02-07 21:05:13.262533 (MainThread): Parsing macros/adapters.sql
2022-02-07 21:05:13.282515 (MainThread): Parsing macros/catalog.sql
2022-02-07 21:05:13.284961 (MainThread): Parsing macros/relations.sql
2022-02-07 21:05:13.286467 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 21:05:13.288926 (MainThread): Parsing macros/core.sql
2022-02-07 21:05:13.292534 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 21:05:13.329193 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 21:05:13.331194 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 21:05:13.333063 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 21:05:13.341144 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 21:05:13.342710 (MainThread): Parsing macros/etc/query.sql
2022-02-07 21:05:13.343714 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 21:05:13.344605 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 21:05:13.352515 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 21:05:13.382371 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 21:05:13.386381 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 21:05:13.437868 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 21:05:13.455034 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 21:05:13.461131 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 21:05:13.463098 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 21:05:13.475602 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 21:05:13.480694 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 21:05:13.487023 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 21:05:13.493325 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 21:05:13.495150 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 21:05:13.496678 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 21:05:13.498549 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 21:05:13.502343 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 21:05:13.504139 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 21:05:13.506184 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 21:05:13.507686 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 21:05:13.516683 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 21:05:13.518788 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 21:05:13.520575 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 21:05:13.525212 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 21:05:13.527483 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 21:05:13.532260 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 21:05:13.539217 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 21:05:13.542817 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 21:05:13.546485 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 21:05:13.551207 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 21:05:13.565162 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 21:05:13.572862 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 21:05:13.577707 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 21:05:13.579994 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 21:05:13.582993 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 21:05:13.585391 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 21:05:13.588979 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 21:05:13.600626 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 21:05:13.603369 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 21:05:13.606621 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 21:05:13.610654 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 21:05:13.615029 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 21:05:13.618183 (MainThread): Parsing macros/sql/star.sql
2022-02-07 21:05:13.623872 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 21:05:13.626659 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 21:05:13.632415 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 21:05:13.634938 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 21:05:13.643669 (MainThread): Parsing macros/sql/union.sql
2022-02-07 21:05:13.652723 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 21:05:13.654710 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 21:05:13.659177 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 21:05:13.662640 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 21:05:13.666307 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 21:05:13.672350 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 21:05:13.676831 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 21:05:13.678388 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 21:05:13.680129 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 21:05:13.682740 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 21:05:13.686358 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 21:05:13.687759 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 21:05:13.689123 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 21:05:13.690398 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 21:05:13.713105 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 21:05:13.715095 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 21:05:13.717464 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 21:05:13.719404 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 21:05:13.721313 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 21:05:13.727100 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 21:05:13.733566 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 21:05:13.739164 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 21:05:13.742736 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 21:05:13.746660 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 21:05:13.752424 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 21:05:13.760321 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 21:05:13.764883 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 21:05:13.775566 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 21:05:13.780426 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 21:05:13.786381 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 21:05:13.787810 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 21:05:13.791454 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 21:05:13.795919 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 21:05:13.802349 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 21:05:13.813480 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 21:05:13.817406 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 21:05:13.818258 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 21:05:13.829298 (MainThread): Parsing macros/tables/link.sql
2022-02-07 21:05:13.839285 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 21:05:13.850661 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 21:05:13.858530 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 21:05:13.862554 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 21:05:13.876800 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 21:05:13.883397 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 21:05:13.900569 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 21:05:13.901911 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 21:05:13.919624 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 21:05:13.927391 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 21:05:13.934411 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 21:05:13.935821 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 21:05:13.942117 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 21:05:13.944651 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 21:05:13.955759 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 21:05:13.965608 (MainThread): Partial parsing not enabled
2022-02-07 21:05:14.049823 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:05:14.119796 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:05:14.170611 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:05:14.218505 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:05:14.250770 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:05:14.273949 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:05:14.309239 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:05:14.327679 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:05:14.345437 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:05:14.442852 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:05:14.460664 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:05:14.478439 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:05:14.496753 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:05:14.506425 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:05:15.162686 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.prestage
- models.project_otus_dbt.report

2022-02-07 21:05:15.315836 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 21:05:15.316550 (MainThread): Found 14 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 21:05:15.318835 (MainThread): 
2022-02-07 21:05:15.319662 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:05:15.340713 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 21:05:15.354664 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 21:05:15.354908 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 21:05:15.355040 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 21:05:15.391376 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.04 seconds
2022-02-07 21:05:15.394360 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 21:05:15.433767 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 21:05:15.443997 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:05:15.444260 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 21:05:15.444385 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 21:05:15.459142 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:05:15.459476 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:05:15.459683 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 21:05:15.463890 (ThreadPoolExecutor-1_0): SQL status: SELECT 8 in 0.00 seconds
2022-02-07 21:05:15.473507 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 21:05:15.474953 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 21:05:15.507964 (MainThread): Using postgres connection "master".
2022-02-07 21:05:15.508222 (MainThread): On master: BEGIN
2022-02-07 21:05:15.508379 (MainThread): Opening a new connection, currently in state init
2022-02-07 21:05:15.519496 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:05:15.519754 (MainThread): Using postgres connection "master".
2022-02-07 21:05:15.519908 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 21:05:15.633989 (MainThread): SQL status: SELECT 6 in 0.11 seconds
2022-02-07 21:05:15.649395 (MainThread): On master: ROLLBACK
2022-02-07 21:05:15.650993 (MainThread): Using postgres connection "master".
2022-02-07 21:05:15.651254 (MainThread): On master: BEGIN
2022-02-07 21:05:15.653533 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:05:15.653766 (MainThread): On master: COMMIT
2022-02-07 21:05:15.653914 (MainThread): Using postgres connection "master".
2022-02-07 21:05:15.653991 (MainThread): On master: COMMIT
2022-02-07 21:05:15.655250 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:05:15.655573 (MainThread): On master: Close
2022-02-07 21:05:15.656327 (MainThread): 00:05:15 | Concurrency: 2 threads (target='dev')
2022-02-07 21:05:15.656700 (MainThread): 00:05:15 | 
2022-02-07 21:05:15.661470 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:05:15.661803 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:05:15.664575 (Thread-1): 00:05:15 | 1 of 14 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-07 21:05:15.666543 (Thread-2): 00:05:15 | 2 of 14 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-07 21:05:15.667130 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:05:15.667882 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:05:15.668192 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:05:15.668528 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:05:15.727686 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:05:15.729226 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:05:15.729745 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-07 21:05:15.730179 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-07 21:05:15.730439 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:05:15.730824 (Thread-2): Opening a new connection, currently in state init
2022-02-07 21:05:15.742980 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:05:15.743253 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:05:15.743405 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:05:15.747677 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:05:15.747896 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:05:15.747970 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:05:15.759834 (Thread-1): SQL status: SELECT 6 in 0.02 seconds
2022-02-07 21:05:15.765773 (Thread-2): SQL status: SELECT 7 in 0.02 seconds
2022-02-07 21:05:15.778481 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:05:15.781508 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:05:15.781784 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:05:15.782072 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:05:15.786959 (Thread-1): SQL status: SELECT 6 in 0.00 seconds
2022-02-07 21:05:15.787223 (Thread-2): SQL status: SELECT 7 in 0.00 seconds
2022-02-07 21:05:15.793442 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:05:15.801132 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:05:15.802630 (Thread-2): finished collecting timing info
2022-02-07 21:05:15.813566 (Thread-1): finished collecting timing info
2022-02-07 21:05:15.920906 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:05:15.919846 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:05:15.921304 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 21:05:15.921739 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-07 21:05:15.923927 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:05:15.924237 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:05:15.927095 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:05:15.931390 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:05:15.931677 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:05:15.931972 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:05:15.933735 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:05:15.934103 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:05:15.938901 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:05:15.941051 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:05:15.944778 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:05:15.945016 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:05:15.945176 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:05:15.945437 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:05:15.958420 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:05:15.958654 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:05:15.964888 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:05:15.970199 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:05:15.970495 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-07 21:05:15.970788 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-07 21:05:15.973853 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:05:15.974099 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:05:15.980248 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:05:15.981955 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:05:15.982217 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:05:15.982518 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:05:15.982722 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:05:15.983003 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:05:15.986814 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:05:15.990651 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:05:15.990879 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:05:15.991150 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:05:15.994283 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:05:15.994742 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:05:15.996033 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:05:15.996375 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:05:15.998623 (Thread-2): finished collecting timing info
2022-02-07 21:05:16.002835 (Thread-1): finished collecting timing info
2022-02-07 21:05:16.003322 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-07 21:05:16.003682 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-07 21:05:16.005495 (Thread-2): 00:05:15 | 2 of 14 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.34s]
2022-02-07 21:05:16.009113 (Thread-1): 00:05:15 | 1 of 14 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.34s]
2022-02-07 21:05:16.009573 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:05:16.010276 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:05:16.010645 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:05:16.011782 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:05:16.014253 (Thread-2): 00:05:16 | 3 of 14 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-07 21:05:16.016357 (Thread-1): 00:05:16 | 4 of 14 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-07 21:05:16.017343 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:05:16.018257 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:05:16.018522 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:05:16.018815 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:05:16.060813 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:05:16.066365 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 21:05:16.068741 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:05:16.069051 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:05:16.069304 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 21:05:16.069882 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:05:16.080371 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:05:16.080612 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:05:16.080769 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:05:16.083426 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:05:16.083777 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:05:16.084000 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:05:16.091228 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 21:05:16.098525 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:05:16.099687 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:05:16.108464 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:05:16.108742 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:05:16.109096 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:05:16.114276 (Thread-2): SQL status: SELECT 18 in 0.00 seconds
2022-02-07 21:05:16.114567 (Thread-1): SQL status: SELECT 7 in 0.00 seconds
2022-02-07 21:05:16.120414 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:05:16.131432 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:05:16.132933 (Thread-2): finished collecting timing info
2022-02-07 21:05:16.133383 (Thread-1): finished collecting timing info
2022-02-07 21:05:16.141065 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:05:16.151921 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 21:05:16.156771 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:05:16.157306 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 21:05:16.158742 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:05:16.164325 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:05:16.165181 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:05:16.170145 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:05:16.170552 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:05:16.170864 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:05:16.172514 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:05:16.172797 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:05:16.174369 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:05:16.176367 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:05:16.177339 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:05:16.177587 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:05:16.177859 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:05:16.178254 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:05:16.183108 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 21:05:16.186343 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:05:16.186565 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-07 21:05:16.187976 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:05:16.190945 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:05:16.191161 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:05:16.191400 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 21:05:16.192966 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:05:16.193402 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:05:16.193600 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:05:16.194990 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:05:16.196591 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:05:16.196829 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:05:16.197024 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:05:16.200562 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:05:16.200868 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:05:16.201107 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:05:16.202480 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:05:16.206856 (Thread-1): finished collecting timing info
2022-02-07 21:05:16.207269 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:05:16.207540 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 21:05:16.210413 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:05:16.210851 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:05:16.212812 (Thread-1): 00:05:16 | 4 of 14 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.19s]
2022-02-07 21:05:16.213414 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:05:16.213942 (Thread-1): Began running node model.project_otus_dbt.dim_day
2022-02-07 21:05:16.214919 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:05:16.216290 (Thread-1): 00:05:16 | 5 of 14 START table model public.dim_day............................. [RUN]
2022-02-07 21:05:16.219771 (Thread-2): finished collecting timing info
2022-02-07 21:05:16.220443 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 21:05:16.221183 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:05:16.225298 (Thread-2): 00:05:16 | 3 of 14 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.21s]
2022-02-07 21:05:16.225738 (Thread-1): Compiling model.project_otus_dbt.dim_day
2022-02-07 21:05:16.226265 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:05:16.233942 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:05:16.234355 (Thread-2): Began running node model.project_otus_dbt.dim_week
2022-02-07 21:05:16.237662 (Thread-2): 00:05:16 | 6 of 14 START table model public.dim_week............................ [RUN]
2022-02-07 21:05:16.238548 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:05:16.238932 (Thread-2): Compiling model.project_otus_dbt.dim_week
2022-02-07 21:05:16.239216 (Thread-1): finished collecting timing info
2022-02-07 21:05:16.250072 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:05:16.279282 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:05:16.279612 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-07 21:05:16.279812 (Thread-2): finished collecting timing info
2022-02-07 21:05:16.280221 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:05:16.291589 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:05:16.291979 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-07 21:05:16.292216 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:05:16.301951 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 21:05:16.304985 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:05:16.305197 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:05:16.305484 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:05:16.309112 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:05:16.309660 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:05:16.310677 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:05:16.310925 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:05:16.318929 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:05:16.320248 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:05:16.321369 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:05:16.321616 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:05:16.321793 (Thread-2): On model.project_otus_dbt.dim_week: BEGIN
2022-02-07 21:05:16.321974 (Thread-1): On model.project_otus_dbt.dim_day: BEGIN
2022-02-07 21:05:16.323537 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:05:16.323748 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:05:16.323928 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:05:16.324126 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:05:16.324301 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 day')
        as t(date)
        )

select * from dim_day
order by date desc
  );
2022-02-07 21:05:16.324496 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-07 21:05:16.340614 (Thread-2): SQL status: SELECT 731 in 0.02 seconds
2022-02-07 21:05:16.346774 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:05:16.347033 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-07 21:05:16.348773 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:05:16.351824 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:05:16.352021 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-07 21:05:16.353435 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:05:16.354928 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:05:16.355152 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:05:16.355286 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:05:16.361195 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:05:16.365345 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:05:16.365564 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:05:16.371680 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:05:16.374700 (Thread-2): finished collecting timing info
2022-02-07 21:05:16.375094 (Thread-2): On model.project_otus_dbt.dim_week: Close
2022-02-07 21:05:16.377117 (Thread-2): 00:05:16 | 6 of 14 OK created table model public.dim_week....................... [SELECT 731 in 0.14s]
2022-02-07 21:05:16.377429 (Thread-1): SQL status: SELECT 5114 in 0.05 seconds
2022-02-07 21:05:16.377910 (Thread-2): Finished running node model.project_otus_dbt.dim_week
2022-02-07 21:05:16.382301 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:05:16.382814 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:05:16.383272 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-07 21:05:16.384781 (Thread-2): 00:05:16 | 7 of 14 START incremental model public.hub_wheat_gbp................. [RUN]
2022-02-07 21:05:16.386108 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:05:16.386510 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:05:16.392709 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 21:05:16.397794 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:05:16.401805 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:05:16.402404 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-07 21:05:16.404111 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:05:16.405821 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:05:16.406067 (Thread-2): finished collecting timing info
2022-02-07 21:05:16.406481 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:05:16.417242 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:05:16.433259 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:05:16.441638 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:05:16.447084 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:05:16.452290 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:05:16.453898 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:05:16.454123 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-07 21:05:16.454278 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:05:16.458320 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:05:16.461393 (Thread-1): finished collecting timing info
2022-02-07 21:05:16.461758 (Thread-1): On model.project_otus_dbt.dim_day: Close
2022-02-07 21:05:16.463939 (Thread-1): 00:05:16 | 5 of 14 OK created table model public.dim_day........................ [SELECT 5114 in 0.24s]
2022-02-07 21:05:16.464412 (Thread-1): Finished running node model.project_otus_dbt.dim_day
2022-02-07 21:05:16.464901 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:05:16.467576 (Thread-1): 00:05:16 | 8 of 14 START incremental model public.sat_wheat_gbp_details......... [RUN]
2022-02-07 21:05:16.467864 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:05:16.468455 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:05:16.468865 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:05:16.469239 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:05:16.469612 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

  create  table "postgres"."public"."hub_wheat_gbp"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:05:16.496936 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:05:16.501467 (Thread-1): finished collecting timing info
2022-02-07 21:05:16.510032 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:05:16.510259 (Thread-2): SQL status: SELECT 531 in 0.03 seconds
2022-02-07 21:05:16.512082 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:05:16.512391 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:05:16.512625 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:05:16.512796 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:05:16.512986 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-07 21:05:16.513327 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:05:16.516269 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:05:16.519060 (Thread-2): finished collecting timing info
2022-02-07 21:05:16.519530 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-07 21:05:16.521720 (Thread-2): 00:05:16 | 7 of 14 OK created incremental model public.hub_wheat_gbp............ [SELECT 531 in 0.13s]
2022-02-07 21:05:16.522106 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:05:16.522628 (Thread-2): Began running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:05:16.524796 (Thread-2): 00:05:16 | 9 of 14 START incremental model public.link_wheat_gbp_rate........... [RUN]
2022-02-07 21:05:16.525673 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:05:16.526175 (Thread-2): Compiling model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:05:16.532643 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:05:16.538130 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:05:16.542262 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:05:16.542530 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

  create  table "postgres"."public"."sat_wheat_gbp_details"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:05:16.543302 (Thread-2): finished collecting timing info
2022-02-07 21:05:16.558240 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:05:16.559143 (Thread-2): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:05:16.559477 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: BEGIN
2022-02-07 21:05:16.559774 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:05:16.563574 (Thread-1): SQL status: SELECT 531 in 0.02 seconds
2022-02-07 21:05:16.565151 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:05:16.565396 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:05:16.565590 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:05:16.569658 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:05:16.571960 (Thread-1): finished collecting timing info
2022-02-07 21:05:16.572415 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-07 21:05:16.575088 (Thread-1): 00:05:16 | 8 of 14 OK created incremental model public.sat_wheat_gbp_details.... [SELECT 531 in 0.11s]
2022-02-07 21:05:16.575398 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:05:16.576130 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:05:16.576582 (Thread-2): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:05:16.577259 (Thread-1): Began running node model.project_otus_dbt.sat_rate_gbp_usd
2022-02-07 21:05:16.577904 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.link_wheat_gbp_rate"} */

      

  create  table "postgres"."public"."link_wheat_gbp_rate"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (
   
SELECT * FROM (
    SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY LINK_DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as l
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.LINK_DATE_PK, a.DATE_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:05:16.579345 (Thread-1): 00:05:16 | 10 of 14 START incremental model public.sat_rate_gbp_usd............. [RUN]
2022-02-07 21:05:16.580537 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:05:16.580992 (Thread-1): Compiling model.project_otus_dbt.sat_rate_gbp_usd
2022-02-07 21:05:16.588866 (Thread-2): Postgres error: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^

2022-02-07 21:05:16.594365 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: ROLLBACK
2022-02-07 21:05:16.606468 (Thread-2): finished collecting timing info
2022-02-07 21:05:16.608015 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd"
2022-02-07 21:05:16.608322 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: Close
2022-02-07 21:05:16.609962 (Thread-1): finished collecting timing info
2022-02-07 21:05:16.618586 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd"
2022-02-07 21:05:16.619660 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:05:16.620119 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd: BEGIN
2022-02-07 21:05:16.620364 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:05:16.609372 (Thread-2): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 132, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:05:16.628137 (Thread-2): 00:05:16 | 9 of 14 ERROR creating incremental model public.link_wheat_gbp_rate.. [ERROR in 0.10s]
2022-02-07 21:05:16.628477 (Thread-2): Finished running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:05:16.628755 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:05:16.631932 (Thread-2): 00:05:16 | 11 of 14 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-07 21:05:16.632797 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:05:16.633489 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:05:16.640712 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:05:16.648861 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:05:16.649180 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:05:16.649811 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

      

  create  table "postgres"."public"."sat_rate_gbp_usd"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:05:16.650549 (Thread-2): finished collecting timing info
2022-02-07 21:05:16.658236 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:05:16.659100 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:05:16.659330 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-07 21:05:16.659577 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:05:16.672177 (Thread-1): SQL status: SELECT 548 in 0.02 seconds
2022-02-07 21:05:16.672515 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:05:16.673803 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd: COMMIT
2022-02-07 21:05:16.674144 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:05:16.674454 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:05:16.674752 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

  create  table "postgres"."public"."hub_wheat_usa"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:05:16.675001 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd: COMMIT
2022-02-07 21:05:16.679634 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:05:16.682210 (Thread-1): finished collecting timing info
2022-02-07 21:05:16.682920 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd: Close
2022-02-07 21:05:16.685552 (Thread-1): 00:05:16 | 10 of 14 OK created incremental model public.sat_rate_gbp_usd........ [SELECT 548 in 0.10s]
2022-02-07 21:05:16.686440 (Thread-1): Finished running node model.project_otus_dbt.sat_rate_gbp_usd
2022-02-07 21:05:16.687009 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:05:16.689564 (Thread-1): 00:05:16 | 12 of 14 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-07 21:05:16.690419 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:05:16.690745 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:05:16.699374 (Thread-2): SQL status: SELECT 547 in 0.02 seconds
2022-02-07 21:05:16.706300 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:05:16.711878 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:05:16.713897 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:05:16.714111 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:05:16.715298 (Thread-1): finished collecting timing info
2022-02-07 21:05:16.722893 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:05:16.722758 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:05:16.725482 (Thread-2): finished collecting timing info
2022-02-07 21:05:16.726310 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-07 21:05:16.728409 (Thread-2): 00:05:16 | 11 of 14 OK created incremental model public.hub_wheat_usa........... [SELECT 547 in 0.09s]
2022-02-07 21:05:16.729005 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:05:16.729571 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:05:16.730086 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-07 21:05:16.730718 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:05:16.731457 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:05:16.733434 (Thread-2): 00:05:16 | 13 of 14 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-07 21:05:16.734514 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:05:16.734912 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:05:16.750794 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:05:16.751235 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:05:16.751580 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:05:16.751734 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

  create  table "postgres"."public"."sat_wheat_usa_details"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:05:16.752032 (Thread-2): finished collecting timing info
2022-02-07 21:05:16.760594 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:05:16.761236 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:05:16.761430 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-07 21:05:16.761612 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:05:16.772614 (Thread-1): SQL status: SELECT 547 in 0.02 seconds
2022-02-07 21:05:16.772974 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:05:16.774280 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:05:16.774565 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:05:16.774769 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:05:16.774961 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

  create  table "postgres"."public"."hub_wheat_msk"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:05:16.775140 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:05:16.778603 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:05:16.781111 (Thread-1): finished collecting timing info
2022-02-07 21:05:16.781480 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-07 21:05:16.783474 (Thread-1): 00:05:16 | 12 of 14 OK created incremental model public.sat_wheat_usa_details... [SELECT 547 in 0.09s]
2022-02-07 21:05:16.783811 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:05:16.784219 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:05:16.786242 (Thread-1): 00:05:16 | 14 of 14 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-07 21:05:16.786920 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:05:16.787235 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:05:16.794306 (Thread-2): SQL status: SELECT 216 in 0.02 seconds
2022-02-07 21:05:16.801137 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:05:16.806715 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:05:16.809908 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:05:16.810186 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:05:16.810827 (Thread-1): finished collecting timing info
2022-02-07 21:05:16.817603 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:05:16.817833 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:05:16.819895 (Thread-2): finished collecting timing info
2022-02-07 21:05:16.820299 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-07 21:05:16.820764 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:05:16.823841 (Thread-2): 00:05:16 | 13 of 14 OK created incremental model public.hub_wheat_msk........... [SELECT 216 in 0.09s]
2022-02-07 21:05:16.824108 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-07 21:05:16.824612 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:05:16.824856 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:05:16.837214 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:05:16.837598 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:05:16.837783 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

  create  table "postgres"."public"."sat_wheat_msk_details"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:05:16.850455 (Thread-1): SQL status: SELECT 216 in 0.01 seconds
2022-02-07 21:05:16.852131 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:05:16.852353 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:05:16.852600 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:05:16.855261 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:05:16.858777 (Thread-1): finished collecting timing info
2022-02-07 21:05:16.859201 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-07 21:05:16.860992 (Thread-1): 00:05:16 | 14 of 14 OK created incremental model public.sat_wheat_msk_details... [SELECT 216 in 0.07s]
2022-02-07 21:05:16.861286 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:05:16.864061 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:05:16.864363 (MainThread): Using postgres connection "master".
2022-02-07 21:05:16.864513 (MainThread): On master: BEGIN
2022-02-07 21:05:16.864674 (MainThread): Opening a new connection, currently in state closed
2022-02-07 21:05:16.877716 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:05:16.877992 (MainThread): On master: COMMIT
2022-02-07 21:05:16.878141 (MainThread): Using postgres connection "master".
2022-02-07 21:05:16.878262 (MainThread): On master: COMMIT
2022-02-07 21:05:16.879402 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:05:16.879825 (MainThread): On master: Close
2022-02-07 21:05:16.880616 (MainThread): 00:05:16 | 
2022-02-07 21:05:16.880989 (MainThread): 00:05:16 | Finished running 4 view models, 2 table models, 8 incremental models in 1.56s.
2022-02-07 21:05:16.881305 (MainThread): Connection 'master' was properly closed.
2022-02-07 21:05:16.881530 (MainThread): Connection 'model.project_otus_dbt.sat_wheat_msk_details' was properly closed.
2022-02-07 21:05:16.881739 (MainThread): Connection 'model.project_otus_dbt.hub_wheat_msk' was properly closed.
2022-02-07 21:05:17.012535 (MainThread): 
2022-02-07 21:05:17.012843 (MainThread): Completed with 1 error and 0 warnings:
2022-02-07 21:05:17.013049 (MainThread): 
2022-02-07 21:05:17.013503 (MainThread): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
2022-02-07 21:05:17.014010 (MainThread):   column "link_date_pk" does not exist
2022-02-07 21:05:17.014407 (MainThread):   LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
2022-02-07 21:05:17.014667 (MainThread):                       ^
2022-02-07 21:05:17.014839 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:05:17.015090 (MainThread): 
Done. PASS=13 WARN=0 ERROR=1 SKIP=0 TOTAL=14
2022-02-07 21:05:17.015528 (MainThread): Flushing usage events
2022-02-07 21:27:05.214748 (MainThread): Running with dbt=0.19.0
2022-02-07 21:27:05.303170 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 21:27:05.304826 (MainThread): Tracking: do not track
2022-02-07 21:27:05.398753 (MainThread): Partial parsing not enabled
2022-02-07 21:27:05.400529 (MainThread): Parsing macros/adapters.sql
2022-02-07 21:27:05.423981 (MainThread): Parsing macros/catalog.sql
2022-02-07 21:27:05.427010 (MainThread): Parsing macros/relations.sql
2022-02-07 21:27:05.429537 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 21:27:05.435932 (MainThread): Parsing macros/core.sql
2022-02-07 21:27:05.444769 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 21:27:05.520798 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 21:27:05.524026 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 21:27:05.526756 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 21:27:05.540246 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 21:27:05.543789 (MainThread): Parsing macros/etc/query.sql
2022-02-07 21:27:05.545739 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 21:27:05.547454 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 21:27:05.562220 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 21:27:05.590430 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 21:27:05.593368 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 21:27:05.633072 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 21:27:05.654671 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 21:27:05.663002 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 21:27:05.665643 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 21:27:05.689231 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 21:27:05.701409 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 21:27:05.716416 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 21:27:05.730679 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 21:27:05.734320 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 21:27:05.737392 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 21:27:05.741377 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 21:27:05.750891 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 21:27:05.754970 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 21:27:05.759821 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 21:27:05.761744 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 21:27:05.776877 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 21:27:05.780336 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 21:27:05.783106 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 21:27:05.786876 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 21:27:05.788240 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 21:27:05.791474 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 21:27:05.796277 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 21:27:05.798562 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 21:27:05.801509 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 21:27:05.804833 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 21:27:05.813494 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 21:27:05.818083 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 21:27:05.821688 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 21:27:05.824154 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 21:27:05.826759 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 21:27:05.828831 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 21:27:05.831045 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 21:27:05.838397 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 21:27:05.840314 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 21:27:05.842483 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 21:27:05.845223 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 21:27:05.848963 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 21:27:05.851608 (MainThread): Parsing macros/sql/star.sql
2022-02-07 21:27:05.856963 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 21:27:05.859626 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 21:27:05.865395 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 21:27:05.867942 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 21:27:05.878189 (MainThread): Parsing macros/sql/union.sql
2022-02-07 21:27:05.893669 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 21:27:05.898263 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 21:27:05.905314 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 21:27:05.908990 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 21:27:05.912887 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 21:27:05.919994 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 21:27:05.924782 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 21:27:05.926482 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 21:27:05.928393 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 21:27:05.931032 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 21:27:05.934969 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 21:27:05.936509 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 21:27:05.938114 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 21:27:05.939670 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 21:27:05.977929 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 21:27:05.981518 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 21:27:05.985492 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 21:27:05.988593 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 21:27:05.991637 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 21:27:06.001228 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 21:27:06.006730 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 21:27:06.010959 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 21:27:06.014362 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 21:27:06.017735 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 21:27:06.021987 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 21:27:06.028505 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 21:27:06.034253 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 21:27:06.051264 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 21:27:06.057778 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 21:27:06.064372 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 21:27:06.066567 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 21:27:06.070399 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 21:27:06.074825 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 21:27:06.081552 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 21:27:06.096406 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 21:27:06.101277 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 21:27:06.102333 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 21:27:06.115439 (MainThread): Parsing macros/tables/link.sql
2022-02-07 21:27:06.128411 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 21:27:06.144786 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 21:27:06.154458 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 21:27:06.160216 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 21:27:06.180855 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 21:27:06.189079 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 21:27:06.210601 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 21:27:06.212701 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 21:27:06.234026 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 21:27:06.239928 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 21:27:06.246817 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 21:27:06.248338 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 21:27:06.254545 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 21:27:06.257070 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 21:27:06.267591 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 21:27:06.279787 (MainThread): Partial parsing not enabled
2022-02-07 21:27:06.450094 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:27:06.598064 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:27:06.710369 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:27:06.755924 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:27:06.805464 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:27:06.847070 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:27:06.921615 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:27:06.946421 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:27:06.966925 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:27:07.129629 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:27:07.169609 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:27:07.205487 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:27:07.247606 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:27:07.265477 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:27:07.278687 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 21:27:07.289426 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:27:08.409208 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.report
- models.project_otus_dbt.prestage

2022-02-07 21:27:08.654639 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 21:27:08.655804 (MainThread): Found 16 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 21:27:08.659335 (MainThread): 
2022-02-07 21:27:08.660164 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:27:08.692514 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 21:27:08.704224 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 21:27:08.704496 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 21:27:08.704672 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 21:27:08.800055 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.10 seconds
2022-02-07 21:27:08.802933 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 21:27:08.842696 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 21:27:08.859955 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:27:08.860331 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 21:27:08.860662 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 21:27:08.876352 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:27:08.876891 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:27:08.877189 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 21:27:08.895982 (ThreadPoolExecutor-1_0): SQL status: SELECT 19 in 0.02 seconds
2022-02-07 21:27:08.928575 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 21:27:08.930666 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 21:27:08.986961 (MainThread): Using postgres connection "master".
2022-02-07 21:27:08.987401 (MainThread): On master: BEGIN
2022-02-07 21:27:08.987734 (MainThread): Opening a new connection, currently in state init
2022-02-07 21:27:09.002834 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:27:09.003128 (MainThread): Using postgres connection "master".
2022-02-07 21:27:09.003320 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 21:27:09.295561 (MainThread): SQL status: SELECT 10 in 0.29 seconds
2022-02-07 21:27:09.307319 (MainThread): On master: ROLLBACK
2022-02-07 21:27:09.308684 (MainThread): Using postgres connection "master".
2022-02-07 21:27:09.308935 (MainThread): On master: BEGIN
2022-02-07 21:27:09.311230 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:27:09.311515 (MainThread): On master: COMMIT
2022-02-07 21:27:09.311695 (MainThread): Using postgres connection "master".
2022-02-07 21:27:09.311895 (MainThread): On master: COMMIT
2022-02-07 21:27:09.313139 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:27:09.313450 (MainThread): On master: Close
2022-02-07 21:27:09.314062 (MainThread): 00:27:09 | Concurrency: 2 threads (target='dev')
2022-02-07 21:27:09.314451 (MainThread): 00:27:09 | 
2022-02-07 21:27:09.319416 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:27:09.319896 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:27:09.321551 (Thread-1): 00:27:09 | 1 of 15 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-07 21:27:09.323406 (Thread-2): 00:27:09 | 2 of 15 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-07 21:27:09.324376 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:27:09.325236 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:27:09.325640 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:27:09.326021 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:27:09.401705 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:27:09.403242 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:27:09.403533 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-07 21:27:09.403806 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-07 21:27:09.404074 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:27:09.404277 (Thread-2): Opening a new connection, currently in state init
2022-02-07 21:27:09.417219 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:27:09.417559 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:27:09.417777 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:09.419150 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:27:09.419513 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:27:09.419756 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:09.474840 (Thread-1): SQL status: SELECT 6 in 0.06 seconds
2022-02-07 21:27:09.484132 (Thread-2): SQL status: SELECT 7 in 0.06 seconds
2022-02-07 21:27:09.486514 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:27:09.494448 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:27:09.494764 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:09.495041 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:09.504439 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-07 21:27:09.512145 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:27:09.512409 (Thread-2): SQL status: SELECT 7 in 0.02 seconds
2022-02-07 21:27:09.585910 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:27:09.586642 (Thread-2): finished collecting timing info
2022-02-07 21:27:09.587226 (Thread-1): finished collecting timing info
2022-02-07 21:27:09.628799 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:27:09.629721 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:27:09.630012 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-07 21:27:09.630311 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 21:27:09.632869 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:27:09.633139 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:27:09.636686 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:27:09.643525 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:27:09.643832 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:27:09.644202 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:27:09.646044 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:27:09.646358 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:27:09.652332 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:27:09.654714 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:27:09.655851 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:27:09.656338 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:27:09.657201 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:27:09.657464 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:27:09.675266 (Thread-1): SQL status: CREATE VIEW in 0.02 seconds
2022-02-07 21:27:09.683880 (Thread-2): SQL status: CREATE VIEW in 0.03 seconds
2022-02-07 21:27:09.697497 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:27:09.700180 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:27:09.700528 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-07 21:27:09.700746 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-07 21:27:09.703300 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:27:09.703611 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:27:09.706718 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:27:09.711746 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:27:09.712073 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-07 21:27:09.712323 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-07 21:27:09.714890 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:27:09.715254 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:27:09.733686 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:27:09.735760 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:27:09.736018 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:27:09.736293 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:27:09.736556 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:27:09.736799 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:27:09.740953 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:27:09.745631 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:27:09.745868 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:27:09.746363 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:27:09.749825 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:27:09.750345 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:27:09.755481 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:27:09.758825 (Thread-1): finished collecting timing info
2022-02-07 21:27:09.759342 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:27:09.759580 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-07 21:27:09.762553 (Thread-2): finished collecting timing info
2022-02-07 21:27:09.764895 (Thread-1): 00:27:09 | 1 of 15 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.44s]
2022-02-07 21:27:09.765259 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-07 21:27:09.765782 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:27:09.766493 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:27:09.769327 (Thread-2): 00:27:09 | 2 of 15 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.44s]
2022-02-07 21:27:09.772257 (Thread-1): 00:27:09 | 3 of 15 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-07 21:27:09.773325 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:27:09.774631 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:27:09.775204 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:27:09.776216 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:27:09.780017 (Thread-2): 00:27:09 | 4 of 15 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-07 21:27:09.798864 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:27:09.804384 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:27:09.817153 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:27:09.822741 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 21:27:09.828436 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:27:09.836738 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:27:09.837144 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 21:27:09.837422 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:27:09.866845 (Thread-1): SQL status: BEGIN in 0.04 seconds
2022-02-07 21:27:09.867513 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:27:09.867731 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:09.904056 (Thread-2): SQL status: BEGIN in 0.07 seconds
2022-02-07 21:27:09.904458 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:27:09.904838 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:09.911443 (Thread-1): SQL status: SELECT 18 in 0.04 seconds
2022-02-07 21:27:09.918526 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:27:09.918789 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:09.933941 (Thread-1): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 21:27:09.940286 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:27:09.940821 (Thread-1): finished collecting timing info
2022-02-07 21:27:09.949200 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:27:09.949461 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 21:27:09.951450 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:27:09.956435 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:27:09.956674 (Thread-2): SQL status: SELECT 7 in 0.05 seconds
2022-02-07 21:27:09.956850 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:27:09.968782 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:27:09.968987 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:09.971712 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:27:09.973060 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:27:09.973647 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:27:09.973797 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:27:09.982616 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:27:09.987846 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:27:09.988085 (Thread-2): SQL status: SELECT 7 in 0.02 seconds
2022-02-07 21:27:09.988276 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-07 21:27:10.009207 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:27:10.009510 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 21:27:10.013599 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:27:10.013862 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 21:27:10.014097 (Thread-2): finished collecting timing info
2022-02-07 21:27:10.021736 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 21:27:10.023721 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:27:10.025458 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:27:10.025731 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 21:27:10.025966 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:27:10.026267 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:27:10.027619 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:27:10.031842 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:27:10.032117 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:27:10.032320 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:27:10.037122 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:27:10.037741 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:27:10.038905 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:27:10.040890 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:27:10.041417 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:27:10.041611 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:27:10.043478 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:27:10.046351 (Thread-1): finished collecting timing info
2022-02-07 21:27:10.047182 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 21:27:10.049364 (Thread-1): 00:27:10 | 3 of 15 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.27s]
2022-02-07 21:27:10.049749 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:27:10.050069 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:27:10.051731 (Thread-1): 00:27:10 | 5 of 15 START view model public.dds_wheat_msk........................ [RUN]
2022-02-07 21:27:10.052776 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:27:10.053090 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:27:10.061420 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 21:27:10.062508 (Thread-2): SQL status: CREATE VIEW in 0.02 seconds
2022-02-07 21:27:10.069459 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:27:10.069742 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-07 21:27:10.069981 (Thread-1): finished collecting timing info
2022-02-07 21:27:10.077258 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 21:27:10.079079 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:27:10.083156 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:27:10.083609 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-07 21:27:10.083903 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-07 21:27:10.084260 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:27:10.086865 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:27:10.088510 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:27:10.088734 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:27:10.088855 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:27:10.092749 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:27:10.095717 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:27:10.096054 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:27:10.097906 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:27:10.101371 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:27:10.101608 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 21:27:10.102938 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:27:10.103156 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:27:10.104409 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 21:27:10.107409 (Thread-2): finished collecting timing info
2022-02-07 21:27:10.108621 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 21:27:10.110913 (Thread-2): 00:27:10 | 4 of 15 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.31s]
2022-02-07 21:27:10.111397 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:27:10.111664 (Thread-2): Began running node model.project_otus_dbt.dim_day
2022-02-07 21:27:10.112536 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:27:10.114247 (Thread-2): 00:27:10 | 6 of 15 START table model public.dim_day............................. [RUN]
2022-02-07 21:27:10.115000 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-07 21:27:10.115632 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:27:10.116143 (Thread-2): Compiling model.project_otus_dbt.dim_day
2022-02-07 21:27:10.122477 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:27:10.124328 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:27:10.124627 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:27:10.125036 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */

  create view "postgres"."public"."dds_wheat_msk__dbt_tmp" as (
    min(to_date(tradedate, 'DD.MM.YYYY')), max(to_date(tradedate, 'DD.MM.YYYY'))
  );

2022-02-07 21:27:10.125482 (Thread-2): finished collecting timing info
2022-02-07 21:27:10.133472 (Thread-1): Postgres error: syntax error at or near "min"
LINE 4:     min(to_date(tradedate, 'DD.MM.YYYY')), max(to_date(trade...
            ^

2022-02-07 21:27:10.138956 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: ROLLBACK
2022-02-07 21:27:10.148501 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:27:10.148850 (Thread-1): finished collecting timing info
2022-02-07 21:27:10.149258 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-07 21:27:10.149654 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-07 21:27:10.149876 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:27:10.150733 (Thread-1): Database Error in model dds_wheat_msk (models/dds/dds_wheat_msk.sql)
  syntax error at or near "min"
  LINE 4:     min(to_date(tradedate, 'DD.MM.YYYY')), max(to_date(trade...
              ^
  compiled SQL at target/run/project_otus_dbt/models/dds/dds_wheat_msk.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near "min"
LINE 4:     min(to_date(tradedate, 'DD.MM.YYYY')), max(to_date(trade...
            ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model dds_wheat_msk (models/dds/dds_wheat_msk.sql)
  syntax error at or near "min"
  LINE 4:     min(to_date(tradedate, 'DD.MM.YYYY')), max(to_date(trade...
              ^
  compiled SQL at target/run/project_otus_dbt/models/dds/dds_wheat_msk.sql
2022-02-07 21:27:10.158700 (Thread-1): 00:27:10 | 5 of 15 ERROR creating view model public.dds_wheat_msk............... [ERROR in 0.10s]
2022-02-07 21:27:10.159027 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:27:10.159296 (Thread-1): Began running node model.project_otus_dbt.dim_week
2022-02-07 21:27:10.162183 (Thread-1): 00:27:10 | 7 of 15 START table model public.dim_week............................ [RUN]
2022-02-07 21:27:10.162934 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:27:10.163333 (Thread-1): Compiling model.project_otus_dbt.dim_week
2022-02-07 21:27:10.170592 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 21:27:10.171789 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:27:10.175911 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:27:10.176542 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:27:10.176956 (Thread-1): finished collecting timing info
2022-02-07 21:27:10.184677 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:27:10.185346 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:27:10.193535 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:27:10.193845 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-07 21:27:10.194344 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:27:10.195130 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:27:10.195472 (Thread-2): On model.project_otus_dbt.dim_day: BEGIN
2022-02-07 21:27:10.196845 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:27:10.197187 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:27:10.197396 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 day')
        as t(date)
        )

select * from dim_day
order by date desc
  );
2022-02-07 21:27:10.209319 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 21:27:10.214029 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:27:10.214244 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:27:10.215646 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:27:10.217330 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:27:10.217805 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:27:10.217953 (Thread-1): On model.project_otus_dbt.dim_week: BEGIN
2022-02-07 21:27:10.219525 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:27:10.219798 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:27:10.219945 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-07 21:27:10.236941 (Thread-2): SQL status: SELECT 5114 in 0.04 seconds
2022-02-07 21:27:10.237320 (Thread-1): SQL status: SELECT 731 in 0.02 seconds
2022-02-07 21:27:10.243480 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:27:10.249386 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:27:10.249703 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-07 21:27:10.249947 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-07 21:27:10.252242 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:27:10.252492 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:27:10.256281 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:27:10.260211 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:27:10.260539 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-07 21:27:10.260753 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-07 21:27:10.262479 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:27:10.262797 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:27:10.264587 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:27:10.266383 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:27:10.266688 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:27:10.266937 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:27:10.267151 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:27:10.267371 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:27:10.272316 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:27:10.275138 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:27:10.275347 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:27:10.275511 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:27:10.278419 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:27:10.278985 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:27:10.285084 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:27:10.285392 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:27:10.289076 (Thread-2): finished collecting timing info
2022-02-07 21:27:10.293083 (Thread-1): finished collecting timing info
2022-02-07 21:27:10.293599 (Thread-2): On model.project_otus_dbt.dim_day: Close
2022-02-07 21:27:10.293838 (Thread-1): On model.project_otus_dbt.dim_week: Close
2022-02-07 21:27:10.295730 (Thread-1): 00:27:10 | 7 of 15 OK created table model public.dim_week....................... [SELECT 731 in 0.13s]
2022-02-07 21:27:10.297967 (Thread-2): 00:27:10 | 6 of 15 OK created table model public.dim_day........................ [SELECT 5114 in 0.18s]
2022-02-07 21:27:10.298368 (Thread-1): Finished running node model.project_otus_dbt.dim_week
2022-02-07 21:27:10.298659 (Thread-2): Finished running node model.project_otus_dbt.dim_day
2022-02-07 21:27:10.298981 (Thread-1): Began running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:27:10.299801 (Thread-2): Began running node model.project_otus_dbt.sat_rate_gbp_usd
2022-02-07 21:27:10.301663 (Thread-1): 00:27:10 | 8 of 15 START incremental model public.link_wheat_gbp_rate........... [RUN]
2022-02-07 21:27:10.303416 (Thread-2): 00:27:10 | 9 of 15 START incremental model public.sat_rate_gbp_usd.............. [RUN]
2022-02-07 21:27:10.304242 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:27:10.305166 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:27:10.305563 (Thread-1): Compiling model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:27:10.305942 (Thread-2): Compiling model.project_otus_dbt.sat_rate_gbp_usd
2022-02-07 21:27:10.327023 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:27:10.349503 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd"
2022-02-07 21:27:10.350127 (Thread-2): finished collecting timing info
2022-02-07 21:27:10.350508 (Thread-1): finished collecting timing info
2022-02-07 21:27:10.400570 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:27:10.404681 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:27:10.405076 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

    

  create temporary table "sat_rate_gbp_usd__dbt_tmp002710397621"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:27:10.405199 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:27:10.405903 (Thread-1): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:27:10.406257 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: BEGIN
2022-02-07 21:27:10.406560 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:27:10.419944 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:27:10.420176 (Thread-1): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:27:10.420254 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.link_wheat_gbp_rate"} */

      

  create  table "postgres"."public"."link_wheat_gbp_rate"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (
   
SELECT * FROM (
    SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY LINK_DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as l
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.LINK_DATE_PK, a.DATE_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:27:10.422897 (Thread-1): Postgres error: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^

2022-02-07 21:27:10.423323 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: ROLLBACK
2022-02-07 21:27:10.424666 (Thread-1): finished collecting timing info
2022-02-07 21:27:10.425175 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: Close
2022-02-07 21:27:10.425744 (Thread-1): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 132, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:27:10.428092 (Thread-1): 00:27:10 | 8 of 15 ERROR creating incremental model public.link_wheat_gbp_rate.. [ERROR in 0.12s]
2022-02-07 21:27:10.428539 (Thread-1): Finished running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:27:10.428990 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:27:10.432065 (Thread-1): 00:27:10 | 10 of 15 START incremental model public.hub_wheat_gbp................ [RUN]
2022-02-07 21:27:10.433038 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:27:10.433503 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:27:10.441220 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 21:27:10.451266 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:27:10.455389 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:27:10.455689 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: BEGIN
2022-02-07 21:27:10.456913 (Thread-1): finished collecting timing info
2022-02-07 21:27:10.463196 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:27:10.468021 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:27:10.468299 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:27:10.468551 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp002710466519"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:27:10.468780 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd__dbt_tmp002710397621'
        
      order by ordinal_position

  
2022-02-07 21:27:10.469038 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:27:10.479810 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:27:10.486209 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:27:10.486529 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:10.492726 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:27:10.502508 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:27:10.502777 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:10.508074 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:27:10.509853 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd"
2022-02-07 21:27:10.510603 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:27:10.510829 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd__dbt_tmp002710397621"
    );
  
2022-02-07 21:27:10.512890 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:27:10.514586 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: COMMIT
2022-02-07 21:27:10.514889 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:27:10.515087 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: COMMIT
2022-02-07 21:27:10.517704 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:27:10.520459 (Thread-2): finished collecting timing info
2022-02-07 21:27:10.520871 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: Close
2022-02-07 21:27:10.524020 (Thread-2): 00:27:10 | 9 of 15 OK created incremental model public.sat_rate_gbp_usd......... [INSERT 0 0 in 0.22s]
2022-02-07 21:27:10.524613 (Thread-2): Finished running node model.project_otus_dbt.sat_rate_gbp_usd
2022-02-07 21:27:10.525899 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:27:10.530702 (Thread-2): 00:27:10 | 11 of 15 START incremental model public.sat_wheat_gbp_details........ [RUN]
2022-02-07 21:27:10.532953 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:27:10.533738 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:27:10.542023 (Thread-1): SQL status: SELECT 0 in 0.07 seconds
2022-02-07 21:27:10.552629 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:27:10.568626 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-07 21:27:10.572365 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:27:10.573922 (Thread-2): finished collecting timing info
2022-02-07 21:27:10.574562 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:27:10.585287 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:27:10.589595 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:27:10.589849 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp002710466519'
        
      order by ordinal_position

  
2022-02-07 21:27:10.590164 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp002710586843"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:27:10.590846 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:27:10.615590 (Thread-1): SQL status: SELECT 4 in 0.03 seconds
2022-02-07 21:27:10.621240 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:27:10.621465 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:10.629607 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 21:27:10.629910 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:27:10.634159 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:27:10.640731 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:27:10.640983 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-07 21:27:10.641234 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:10.642944 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:27:10.643244 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:27:10.643419 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp002710586843'
        
      order by ordinal_position

  
2022-02-07 21:27:10.646206 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:27:10.647373 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:27:10.648028 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:27:10.648195 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp002710466519"
    );
  
2022-02-07 21:27:10.649890 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:27:10.652475 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:27:10.652735 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:27:10.652885 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:27:10.654006 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:27:10.658859 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:27:10.659086 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:27:10.659273 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:10.661999 (Thread-1): finished collecting timing info
2022-02-07 21:27:10.662586 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-07 21:27:10.665142 (Thread-1): 00:27:10 | 10 of 15 OK created incremental model public.hub_wheat_gbp........... [INSERT 0 0 in 0.23s]
2022-02-07 21:27:10.665592 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:27:10.666053 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:27:10.668482 (Thread-1): 00:27:10 | 12 of 15 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-07 21:27:10.668801 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:27:10.669705 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:27:10.675425 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:27:10.675695 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:27:10.675908 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:10.690088 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:27:10.690924 (Thread-1): finished collecting timing info
2022-02-07 21:27:10.691394 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:27:10.699149 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:27:10.704330 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:27:10.704973 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp002710702404"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:27:10.705324 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:27:10.705848 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:27:10.706251 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp002710586843"
    );
  
2022-02-07 21:27:10.708183 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:27:10.710146 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:27:10.710530 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:27:10.710771 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:27:10.717799 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:27:10.720277 (Thread-2): finished collecting timing info
2022-02-07 21:27:10.720665 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-07 21:27:10.722411 (Thread-2): 00:27:10 | 11 of 15 OK created incremental model public.sat_wheat_gbp_details... [INSERT 0 0 in 0.19s]
2022-02-07 21:27:10.722795 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:27:10.723231 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:27:10.725736 (Thread-2): 00:27:10 | 13 of 15 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-07 21:27:10.726707 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:27:10.727119 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:27:10.738260 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:27:10.748734 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:27:10.754182 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-07 21:27:10.758924 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:27:10.759656 (Thread-2): finished collecting timing info
2022-02-07 21:27:10.765977 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:27:10.769732 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:27:10.770135 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:27:10.770372 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp002710768196"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:27:10.770624 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp002710702404'
        
      order by ordinal_position

  
2022-02-07 21:27:10.770845 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:27:10.778855 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:27:10.783547 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:27:10.783782 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:10.788302 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:27:10.794349 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:27:10.794584 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:10.799395 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:27:10.800594 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:27:10.800974 (Thread-2): Postgres error: column a.close does not exist
LINE 15: ...K, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a...
                                                              ^
HINT:  Perhaps you meant to reference the column "b.close".

2022-02-07 21:27:10.801495 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:27:10.801917 (Thread-2): finished collecting timing info
2022-02-07 21:27:10.802407 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp002710702404"
    );
  
2022-02-07 21:27:10.802693 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-07 21:27:10.803301 (Thread-2): Database Error in model sat_wheat_msk_details (models/raw_vault/sats/sat_wheat_msk_details.sql)
  column a.close does not exist
  LINE 15: ...K, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a...
                                                                ^
  HINT:  Perhaps you meant to reference the column "b.close".
  compiled SQL at target/compiled/project_otus_dbt/models/raw_vault/sats/sat_wheat_msk_details.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column a.close does not exist
LINE 15: ...K, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a...
                                                              ^
HINT:  Perhaps you meant to reference the column "b.close".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 107, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 33, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model sat_wheat_msk_details (models/raw_vault/sats/sat_wheat_msk_details.sql)
  column a.close does not exist
  LINE 15: ...K, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a...
                                                                ^
  HINT:  Perhaps you meant to reference the column "b.close".
  compiled SQL at target/compiled/project_otus_dbt/models/raw_vault/sats/sat_wheat_msk_details.sql
2022-02-07 21:27:10.804409 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:27:10.806132 (Thread-2): 00:27:10 | 13 of 15 ERROR creating incremental model public.sat_wheat_msk_details [ERROR in 0.08s]
2022-02-07 21:27:10.807887 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:27:10.808331 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:27:10.808561 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:27:10.808995 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:27:10.809631 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:27:10.811389 (Thread-2): 00:27:10 | 14 of 15 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-07 21:27:10.812388 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:27:10.812681 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:27:10.819525 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:27:10.825231 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:27:10.827726 (Thread-1): finished collecting timing info
2022-02-07 21:27:10.828354 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-07 21:27:10.830938 (Thread-1): 00:27:10 | 12 of 15 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.16s]
2022-02-07 21:27:10.831660 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:27:10.832104 (Thread-2): finished collecting timing info
2022-02-07 21:27:10.832884 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:27:10.895480 (Thread-1): 00:27:10 | 15 of 15 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-07 21:27:10.898345 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:27:10.899618 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:27:10.900161 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp002710893638"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:27:10.900688 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:27:10.901032 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:27:10.970575 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:27:10.970980 (Thread-2): SQL status: SELECT 0 in 0.07 seconds
2022-02-07 21:27:10.977846 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:27:10.978146 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-07 21:27:10.978500 (Thread-1): finished collecting timing info
2022-02-07 21:27:10.984901 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:27:10.988508 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:27:10.988750 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:27:10.988979 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp002710986647"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:27:10.989278 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp002710893638'
        
      order by ordinal_position

  
2022-02-07 21:27:10.989541 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:27:10.998946 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:27:11.005626 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:27:11.005972 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:11.011499 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:27:11.016819 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:27:11.017046 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:11.021664 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:27:11.023055 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:27:11.023704 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:27:11.028518 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:27:11.028855 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:27:11.029053 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-07 21:27:11.029294 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp002710893638"
    );
  
2022-02-07 21:27:11.030806 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:27:11.031090 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:27:11.032521 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:27:11.032936 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:27:11.033151 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:27:11.033352 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp002710986647'
        
      order by ordinal_position

  
2022-02-07 21:27:11.033539 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:27:11.036045 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:27:11.039028 (Thread-2): finished collecting timing info
2022-02-07 21:27:11.039384 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-07 21:27:11.042010 (Thread-2): 00:27:11 | 14 of 15 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.23s]
2022-02-07 21:27:11.042429 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:27:11.043262 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:27:11.049163 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:27:11.049406 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:11.054176 (Thread-1): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:27:11.060005 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:27:11.060245 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:27:11.064837 (Thread-1): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:27:11.066198 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:27:11.066677 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:27:11.066805 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp002710986647"
    );
  
2022-02-07 21:27:11.068136 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:27:11.069361 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:27:11.069587 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:27:11.069704 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:27:11.072015 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:27:11.074676 (Thread-1): finished collecting timing info
2022-02-07 21:27:11.075442 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-07 21:27:11.078010 (Thread-1): 00:27:11 | 15 of 15 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.18s]
2022-02-07 21:27:11.078388 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:27:11.081078 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:27:11.081351 (MainThread): Using postgres connection "master".
2022-02-07 21:27:11.081467 (MainThread): On master: BEGIN
2022-02-07 21:27:11.081588 (MainThread): Opening a new connection, currently in state closed
2022-02-07 21:27:11.092340 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:27:11.092623 (MainThread): On master: COMMIT
2022-02-07 21:27:11.092784 (MainThread): Using postgres connection "master".
2022-02-07 21:27:11.092917 (MainThread): On master: COMMIT
2022-02-07 21:27:11.094284 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:27:11.094659 (MainThread): On master: Close
2022-02-07 21:27:11.095298 (MainThread): 00:27:11 | 
2022-02-07 21:27:11.095623 (MainThread): 00:27:11 | Finished running 5 view models, 2 table models, 8 incremental models in 2.44s.
2022-02-07 21:27:11.095860 (MainThread): Connection 'master' was properly closed.
2022-02-07 21:27:11.096001 (MainThread): Connection 'model.project_otus_dbt.sat_wheat_usa_details' was properly closed.
2022-02-07 21:27:11.096100 (MainThread): Connection 'model.project_otus_dbt.hub_wheat_usa' was properly closed.
2022-02-07 21:27:11.203107 (MainThread): 
2022-02-07 21:27:11.203382 (MainThread): Completed with 3 errors and 0 warnings:
2022-02-07 21:27:11.203622 (MainThread): 
2022-02-07 21:27:11.203882 (MainThread): Database Error in model dds_wheat_msk (models/dds/dds_wheat_msk.sql)
2022-02-07 21:27:11.204171 (MainThread):   syntax error at or near "min"
2022-02-07 21:27:11.204570 (MainThread):   LINE 4:     min(to_date(tradedate, 'DD.MM.YYYY')), max(to_date(trade...
2022-02-07 21:27:11.204865 (MainThread):               ^
2022-02-07 21:27:11.205108 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/dds/dds_wheat_msk.sql
2022-02-07 21:27:11.205367 (MainThread): 
2022-02-07 21:27:11.205666 (MainThread): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
2022-02-07 21:27:11.205973 (MainThread):   column "link_date_pk" does not exist
2022-02-07 21:27:11.206217 (MainThread):   LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
2022-02-07 21:27:11.206448 (MainThread):                       ^
2022-02-07 21:27:11.206629 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:27:11.206899 (MainThread): 
2022-02-07 21:27:11.207277 (MainThread): Database Error in model sat_wheat_msk_details (models/raw_vault/sats/sat_wheat_msk_details.sql)
2022-02-07 21:27:11.207542 (MainThread):   column a.close does not exist
2022-02-07 21:27:11.207724 (MainThread):   LINE 15: ...K, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a...
2022-02-07 21:27:11.207862 (MainThread):                                                                 ^
2022-02-07 21:27:11.208082 (MainThread):   HINT:  Perhaps you meant to reference the column "b.close".
2022-02-07 21:27:11.208319 (MainThread):   compiled SQL at target/compiled/project_otus_dbt/models/raw_vault/sats/sat_wheat_msk_details.sql
2022-02-07 21:27:11.208618 (MainThread): 
Done. PASS=12 WARN=0 ERROR=3 SKIP=0 TOTAL=15
2022-02-07 21:27:11.209032 (MainThread): Flushing usage events
2022-02-07 21:28:02.258196 (MainThread): Running with dbt=0.19.0
2022-02-07 21:28:02.347139 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 21:28:02.347718 (MainThread): Tracking: do not track
2022-02-07 21:28:02.401397 (MainThread): Partial parsing not enabled
2022-02-07 21:28:02.402411 (MainThread): Parsing macros/adapters.sql
2022-02-07 21:28:02.431699 (MainThread): Parsing macros/catalog.sql
2022-02-07 21:28:02.437254 (MainThread): Parsing macros/relations.sql
2022-02-07 21:28:02.441019 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 21:28:02.446459 (MainThread): Parsing macros/core.sql
2022-02-07 21:28:02.454525 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 21:28:02.512427 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 21:28:02.514597 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 21:28:02.516865 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 21:28:02.525971 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 21:28:02.527981 (MainThread): Parsing macros/etc/query.sql
2022-02-07 21:28:02.529316 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 21:28:02.530506 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 21:28:02.539141 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 21:28:02.560931 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 21:28:02.564012 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 21:28:02.609581 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 21:28:02.630262 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 21:28:02.636398 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 21:28:02.638791 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 21:28:02.658464 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 21:28:02.665884 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 21:28:02.679476 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 21:28:02.694372 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 21:28:02.698256 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 21:28:02.701795 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 21:28:02.705281 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 21:28:02.710782 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 21:28:02.712861 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 21:28:02.715371 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 21:28:02.716782 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 21:28:02.727837 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 21:28:02.730398 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 21:28:02.732482 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 21:28:02.737735 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 21:28:02.739952 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 21:28:02.744857 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 21:28:02.750935 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 21:28:02.753407 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 21:28:02.755873 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 21:28:02.758868 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 21:28:02.765712 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 21:28:02.769476 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 21:28:02.772052 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 21:28:02.773356 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 21:28:02.775139 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 21:28:02.776659 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 21:28:02.778110 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 21:28:02.783545 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 21:28:02.784924 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 21:28:02.786499 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 21:28:02.788443 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 21:28:02.791136 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 21:28:02.792855 (MainThread): Parsing macros/sql/star.sql
2022-02-07 21:28:02.796688 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 21:28:02.799752 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 21:28:02.803849 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 21:28:02.805608 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 21:28:02.812696 (MainThread): Parsing macros/sql/union.sql
2022-02-07 21:28:02.820789 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 21:28:02.822695 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 21:28:02.827054 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 21:28:02.830671 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 21:28:02.834201 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 21:28:02.840264 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 21:28:02.844730 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 21:28:02.846394 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 21:28:02.848193 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 21:28:02.850633 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 21:28:02.854136 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 21:28:02.855525 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 21:28:02.856838 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 21:28:02.858101 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 21:28:02.880691 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 21:28:02.882560 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 21:28:02.884824 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 21:28:02.886835 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 21:28:02.888709 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 21:28:02.896118 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 21:28:02.904311 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 21:28:02.909972 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 21:28:02.914463 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 21:28:02.918832 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 21:28:02.924205 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 21:28:02.936007 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 21:28:02.942238 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 21:28:02.952577 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 21:28:02.957146 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 21:28:02.963688 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 21:28:02.965230 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 21:28:02.969117 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 21:28:02.974114 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 21:28:02.982292 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 21:28:02.994802 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 21:28:02.998335 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 21:28:02.998904 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 21:28:03.009973 (MainThread): Parsing macros/tables/link.sql
2022-02-07 21:28:03.021362 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 21:28:03.041244 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 21:28:03.053595 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 21:28:03.059334 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 21:28:03.078747 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 21:28:03.086639 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 21:28:03.104493 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 21:28:03.106045 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 21:28:03.124379 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 21:28:03.130699 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 21:28:03.138070 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 21:28:03.139651 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 21:28:03.145795 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 21:28:03.148304 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 21:28:03.159653 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 21:28:03.169609 (MainThread): Partial parsing not enabled
2022-02-07 21:28:03.277009 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:28:03.348092 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:03.429076 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:28:03.455677 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:03.500616 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:03.543718 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:03.577381 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:03.592378 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:03.607285 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:03.729890 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:03.751964 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:03.790938 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:03.823233 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:03.843089 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:03.854770 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 21:28:03.865039 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:28:04.563137 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.prestage
- models.project_otus_dbt.report

2022-02-07 21:28:04.732194 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 21:28:04.733291 (MainThread): Found 16 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 21:28:04.736980 (MainThread): 
2022-02-07 21:28:04.737849 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:28:04.766410 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 21:28:04.781022 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 21:28:04.781300 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 21:28:04.781460 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 21:28:04.794291 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 21:28:04.797584 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 21:28:04.820652 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 21:28:04.829708 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:28:04.829947 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 21:28:04.830061 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 21:28:04.840294 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:28:04.840585 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:28:04.840749 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 21:28:04.844456 (ThreadPoolExecutor-1_0): SQL status: SELECT 17 in 0.00 seconds
2022-02-07 21:28:04.863686 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 21:28:04.865003 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 21:28:04.890041 (MainThread): Using postgres connection "master".
2022-02-07 21:28:04.890272 (MainThread): On master: BEGIN
2022-02-07 21:28:04.890367 (MainThread): Opening a new connection, currently in state init
2022-02-07 21:28:04.902327 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:28:04.902619 (MainThread): Using postgres connection "master".
2022-02-07 21:28:04.902785 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 21:28:05.162138 (MainThread): SQL status: SELECT 9 in 0.26 seconds
2022-02-07 21:28:05.184062 (MainThread): On master: ROLLBACK
2022-02-07 21:28:05.186289 (MainThread): Using postgres connection "master".
2022-02-07 21:28:05.186718 (MainThread): On master: BEGIN
2022-02-07 21:28:05.190051 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:05.190500 (MainThread): On master: COMMIT
2022-02-07 21:28:05.190799 (MainThread): Using postgres connection "master".
2022-02-07 21:28:05.191221 (MainThread): On master: COMMIT
2022-02-07 21:28:05.193084 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:05.193445 (MainThread): On master: Close
2022-02-07 21:28:05.194346 (MainThread): 00:28:05 | Concurrency: 2 threads (target='dev')
2022-02-07 21:28:05.194823 (MainThread): 00:28:05 | 
2022-02-07 21:28:05.201721 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:28:05.202181 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:28:05.204636 (Thread-1): 00:28:05 | 1 of 15 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-07 21:28:05.206085 (Thread-2): 00:28:05 | 2 of 15 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-07 21:28:05.207188 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:05.208020 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:05.208467 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:28:05.208938 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:28:05.261192 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:05.264126 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:05.264580 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-07 21:28:05.264992 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-07 21:28:05.265392 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:28:05.265745 (Thread-2): Opening a new connection, currently in state init
2022-02-07 21:28:05.278847 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:28:05.279220 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:05.279613 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:05.282771 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:28:05.283010 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:05.283096 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:05.294367 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:28:05.301107 (Thread-1): SQL status: SELECT 6 in 0.02 seconds
2022-02-07 21:28:05.303233 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:05.309482 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:05.309912 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:05.310348 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:05.316749 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:28:05.317026 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-07 21:28:05.326613 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:28:05.333536 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:28:05.334697 (Thread-2): finished collecting timing info
2022-02-07 21:28:05.335328 (Thread-1): finished collecting timing info
2022-02-07 21:28:05.465320 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:05.467124 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:05.467339 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-07 21:28:05.467602 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 21:28:05.469319 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:05.469577 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:05.473390 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:05.477229 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:05.477682 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:28:05.477914 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:28:05.479580 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:05.479892 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:05.484598 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:28:05.486399 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:28:05.487141 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:05.487319 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:28:05.487619 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:05.487825 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:28:05.493059 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:28:05.493311 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:28:05.505140 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:05.510110 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:05.510488 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-07 21:28:05.510697 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-07 21:28:05.512564 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:05.512790 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:05.516585 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:05.520300 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:05.520633 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-07 21:28:05.520838 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-07 21:28:05.522873 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:05.523093 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:05.529536 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:28:05.531178 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:28:05.531429 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:05.531620 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:05.531783 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:28:05.531959 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:28:05.534742 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:05.534989 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:05.539964 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:05.543122 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:05.543525 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:28:05.543800 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:28:05.547691 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:05.547929 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:05.550554 (Thread-1): finished collecting timing info
2022-02-07 21:28:05.554070 (Thread-2): finished collecting timing info
2022-02-07 21:28:05.554786 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-07 21:28:05.555084 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-07 21:28:05.557619 (Thread-2): 00:28:05 | 2 of 15 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.35s]
2022-02-07 21:28:05.559578 (Thread-1): 00:28:05 | 1 of 15 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.35s]
2022-02-07 21:28:05.560180 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:28:05.560724 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:28:05.561231 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:28:05.562003 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:28:05.563974 (Thread-2): 00:28:05 | 3 of 15 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-07 21:28:05.565490 (Thread-1): 00:28:05 | 4 of 15 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-07 21:28:05.566406 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:05.567292 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:05.567690 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:28:05.568077 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:28:05.599793 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:05.604529 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:05.604810 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 21:28:05.605066 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 21:28:05.605324 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:28:05.605696 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:28:05.617612 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:28:05.618045 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:05.618188 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:05.622018 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:28:05.622375 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:05.622590 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:05.629792 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:28:05.636129 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:05.636349 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 21:28:05.636521 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:05.644395 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:05.644907 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:05.650130 (Thread-2): SQL status: SELECT 18 in 0.00 seconds
2022-02-07 21:28:05.650417 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:28:05.658585 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:28:05.665965 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:28:05.666644 (Thread-1): finished collecting timing info
2022-02-07 21:28:05.667022 (Thread-2): finished collecting timing info
2022-02-07 21:28:05.675106 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:05.685969 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 21:28:05.686669 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:05.687023 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 21:28:05.688223 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:05.688529 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:05.691567 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:05.696636 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:05.697091 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:28:05.697505 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:28:05.699228 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:05.699495 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:05.700712 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:28:05.703064 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:28:05.703887 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:05.704210 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:28:05.704579 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:05.704836 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:28:05.712844 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:28:05.713146 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:28:05.716667 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:05.724404 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:05.724784 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 21:28:05.725093 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-07 21:28:05.727098 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:05.727436 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:05.732980 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:05.734288 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:28:05.734582 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-07 21:28:05.734788 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:05.735203 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:28:05.736720 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:05.738000 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:28:05.738276 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:05.738447 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:05.741385 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:05.741698 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:28:05.742004 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:28:05.743596 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:05.746858 (Thread-2): finished collecting timing info
2022-02-07 21:28:05.747265 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:28:05.747549 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 21:28:05.750454 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:05.750963 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:28:05.753090 (Thread-2): 00:28:05 | 3 of 15 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.19s]
2022-02-07 21:28:05.753735 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:28:05.754236 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:28:05.756279 (Thread-2): 00:28:05 | 5 of 15 START view model public.dds_wheat_msk........................ [RUN]
2022-02-07 21:28:05.757281 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:28:05.757705 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:28:05.757931 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:05.766022 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 21:28:05.768916 (Thread-1): finished collecting timing info
2022-02-07 21:28:05.769618 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 21:28:05.770038 (Thread-2): finished collecting timing info
2022-02-07 21:28:05.771934 (Thread-1): 00:28:05 | 4 of 15 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.20s]
2022-02-07 21:28:05.781737 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:28:05.782341 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:28:05.782619 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-07 21:28:05.783136 (Thread-1): Began running node model.project_otus_dbt.dim_day
2022-02-07 21:28:05.783811 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:28:05.785367 (Thread-1): 00:28:05 | 6 of 15 START table model public.dim_day............................. [RUN]
2022-02-07 21:28:05.786196 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:05.786451 (Thread-1): Compiling model.project_otus_dbt.dim_day
2022-02-07 21:28:05.793770 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:28:05.794432 (Thread-1): finished collecting timing info
2022-02-07 21:28:05.808984 (Thread-2): SQL status: DROP VIEW in 0.03 seconds
2022-02-07 21:28:05.819015 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:28:05.824673 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 21:28:05.825264 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:05.825768 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-07 21:28:05.825918 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:28:05.827058 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:05.829181 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 21:28:05.830216 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:28:05.830622 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-07 21:28:05.832060 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:05.832301 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:28:05.832431 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */

  create view "postgres"."public"."dds_wheat_msk__dbt_tmp" as (
    min(to_date(tradedate, 'DD.MM.YYYY')), max(to_date(tradedate, 'DD.MM.YYYY'))
  );

2022-02-07 21:28:05.833464 (Thread-2): Postgres error: syntax error at or near "min"
LINE 4:     min(to_date(tradedate, 'DD.MM.YYYY')), max(to_date(trade...
            ^

2022-02-07 21:28:05.833713 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: ROLLBACK
2022-02-07 21:28:05.834927 (Thread-2): finished collecting timing info
2022-02-07 21:28:05.835388 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-07 21:28:05.836847 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:28:05.840591 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:05.840930 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:28:05.835865 (Thread-2): Database Error in model dds_wheat_msk (models/dds/dds_wheat_msk.sql)
  syntax error at or near "min"
  LINE 4:     min(to_date(tradedate, 'DD.MM.YYYY')), max(to_date(trade...
              ^
  compiled SQL at target/run/project_otus_dbt/models/dds/dds_wheat_msk.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near "min"
LINE 4:     min(to_date(tradedate, 'DD.MM.YYYY')), max(to_date(trade...
            ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model dds_wheat_msk (models/dds/dds_wheat_msk.sql)
  syntax error at or near "min"
  LINE 4:     min(to_date(tradedate, 'DD.MM.YYYY')), max(to_date(trade...
              ^
  compiled SQL at target/run/project_otus_dbt/models/dds/dds_wheat_msk.sql
2022-02-07 21:28:05.842613 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:28:05.844135 (Thread-2): 00:28:05 | 5 of 15 ERROR creating view model public.dds_wheat_msk............... [ERROR in 0.09s]
2022-02-07 21:28:05.852570 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:28:05.852924 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:28:05.853440 (Thread-2): Began running node model.project_otus_dbt.dim_week
2022-02-07 21:28:05.855729 (Thread-2): 00:28:05 | 7 of 15 START table model public.dim_week............................ [RUN]
2022-02-07 21:28:05.856339 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:05.857108 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:05.857484 (Thread-1): On model.project_otus_dbt.dim_day: BEGIN
2022-02-07 21:28:05.857876 (Thread-2): Compiling model.project_otus_dbt.dim_week
2022-02-07 21:28:05.864729 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:28:05.866678 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:28:05.866899 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:05.867306 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 day')
        as t(date)
        )

select * from dim_day
order by date desc
  );
2022-02-07 21:28:05.867640 (Thread-2): finished collecting timing info
2022-02-07 21:28:05.877805 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:05.878042 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-07 21:28:05.878165 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:28:05.889239 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:28:05.894659 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:05.894929 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:28:05.896170 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:28:05.897759 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:28:05.898366 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:05.898606 (Thread-2): On model.project_otus_dbt.dim_week: BEGIN
2022-02-07 21:28:05.899974 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:05.900253 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:05.901539 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-07 21:28:05.905465 (Thread-1): SQL status: SELECT 5114 in 0.04 seconds
2022-02-07 21:28:05.913633 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:05.913979 (Thread-2): SQL status: SELECT 731 in 0.01 seconds
2022-02-07 21:28:05.914235 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-07 21:28:05.920912 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:05.921428 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-07 21:28:05.922873 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:05.923186 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:05.926704 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:05.930704 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:05.931099 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-07 21:28:05.931395 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-07 21:28:05.933189 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:05.933403 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:05.934815 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:28:05.936610 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:28:05.936962 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:05.937218 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:05.937418 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:28:05.937627 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:28:05.943942 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:28:05.944218 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:28:05.946689 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:05.949426 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:05.949795 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:28:05.949997 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:28:05.954939 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:28:05.957834 (Thread-1): finished collecting timing info
2022-02-07 21:28:05.958149 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:28:05.958443 (Thread-1): On model.project_otus_dbt.dim_day: Close
2022-02-07 21:28:05.961025 (Thread-2): finished collecting timing info
2022-02-07 21:28:05.961597 (Thread-2): On model.project_otus_dbt.dim_week: Close
2022-02-07 21:28:05.964209 (Thread-1): 00:28:05 | 6 of 15 OK created table model public.dim_day........................ [SELECT 5114 in 0.18s]
2022-02-07 21:28:05.967100 (Thread-2): 00:28:05 | 7 of 15 OK created table model public.dim_week....................... [SELECT 731 in 0.11s]
2022-02-07 21:28:05.967638 (Thread-1): Finished running node model.project_otus_dbt.dim_day
2022-02-07 21:28:05.968204 (Thread-2): Finished running node model.project_otus_dbt.dim_week
2022-02-07 21:28:05.968708 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:28:05.969341 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:28:05.971421 (Thread-1): 00:28:05 | 8 of 15 START incremental model public.hub_wheat_gbp................. [RUN]
2022-02-07 21:28:05.973674 (Thread-2): 00:28:05 | 9 of 15 START incremental model public.sat_wheat_gbp_details......... [RUN]
2022-02-07 21:28:05.974675 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:05.975530 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:05.975930 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:28:05.976375 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:28:06.003881 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:28:06.016462 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:28:06.016967 (Thread-1): finished collecting timing info
2022-02-07 21:28:06.028222 (Thread-2): finished collecting timing info
2022-02-07 21:28:06.083879 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:06.086912 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:06.087311 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp002806074360"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:06.087720 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp002806081540"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:06.088100 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:28:06.088446 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:28:06.108330 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 21:28:06.113141 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:06.113369 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-07 21:28:06.114608 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:06.114841 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:06.114973 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp002806074360'
        
      order by ordinal_position

  
2022-02-07 21:28:06.119083 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:28:06.123501 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:06.123786 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-07 21:28:06.125285 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:06.125566 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:06.125739 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp002806081540'
        
      order by ordinal_position

  
2022-02-07 21:28:06.126373 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:28:06.134421 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:06.134753 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:06.135691 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:28:06.142066 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:06.142335 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:28:06.142565 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:06.152110 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:06.152520 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:06.156764 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:28:06.162929 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:28:06.163719 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:06.165069 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:28:06.165495 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:06.166400 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:06.166668 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp002806074360"
    );
  
2022-02-07 21:28:06.168226 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:28:06.170015 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:28:06.170266 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:06.170380 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:28:06.171590 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:28:06.173038 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:28:06.173297 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:06.175936 (Thread-1): finished collecting timing info
2022-02-07 21:28:06.176354 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-07 21:28:06.176648 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:06.177140 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp002806081540"
    );
  
2022-02-07 21:28:06.179635 (Thread-1): 00:28:06 | 8 of 15 OK created incremental model public.hub_wheat_gbp............ [INSERT 0 0 in 0.20s]
2022-02-07 21:28:06.180478 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:28:06.181035 (Thread-1): Began running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:28:06.181939 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:28:06.184015 (Thread-1): 00:28:06 | 10 of 15 START incremental model public.link_wheat_gbp_rate.......... [RUN]
2022-02-07 21:28:06.185921 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:28:06.186730 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:28:06.187225 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:06.187714 (Thread-1): Compiling model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:28:06.188124 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:28:06.202811 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:28:06.203093 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:06.205406 (Thread-2): finished collecting timing info
2022-02-07 21:28:06.205812 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-07 21:28:06.206268 (Thread-1): finished collecting timing info
2022-02-07 21:28:06.209114 (Thread-2): 00:28:06 | 9 of 15 OK created incremental model public.sat_wheat_gbp_details.... [INSERT 0 0 in 0.23s]
2022-02-07 21:28:06.219252 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:28:06.219805 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:28:06.220530 (Thread-2): Began running node model.project_otus_dbt.sat_rate_gbp_usd
2022-02-07 21:28:06.223048 (Thread-2): 00:28:06 | 11 of 15 START incremental model public.sat_rate_gbp_usd............. [RUN]
2022-02-07 21:28:06.223483 (Thread-1): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:28:06.224263 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:06.224533 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: BEGIN
2022-02-07 21:28:06.224885 (Thread-2): Compiling model.project_otus_dbt.sat_rate_gbp_usd
2022-02-07 21:28:06.225197 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:28:06.257544 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd"
2022-02-07 21:28:06.257786 (Thread-1): SQL status: BEGIN in 0.03 seconds
2022-02-07 21:28:06.258148 (Thread-1): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:28:06.258418 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.link_wheat_gbp_rate"} */

      

  create  table "postgres"."public"."link_wheat_gbp_rate"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (
   
SELECT * FROM (
    SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY LINK_DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as l
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.LINK_DATE_PK, a.DATE_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:06.258754 (Thread-2): finished collecting timing info
2022-02-07 21:28:06.271231 (Thread-1): Postgres error: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^

2022-02-07 21:28:06.271796 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:06.272032 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: ROLLBACK
2022-02-07 21:28:06.272287 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

    

  create temporary table "sat_rate_gbp_usd__dbt_tmp002806269054"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:06.272668 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:28:06.273954 (Thread-1): finished collecting timing info
2022-02-07 21:28:06.274520 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: Close
2022-02-07 21:28:06.275081 (Thread-1): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 132, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:28:06.277249 (Thread-1): 00:28:06 | 10 of 15 ERROR creating incremental model public.link_wheat_gbp_rate. [ERROR in 0.09s]
2022-02-07 21:28:06.277597 (Thread-1): Finished running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:28:06.277873 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:28:06.279958 (Thread-1): 00:28:06 | 12 of 15 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-07 21:28:06.280648 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:06.280910 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:28:06.294278 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:28:06.294816 (Thread-1): finished collecting timing info
2022-02-07 21:28:06.303189 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:06.303449 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:28:06.303726 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp002806301584"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:06.309542 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:06.309843 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:28:06.310109 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: BEGIN
2022-02-07 21:28:06.312068 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:06.312426 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:06.312626 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd__dbt_tmp002806269054'
        
      order by ordinal_position

  
2022-02-07 21:28:06.321802 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:28:06.328395 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:06.328715 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:06.332458 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 21:28:06.336587 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:06.336831 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:28:06.337078 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-07 21:28:06.343238 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:06.343672 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:06.344855 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:06.345109 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:06.345243 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp002806301584'
        
      order by ordinal_position

  
2022-02-07 21:28:06.348741 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:28:06.350599 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd"
2022-02-07 21:28:06.351270 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:06.351499 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd__dbt_tmp002806269054"
    );
  
2022-02-07 21:28:06.352981 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:28:06.353335 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:28:06.358022 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:06.359754 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: COMMIT
2022-02-07 21:28:06.360052 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:06.360303 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:06.360652 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: COMMIT
2022-02-07 21:28:06.363684 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:06.366265 (Thread-2): finished collecting timing info
2022-02-07 21:28:06.366661 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:28:06.366937 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd: Close
2022-02-07 21:28:06.372198 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:06.372798 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:06.375048 (Thread-2): 00:28:06 | 11 of 15 OK created incremental model public.sat_rate_gbp_usd........ [INSERT 0 0 in 0.15s]
2022-02-07 21:28:06.375661 (Thread-2): Finished running node model.project_otus_dbt.sat_rate_gbp_usd
2022-02-07 21:28:06.376113 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:28:06.378116 (Thread-2): 00:28:06 | 13 of 15 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-07 21:28:06.378699 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:28:06.379143 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:28:06.385911 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:28:06.392311 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:28:06.401303 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:28:06.401919 (Thread-2): finished collecting timing info
2022-02-07 21:28:06.402451 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:06.412137 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:28:06.412419 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp002806301584"
    );
  
2022-02-07 21:28:06.413195 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:28:06.413460 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-07 21:28:06.413684 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:28:06.414346 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:28:06.416925 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:28:06.417179 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:06.417333 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:28:06.420979 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:06.423562 (Thread-1): finished collecting timing info
2022-02-07 21:28:06.424032 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-07 21:28:06.426149 (Thread-1): 00:28:06 | 12 of 15 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.14s]
2022-02-07 21:28:06.426470 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:28:06.426762 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:28:06.428754 (Thread-1): 00:28:06 | 14 of 15 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-07 21:28:06.429360 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:06.429651 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:28:06.442622 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:28:06.443123 (Thread-1): finished collecting timing info
2022-02-07 21:28:06.455983 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:06.456345 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp002806453227"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:06.456567 (Thread-2): SQL status: BEGIN in 0.04 seconds
2022-02-07 21:28:06.456799 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:28:06.457021 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:28:06.457431 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

  create  table "postgres"."public"."sat_wheat_msk_details"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:06.478643 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 21:28:06.531837 (Thread-2): SQL status: SELECT 216 in 0.07 seconds
2022-02-07 21:28:06.536684 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:06.538418 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:28:06.538802 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-07 21:28:06.539140 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:28:06.539632 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:28:06.540720 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:06.541001 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:06.541157 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp002806453227'
        
      order by ordinal_position

  
2022-02-07 21:28:06.543415 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:06.546552 (Thread-2): finished collecting timing info
2022-02-07 21:28:06.546967 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-07 21:28:06.549348 (Thread-2): 00:28:06 | 13 of 15 OK created incremental model public.sat_wheat_msk_details... [SELECT 216 in 0.17s]
2022-02-07 21:28:06.549974 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:28:06.550558 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:28:06.553025 (Thread-2): 00:28:06 | 15 of 15 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-07 21:28:06.554172 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:06.554532 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:28:06.569638 (Thread-1): SQL status: SELECT 4 in 0.03 seconds
2022-02-07 21:28:06.580145 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:06.581484 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:28:06.581719 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:06.582408 (Thread-2): finished collecting timing info
2022-02-07 21:28:06.592508 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:06.592789 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:28:06.593050 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp002806590826"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:06.598652 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:06.598995 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:28:06.599212 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:06.605181 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:28:06.606644 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:28:06.607338 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:06.607540 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp002806453227"
    );
  
2022-02-07 21:28:06.609118 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:28:06.610878 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:28:06.611156 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:06.611290 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:28:06.613587 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:06.615734 (Thread-1): finished collecting timing info
2022-02-07 21:28:06.616112 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-07 21:28:06.619070 (Thread-1): 00:28:06 | 14 of 15 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.19s]
2022-02-07 21:28:06.619483 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:28:06.648176 (Thread-2): SQL status: SELECT 0 in 0.05 seconds
2022-02-07 21:28:06.652466 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:06.652715 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-07 21:28:06.654041 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:06.654311 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:06.654455 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp002806590826'
        
      order by ordinal_position

  
2022-02-07 21:28:06.678202 (Thread-2): SQL status: SELECT 11 in 0.02 seconds
2022-02-07 21:28:06.684404 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:06.684677 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:06.689198 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:28:06.695213 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:06.695462 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:06.700374 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:28:06.702234 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:28:06.702761 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:06.702925 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp002806590826"
    );
  
2022-02-07 21:28:06.704570 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:28:06.706075 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:28:06.706274 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:06.706410 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:28:06.708873 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:06.711531 (Thread-2): finished collecting timing info
2022-02-07 21:28:06.711890 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-07 21:28:06.715246 (Thread-2): 00:28:06 | 15 of 15 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.16s]
2022-02-07 21:28:06.715565 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:28:06.718405 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:28:06.718722 (MainThread): Using postgres connection "master".
2022-02-07 21:28:06.718876 (MainThread): On master: BEGIN
2022-02-07 21:28:06.719036 (MainThread): Opening a new connection, currently in state closed
2022-02-07 21:28:06.732921 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:28:06.733252 (MainThread): On master: COMMIT
2022-02-07 21:28:06.733413 (MainThread): Using postgres connection "master".
2022-02-07 21:28:06.733564 (MainThread): On master: COMMIT
2022-02-07 21:28:06.734893 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:06.735373 (MainThread): On master: Close
2022-02-07 21:28:06.736126 (MainThread): 00:28:06 | 
2022-02-07 21:28:06.736453 (MainThread): 00:28:06 | Finished running 5 view models, 2 table models, 8 incremental models in 2.00s.
2022-02-07 21:28:06.736693 (MainThread): Connection 'master' was properly closed.
2022-02-07 21:28:06.736885 (MainThread): Connection 'model.project_otus_dbt.hub_wheat_usa' was properly closed.
2022-02-07 21:28:06.737048 (MainThread): Connection 'model.project_otus_dbt.sat_wheat_usa_details' was properly closed.
2022-02-07 21:28:06.845790 (MainThread): 
2022-02-07 21:28:06.846040 (MainThread): Completed with 2 errors and 0 warnings:
2022-02-07 21:28:06.846192 (MainThread): 
2022-02-07 21:28:06.846359 (MainThread): Database Error in model dds_wheat_msk (models/dds/dds_wheat_msk.sql)
2022-02-07 21:28:06.846520 (MainThread):   syntax error at or near "min"
2022-02-07 21:28:06.846675 (MainThread):   LINE 4:     min(to_date(tradedate, 'DD.MM.YYYY')), max(to_date(trade...
2022-02-07 21:28:06.846853 (MainThread):               ^
2022-02-07 21:28:06.847028 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/dds/dds_wheat_msk.sql
2022-02-07 21:28:06.847214 (MainThread): 
2022-02-07 21:28:06.847385 (MainThread): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
2022-02-07 21:28:06.847539 (MainThread):   column "link_date_pk" does not exist
2022-02-07 21:28:06.847708 (MainThread):   LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
2022-02-07 21:28:06.847859 (MainThread):                       ^
2022-02-07 21:28:06.848003 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:28:06.848228 (MainThread): 
Done. PASS=13 WARN=0 ERROR=2 SKIP=0 TOTAL=15
2022-02-07 21:28:06.848536 (MainThread): Flushing usage events
2022-02-07 21:28:23.347138 (MainThread): Running with dbt=0.19.0
2022-02-07 21:28:23.480484 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 21:28:23.481456 (MainThread): Tracking: do not track
2022-02-07 21:28:23.613017 (MainThread): Partial parsing not enabled
2022-02-07 21:28:23.615143 (MainThread): Parsing macros/adapters.sql
2022-02-07 21:28:23.645236 (MainThread): Parsing macros/catalog.sql
2022-02-07 21:28:23.648560 (MainThread): Parsing macros/relations.sql
2022-02-07 21:28:23.650533 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 21:28:23.654158 (MainThread): Parsing macros/core.sql
2022-02-07 21:28:23.659858 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 21:28:23.721491 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 21:28:23.724099 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 21:28:23.726499 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 21:28:23.736539 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 21:28:23.738418 (MainThread): Parsing macros/etc/query.sql
2022-02-07 21:28:23.740104 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 21:28:23.741694 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 21:28:23.752458 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 21:28:23.784132 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 21:28:23.787625 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 21:28:23.833902 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 21:28:23.865969 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 21:28:23.873967 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 21:28:23.876552 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 21:28:23.900593 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 21:28:23.910113 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 21:28:23.921268 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 21:28:23.932839 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 21:28:23.936729 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 21:28:23.940241 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 21:28:23.945424 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 21:28:23.953923 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 21:28:23.957836 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 21:28:23.960585 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 21:28:23.962444 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 21:28:23.975316 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 21:28:23.978094 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 21:28:23.981575 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 21:28:23.985647 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 21:28:23.987362 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 21:28:23.990753 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 21:28:23.995650 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 21:28:23.998547 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 21:28:24.001576 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 21:28:24.006255 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 21:28:24.017753 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 21:28:24.022698 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 21:28:24.027607 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 21:28:24.030595 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 21:28:24.034091 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 21:28:24.037190 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 21:28:24.041068 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 21:28:24.053385 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 21:28:24.055479 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 21:28:24.058853 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 21:28:24.062713 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 21:28:24.068202 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 21:28:24.073223 (MainThread): Parsing macros/sql/star.sql
2022-02-07 21:28:24.081600 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 21:28:24.086115 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 21:28:24.096027 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 21:28:24.100328 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 21:28:24.114550 (MainThread): Parsing macros/sql/union.sql
2022-02-07 21:28:24.130766 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 21:28:24.134918 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 21:28:24.142958 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 21:28:24.150020 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 21:28:24.155639 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 21:28:24.166301 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 21:28:24.175688 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 21:28:24.178170 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 21:28:24.184059 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 21:28:24.191815 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 21:28:24.206776 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 21:28:24.209059 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 21:28:24.211770 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 21:28:24.215420 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 21:28:24.258556 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 21:28:24.262161 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 21:28:24.267432 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 21:28:24.271214 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 21:28:24.275303 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 21:28:24.287579 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 21:28:24.294717 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 21:28:24.307382 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 21:28:24.310573 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 21:28:24.321208 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 21:28:24.327106 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 21:28:24.339013 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 21:28:24.343434 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 21:28:24.355416 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 21:28:24.360296 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 21:28:24.370098 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 21:28:24.372069 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 21:28:24.384882 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 21:28:24.393170 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 21:28:24.411109 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 21:28:24.436673 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 21:28:24.448500 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 21:28:24.450304 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 21:28:24.472104 (MainThread): Parsing macros/tables/link.sql
2022-02-07 21:28:24.494618 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 21:28:24.522838 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 21:28:24.541348 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 21:28:24.550813 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 21:28:24.579255 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 21:28:24.588570 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 21:28:24.619909 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 21:28:24.621864 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 21:28:24.647460 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 21:28:24.653991 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 21:28:24.661290 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 21:28:24.663252 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 21:28:24.670214 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 21:28:24.672892 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 21:28:24.684640 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 21:28:24.694564 (MainThread): Partial parsing not enabled
2022-02-07 21:28:24.811558 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:28:24.952594 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:25.019721 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:28:25.047154 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:25.073131 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:25.105633 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:25.149689 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:25.165672 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:25.182146 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:25.285620 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:25.315919 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:25.372045 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:25.411423 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:25.428214 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:25.444595 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 21:28:25.460612 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:28:26.416234 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.prestage
- models.project_otus_dbt.report

2022-02-07 21:28:26.620600 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 21:28:26.621535 (MainThread): Found 16 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 21:28:26.625196 (MainThread): 
2022-02-07 21:28:26.626076 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:28:26.658846 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 21:28:26.677431 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 21:28:26.677771 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 21:28:26.677989 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 21:28:26.695913 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 21:28:26.700112 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 21:28:26.737422 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 21:28:26.745760 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:28:26.746093 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 21:28:26.746272 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 21:28:26.756751 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:28:26.757063 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:28:26.757248 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 21:28:26.762158 (ThreadPoolExecutor-1_0): SQL status: SELECT 19 in 0.00 seconds
2022-02-07 21:28:26.780199 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 21:28:26.781518 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 21:28:26.820005 (MainThread): Using postgres connection "master".
2022-02-07 21:28:26.820289 (MainThread): On master: BEGIN
2022-02-07 21:28:26.820473 (MainThread): Opening a new connection, currently in state init
2022-02-07 21:28:26.832283 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:28:26.832537 (MainThread): Using postgres connection "master".
2022-02-07 21:28:26.832655 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 21:28:27.133693 (MainThread): SQL status: SELECT 10 in 0.30 seconds
2022-02-07 21:28:27.145967 (MainThread): On master: ROLLBACK
2022-02-07 21:28:27.147472 (MainThread): Using postgres connection "master".
2022-02-07 21:28:27.147856 (MainThread): On master: BEGIN
2022-02-07 21:28:27.150355 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:27.150655 (MainThread): On master: COMMIT
2022-02-07 21:28:27.150858 (MainThread): Using postgres connection "master".
2022-02-07 21:28:27.151069 (MainThread): On master: COMMIT
2022-02-07 21:28:27.152396 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:27.152700 (MainThread): On master: Close
2022-02-07 21:28:27.153596 (MainThread): 00:28:27 | Concurrency: 2 threads (target='dev')
2022-02-07 21:28:27.154153 (MainThread): 00:28:27 | 
2022-02-07 21:28:27.160155 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:28:27.160537 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:28:27.162257 (Thread-1): 00:28:27 | 1 of 14 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-07 21:28:27.164478 (Thread-2): 00:28:27 | 2 of 14 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-07 21:28:27.165729 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:27.166909 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:27.167319 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:28:27.167681 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:28:27.243233 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:27.245963 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:27.246291 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-07 21:28:27.246575 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-07 21:28:27.246858 (Thread-2): Opening a new connection, currently in state init
2022-02-07 21:28:27.247118 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:28:27.259659 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:28:27.259932 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:27.260077 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:27.267361 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:28:27.267634 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:27.267788 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:27.270905 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-07 21:28:27.284722 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:27.285038 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:27.287643 (Thread-2): SQL status: SELECT 7 in 0.02 seconds
2022-02-07 21:28:27.297502 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:27.297826 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-07 21:28:27.298139 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:27.307847 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:28:27.308751 (Thread-1): finished collecting timing info
2022-02-07 21:28:27.368782 (Thread-2): SQL status: SELECT 7 in 0.06 seconds
2022-02-07 21:28:27.431222 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:28:27.470550 (Thread-2): finished collecting timing info
2022-02-07 21:28:27.527922 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:27.533547 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 21:28:27.533296 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:27.534310 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-07 21:28:27.535577 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:27.541537 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:28:27.541213 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:27.548291 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:27.548685 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:28:27.549260 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:28:27.551438 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:27.551837 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:27.560329 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:28:27.563302 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:28:27.564542 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:27.565274 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:27.565617 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:28:27.565944 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:28:27.571553 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:28:27.571826 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:28:27.591975 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:27.594284 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:27.594655 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-07 21:28:27.595020 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-07 21:28:27.597340 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:27.597681 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:27.601989 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:27.606198 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:27.606692 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-07 21:28:27.607104 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-07 21:28:27.609421 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:27.609870 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:27.620250 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:28:27.622138 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:28:27.622517 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:27.622808 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:27.623107 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:28:27.623385 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:28:27.626434 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:27.626728 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:27.634328 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:28:27.638011 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:28:27.638444 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:28:27.638849 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:28:27.642598 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:27.647396 (Thread-2): finished collecting timing info
2022-02-07 21:28:27.647839 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:28:27.648152 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-07 21:28:27.651435 (Thread-1): finished collecting timing info
2022-02-07 21:28:27.652145 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-07 21:28:27.655098 (Thread-2): 00:28:27 | 2 of 14 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.49s]
2022-02-07 21:28:27.659134 (Thread-1): 00:28:27 | 1 of 14 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.49s]
2022-02-07 21:28:27.659779 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:28:27.660329 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:28:27.661022 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:28:27.662323 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:28:27.666166 (Thread-2): 00:28:27 | 3 of 14 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-07 21:28:27.669060 (Thread-1): 00:28:27 | 4 of 14 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-07 21:28:27.670370 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:27.671304 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:27.672238 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:28:27.673489 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:28:27.727066 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:27.732763 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 21:28:27.738382 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:28:27.741345 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:27.742262 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 21:28:27.742735 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:28:27.756265 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:28:27.756638 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:27.756958 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:27.758580 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:28:27.759033 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:27.759476 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:27.772779 (Thread-1): SQL status: SELECT 7 in 0.02 seconds
2022-02-07 21:28:27.780639 (Thread-2): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 21:28:27.785583 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:27.796648 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:27.797924 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:27.798552 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:27.804266 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:28:27.812642 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 21:28:27.814906 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:28:27.831396 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:28:27.832300 (Thread-1): finished collecting timing info
2022-02-07 21:28:27.846115 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:27.846410 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 21:28:27.846750 (Thread-2): finished collecting timing info
2022-02-07 21:28:27.853149 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:28:27.858198 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:27.862273 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:27.862682 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 21:28:27.862962 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:28:27.864624 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:27.864883 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:27.868840 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:27.870628 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:28:27.871018 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:28:27.871955 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:27.872277 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:28:27.873115 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:28:27.874948 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:28:27.875663 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:27.875992 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:28:27.876810 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 21:28:27.883639 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:27.883920 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-07 21:28:27.885433 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:28:27.885780 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:27.890712 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:27.894807 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:27.895212 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-07 21:28:27.895425 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-07 21:28:27.897502 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:27.897762 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:27.899548 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:28:27.906086 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:27.906366 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:27.906684 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 21:28:27.906951 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:28:27.909327 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:27.910966 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:28:27.911248 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:27.911460 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:27.914040 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:28:27.914403 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:28:27.914629 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:28:27.917366 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:27.920443 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:28:27.920662 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:28:27.920898 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:28:27.923800 (Thread-1): finished collecting timing info
2022-02-07 21:28:27.924336 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 21:28:27.926173 (Thread-1): 00:28:27 | 4 of 14 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.25s]
2022-02-07 21:28:27.926634 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:28:27.927072 (Thread-1): Began running node model.project_otus_dbt.dim_day
2022-02-07 21:28:27.929757 (Thread-1): 00:28:27 | 5 of 14 START table model public.dim_day............................. [RUN]
2022-02-07 21:28:27.930074 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:28:27.931445 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:27.934242 (Thread-2): finished collecting timing info
2022-02-07 21:28:27.934787 (Thread-1): Compiling model.project_otus_dbt.dim_day
2022-02-07 21:28:27.935118 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 21:28:27.942423 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:28:27.945134 (Thread-2): 00:28:27 | 3 of 14 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.27s]
2022-02-07 21:28:27.945737 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:28:27.946072 (Thread-1): finished collecting timing info
2022-02-07 21:28:27.947703 (Thread-2): Began running node model.project_otus_dbt.dim_week
2022-02-07 21:28:27.960624 (Thread-2): 00:28:27 | 6 of 14 START table model public.dim_week............................ [RUN]
2022-02-07 21:28:27.972160 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:27.977937 (Thread-2): Compiling model.project_otus_dbt.dim_week
2022-02-07 21:28:27.979185 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:27.998209 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-07 21:28:27.998897 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:28:27.999213 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:28:28.000425 (Thread-2): finished collecting timing info
2022-02-07 21:28:28.014776 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:28.015328 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-07 21:28:28.015649 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:28:28.017976 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 21:28:28.023796 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:28.024119 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:28:28.025933 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:28:28.038197 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:28:28.038512 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 21:28:28.043693 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:28.044167 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:28:28.044735 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:28.045209 (Thread-1): On model.project_otus_dbt.dim_day: BEGIN
2022-02-07 21:28:28.045982 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:28:28.048051 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:28:28.048469 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:28.049246 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:28.049747 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 day')
        as t(date)
        )

select * from dim_day
order by date desc
  );
2022-02-07 21:28:28.050344 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:28.050682 (Thread-2): On model.project_otus_dbt.dim_week: BEGIN
2022-02-07 21:28:28.052399 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:28.052949 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:28.053427 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-07 21:28:28.067168 (Thread-2): SQL status: SELECT 731 in 0.01 seconds
2022-02-07 21:28:28.075546 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:28.076049 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-07 21:28:28.077994 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:28.085788 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:28.086127 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-07 21:28:28.088081 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:28.090240 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:28:28.090618 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:28.090937 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:28:28.096314 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:28:28.100623 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:28:28.101017 (Thread-1): SQL status: SELECT 5114 in 0.05 seconds
2022-02-07 21:28:28.101413 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:28:28.108443 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:28.109082 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-07 21:28:28.111308 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:28:28.118411 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:28.118901 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:28:28.119322 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-07 21:28:28.124525 (Thread-2): finished collecting timing info
2022-02-07 21:28:28.126302 (Thread-2): On model.project_otus_dbt.dim_week: Close
2022-02-07 21:28:28.131417 (Thread-2): 00:28:28 | 6 of 14 OK created table model public.dim_week....................... [SELECT 731 in 0.16s]
2022-02-07 21:28:28.131691 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 21:28:28.132332 (Thread-2): Finished running node model.project_otus_dbt.dim_week
2022-02-07 21:28:28.134803 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:28:28.135646 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:28:28.136461 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:28.139067 (Thread-2): 00:28:28 | 7 of 14 START incremental model public.hub_wheat_gbp................. [RUN]
2022-02-07 21:28:28.139553 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:28:28.140460 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:28.141233 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:28:28.148962 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:28:28.159362 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:28:28.170323 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:28:28.171796 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:28:28.174304 (Thread-2): finished collecting timing info
2022-02-07 21:28:28.182699 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:28:28.191625 (Thread-1): finished collecting timing info
2022-02-07 21:28:28.197532 (Thread-1): On model.project_otus_dbt.dim_day: Close
2022-02-07 21:28:28.211339 (Thread-1): 00:28:28 | 5 of 14 OK created table model public.dim_day........................ [SELECT 5114 in 0.28s]
2022-02-07 21:28:28.222288 (Thread-1): Finished running node model.project_otus_dbt.dim_day
2022-02-07 21:28:28.227920 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:28:28.235151 (Thread-1): 00:28:28 | 8 of 14 START incremental model public.sat_wheat_gbp_details......... [RUN]
2022-02-07 21:28:28.235729 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:28.236289 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:28.236770 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp002828227026"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:28.237269 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:28:28.237638 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:28:28.270537 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:28:28.271110 (Thread-1): finished collecting timing info
2022-02-07 21:28:28.278795 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 21:28:28.284062 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:28.288490 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:28.288911 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp002828282053"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:28.289182 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-07 21:28:28.289554 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:28:28.291156 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:28.291521 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:28.291709 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp002828227026'
        
      order by ordinal_position

  
2022-02-07 21:28:28.300528 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:28:28.306241 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:28.306698 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:28.311740 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:28:28.322392 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:28.322720 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:28.328471 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:28:28.328756 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 21:28:28.329966 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:28:28.335168 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:28.335843 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-07 21:28:28.336341 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:28.336669 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp002828227026"
    );
  
2022-02-07 21:28:28.337460 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:28.337782 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:28.338037 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp002828282053'
        
      order by ordinal_position

  
2022-02-07 21:28:28.338274 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:28:28.339830 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:28:28.340067 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:28:28.340205 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:28:28.342878 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:28.346379 (Thread-2): finished collecting timing info
2022-02-07 21:28:28.347036 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:28:28.347405 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-07 21:28:28.354121 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:28.356906 (Thread-2): 00:28:28 | 7 of 14 OK created incremental model public.hub_wheat_gbp............ [INSERT 0 0 in 0.22s]
2022-02-07 21:28:28.357205 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:28.357724 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:28:28.358598 (Thread-2): Began running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:28:28.361378 (Thread-2): 00:28:28 | 9 of 14 START incremental model public.link_wheat_gbp_rate........... [RUN]
2022-02-07 21:28:28.362549 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:28:28.362968 (Thread-2): Compiling model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:28:28.370176 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:28:28.389077 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:28.389418 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:28:28.389744 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:28.390576 (Thread-2): finished collecting timing info
2022-02-07 21:28:28.399089 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:28:28.399368 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:28:28.401139 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:28:28.401627 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:28.401809 (Thread-2): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:28:28.401974 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp002828282053"
    );
  
2022-02-07 21:28:28.402224 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: BEGIN
2022-02-07 21:28:28.402619 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:28:28.404308 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:28:28.406664 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:28:28.406941 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:28:28.407168 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:28:28.409591 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:28.414354 (Thread-1): finished collecting timing info
2022-02-07 21:28:28.414973 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-07 21:28:28.417899 (Thread-1): 00:28:28 | 8 of 14 OK created incremental model public.sat_wheat_gbp_details.... [INSERT 0 0 in 0.18s]
2022-02-07 21:28:28.418192 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:28:28.418789 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:28:28.419171 (Thread-2): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:28:28.419717 (Thread-1): Began running node model.project_otus_dbt.sat_rate_gbp_usd
2022-02-07 21:28:28.420346 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.link_wheat_gbp_rate"} */

      

  create  table "postgres"."public"."link_wheat_gbp_rate"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (
   
SELECT * FROM (
    SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY LINK_DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as l
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.LINK_DATE_PK, a.DATE_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:28.422310 (Thread-1): 00:28:28 | 10 of 14 START incremental model public.sat_rate_gbp_usd............. [RUN]
2022-02-07 21:28:28.423318 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:28.423587 (Thread-1): Compiling model.project_otus_dbt.sat_rate_gbp_usd
2022-02-07 21:28:28.429923 (Thread-2): Postgres error: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^

2022-02-07 21:28:28.435446 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: ROLLBACK
2022-02-07 21:28:28.447652 (Thread-2): finished collecting timing info
2022-02-07 21:28:28.453492 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: Close
2022-02-07 21:28:28.455073 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd"
2022-02-07 21:28:28.457836 (Thread-1): finished collecting timing info
2022-02-07 21:28:28.473748 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:28.474059 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

    

  create temporary table "sat_rate_gbp_usd__dbt_tmp002828470894"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:28.474618 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:28:28.455925 (Thread-2): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 132, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:28:28.479942 (Thread-2): 00:28:28 | 9 of 14 ERROR creating incremental model public.link_wheat_gbp_rate.. [ERROR in 0.12s]
2022-02-07 21:28:28.480451 (Thread-2): Finished running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:28:28.480995 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:28:28.484138 (Thread-2): 00:28:28 | 11 of 14 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-07 21:28:28.486179 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:28.486729 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:28:28.513710 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:28:28.514020 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 21:28:28.519120 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:28.519477 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd: BEGIN
2022-02-07 21:28:28.519878 (Thread-2): finished collecting timing info
2022-02-07 21:28:28.526328 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:28:28.531945 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:28.537552 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd__dbt_tmp002828470894'
        
      order by ordinal_position

  
2022-02-07 21:28:28.538710 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:28.539238 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp002828535748"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:28.539962 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:28:28.551060 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:28:28.558269 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:28.559081 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:28.564932 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:28:28.572365 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:28.572659 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:28:28.572885 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:28.579293 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:28.579815 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-07 21:28:28.581189 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:28.581522 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:28.581733 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp002828535748'
        
      order by ordinal_position

  
2022-02-07 21:28:28.585215 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:28:28.587142 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd"
2022-02-07 21:28:28.587947 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:28.588276 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd__dbt_tmp002828470894"
    );
  
2022-02-07 21:28:28.589871 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:28:28.592671 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd: COMMIT
2022-02-07 21:28:28.593087 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:28:28.593430 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd".
2022-02-07 21:28:28.600421 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:28.600773 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd: COMMIT
2022-02-07 21:28:28.601064 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:28.606934 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:28:28.607193 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:28:28.613079 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:28.616062 (Thread-1): finished collecting timing info
2022-02-07 21:28:28.616590 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:28.616917 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd: Close
2022-02-07 21:28:28.619959 (Thread-1): 00:28:28 | 10 of 14 OK created incremental model public.sat_rate_gbp_usd........ [INSERT 0 0 in 0.19s]
2022-02-07 21:28:28.620323 (Thread-1): Finished running node model.project_otus_dbt.sat_rate_gbp_usd
2022-02-07 21:28:28.620697 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:28:28.623803 (Thread-1): 00:28:28 | 12 of 14 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-07 21:28:28.624087 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:28:28.624656 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:28.626464 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:28:28.627029 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:28:28.643430 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:28.649080 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp002828535748"
    );
  
2022-02-07 21:28:28.661562 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:28:28.662193 (Thread-2): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-07 21:28:28.664682 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:28:28.665041 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:28:28.665265 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:28:28.665640 (Thread-1): finished collecting timing info
2022-02-07 21:28:28.678506 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:28:28.683424 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:28.686537 (Thread-2): finished collecting timing info
2022-02-07 21:28:28.687164 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp002828680579"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:28.687528 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-07 21:28:28.687818 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:28:28.695642 (Thread-2): 00:28:28 | 11 of 14 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.20s]
2022-02-07 21:28:28.696145 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:28:28.696602 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:28:28.699812 (Thread-2): 00:28:28 | 13 of 14 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-07 21:28:28.700920 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:28.701351 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:28:28.729652 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 21:28:28.741825 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:28:28.746737 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:28.747496 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-07 21:28:28.748271 (Thread-2): finished collecting timing info
2022-02-07 21:28:28.754553 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:28:28.765444 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:28.770436 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:28.770789 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp002828680579'
        
      order by ordinal_position

  
2022-02-07 21:28:28.771165 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp002828766793"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:28.771752 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:28:28.789015 (Thread-1): SQL status: SELECT 11 in 0.02 seconds
2022-02-07 21:28:28.797754 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:28.798641 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:28.801814 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:28:28.809346 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:28.810423 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:28:28.810952 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-07 21:28:28.823895 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:28.824505 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:28.825902 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:28.826845 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:28.827187 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp002828766793'
        
      order by ordinal_position

  
2022-02-07 21:28:28.832633 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:28:28.834846 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:28:28.835730 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:28.836091 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp002828680579"
    );
  
2022-02-07 21:28:28.838615 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:28:28.841003 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:28:28.841612 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:28:28.842665 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:28:28.845146 (Thread-2): SQL status: SELECT 4 in 0.02 seconds
2022-02-07 21:28:28.919001 (Thread-1): SQL status: COMMIT in 0.08 seconds
2022-02-07 21:28:28.924131 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:28.927944 (Thread-1): finished collecting timing info
2022-02-07 21:28:28.928502 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:28.928838 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-07 21:28:28.931603 (Thread-1): 00:28:28 | 12 of 14 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.31s]
2022-02-07 21:28:28.932014 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:28:28.932400 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:28:28.934870 (Thread-1): 00:28:28 | 14 of 14 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-07 21:28:28.935876 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:28:28.936486 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:28:28.936878 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:28:28.944363 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:28.960879 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:28.974000 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:28:28.974325 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:28:28.975852 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:28:28.976582 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:28.976958 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp002828766793"
    );
  
2022-02-07 21:28:28.977209 (Thread-1): finished collecting timing info
2022-02-07 21:28:28.984672 (Thread-2): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-07 21:28:28.991529 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:28:28.991863 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:28:28.992229 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:28:28.992541 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp002828988115"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:28:28.992866 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:28:28.993166 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:28:28.996278 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:28.999751 (Thread-2): finished collecting timing info
2022-02-07 21:28:29.000170 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-07 21:28:29.003010 (Thread-2): 00:28:28 | 13 of 14 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.30s]
2022-02-07 21:28:29.003563 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:28:29.016790 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 21:28:29.022911 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:28:29.023193 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-07 21:28:29.024698 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:28:29.025044 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:28:29.025246 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp002828988115'
        
      order by ordinal_position

  
2022-02-07 21:28:29.035721 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:28:29.043096 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:28:29.043423 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:29.049262 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:28:29.059325 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:28:29.059819 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:28:29.065716 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:28:29.067940 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:28:29.068829 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:28:29.069167 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp002828988115"
    );
  
2022-02-07 21:28:29.071061 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:28:29.074381 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:28:29.075386 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:28:29.075778 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:28:29.078919 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:29.082829 (Thread-1): finished collecting timing info
2022-02-07 21:28:29.083411 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-07 21:28:29.086708 (Thread-1): 00:28:29 | 14 of 14 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.15s]
2022-02-07 21:28:29.087206 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:28:29.090336 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:28:29.090847 (MainThread): Using postgres connection "master".
2022-02-07 21:28:29.091411 (MainThread): On master: BEGIN
2022-02-07 21:28:29.091791 (MainThread): Opening a new connection, currently in state closed
2022-02-07 21:28:29.108291 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:28:29.108743 (MainThread): On master: COMMIT
2022-02-07 21:28:29.109017 (MainThread): Using postgres connection "master".
2022-02-07 21:28:29.109245 (MainThread): On master: COMMIT
2022-02-07 21:28:29.110717 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:28:29.111194 (MainThread): On master: Close
2022-02-07 21:28:29.112411 (MainThread): 00:28:29 | 
2022-02-07 21:28:29.113042 (MainThread): 00:28:29 | Finished running 4 view models, 2 table models, 8 incremental models in 2.49s.
2022-02-07 21:28:29.113606 (MainThread): Connection 'master' was properly closed.
2022-02-07 21:28:29.114177 (MainThread): Connection 'model.project_otus_dbt.sat_wheat_msk_details' was properly closed.
2022-02-07 21:28:29.114598 (MainThread): Connection 'model.project_otus_dbt.hub_wheat_msk' was properly closed.
2022-02-07 21:28:29.308036 (MainThread): 
2022-02-07 21:28:29.308380 (MainThread): Completed with 1 error and 0 warnings:
2022-02-07 21:28:29.308604 (MainThread): 
2022-02-07 21:28:29.308829 (MainThread): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
2022-02-07 21:28:29.309049 (MainThread):   column "link_date_pk" does not exist
2022-02-07 21:28:29.309327 (MainThread):   LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
2022-02-07 21:28:29.309613 (MainThread):                       ^
2022-02-07 21:28:29.309805 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:28:29.310068 (MainThread): 
Done. PASS=13 WARN=0 ERROR=1 SKIP=0 TOTAL=14
2022-02-07 21:28:29.310434 (MainThread): Flushing usage events
2022-02-07 21:46:12.262969 (MainThread): Running with dbt=0.19.0
2022-02-07 21:46:12.329747 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 21:46:12.330564 (MainThread): Tracking: do not track
2022-02-07 21:46:12.410434 (MainThread): Partial parsing not enabled
2022-02-07 21:46:12.411615 (MainThread): Parsing macros/adapters.sql
2022-02-07 21:46:12.434410 (MainThread): Parsing macros/catalog.sql
2022-02-07 21:46:12.437320 (MainThread): Parsing macros/relations.sql
2022-02-07 21:46:12.439306 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 21:46:12.442304 (MainThread): Parsing macros/core.sql
2022-02-07 21:46:12.446840 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 21:46:12.487280 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 21:46:12.489246 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 21:46:12.490923 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 21:46:12.498929 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 21:46:12.500697 (MainThread): Parsing macros/etc/query.sql
2022-02-07 21:46:12.501818 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 21:46:12.502799 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 21:46:12.510649 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 21:46:12.529147 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 21:46:12.530964 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 21:46:12.557824 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 21:46:12.574947 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 21:46:12.581120 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 21:46:12.583183 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 21:46:12.599500 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 21:46:12.609347 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 21:46:12.624811 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 21:46:12.637347 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 21:46:12.640418 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 21:46:12.644225 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 21:46:12.650210 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 21:46:12.661037 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 21:46:12.665078 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 21:46:12.669786 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 21:46:12.672300 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 21:46:12.693649 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 21:46:12.696689 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 21:46:12.699122 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 21:46:12.702634 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 21:46:12.703942 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 21:46:12.707752 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 21:46:12.713280 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 21:46:12.716221 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 21:46:12.719673 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 21:46:12.724023 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 21:46:12.733847 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 21:46:12.739051 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 21:46:12.742890 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 21:46:12.744889 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 21:46:12.747213 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 21:46:12.749190 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 21:46:12.751081 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 21:46:12.757535 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 21:46:12.759174 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 21:46:12.761055 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 21:46:12.763466 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 21:46:12.766399 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 21:46:12.768320 (MainThread): Parsing macros/sql/star.sql
2022-02-07 21:46:12.773441 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 21:46:12.776808 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 21:46:12.784051 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 21:46:12.789043 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 21:46:12.809264 (MainThread): Parsing macros/sql/union.sql
2022-02-07 21:46:12.825356 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 21:46:12.827981 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 21:46:12.833883 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 21:46:12.838545 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 21:46:12.843886 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 21:46:12.851036 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 21:46:12.856261 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 21:46:12.857989 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 21:46:12.859923 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 21:46:12.862550 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 21:46:12.866246 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 21:46:12.867568 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 21:46:12.868994 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 21:46:12.870547 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 21:46:12.899996 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 21:46:12.902117 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 21:46:12.905063 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 21:46:12.907278 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 21:46:12.909368 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 21:46:12.916136 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 21:46:12.920411 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 21:46:12.923329 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 21:46:12.925062 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 21:46:12.926807 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 21:46:12.928965 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 21:46:12.932068 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 21:46:12.934054 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 21:46:12.939581 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 21:46:12.942148 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 21:46:12.945761 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 21:46:12.946764 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 21:46:12.949179 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 21:46:12.952401 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 21:46:12.957258 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 21:46:12.967179 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 21:46:12.974693 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 21:46:12.975878 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 21:46:13.000900 (MainThread): Parsing macros/tables/link.sql
2022-02-07 21:46:13.019539 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 21:46:13.036719 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 21:46:13.051636 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 21:46:13.062952 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 21:46:13.100550 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 21:46:13.112679 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 21:46:13.152834 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 21:46:13.155703 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 21:46:13.202640 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 21:46:13.215715 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 21:46:13.230642 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 21:46:13.233192 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 21:46:13.249851 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 21:46:13.256708 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 21:46:13.281793 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 21:46:13.308829 (MainThread): Partial parsing not enabled
2022-02-07 21:46:13.441371 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:46:13.560756 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:46:13.606976 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:46:13.644471 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:46:13.666022 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:46:13.686368 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:46:13.717357 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:46:13.733591 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:46:13.749102 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:46:13.850933 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:46:13.868543 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:46:13.899228 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:46:13.928140 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:46:13.940038 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:46:13.949910 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 21:46:13.960192 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:46:14.705430 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.prestage
- models.project_otus_dbt.report

2022-02-07 21:46:14.876374 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 21:46:14.877035 (MainThread): Found 16 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 21:46:14.879427 (MainThread): 
2022-02-07 21:46:14.880072 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:46:14.900746 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 21:46:14.914432 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 21:46:14.914689 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 21:46:14.914803 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 21:46:14.928656 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 21:46:14.931735 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 21:46:14.959047 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 21:46:14.967493 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:46:14.967734 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 21:46:14.967852 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 21:46:14.979711 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:46:14.979982 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:46:14.980100 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 21:46:14.985586 (ThreadPoolExecutor-1_0): SQL status: SELECT 19 in 0.01 seconds
2022-02-07 21:46:14.999340 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 21:46:15.000710 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 21:46:15.035480 (MainThread): Using postgres connection "master".
2022-02-07 21:46:15.035700 (MainThread): On master: BEGIN
2022-02-07 21:46:15.035857 (MainThread): Opening a new connection, currently in state init
2022-02-07 21:46:15.048476 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:46:15.048796 (MainThread): Using postgres connection "master".
2022-02-07 21:46:15.049004 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 21:46:15.265540 (MainThread): SQL status: SELECT 10 in 0.22 seconds
2022-02-07 21:46:15.284452 (MainThread): On master: ROLLBACK
2022-02-07 21:46:15.285798 (MainThread): Using postgres connection "master".
2022-02-07 21:46:15.286075 (MainThread): On master: BEGIN
2022-02-07 21:46:15.288331 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:46:15.288640 (MainThread): On master: COMMIT
2022-02-07 21:46:15.288833 (MainThread): Using postgres connection "master".
2022-02-07 21:46:15.289021 (MainThread): On master: COMMIT
2022-02-07 21:46:15.290334 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:46:15.290544 (MainThread): On master: Close
2022-02-07 21:46:15.290941 (MainThread): 00:46:15 | Concurrency: 2 threads (target='dev')
2022-02-07 21:46:15.291112 (MainThread): 00:46:15 | 
2022-02-07 21:46:15.305190 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:46:15.305621 (Thread-2): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:46:15.307667 (Thread-1): 00:46:15 | 1 of 15 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-07 21:46:15.309658 (Thread-2): 00:46:15 | 2 of 15 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-07 21:46:15.310577 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:46:15.311032 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:46:15.311448 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:46:15.311870 (Thread-2): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:46:15.415733 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:46:15.418590 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:46:15.418889 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 21:46:15.419313 (Thread-2): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-07 21:46:15.419739 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:46:15.420060 (Thread-2): Opening a new connection, currently in state init
2022-02-07 21:46:15.435057 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:46:15.435389 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:46:15.435610 (Thread-2): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:15.436347 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:46:15.436623 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:46:15.436807 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:15.449743 (Thread-2): SQL status: SELECT 6 in 0.01 seconds
2022-02-07 21:46:15.459780 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:46:15.460173 (Thread-1): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 21:46:15.460443 (Thread-2): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:15.476999 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:46:15.477364 (Thread-2): SQL status: SELECT 6 in 0.01 seconds
2022-02-07 21:46:15.477763 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:15.484494 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:46:15.485314 (Thread-2): finished collecting timing info
2022-02-07 21:46:15.532873 (Thread-1): SQL status: SELECT 18 in 0.05 seconds
2022-02-07 21:46:15.568023 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:46:15.581363 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:46:15.581797 (Thread-2): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 21:46:15.582190 (Thread-1): finished collecting timing info
2022-02-07 21:46:15.588467 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:46:15.596314 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:46:15.600079 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:46:15.600331 (Thread-2): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:46:15.600647 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 21:46:15.602536 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:46:15.602900 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:46:15.607915 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:46:15.612162 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:46:15.612589 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:46:15.613199 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:46:15.613332 (Thread-2): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:46:15.614327 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:46:15.615590 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:46:15.615988 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:46:15.616105 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:46:15.622425 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:46:15.622705 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:46:15.631143 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:46:15.638931 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:46:15.639207 (Thread-2): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-07 21:46:15.639570 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-07 21:46:15.641253 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:46:15.646397 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:46:15.646882 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 21:46:15.647264 (Thread-2): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-07 21:46:15.653051 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:46:15.653470 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 21:46:15.655522 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:46:15.655889 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:46:15.670791 (Thread-2): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:46:15.673092 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:46:15.673413 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:46:15.673688 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:46:15.673873 (Thread-2): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:46:15.674181 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:46:15.677220 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:46:15.683157 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:46:15.683324 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:46:15.683585 (Thread-2): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:46:15.685690 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:46:15.686214 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:46:15.691046 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:46:15.695903 (Thread-2): finished collecting timing info
2022-02-07 21:46:15.696465 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:46:15.696754 (Thread-2): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-07 21:46:15.701597 (Thread-1): finished collecting timing info
2022-02-07 21:46:15.702278 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 21:46:15.705440 (Thread-2): 00:46:15 | 2 of 15 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.39s]
2022-02-07 21:46:15.708048 (Thread-1): 00:46:15 | 1 of 15 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.40s]
2022-02-07 21:46:15.708733 (Thread-2): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:46:15.709116 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:46:15.709390 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:46:15.710319 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:46:15.713992 (Thread-2): 00:46:15 | 3 of 15 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-07 21:46:15.716664 (Thread-1): 00:46:15 | 4 of 15 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-07 21:46:15.717695 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:46:15.718536 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:46:15.718824 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:46:15.719170 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:46:15.752838 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:46:15.757046 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:46:15.757293 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 21:46:15.757648 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-07 21:46:15.758101 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:46:15.758490 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:46:15.770500 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:46:15.770859 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:46:15.771226 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:15.772502 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:46:15.772834 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:46:15.773046 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:15.778498 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:46:15.786827 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:46:15.787127 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:15.787572 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:46:15.795646 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:46:15.795908 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:46:15.796121 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:15.801373 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:46:15.802116 (Thread-2): finished collecting timing info
2022-02-07 21:46:15.815045 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:46:15.815238 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:46:15.815389 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-07 21:46:15.821637 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:46:15.822373 (Thread-1): finished collecting timing info
2022-02-07 21:46:15.828625 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:46:15.833784 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:46:15.839662 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:46:15.839938 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 21:46:15.840274 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:46:15.841889 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:46:15.842223 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:46:15.845563 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:46:15.848008 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:46:15.848342 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:46:15.849179 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:46:15.849722 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:46:15.850363 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:46:15.851748 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:46:15.852301 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:46:15.852496 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:46:15.857227 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:46:15.862609 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:46:15.862946 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:46:15.863227 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-07 21:46:15.872323 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:46:15.872914 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-07 21:46:15.874842 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:46:15.875181 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:46:15.880227 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:46:15.883509 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:46:15.883880 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-07 21:46:15.884095 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-07 21:46:15.886696 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:46:15.886965 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:46:15.888448 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:46:15.889799 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:46:15.890123 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:46:15.890328 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:46:15.890549 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:46:15.890757 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:46:15.893553 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:46:15.893799 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:46:15.896150 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:46:15.900156 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:46:15.900589 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:46:15.900878 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:46:15.906474 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:46:15.911183 (Thread-2): finished collecting timing info
2022-02-07 21:46:15.911565 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:46:15.911818 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-07 21:46:15.915341 (Thread-1): finished collecting timing info
2022-02-07 21:46:15.915953 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 21:46:15.919229 (Thread-2): 00:46:15 | 3 of 15 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.20s]
2022-02-07 21:46:15.921694 (Thread-1): 00:46:15 | 4 of 15 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.20s]
2022-02-07 21:46:15.922077 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:46:15.922706 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:46:15.923332 (Thread-2): Began running node model.project_otus_dbt.dim_day
2022-02-07 21:46:15.924519 (Thread-1): Began running node model.project_otus_dbt.dim_week
2022-02-07 21:46:15.926506 (Thread-2): 00:46:15 | 5 of 15 START table model public.dim_day............................. [RUN]
2022-02-07 21:46:15.928336 (Thread-1): 00:46:15 | 6 of 15 START table model public.dim_week............................ [RUN]
2022-02-07 21:46:15.929219 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:46:15.930119 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:46:15.930631 (Thread-2): Compiling model.project_otus_dbt.dim_day
2022-02-07 21:46:15.931057 (Thread-1): Compiling model.project_otus_dbt.dim_week
2022-02-07 21:46:15.937997 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:46:15.946216 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:46:15.947100 (Thread-2): finished collecting timing info
2022-02-07 21:46:15.947706 (Thread-1): finished collecting timing info
2022-02-07 21:46:15.988811 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:46:15.994372 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-07 21:46:15.999542 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:46:15.999794 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:46:16.000039 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-07 21:46:16.000501 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:46:16.011819 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:46:16.015679 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:46:16.015973 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 21:46:16.016214 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:46:16.020554 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:46:16.021130 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:46:16.022367 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:46:16.022645 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:46:16.030213 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:46:16.032054 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:46:16.032920 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:46:16.033184 (Thread-2): On model.project_otus_dbt.dim_day: BEGIN
2022-02-07 21:46:16.033919 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:46:16.034285 (Thread-1): On model.project_otus_dbt.dim_week: BEGIN
2022-02-07 21:46:16.034631 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:46:16.034919 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:46:16.035276 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 day')
        as t(date)
        )

select * from dim_day
order by date desc
  );
2022-02-07 21:46:16.035980 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:46:16.036193 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:46:16.036311 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-07 21:46:16.048696 (Thread-1): SQL status: SELECT 731 in 0.01 seconds
2022-02-07 21:46:16.053979 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:46:16.054198 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-07 21:46:16.055733 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:46:16.058881 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:46:16.059081 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-07 21:46:16.060526 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:46:16.062030 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:46:16.062238 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:46:16.062375 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:46:16.066202 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:46:16.068912 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:46:16.069122 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:46:16.079268 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:46:16.083555 (Thread-1): finished collecting timing info
2022-02-07 21:46:16.083921 (Thread-1): On model.project_otus_dbt.dim_week: Close
2022-02-07 21:46:16.084088 (Thread-2): SQL status: SELECT 5114 in 0.05 seconds
2022-02-07 21:46:16.086626 (Thread-1): 00:46:16 | 6 of 15 OK created table model public.dim_week....................... [SELECT 731 in 0.15s]
2022-02-07 21:46:16.092273 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:46:16.092728 (Thread-1): Finished running node model.project_otus_dbt.dim_week
2022-02-07 21:46:16.092982 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-07 21:46:16.093365 (Thread-1): Began running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:46:16.095222 (Thread-1): 00:46:16 | 7 of 15 START incremental model public.link_wheat_gbp_rate........... [RUN]
2022-02-07 21:46:16.095759 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:46:16.095943 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:46:16.096203 (Thread-1): Compiling model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:46:16.100696 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:46:16.111660 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-07 21:46:16.114277 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:46:16.115316 (Thread-1): finished collecting timing info
2022-02-07 21:46:16.121667 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 21:46:16.128637 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:46:16.135663 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:46:16.141231 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:46:16.149580 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:46:16.150307 (Thread-1): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:46:16.150491 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: BEGIN
2022-02-07 21:46:16.150601 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:46:16.156622 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:46:16.159994 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:46:16.160471 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:46:16.162784 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:46:16.163246 (Thread-1): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:46:16.163391 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.link_wheat_gbp_rate"} */

      

  create  table "postgres"."public"."link_wheat_gbp_rate"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (
   
SELECT * FROM (
    SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY LINK_DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as l
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.LINK_DATE_PK, a.DATE_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:46:16.165524 (Thread-1): Postgres error: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^

2022-02-07 21:46:16.165776 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:46:16.165989 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: ROLLBACK
2022-02-07 21:46:16.169575 (Thread-2): finished collecting timing info
2022-02-07 21:46:16.170242 (Thread-2): On model.project_otus_dbt.dim_day: Close
2022-02-07 21:46:16.172258 (Thread-2): 00:46:16 | 5 of 15 OK created table model public.dim_day........................ [SELECT 5114 in 0.24s]
2022-02-07 21:46:16.172592 (Thread-1): finished collecting timing info
2022-02-07 21:46:16.173188 (Thread-2): Finished running node model.project_otus_dbt.dim_day
2022-02-07 21:46:16.173518 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: Close
2022-02-07 21:46:16.173958 (Thread-2): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 21:46:16.176395 (Thread-2): 00:46:16 | 8 of 15 START incremental model public.sat_rate_gbp_usd_details...... [RUN]
2022-02-07 21:46:16.178650 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:46:16.179033 (Thread-2): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 21:46:16.200823 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 21:46:16.202410 (Thread-2): finished collecting timing info
2022-02-07 21:46:16.209661 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 21:46:16.176937 (Thread-1): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 132, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:46:16.212711 (Thread-1): 00:46:16 | 7 of 15 ERROR creating incremental model public.link_wheat_gbp_rate.. [ERROR in 0.12s]
2022-02-07 21:46:16.213214 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:46:16.213439 (Thread-1): Finished running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:46:16.213676 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-07 21:46:16.214116 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:46:16.214873 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:46:16.216474 (Thread-1): 00:46:16 | 9 of 15 START incremental model public.hub_wheat_msk................. [RUN]
2022-02-07 21:46:16.217542 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:46:16.217847 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:46:16.233549 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:46:16.234087 (Thread-1): finished collecting timing info
2022-02-07 21:46:16.240486 (Thread-2): SQL status: BEGIN in 0.03 seconds
2022-02-07 21:46:16.246005 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:46:16.249556 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:46:16.249866 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

  create  table "postgres"."public"."sat_rate_gbp_usd_details"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:46:16.250090 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp004616244216"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:46:16.250504 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:46:16.266294 (Thread-2): SQL status: SELECT 548 in 0.02 seconds
2022-02-07 21:46:16.268087 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 21:46:16.268319 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:46:16.268443 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 21:46:16.272056 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:46:16.272319 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 21:46:16.274602 (Thread-2): finished collecting timing info
2022-02-07 21:46:16.278692 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:46:16.279070 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-07 21:46:16.279288 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-07 21:46:16.281791 (Thread-2): 00:46:16 | 8 of 15 OK created incremental model public.sat_rate_gbp_usd_details. [SELECT 548 in 0.10s]
2022-02-07 21:46:16.282326 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:46:16.282793 (Thread-2): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 21:46:16.283001 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:46:16.283347 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:46:16.283798 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp004616244216'
        
      order by ordinal_position

  
2022-02-07 21:46:16.285260 (Thread-2): 00:46:16 | 10 of 15 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-07 21:46:16.286037 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:46:16.286294 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:46:16.300010 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:46:16.315601 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:46:16.310715 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:46:16.315883 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:16.316468 (Thread-2): finished collecting timing info
2022-02-07 21:46:16.327377 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:46:16.328111 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:46:16.338566 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:46:16.338837 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp004616325695"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:46:16.339151 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:16.339505 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:46:16.343782 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:46:16.345089 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:46:16.345640 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:46:16.345795 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp004616244216"
    );
  
2022-02-07 21:46:16.347141 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:46:16.349271 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:46:16.349618 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:46:16.349791 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:46:16.352269 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:46:16.355105 (Thread-1): finished collecting timing info
2022-02-07 21:46:16.355573 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-07 21:46:16.357664 (Thread-1): 00:46:16 | 9 of 15 OK created incremental model public.hub_wheat_msk............ [INSERT 0 0 in 0.14s]
2022-02-07 21:46:16.358081 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:46:16.358469 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:46:16.360656 (Thread-1): 00:46:16 | 11 of 15 START incremental model public.hub_wheat_gbp................ [RUN]
2022-02-07 21:46:16.361572 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:46:16.362038 (Thread-2): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 21:46:16.362440 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:46:16.367495 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:46:16.378421 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-07 21:46:16.380947 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:46:16.381603 (Thread-1): finished collecting timing info
2022-02-07 21:46:16.387796 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:46:16.394043 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:46:16.394299 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:46:16.394554 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp004616392058"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:46:16.394791 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp004616325695'
        
      order by ordinal_position

  
2022-02-07 21:46:16.395043 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:46:16.402692 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:46:16.408741 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:46:16.409052 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:16.414294 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:46:16.420447 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:46:16.420699 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:46:16.420906 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:16.425153 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:46:16.425616 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-07 21:46:16.426852 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:46:16.427170 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:46:16.427359 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp004616392058'
        
      order by ordinal_position

  
2022-02-07 21:46:16.429679 (Thread-2): SQL status: SELECT 12 in 0.00 seconds
2022-02-07 21:46:16.431148 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:46:16.431691 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:46:16.431903 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp004616325695"
    );
  
2022-02-07 21:46:16.433718 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:46:16.435296 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:46:16.435533 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:46:16.435680 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:46:16.436077 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:46:16.440636 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:46:16.440844 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:46:16.441012 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:16.443542 (Thread-2): finished collecting timing info
2022-02-07 21:46:16.444078 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-07 21:46:16.445943 (Thread-2): 00:46:16 | 10 of 15 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.16s]
2022-02-07 21:46:16.446289 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:46:16.446567 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:46:16.448380 (Thread-2): 00:46:16 | 12 of 15 START incremental model public.sat_wheat_gbp_details........ [RUN]
2022-02-07 21:46:16.449486 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:46:16.449776 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:46:16.450003 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:46:16.455455 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:46:16.466621 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:16.477312 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:46:16.477611 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:46:16.479170 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:46:16.479837 (Thread-2): finished collecting timing info
2022-02-07 21:46:16.490965 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:46:16.492672 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:46:16.492916 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp004616392058"
    );
  
2022-02-07 21:46:16.493181 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp004616490257"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:46:16.493615 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:46:16.495110 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:46:16.496923 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:46:16.497163 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:46:16.497296 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:46:16.499574 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:46:16.502152 (Thread-1): finished collecting timing info
2022-02-07 21:46:16.502660 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-07 21:46:16.504811 (Thread-1): 00:46:16 | 11 of 15 OK created incremental model public.hub_wheat_gbp........... [INSERT 0 0 in 0.14s]
2022-02-07 21:46:16.505248 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:46:16.505629 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:46:16.507510 (Thread-1): 00:46:16 | 13 of 15 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-07 21:46:16.508483 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:46:16.508949 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:46:16.521140 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:46:16.521371 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:46:16.526110 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:46:16.526491 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-07 21:46:16.526757 (Thread-1): finished collecting timing info
2022-02-07 21:46:16.533496 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:46:16.537418 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:46:16.537657 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:46:16.537883 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp004616535982"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:46:16.538099 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp004616490257'
        
      order by ordinal_position

  
2022-02-07 21:46:16.538329 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:46:16.546751 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:46:16.551971 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:46:16.552395 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:16.557606 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:46:16.563410 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:46:16.563645 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:46:16.563885 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:16.567927 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:46:16.568393 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-07 21:46:16.569603 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:46:16.569831 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:46:16.569913 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp004616535982'
        
      order by ordinal_position

  
2022-02-07 21:46:16.572884 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:46:16.574326 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:46:16.575180 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:46:16.575443 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp004616490257"
    );
  
2022-02-07 21:46:16.577496 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:46:16.578973 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:46:16.579254 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:46:16.579495 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:46:16.583894 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:46:16.584238 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:46:16.584479 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:16.587207 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:46:16.589776 (Thread-2): finished collecting timing info
2022-02-07 21:46:16.590128 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:46:16.590398 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-07 21:46:16.641973 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:46:16.642336 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:16.644950 (Thread-2): 00:46:16 | 12 of 15 OK created incremental model public.sat_wheat_gbp_details... [INSERT 0 0 in 0.19s]
2022-02-07 21:46:16.645666 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:46:16.646324 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:46:16.648815 (Thread-2): 00:46:16 | 14 of 15 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-07 21:46:16.649828 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:46:16.650540 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:46:16.650871 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:46:16.663056 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:46:16.672314 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:46:16.673105 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:46:16.673401 (Thread-2): finished collecting timing info
2022-02-07 21:46:16.673785 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp004616535982"
    );
  
2022-02-07 21:46:16.681713 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:46:16.682098 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp004616680205"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:46:16.682206 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:46:16.683481 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:46:16.685203 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:46:16.685445 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:46:16.685727 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:46:16.688528 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:46:16.691690 (Thread-1): finished collecting timing info
2022-02-07 21:46:16.692126 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-07 21:46:16.694465 (Thread-1): 00:46:16 | 13 of 15 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.18s]
2022-02-07 21:46:16.695011 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:46:16.695457 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:46:16.697693 (Thread-1): 00:46:16 | 15 of 15 START view model public.dds_wheat_msk....................... [RUN]
2022-02-07 21:46:16.698736 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:46:16.699065 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:46:16.708201 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 21:46:16.708752 (Thread-1): finished collecting timing info
2022-02-07 21:46:16.709160 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:46:16.717520 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:46:16.724396 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:46:16.724636 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-07 21:46:16.724898 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-07 21:46:16.725133 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:46:16.726669 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:46:16.726937 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:46:16.727101 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp004616680205'
        
      order by ordinal_position

  
2022-02-07 21:46:16.735575 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:46:16.742299 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:46:16.742554 (Thread-1): SQL status: DROP VIEW in 0.02 seconds
2022-02-07 21:46:16.742748 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:16.746295 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:46:16.746857 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 21:46:16.748322 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:46:16.750005 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 21:46:16.750861 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:46:16.751074 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-07 21:46:16.751809 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:46:16.756961 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:46:16.757244 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:46:16.757489 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:46:16.757853 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:46:16.758258 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */

  create view "postgres"."public"."dds_wheat_msk__dbt_tmp" as (
    with dds_wheat_msk as(
    select sm.tradedate  as tradedate
        ,cast(sm.value as decimal(18,2)) as value
        ,cast(sm.open as decimal(18,2)) as open
        ,cast(sm.close as decimal(18,2)) as close
        ,cast(sm.high as decimal(18,2)) as high
        ,cast(sm.low as decimal(18,2)) as low
        ,cast(sm.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hm
    left join "postgres"."public"."sat_wheat_msk_details" as sm
    on hm.date_pk=sm.date_pk
)
select * from dds_wheat_msk
  );

2022-02-07 21:46:16.761959 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:46:16.763224 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:46:16.763753 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:46:16.763942 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp004616680205"
    );
  
2022-02-07 21:46:16.764319 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:46:16.768834 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:46:16.769170 (Thread-2): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-07 21:46:16.769402 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-07 21:46:16.771262 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:46:16.771700 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:46:16.771971 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:46:16.773374 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:46:16.774876 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 21:46:16.775116 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:46:16.775315 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:46:16.775513 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 21:46:16.777989 (Thread-2): finished collecting timing info
2022-02-07 21:46:16.778698 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-07 21:46:16.781649 (Thread-2): 00:46:16 | 14 of 15 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.13s]
2022-02-07 21:46:16.781939 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:46:16.782311 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:46:16.786270 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:46:16.787053 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 21:46:16.788714 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:46:16.793922 (Thread-1): finished collecting timing info
2022-02-07 21:46:16.794327 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-07 21:46:16.796716 (Thread-1): 00:46:16 | 15 of 15 OK created view model public.dds_wheat_msk.................. [CREATE VIEW in 0.10s]
2022-02-07 21:46:16.797291 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:46:16.800433 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:46:16.800711 (MainThread): Using postgres connection "master".
2022-02-07 21:46:16.800836 (MainThread): On master: BEGIN
2022-02-07 21:46:16.800976 (MainThread): Opening a new connection, currently in state closed
2022-02-07 21:46:16.811645 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:46:16.812221 (MainThread): On master: COMMIT
2022-02-07 21:46:16.812501 (MainThread): Using postgres connection "master".
2022-02-07 21:46:16.812725 (MainThread): On master: COMMIT
2022-02-07 21:46:16.813884 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:46:16.814165 (MainThread): On master: Close
2022-02-07 21:46:16.814782 (MainThread): 00:46:16 | 
2022-02-07 21:46:16.815061 (MainThread): 00:46:16 | Finished running 5 view models, 2 table models, 8 incremental models in 1.93s.
2022-02-07 21:46:16.815275 (MainThread): Connection 'master' was properly closed.
2022-02-07 21:46:16.815460 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_msk' was properly closed.
2022-02-07 21:46:16.815588 (MainThread): Connection 'model.project_otus_dbt.sat_wheat_usa_details' was properly closed.
2022-02-07 21:46:16.932861 (MainThread): 
2022-02-07 21:46:16.933187 (MainThread): Completed with 1 error and 0 warnings:
2022-02-07 21:46:16.933432 (MainThread): 
2022-02-07 21:46:16.933727 (MainThread): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
2022-02-07 21:46:16.933997 (MainThread):   column "link_date_pk" does not exist
2022-02-07 21:46:16.934251 (MainThread):   LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
2022-02-07 21:46:16.934520 (MainThread):                       ^
2022-02-07 21:46:16.934752 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:46:16.935049 (MainThread): 
Done. PASS=14 WARN=0 ERROR=1 SKIP=0 TOTAL=15
2022-02-07 21:46:16.935411 (MainThread): Flushing usage events
2022-02-07 21:47:57.179888 (MainThread): Running with dbt=0.19.0
2022-02-07 21:47:57.261230 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 21:47:57.263071 (MainThread): Tracking: do not track
2022-02-07 21:47:57.335233 (MainThread): Partial parsing not enabled
2022-02-07 21:47:57.337165 (MainThread): Parsing macros/adapters.sql
2022-02-07 21:47:57.363942 (MainThread): Parsing macros/catalog.sql
2022-02-07 21:47:57.367413 (MainThread): Parsing macros/relations.sql
2022-02-07 21:47:57.369859 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 21:47:57.374582 (MainThread): Parsing macros/core.sql
2022-02-07 21:47:57.380469 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 21:47:57.428722 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 21:47:57.431847 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 21:47:57.435136 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 21:47:57.448150 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 21:47:57.450961 (MainThread): Parsing macros/etc/query.sql
2022-02-07 21:47:57.452786 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 21:47:57.454363 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 21:47:57.463877 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 21:47:57.494487 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 21:47:57.497539 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 21:47:57.542467 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 21:47:57.574033 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 21:47:57.582602 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 21:47:57.587024 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 21:47:57.610431 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 21:47:57.616605 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 21:47:57.624814 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 21:47:57.633634 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 21:47:57.637205 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 21:47:57.640187 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 21:47:57.644462 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 21:47:57.650856 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 21:47:57.653944 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 21:47:57.657454 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 21:47:57.659401 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 21:47:57.672530 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 21:47:57.675439 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 21:47:57.677727 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 21:47:57.680807 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 21:47:57.682058 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 21:47:57.684777 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 21:47:57.690260 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 21:47:57.693149 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 21:47:57.695695 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 21:47:57.698674 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 21:47:57.709268 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 21:47:57.713996 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 21:47:57.717029 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 21:47:57.718864 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 21:47:57.722096 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 21:47:57.724251 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 21:47:57.726275 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 21:47:57.732742 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 21:47:57.734474 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 21:47:57.736981 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 21:47:57.741234 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 21:47:57.745625 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 21:47:57.748741 (MainThread): Parsing macros/sql/star.sql
2022-02-07 21:47:57.754560 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 21:47:57.757305 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 21:47:57.762251 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 21:47:57.764535 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 21:47:57.773832 (MainThread): Parsing macros/sql/union.sql
2022-02-07 21:47:57.785507 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 21:47:57.788725 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 21:47:57.795305 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 21:47:57.800406 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 21:47:57.806206 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 21:47:57.815057 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 21:47:57.820476 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 21:47:57.822377 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 21:47:57.824354 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 21:47:57.827399 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 21:47:57.831476 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 21:47:57.832926 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 21:47:57.834338 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 21:47:57.836169 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 21:47:57.860614 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 21:47:57.862732 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 21:47:57.865098 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 21:47:57.867273 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 21:47:57.869937 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 21:47:57.876532 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 21:47:57.880454 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 21:47:57.883251 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 21:47:57.885180 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 21:47:57.887730 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 21:47:57.890226 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 21:47:57.893413 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 21:47:57.895266 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 21:47:57.900648 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 21:47:57.903568 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 21:47:57.907306 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 21:47:57.908204 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 21:47:57.910535 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 21:47:57.913597 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 21:47:57.918584 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 21:47:57.927445 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 21:47:57.930488 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 21:47:57.931010 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 21:47:57.949924 (MainThread): Parsing macros/tables/link.sql
2022-02-07 21:47:57.970280 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 21:47:57.988607 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 21:47:58.004116 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 21:47:58.014143 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 21:47:58.033892 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 21:47:58.042010 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 21:47:58.060897 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 21:47:58.062447 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 21:47:58.084935 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 21:47:58.092447 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 21:47:58.100670 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 21:47:58.102934 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 21:47:58.110439 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 21:47:58.113398 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 21:47:58.126409 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 21:47:58.137589 (MainThread): Partial parsing not enabled
2022-02-07 21:47:58.239691 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:47:58.323573 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:47:58.399989 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:47:58.429811 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:47:58.450855 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:47:58.486178 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:47:58.539893 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:47:58.570264 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:47:58.588938 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:47:58.612810 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:47:58.758312 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:47:58.781825 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:47:58.810283 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:47:58.843604 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:47:58.859005 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:47:58.870784 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 21:47:58.880723 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:47:59.644773 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.prestage
- models.project_otus_dbt.report

2022-02-07 21:47:59.812281 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 21:47:59.815230 (MainThread): Found 17 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 21:47:59.819363 (MainThread): 
2022-02-07 21:47:59.821114 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:47:59.879676 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 21:47:59.908789 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 21:47:59.909213 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 21:47:59.909613 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 21:47:59.936808 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.03 seconds
2022-02-07 21:47:59.943902 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 21:48:00.022393 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 21:48:00.031932 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:48:00.032193 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 21:48:00.032307 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 21:48:00.046410 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:48:00.046689 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:48:00.046865 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 21:48:00.051475 (ThreadPoolExecutor-1_0): SQL status: SELECT 21 in 0.00 seconds
2022-02-07 21:48:00.074926 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 21:48:00.076831 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 21:48:00.119122 (MainThread): Using postgres connection "master".
2022-02-07 21:48:00.119387 (MainThread): On master: BEGIN
2022-02-07 21:48:00.119610 (MainThread): Opening a new connection, currently in state init
2022-02-07 21:48:00.130351 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:48:00.130614 (MainThread): Using postgres connection "master".
2022-02-07 21:48:00.130758 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 21:48:00.446867 (MainThread): SQL status: SELECT 12 in 0.32 seconds
2022-02-07 21:48:00.461677 (MainThread): On master: ROLLBACK
2022-02-07 21:48:00.463041 (MainThread): Using postgres connection "master".
2022-02-07 21:48:00.463322 (MainThread): On master: BEGIN
2022-02-07 21:48:00.465733 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:48:00.466143 (MainThread): On master: COMMIT
2022-02-07 21:48:00.466384 (MainThread): Using postgres connection "master".
2022-02-07 21:48:00.466575 (MainThread): On master: COMMIT
2022-02-07 21:48:00.467818 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:48:00.468102 (MainThread): On master: Close
2022-02-07 21:48:00.468707 (MainThread): 00:48:00 | Concurrency: 2 threads (target='dev')
2022-02-07 21:48:00.469193 (MainThread): 00:48:00 | 
2022-02-07 21:48:00.483077 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:48:00.483446 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:48:00.485006 (Thread-1): 00:48:00 | 1 of 16 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-07 21:48:00.486723 (Thread-2): 00:48:00 | 2 of 16 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-07 21:48:00.487739 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:48:00.488679 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:48:00.489066 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:48:00.489534 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:48:00.548865 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:48:00.549161 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:48:00.549533 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-07 21:48:00.549970 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 21:48:00.550325 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:48:00.550610 (Thread-2): Opening a new connection, currently in state init
2022-02-07 21:48:00.562531 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:48:00.562772 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:48:00.563011 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:48:00.563243 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:48:00.563459 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:00.563683 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:00.575292 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-07 21:48:00.580980 (Thread-2): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 21:48:00.591972 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:48:00.595585 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:48:00.595893 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:00.596166 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:00.601110 (Thread-1): SQL status: SELECT 6 in 0.00 seconds
2022-02-07 21:48:00.601464 (Thread-2): SQL status: SELECT 18 in 0.00 seconds
2022-02-07 21:48:00.718625 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:48:00.739665 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:48:00.740327 (Thread-2): finished collecting timing info
2022-02-07 21:48:00.740891 (Thread-1): finished collecting timing info
2022-02-07 21:48:00.806824 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:48:00.807446 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:48:00.807768 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 21:48:00.808203 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 21:48:00.810318 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:48:00.810584 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:48:00.814184 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:48:00.818166 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:48:00.818615 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:48:00.818898 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:48:00.821009 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:48:00.821270 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:48:00.828793 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:48:00.830673 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:48:00.831674 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:48:00.831989 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:48:00.832411 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:48:00.832879 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:48:00.837588 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 21:48:00.844376 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:48:00.847946 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:48:00.854303 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:48:00.854652 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-07 21:48:00.854975 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-07 21:48:00.857484 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:48:00.863171 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 21:48:00.865371 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:48:00.871741 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:48:00.872336 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-07 21:48:00.872786 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 21:48:00.875092 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:48:00.875423 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:48:00.896903 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:48:00.903456 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:48:00.904311 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:48:00.904624 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:48:00.905006 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:48:00.905566 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:48:00.908587 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:48:00.915024 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:48:00.917778 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:48:00.924275 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:48:00.924652 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:48:00.925057 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:48:00.929556 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:48:00.934853 (Thread-2): finished collecting timing info
2022-02-07 21:48:00.935418 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:48:00.935799 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 21:48:00.940111 (Thread-1): finished collecting timing info
2022-02-07 21:48:00.941076 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-07 21:48:00.945397 (Thread-2): 00:48:00 | 2 of 16 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.45s]
2022-02-07 21:48:00.952247 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:48:00.953220 (Thread-1): 00:48:00 | 1 of 16 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.46s]
2022-02-07 21:48:00.953960 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:48:00.955782 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:48:00.958820 (Thread-2): 00:48:00 | 3 of 16 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-07 21:48:00.959576 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:48:00.961860 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:48:00.964412 (Thread-1): 00:48:00 | 4 of 16 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-07 21:48:00.965536 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:48:00.968845 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:48:00.985066 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:48:01.019873 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:48:01.025420 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-07 21:48:01.029548 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:48:01.029857 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:48:01.030200 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 21:48:01.030770 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:48:01.044632 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:48:01.045016 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:48:01.045244 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:01.045483 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:48:01.045915 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:48:01.046117 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:01.058173 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:48:01.065186 (Thread-2): SQL status: SELECT 7 in 0.02 seconds
2022-02-07 21:48:01.066090 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:48:01.073292 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:48:01.073564 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:01.073813 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:01.078804 (Thread-1): SQL status: SELECT 7 in 0.00 seconds
2022-02-07 21:48:01.089881 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:48:01.090203 (Thread-2): SQL status: SELECT 7 in 0.02 seconds
2022-02-07 21:48:01.099294 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:48:01.100065 (Thread-1): finished collecting timing info
2022-02-07 21:48:01.109792 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:48:01.110061 (Thread-2): finished collecting timing info
2022-02-07 21:48:01.110529 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 21:48:01.122226 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:48:01.122505 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-07 21:48:01.122970 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:48:01.126536 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:48:01.126800 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:48:01.127061 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:48:01.132962 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:48:01.133437 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:48:01.134605 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:48:01.134911 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:48:01.136307 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:48:01.137991 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:48:01.139235 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:48:01.139616 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:48:01.139825 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:48:01.140073 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:48:01.145087 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 21:48:01.151171 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:48:01.152889 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:48:01.161194 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:48:01.161507 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-07 21:48:01.162071 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-07 21:48:01.164347 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:48:01.164656 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:48:01.170257 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:48:01.174244 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:48:01.174682 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-07 21:48:01.174985 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-07 21:48:01.177215 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:48:01.177581 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:48:01.179387 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:48:01.181286 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:48:01.181707 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:48:01.182100 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:48:01.182459 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:48:01.182796 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:48:01.186249 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:48:01.186797 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:48:01.189510 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:48:01.193943 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:48:01.194386 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:48:01.194754 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:48:01.198936 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:48:01.203001 (Thread-2): finished collecting timing info
2022-02-07 21:48:01.203434 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:48:01.203708 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-07 21:48:01.210150 (Thread-1): finished collecting timing info
2022-02-07 21:48:01.213014 (Thread-2): 00:48:01 | 3 of 16 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.25s]
2022-02-07 21:48:01.213522 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 21:48:01.214133 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:48:01.217919 (Thread-1): 00:48:01 | 4 of 16 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.25s]
2022-02-07 21:48:01.218436 (Thread-2): Began running node model.project_otus_dbt.dim_day
2022-02-07 21:48:01.219871 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:48:01.221357 (Thread-2): 00:48:01 | 5 of 16 START table model public.dim_day............................. [RUN]
2022-02-07 21:48:01.221850 (Thread-1): Began running node model.project_otus_dbt.dim_week
2022-02-07 21:48:01.223345 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:48:01.226724 (Thread-1): 00:48:01 | 6 of 16 START table model public.dim_week............................ [RUN]
2022-02-07 21:48:01.227290 (Thread-2): Compiling model.project_otus_dbt.dim_day
2022-02-07 21:48:01.228726 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:48:01.236619 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:48:01.237193 (Thread-1): Compiling model.project_otus_dbt.dim_week
2022-02-07 21:48:01.247103 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:48:01.247861 (Thread-2): finished collecting timing info
2022-02-07 21:48:01.253653 (Thread-1): finished collecting timing info
2022-02-07 21:48:01.300275 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:48:01.305729 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-07 21:48:01.306989 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:48:01.307227 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:48:01.307439 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-07 21:48:01.307880 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:48:01.319192 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:48:01.324179 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:48:01.324601 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:48:01.326002 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:48:01.332257 (Thread-2): SQL status: DROP TABLE in 0.03 seconds
2022-02-07 21:48:01.335635 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:48:01.340551 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:48:01.341462 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:48:01.342194 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:48:01.342591 (Thread-1): On model.project_otus_dbt.dim_week: BEGIN
2022-02-07 21:48:01.343493 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:48:01.346052 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:48:01.346341 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:48:01.346836 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:48:01.347085 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-07 21:48:01.348073 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:48:01.348516 (Thread-2): On model.project_otus_dbt.dim_day: BEGIN
2022-02-07 21:48:01.350113 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:48:01.350540 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:48:01.350843 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 day')
        as t(date)
        )

select * from dim_day
order by date desc
  );
2022-02-07 21:48:01.358873 (Thread-1): SQL status: SELECT 731 in 0.01 seconds
2022-02-07 21:48:01.366548 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:48:01.366912 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-07 21:48:01.368602 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:48:01.373708 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:48:01.374022 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-07 21:48:01.375719 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:48:01.378994 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:48:01.379842 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:48:01.380382 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:48:01.385899 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:48:01.390947 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:48:01.391282 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:48:01.401400 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:48:01.406940 (Thread-1): finished collecting timing info
2022-02-07 21:48:01.408329 (Thread-1): On model.project_otus_dbt.dim_week: Close
2022-02-07 21:48:01.418263 (Thread-1): 00:48:01 | 6 of 16 OK created table model public.dim_week....................... [SELECT 731 in 0.18s]
2022-02-07 21:48:01.419773 (Thread-1): Finished running node model.project_otus_dbt.dim_week
2022-02-07 21:48:01.420893 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:48:01.427480 (Thread-1): 00:48:01 | 7 of 16 START incremental model public.hub_wheat_msk................. [RUN]
2022-02-07 21:48:01.428948 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:48:01.429653 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:48:01.441952 (Thread-2): SQL status: SELECT 5114 in 0.09 seconds
2022-02-07 21:48:01.468728 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:48:01.474371 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-07 21:48:01.479222 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:48:01.480472 (Thread-1): finished collecting timing info
2022-02-07 21:48:01.492005 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 21:48:01.514333 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:48:01.514863 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-07 21:48:01.528614 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 21:48:01.531841 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:48:01.545799 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:48:01.546252 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:48:01.571188 (Thread-2): SQL status: COMMIT in 0.02 seconds
2022-02-07 21:48:01.603144 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:48:01.608867 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:48:01.636162 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 21:48:01.650715 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:48:01.652290 (Thread-2): finished collecting timing info
2022-02-07 21:48:01.652981 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp004801626424"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:48:01.653533 (Thread-2): On model.project_otus_dbt.dim_day: Close
2022-02-07 21:48:01.653953 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:48:01.661946 (Thread-2): 00:48:01 | 5 of 16 OK created table model public.dim_day........................ [SELECT 5114 in 0.43s]
2022-02-07 21:48:01.662510 (Thread-2): Finished running node model.project_otus_dbt.dim_day
2022-02-07 21:48:01.663050 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:48:01.666385 (Thread-2): 00:48:01 | 8 of 16 START incremental model public.sat_wheat_msk_details......... [RUN]
2022-02-07 21:48:01.667223 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:48:01.667654 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:48:01.700930 (Thread-1): SQL status: SELECT 0 in 0.05 seconds
2022-02-07 21:48:01.719799 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:48:01.725113 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:48:01.725727 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-07 21:48:01.726948 (Thread-2): finished collecting timing info
2022-02-07 21:48:01.733460 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:48:01.739199 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:48:01.743842 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:48:01.744388 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp004801626424'
        
      order by ordinal_position

  
2022-02-07 21:48:01.744882 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp004801741316"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:48:01.745514 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:48:01.759148 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:48:01.768150 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:48:01.768629 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:01.775243 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:48:01.781565 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 21:48:01.796033 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:48:01.796829 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:48:01.797099 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:01.797405 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-07 21:48:01.799244 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:48:01.799706 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:48:01.799986 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp004801741316'
        
      order by ordinal_position

  
2022-02-07 21:48:01.802874 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:48:01.804321 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:48:01.804897 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:48:01.805116 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp004801626424"
    );
  
2022-02-07 21:48:01.806892 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:48:01.808442 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:48:01.808678 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:48:01.808763 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:48:01.811280 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:48:01.811553 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:48:01.817059 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:48:01.820077 (Thread-1): finished collecting timing info
2022-02-07 21:48:01.820559 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:01.820995 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-07 21:48:01.824514 (Thread-1): 00:48:01 | 7 of 16 OK created incremental model public.hub_wheat_msk............ [INSERT 0 0 in 0.39s]
2022-02-07 21:48:01.824971 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:48:01.825397 (Thread-1): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 21:48:01.828342 (Thread-1): 00:48:01 | 9 of 16 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-07 21:48:01.829278 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:48:01.829669 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:48:01.829931 (Thread-1): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 21:48:01.839383 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:48:01.850372 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:01.853260 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 21:48:01.854030 (Thread-1): finished collecting timing info
2022-02-07 21:48:01.863452 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 21:48:01.863810 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:48:01.868547 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:48:01.869348 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:48:01.870255 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-07 21:48:01.870775 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:48:01.871260 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:48:01.872043 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp004801741316"
    );
  
2022-02-07 21:48:01.874119 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:48:01.875945 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:48:01.876270 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:48:01.876706 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:48:01.879269 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:48:01.882735 (Thread-2): finished collecting timing info
2022-02-07 21:48:01.883204 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-07 21:48:01.886041 (Thread-2): 00:48:01 | 8 of 16 OK created incremental model public.sat_wheat_msk_details.... [INSERT 0 0 in 0.22s]
2022-02-07 21:48:01.886734 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:48:01.887398 (Thread-2): Began running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:48:01.891409 (Thread-2): 00:48:01 | 10 of 16 START incremental model public.link_wheat_gbp_rate.......... [RUN]
2022-02-07 21:48:01.892479 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:48:01.893839 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:48:01.894263 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:48:01.894873 (Thread-2): Compiling model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:48:01.895437 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

  create  table "postgres"."public"."hub_rate_gbp_usd"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:48:01.914456 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:48:01.915451 (Thread-2): finished collecting timing info
2022-02-07 21:48:01.924449 (Thread-1): SQL status: SELECT 548 in 0.02 seconds
2022-02-07 21:48:01.927184 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:48:01.928882 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 21:48:01.929605 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:48:01.929906 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 21:48:01.930468 (Thread-2): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:48:01.930812 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: BEGIN
2022-02-07 21:48:01.931045 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:48:01.934270 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:48:01.938607 (Thread-1): finished collecting timing info
2022-02-07 21:48:01.939025 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-07 21:48:01.941510 (Thread-1): 00:48:01 | 9 of 16 OK created incremental model public.hub_rate_gbp_usd......... [SELECT 548 in 0.11s]
2022-02-07 21:48:01.941950 (Thread-1): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 21:48:01.942433 (Thread-1): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 21:48:01.945482 (Thread-1): 00:48:01 | 11 of 16 START incremental model public.sat_rate_gbp_usd_details..... [RUN]
2022-02-07 21:48:01.945822 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:48:01.946671 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:48:01.946959 (Thread-2): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:48:01.947320 (Thread-1): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 21:48:01.947612 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.link_wheat_gbp_rate"} */

      

  create  table "postgres"."public"."link_wheat_gbp_rate"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (
   
SELECT * FROM (
    SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY LINK_DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as l
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.LINK_DATE_PK, a.DATE_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:48:01.966283 (Thread-2): Postgres error: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^

2022-02-07 21:48:01.977128 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: ROLLBACK
2022-02-07 21:48:01.979239 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 21:48:01.980373 (Thread-1): finished collecting timing info
2022-02-07 21:48:01.986242 (Thread-2): finished collecting timing info
2022-02-07 21:48:01.992016 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: Close
2022-02-07 21:48:01.997372 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:48:01.999162 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp004801995101"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:48:02.000207 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:48:01.998271 (Thread-2): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 132, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:48:02.007552 (Thread-2): 00:48:01 | 10 of 16 ERROR creating incremental model public.link_wheat_gbp_rate. [ERROR in 0.11s]
2022-02-07 21:48:02.008075 (Thread-2): Finished running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:48:02.008592 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:48:02.011351 (Thread-2): 00:48:02 | 12 of 16 START incremental model public.hub_wheat_gbp................ [RUN]
2022-02-07 21:48:02.012198 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:48:02.012673 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:48:02.040032 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:48:02.040483 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 21:48:02.046809 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:48:02.047090 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-07 21:48:02.047490 (Thread-2): finished collecting timing info
2022-02-07 21:48:02.054001 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:48:02.059687 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:48:02.062892 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:48:02.063179 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp004801995101'
        
      order by ordinal_position

  
2022-02-07 21:48:02.063466 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp004802060361"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:48:02.063887 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:48:02.076506 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:48:02.082507 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:48:02.082790 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:02.088611 (Thread-2): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 21:48:02.093568 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:48:02.093844 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:48:02.094076 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-07 21:48:02.103354 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:48:02.103849 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:02.105337 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:48:02.105671 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:48:02.105905 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp004802060361'
        
      order by ordinal_position

  
2022-02-07 21:48:02.109958 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:48:02.111868 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 21:48:02.112587 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:48:02.112794 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp004801995101"
    );
  
2022-02-07 21:48:02.114490 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:48:02.116766 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 21:48:02.117245 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:48:02.117758 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:48:02.126170 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:48:02.126608 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 21:48:02.126980 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:02.130503 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:48:02.134544 (Thread-1): finished collecting timing info
2022-02-07 21:48:02.134974 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:48:02.135288 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-07 21:48:02.142232 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:48:02.142672 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:02.144545 (Thread-1): 00:48:02 | 11 of 16 OK created incremental model public.sat_rate_gbp_usd_details [INSERT 0 0 in 0.20s]
2022-02-07 21:48:02.145089 (Thread-1): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 21:48:02.145505 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:48:02.148888 (Thread-1): 00:48:02 | 13 of 16 START incremental model public.sat_wheat_gbp_details........ [RUN]
2022-02-07 21:48:02.150224 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:48:02.152124 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:48:02.152750 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:48:02.165487 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:48:02.185213 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:48:02.186234 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:48:02.186816 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp004802060361"
    );
  
2022-02-07 21:48:02.187363 (Thread-1): finished collecting timing info
2022-02-07 21:48:02.194076 (Thread-2): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-07 21:48:02.202570 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:48:02.206465 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:48:02.206757 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:48:02.207070 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp004802203604"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:48:02.207413 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:48:02.207911 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:48:02.211195 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:48:02.214886 (Thread-2): finished collecting timing info
2022-02-07 21:48:02.215510 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-07 21:48:02.221267 (Thread-2): 00:48:02 | 12 of 16 OK created incremental model public.hub_wheat_gbp........... [INSERT 0 0 in 0.20s]
2022-02-07 21:48:02.222085 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:48:02.222860 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:48:02.226584 (Thread-2): 00:48:02 | 14 of 16 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-07 21:48:02.227595 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:48:02.228075 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:48:02.251568 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 21:48:02.252925 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:48:02.332758 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:48:02.333263 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-07 21:48:02.333889 (Thread-2): finished collecting timing info
2022-02-07 21:48:02.340253 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:48:02.345159 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:48:02.345393 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:48:02.345624 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp004802343557"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:48:02.345887 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp004802203604'
        
      order by ordinal_position

  
2022-02-07 21:48:02.346130 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:48:02.355085 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:48:02.360243 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:48:02.360568 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:02.364996 (Thread-1): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:48:02.371399 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:48:02.371628 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:48:02.371832 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:02.376346 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:48:02.376811 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-07 21:48:02.378009 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:48:02.378232 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:48:02.378312 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp004802343557'
        
      order by ordinal_position

  
2022-02-07 21:48:02.381225 (Thread-1): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:48:02.382785 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:48:02.383311 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:48:02.383464 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp004802203604"
    );
  
2022-02-07 21:48:02.385181 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:48:02.386700 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:48:02.386956 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:48:02.387126 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:48:02.391552 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:48:02.391893 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:48:02.392109 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:02.394677 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:48:02.397055 (Thread-1): finished collecting timing info
2022-02-07 21:48:02.397386 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:48:02.397600 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-07 21:48:02.403354 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:48:02.403664 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:02.405740 (Thread-1): 00:48:02 | 13 of 16 OK created incremental model public.sat_wheat_gbp_details... [INSERT 0 0 in 0.25s]
2022-02-07 21:48:02.406299 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:48:02.406754 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:48:02.409386 (Thread-1): 00:48:02 | 15 of 16 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-07 21:48:02.410125 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:48:02.410557 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:48:02.416501 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:48:02.431622 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:48:02.433162 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:48:02.434370 (Thread-1): finished collecting timing info
2022-02-07 21:48:02.440256 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:48:02.445707 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:48:02.445969 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp004802343557"
    );
  
2022-02-07 21:48:02.446308 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp004802443780"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:48:02.446766 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:48:02.448774 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:48:02.451127 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:48:02.451563 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:48:02.451927 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:48:02.454445 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:48:02.457385 (Thread-2): finished collecting timing info
2022-02-07 21:48:02.457859 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-07 21:48:02.460293 (Thread-2): 00:48:02 | 14 of 16 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.23s]
2022-02-07 21:48:02.460654 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:48:02.461007 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:48:02.462568 (Thread-2): 00:48:02 | 16 of 16 START view model public.dds_wheat_msk....................... [RUN]
2022-02-07 21:48:02.463375 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:48:02.464015 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:48:02.476764 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:48:02.478308 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 21:48:02.491052 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:48:02.491406 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-07 21:48:02.492274 (Thread-2): finished collecting timing info
2022-02-07 21:48:02.493012 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:48:02.503847 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:48:02.506269 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:48:02.506574 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp004802443780'
        
      order by ordinal_position

  
2022-02-07 21:48:02.506831 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-07 21:48:02.507227 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:48:02.521716 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:48:02.530022 (Thread-1): SQL status: SELECT 11 in 0.02 seconds
2022-02-07 21:48:02.530568 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:48:02.540280 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:48:02.540558 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 21:48:02.540806 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:02.542294 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:48:02.544233 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 21:48:02.544890 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:48:02.545110 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-07 21:48:02.546039 (Thread-1): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:48:02.551663 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:48:02.552574 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:48:02.552802 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:48:02.553126 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:48:02.553344 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */

  create view "postgres"."public"."dds_wheat_msk__dbt_tmp" as (
    with dds_wheat_msk as(
    select sm.tradedate  as tradedate
        ,cast(sm.value as decimal(18,2)) as value
        ,cast(sm.open as decimal(18,2)) as open
        ,cast(sm.close as decimal(18,2)) as close
        ,cast(sm.high as decimal(18,2)) as high
        ,cast(sm.low as decimal(18,2)) as low
        ,cast(sm.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hm
    left join "postgres"."public"."sat_wheat_msk_details" as sm
    on hm.date_pk=sm.date_pk
)
select * from dds_wheat_msk
  );

2022-02-07 21:48:02.557828 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 21:48:02.558098 (Thread-1): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:48:02.563937 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:48:02.565584 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:48:02.565954 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-07 21:48:02.566697 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:48:02.566920 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp004802443780"
    );
  
2022-02-07 21:48:02.568245 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:48:02.568563 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:48:02.572713 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:48:02.574520 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:48:02.575089 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-07 21:48:02.575474 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:48:02.575930 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:48:02.577594 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:48:02.579357 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 21:48:02.579710 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:48:02.579944 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:48:02.582455 (Thread-1): finished collecting timing info
2022-02-07 21:48:02.582936 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 21:48:02.583225 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-07 21:48:02.585787 (Thread-1): 00:48:02 | 15 of 16 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.17s]
2022-02-07 21:48:02.586106 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:48:02.586495 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:48:02.590485 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:48:02.591524 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 21:48:02.594966 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:48:02.598476 (Thread-2): finished collecting timing info
2022-02-07 21:48:02.598887 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-07 21:48:02.600971 (Thread-2): 00:48:02 | 16 of 16 OK created view model public.dds_wheat_msk.................. [CREATE VIEW in 0.14s]
2022-02-07 21:48:02.601312 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:48:02.603870 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:48:02.604211 (MainThread): Using postgres connection "master".
2022-02-07 21:48:02.604419 (MainThread): On master: BEGIN
2022-02-07 21:48:02.604608 (MainThread): Opening a new connection, currently in state closed
2022-02-07 21:48:02.617943 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:48:02.618531 (MainThread): On master: COMMIT
2022-02-07 21:48:02.618937 (MainThread): Using postgres connection "master".
2022-02-07 21:48:02.619241 (MainThread): On master: COMMIT
2022-02-07 21:48:02.620759 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:48:02.621276 (MainThread): On master: Close
2022-02-07 21:48:02.622280 (MainThread): 00:48:02 | 
2022-02-07 21:48:02.622635 (MainThread): 00:48:02 | Finished running 5 view models, 2 table models, 9 incremental models in 2.80s.
2022-02-07 21:48:02.622947 (MainThread): Connection 'master' was properly closed.
2022-02-07 21:48:02.623146 (MainThread): Connection 'model.project_otus_dbt.sat_wheat_usa_details' was properly closed.
2022-02-07 21:48:02.623309 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_msk' was properly closed.
2022-02-07 21:48:02.739845 (MainThread): 
2022-02-07 21:48:02.740081 (MainThread): Completed with 1 error and 0 warnings:
2022-02-07 21:48:02.740233 (MainThread): 
2022-02-07 21:48:02.740381 (MainThread): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
2022-02-07 21:48:02.740515 (MainThread):   column "link_date_pk" does not exist
2022-02-07 21:48:02.740663 (MainThread):   LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
2022-02-07 21:48:02.740882 (MainThread):                       ^
2022-02-07 21:48:02.741124 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:48:02.741420 (MainThread): 
Done. PASS=15 WARN=0 ERROR=1 SKIP=0 TOTAL=16
2022-02-07 21:48:02.741756 (MainThread): Flushing usage events
2022-02-07 21:50:14.931929 (MainThread): Running with dbt=0.19.0
2022-02-07 21:50:15.040947 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 21:50:15.042417 (MainThread): Tracking: do not track
2022-02-07 21:50:15.126030 (MainThread): Partial parsing not enabled
2022-02-07 21:50:15.127180 (MainThread): Parsing macros/adapters.sql
2022-02-07 21:50:15.149109 (MainThread): Parsing macros/catalog.sql
2022-02-07 21:50:15.151509 (MainThread): Parsing macros/relations.sql
2022-02-07 21:50:15.152861 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 21:50:15.155092 (MainThread): Parsing macros/core.sql
2022-02-07 21:50:15.158583 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 21:50:15.238944 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 21:50:15.243164 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 21:50:15.245236 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 21:50:15.256071 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 21:50:15.258283 (MainThread): Parsing macros/etc/query.sql
2022-02-07 21:50:15.259987 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 21:50:15.261369 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 21:50:15.271394 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 21:50:15.292107 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 21:50:15.294876 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 21:50:15.348191 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 21:50:15.377866 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 21:50:15.387153 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 21:50:15.390016 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 21:50:15.408565 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 21:50:15.414449 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 21:50:15.421852 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 21:50:15.428756 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 21:50:15.430669 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 21:50:15.432539 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 21:50:15.434917 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 21:50:15.440035 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 21:50:15.442215 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 21:50:15.444480 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 21:50:15.445742 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 21:50:15.459543 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 21:50:15.463069 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 21:50:15.465928 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 21:50:15.471083 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 21:50:15.472917 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 21:50:15.476380 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 21:50:15.480385 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 21:50:15.482673 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 21:50:15.485530 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 21:50:15.489223 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 21:50:15.496716 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 21:50:15.502037 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 21:50:15.506490 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 21:50:15.508585 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 21:50:15.511105 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 21:50:15.513637 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 21:50:15.515729 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 21:50:15.523340 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 21:50:15.524758 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 21:50:15.526388 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 21:50:15.528722 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 21:50:15.531738 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 21:50:15.533735 (MainThread): Parsing macros/sql/star.sql
2022-02-07 21:50:15.538080 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 21:50:15.540037 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 21:50:15.544597 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 21:50:15.546555 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 21:50:15.554970 (MainThread): Parsing macros/sql/union.sql
2022-02-07 21:50:15.564903 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 21:50:15.567235 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 21:50:15.573777 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 21:50:15.578026 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 21:50:15.582419 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 21:50:15.591084 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 21:50:15.596610 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 21:50:15.598617 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 21:50:15.600813 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 21:50:15.604252 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 21:50:15.610657 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 21:50:15.613202 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 21:50:15.615692 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 21:50:15.618091 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 21:50:15.654976 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 21:50:15.657173 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 21:50:15.659952 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 21:50:15.662227 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 21:50:15.664261 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 21:50:15.673367 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 21:50:15.681171 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 21:50:15.686810 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 21:50:15.690235 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 21:50:15.693435 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 21:50:15.697132 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 21:50:15.702620 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 21:50:15.705986 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 21:50:15.713758 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 21:50:15.717424 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 21:50:15.722443 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 21:50:15.723674 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 21:50:15.726645 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 21:50:15.730329 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 21:50:15.735909 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 21:50:15.745098 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 21:50:15.748527 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 21:50:15.749163 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 21:50:15.760199 (MainThread): Parsing macros/tables/link.sql
2022-02-07 21:50:15.771428 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 21:50:15.784358 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 21:50:15.793317 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 21:50:15.797816 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 21:50:15.813529 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 21:50:15.820448 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 21:50:15.855340 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 21:50:15.857980 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 21:50:15.895627 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 21:50:15.906477 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 21:50:15.918439 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 21:50:15.921139 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 21:50:15.930365 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 21:50:15.934152 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 21:50:15.950739 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 21:50:15.966167 (MainThread): Partial parsing not enabled
2022-02-07 21:50:16.072678 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:50:16.156028 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:50:16.222433 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:50:16.250996 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:50:16.274730 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:50:16.300056 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:50:16.341236 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:50:16.364600 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:50:16.388459 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:50:16.406095 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:50:16.529221 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:50:16.549519 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:50:16.569409 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:50:16.589983 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:50:16.600687 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:50:16.610103 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 21:50:16.620992 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:50:16.638613 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:50:17.567982 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.report
- models.project_otus_dbt.prestage

2022-02-07 21:50:17.740239 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 21:50:17.741181 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 21:50:17.743320 (MainThread): 
2022-02-07 21:50:17.744111 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:50:17.764888 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 21:50:17.780945 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 21:50:17.781223 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 21:50:17.781555 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 21:50:17.795916 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 21:50:17.798700 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 21:50:17.829250 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 21:50:17.836722 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:50:17.836946 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 21:50:17.837039 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 21:50:17.846864 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:50:17.847111 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:50:17.847243 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 21:50:17.851724 (ThreadPoolExecutor-1_0): SQL status: SELECT 22 in 0.00 seconds
2022-02-07 21:50:17.868162 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 21:50:17.869364 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 21:50:17.906029 (MainThread): Using postgres connection "master".
2022-02-07 21:50:17.906313 (MainThread): On master: BEGIN
2022-02-07 21:50:17.906490 (MainThread): Opening a new connection, currently in state init
2022-02-07 21:50:17.916470 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:50:17.916757 (MainThread): Using postgres connection "master".
2022-02-07 21:50:17.916906 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 21:50:18.247392 (MainThread): SQL status: SELECT 12 in 0.33 seconds
2022-02-07 21:50:18.269953 (MainThread): On master: ROLLBACK
2022-02-07 21:50:18.271759 (MainThread): Using postgres connection "master".
2022-02-07 21:50:18.272074 (MainThread): On master: BEGIN
2022-02-07 21:50:18.274790 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:50:18.275099 (MainThread): On master: COMMIT
2022-02-07 21:50:18.275279 (MainThread): Using postgres connection "master".
2022-02-07 21:50:18.275453 (MainThread): On master: COMMIT
2022-02-07 21:50:18.277032 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:50:18.277341 (MainThread): On master: Close
2022-02-07 21:50:18.277952 (MainThread): 00:50:18 | Concurrency: 2 threads (target='dev')
2022-02-07 21:50:18.278301 (MainThread): 00:50:18 | 
2022-02-07 21:50:18.284772 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:50:18.285308 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:50:18.287347 (Thread-1): 00:50:18 | 1 of 17 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-07 21:50:18.288391 (Thread-2): 00:50:18 | 2 of 17 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-07 21:50:18.289329 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:50:18.290048 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:50:18.290386 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:50:18.290856 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:50:18.355182 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:50:18.359304 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:50:18.359637 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 21:50:18.359989 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-07 21:50:18.360241 (Thread-2): Opening a new connection, currently in state init
2022-02-07 21:50:18.360527 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:50:18.373506 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:50:18.373842 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:50:18.374057 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:18.384008 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:50:18.384352 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:50:18.384577 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:18.385308 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-07 21:50:18.455946 (Thread-2): SQL status: SELECT 18 in 0.07 seconds
2022-02-07 21:50:18.459460 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:50:18.467427 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:50:18.467656 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:18.467909 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:18.473277 (Thread-2): SQL status: SELECT 18 in 0.00 seconds
2022-02-07 21:50:18.480065 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:50:18.480307 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-07 21:50:18.485706 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:50:18.486202 (Thread-2): finished collecting timing info
2022-02-07 21:50:18.497184 (Thread-1): finished collecting timing info
2022-02-07 21:50:18.532586 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:50:18.538139 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 21:50:18.538764 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:50:18.539078 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 21:50:18.540467 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:50:18.540723 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:50:18.543659 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:50:18.546830 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:50:18.547133 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:50:18.547315 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:50:18.548931 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:50:18.549131 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:50:18.554228 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:50:18.555934 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:50:18.556860 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:50:18.557098 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:50:18.557401 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:50:18.557761 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:50:18.562632 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 21:50:18.568409 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:50:18.581514 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:50:18.583631 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:50:18.583841 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-07 21:50:18.584083 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-07 21:50:18.586086 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:50:18.589397 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:50:18.589695 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 21:50:18.589957 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-07 21:50:18.592807 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:50:18.593312 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 21:50:18.594842 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:50:18.601193 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 21:50:18.603347 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:50:18.604686 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:50:18.604926 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:50:18.605243 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:50:18.605464 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:50:18.605669 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:50:18.608239 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:50:18.616479 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:50:18.619311 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:50:18.622435 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:50:18.622772 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:50:18.622994 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:50:18.627327 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:50:18.629856 (Thread-1): finished collecting timing info
2022-02-07 21:50:18.630136 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:50:18.630326 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-07 21:50:18.633869 (Thread-2): finished collecting timing info
2022-02-07 21:50:18.634680 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 21:50:18.638002 (Thread-1): 00:50:18 | 1 of 17 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.35s]
2022-02-07 21:50:18.640005 (Thread-2): 00:50:18 | 2 of 17 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.35s]
2022-02-07 21:50:18.640356 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:50:18.640688 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:50:18.641040 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:50:18.641707 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:50:18.644412 (Thread-1): 00:50:18 | 3 of 17 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-07 21:50:18.645888 (Thread-2): 00:50:18 | 4 of 17 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-07 21:50:18.646916 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:50:18.647826 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:50:18.648964 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:50:18.659937 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:50:18.684257 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:50:18.689940 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-07 21:50:18.692629 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:50:18.693047 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:50:18.693325 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 21:50:18.693919 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:50:18.707478 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:50:18.707851 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:50:18.708062 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:50:18.708382 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:50:18.708683 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:18.709006 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:18.724132 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:50:18.724474 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:50:18.733946 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:50:18.741493 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:50:18.741800 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:18.742151 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:18.746955 (Thread-1): SQL status: SELECT 7 in 0.00 seconds
2022-02-07 21:50:18.752947 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:50:18.753605 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:50:18.759219 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:50:18.760330 (Thread-1): finished collecting timing info
2022-02-07 21:50:18.760979 (Thread-2): finished collecting timing info
2022-02-07 21:50:18.777977 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:50:18.781834 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:50:18.782096 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-07 21:50:18.782480 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 21:50:18.784224 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:50:18.784516 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:50:18.788530 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:50:18.793704 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:50:18.794079 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:50:18.794333 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:50:18.795932 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:50:18.796152 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:50:18.797438 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:50:18.799026 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:50:18.800083 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:50:18.800413 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:50:18.800676 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:50:18.800965 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:50:18.806107 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 21:50:18.806392 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:50:18.812992 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:50:18.819253 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:50:18.819619 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-07 21:50:18.819981 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-07 21:50:18.822174 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:50:18.822615 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:50:18.827668 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:50:18.832081 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:50:18.832563 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-07 21:50:18.832902 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-07 21:50:18.835218 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:50:18.835529 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:50:18.837152 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:50:18.838934 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:50:18.839241 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:50:18.839523 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:50:18.839747 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:50:18.839993 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:50:18.842834 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:50:18.845819 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:50:18.846047 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:50:18.846271 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:50:18.849527 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:50:18.849964 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:50:18.853465 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:50:18.856961 (Thread-1): finished collecting timing info
2022-02-07 21:50:18.857305 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:50:18.857533 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-07 21:50:18.860783 (Thread-2): finished collecting timing info
2022-02-07 21:50:18.861509 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 21:50:18.864704 (Thread-1): 00:50:18 | 3 of 17 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.22s]
2022-02-07 21:50:18.867660 (Thread-2): 00:50:18 | 4 of 17 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.22s]
2022-02-07 21:50:18.868209 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:50:18.868986 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:50:18.869370 (Thread-1): Began running node model.project_otus_dbt.dim_day
2022-02-07 21:50:18.870137 (Thread-2): Began running node model.project_otus_dbt.dim_week
2022-02-07 21:50:18.872244 (Thread-1): 00:50:18 | 5 of 17 START table model public.dim_day............................. [RUN]
2022-02-07 21:50:18.874111 (Thread-2): 00:50:18 | 6 of 17 START table model public.dim_week............................ [RUN]
2022-02-07 21:50:18.875235 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:50:18.875899 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:50:18.876184 (Thread-1): Compiling model.project_otus_dbt.dim_day
2022-02-07 21:50:18.876437 (Thread-2): Compiling model.project_otus_dbt.dim_week
2022-02-07 21:50:18.883331 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:50:18.891539 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:50:18.892164 (Thread-2): finished collecting timing info
2022-02-07 21:50:18.892513 (Thread-1): finished collecting timing info
2022-02-07 21:50:18.928001 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:50:18.933504 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-07 21:50:18.939059 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:50:18.942697 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:50:18.943212 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-07 21:50:18.943371 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:50:18.954278 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:50:18.954612 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 21:50:18.958780 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:50:18.962764 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:50:18.963266 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:50:18.963680 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:50:18.965644 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:50:18.966054 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:50:18.976372 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:50:18.978125 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:50:18.979208 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:50:18.979503 (Thread-2): On model.project_otus_dbt.dim_week: BEGIN
2022-02-07 21:50:18.979799 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:50:18.980135 (Thread-1): On model.project_otus_dbt.dim_day: BEGIN
2022-02-07 21:50:18.981342 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:50:18.981562 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:50:18.981793 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:50:18.982098 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:50:18.982320 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-07 21:50:18.982559 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 day')
        as t(date)
        )

select * from dim_day
order by date desc
  );
2022-02-07 21:50:18.994943 (Thread-2): SQL status: SELECT 731 in 0.01 seconds
2022-02-07 21:50:19.000730 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:50:19.000946 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-07 21:50:19.002364 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:50:19.005282 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:50:19.005480 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-07 21:50:19.006949 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:50:19.008813 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:50:19.009074 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:50:19.009233 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:50:19.012182 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:50:19.015602 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:50:19.015854 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:50:19.023231 (Thread-1): SQL status: SELECT 5114 in 0.04 seconds
2022-02-07 21:50:19.023668 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:50:19.028776 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:50:19.031847 (Thread-2): finished collecting timing info
2022-02-07 21:50:19.032294 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-07 21:50:19.032549 (Thread-2): On model.project_otus_dbt.dim_week: Close
2022-02-07 21:50:19.034492 (Thread-2): 00:50:19 | 6 of 17 OK created table model public.dim_week....................... [SELECT 731 in 0.16s]
2022-02-07 21:50:19.034709 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:50:19.035049 (Thread-2): Finished running node model.project_otus_dbt.dim_week
2022-02-07 21:50:19.039236 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:50:19.039916 (Thread-2): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 21:50:19.040520 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-07 21:50:19.042133 (Thread-2): 00:50:19 | 7 of 17 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-07 21:50:19.043104 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:50:19.043492 (Thread-2): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 21:50:19.049568 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 21:50:19.056816 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:50:19.059694 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 21:50:19.060041 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:50:19.060530 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:50:19.061029 (Thread-2): finished collecting timing info
2022-02-07 21:50:19.071634 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:50:19.081881 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:50:19.087433 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:50:19.103763 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:50:19.104317 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:50:19.108039 (Thread-1): finished collecting timing info
2022-02-07 21:50:19.108470 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp005019099818"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:50:19.108731 (Thread-1): On model.project_otus_dbt.dim_day: Close
2022-02-07 21:50:19.108988 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:50:19.111258 (Thread-1): 00:50:19 | 5 of 17 OK created table model public.dim_day........................ [SELECT 5114 in 0.23s]
2022-02-07 21:50:19.112108 (Thread-1): Finished running node model.project_otus_dbt.dim_day
2022-02-07 21:50:19.112607 (Thread-1): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 21:50:19.114744 (Thread-1): 00:50:19 | 8 of 17 START incremental model public.sat_rate_gbp_usd_details...... [RUN]
2022-02-07 21:50:19.115609 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:50:19.116038 (Thread-1): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 21:50:19.141595 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 21:50:19.141878 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:50:19.146690 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:50:19.147037 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-07 21:50:19.147269 (Thread-1): finished collecting timing info
2022-02-07 21:50:19.154156 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:50:19.157906 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:50:19.158157 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:50:19.158385 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp005019156268"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:50:19.158679 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp005019099818'
        
      order by ordinal_position

  
2022-02-07 21:50:19.158906 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:50:19.168871 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:50:19.173844 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:50:19.174083 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.178678 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:50:19.186832 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:50:19.187125 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:50:19.187355 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.194786 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:50:19.195206 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-07 21:50:19.196614 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:50:19.196863 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:50:19.196998 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp005019156268'
        
      order by ordinal_position

  
2022-02-07 21:50:19.200240 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:50:19.201322 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 21:50:19.201808 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:50:19.201981 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp005019099818"
    );
  
2022-02-07 21:50:19.203349 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:50:19.204814 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 21:50:19.205051 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:50:19.205208 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 21:50:19.207289 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:50:19.207602 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:50:19.211853 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:50:19.215116 (Thread-2): finished collecting timing info
2022-02-07 21:50:19.215632 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.215914 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-07 21:50:19.218288 (Thread-2): 00:50:19 | 7 of 17 OK created incremental model public.hub_rate_gbp_usd......... [INSERT 0 0 in 0.17s]
2022-02-07 21:50:19.218662 (Thread-2): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 21:50:19.219022 (Thread-2): Began running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:50:19.221082 (Thread-2): 00:50:19 | 9 of 17 START incremental model public.link_wheat_gbp_rate........... [RUN]
2022-02-07 21:50:19.221794 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:50:19.222254 (Thread-2): Compiling model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:50:19.222712 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:50:19.240438 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:50:19.241028 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:50:19.241427 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.241912 (Thread-2): finished collecting timing info
2022-02-07 21:50:19.249075 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:50:19.249352 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:50:19.251722 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 21:50:19.252399 (Thread-2): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:50:19.252544 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: BEGIN
2022-02-07 21:50:19.252787 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:50:19.253218 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:50:19.253399 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp005019156268"
    );
  
2022-02-07 21:50:19.254816 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:50:19.256081 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 21:50:19.256285 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:50:19.256365 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 21:50:19.258555 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:50:19.260891 (Thread-1): finished collecting timing info
2022-02-07 21:50:19.261248 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-07 21:50:19.263208 (Thread-1): 00:50:19 | 8 of 17 OK created incremental model public.sat_rate_gbp_usd_details. [INSERT 0 0 in 0.15s]
2022-02-07 21:50:19.263625 (Thread-1): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 21:50:19.263934 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:50:19.266189 (Thread-1): 00:50:19 | 10 of 17 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-07 21:50:19.266623 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:50:19.267696 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:50:19.268150 (Thread-2): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:50:19.268573 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:50:19.268851 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.link_wheat_gbp_rate"} */

      

  create  table "postgres"."public"."link_wheat_gbp_rate"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (
   
SELECT * FROM (
    SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY LINK_DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as l
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.LINK_DATE_PK, a.DATE_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:50:19.281708 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:50:19.281953 (Thread-2): Postgres error: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^

2022-02-07 21:50:19.282320 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: ROLLBACK
2022-02-07 21:50:19.282663 (Thread-1): finished collecting timing info
2022-02-07 21:50:19.288783 (Thread-2): finished collecting timing info
2022-02-07 21:50:19.292845 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:50:19.293307 (Thread-2): On model.project_otus_dbt.link_wheat_gbp_rate: Close
2022-02-07 21:50:19.293684 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp005019290018"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:50:19.294137 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:50:19.294725 (Thread-2): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 132, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:50:19.299163 (Thread-2): 00:50:19 | 9 of 17 ERROR creating incremental model public.link_wheat_gbp_rate.. [ERROR in 0.08s]
2022-02-07 21:50:19.299611 (Thread-2): Finished running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:50:19.299949 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:50:19.302231 (Thread-2): 00:50:19 | 11 of 17 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-07 21:50:19.302978 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:50:19.303262 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:50:19.325194 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:50:19.330633 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:50:19.336411 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:50:19.336892 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-07 21:50:19.337327 (Thread-2): finished collecting timing info
2022-02-07 21:50:19.343636 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:50:19.347052 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:50:19.347312 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:50:19.347562 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp005019345654"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:50:19.347832 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp005019290018'
        
      order by ordinal_position

  
2022-02-07 21:50:19.348083 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:50:19.356014 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:50:19.361922 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:50:19.362287 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.367383 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:50:19.372359 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:50:19.372622 (Thread-2): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 21:50:19.372896 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.378393 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:50:19.378903 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-07 21:50:19.380399 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:50:19.380704 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:50:19.380889 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp005019345654'
        
      order by ordinal_position

  
2022-02-07 21:50:19.382668 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:50:19.383822 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:50:19.384348 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:50:19.384533 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp005019290018"
    );
  
2022-02-07 21:50:19.386044 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:50:19.387797 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:50:19.388073 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:50:19.388274 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:50:19.388543 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:50:19.393485 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:50:19.393716 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:50:19.393964 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.396428 (Thread-1): finished collecting timing info
2022-02-07 21:50:19.396979 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-07 21:50:19.398602 (Thread-1): 00:50:19 | 10 of 17 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.13s]
2022-02-07 21:50:19.398918 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:50:19.399172 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:50:19.401549 (Thread-1): 00:50:19 | 12 of 17 START incremental model public.hub_wheat_gbp................ [RUN]
2022-02-07 21:50:19.402298 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:50:19.402684 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:50:19.403005 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:50:19.409082 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:50:19.420161 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.426541 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:50:19.427360 (Thread-1): finished collecting timing info
2022-02-07 21:50:19.435861 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:50:19.438271 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:50:19.439968 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:50:19.440328 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp005019435229"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:50:19.440983 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:50:19.441558 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:50:19.441741 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp005019345654"
    );
  
2022-02-07 21:50:19.443189 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:50:19.445352 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:50:19.445653 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:50:19.445865 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:50:19.447996 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:50:19.451145 (Thread-2): finished collecting timing info
2022-02-07 21:50:19.451680 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-07 21:50:19.454380 (Thread-2): 00:50:19 | 11 of 17 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.15s]
2022-02-07 21:50:19.454727 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:50:19.455085 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:50:19.458253 (Thread-2): 00:50:19 | 13 of 17 START incremental model public.sat_wheat_gbp_details........ [RUN]
2022-02-07 21:50:19.459318 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:50:19.459718 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:50:19.467167 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:50:19.476612 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:50:19.483339 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-07 21:50:19.487648 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:50:19.488504 (Thread-2): finished collecting timing info
2022-02-07 21:50:19.538184 (Thread-1): SQL status: BEGIN in 0.05 seconds
2022-02-07 21:50:19.547627 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:50:19.548141 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:50:19.548447 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp005019544836"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:50:19.548797 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp005019435229'
        
      order by ordinal_position

  
2022-02-07 21:50:19.549128 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:50:19.560925 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:50:19.569972 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:50:19.570234 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.575027 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:50:19.575329 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:50:19.580984 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:50:19.587143 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:50:19.587418 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-07 21:50:19.587701 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.589399 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:50:19.589792 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:50:19.589964 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp005019544836'
        
      order by ordinal_position

  
2022-02-07 21:50:19.592649 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:50:19.594471 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:50:19.595174 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:50:19.595451 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp005019435229"
    );
  
2022-02-07 21:50:19.596819 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:50:19.597048 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:50:19.598824 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:50:19.604900 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:50:19.605162 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:50:19.605438 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.605697 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:50:19.608407 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:50:19.610991 (Thread-1): finished collecting timing info
2022-02-07 21:50:19.611356 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:50:19.611589 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-07 21:50:19.616798 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:50:19.617167 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.619126 (Thread-1): 00:50:19 | 12 of 17 OK created incremental model public.hub_wheat_gbp........... [INSERT 0 0 in 0.22s]
2022-02-07 21:50:19.619733 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:50:19.620148 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:50:19.623401 (Thread-1): 00:50:19 | 14 of 17 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-07 21:50:19.624028 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:50:19.624469 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:50:19.624739 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:50:19.637280 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:50:19.643559 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:50:19.644113 (Thread-1): finished collecting timing info
2022-02-07 21:50:19.644648 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:50:19.652973 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:50:19.653230 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp005019544836"
    );
  
2022-02-07 21:50:19.653486 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp005019651395"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:50:19.653864 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:50:19.655466 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:50:19.657520 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:50:19.657970 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:50:19.658202 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:50:19.660809 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:50:19.663822 (Thread-2): finished collecting timing info
2022-02-07 21:50:19.664236 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-07 21:50:19.666607 (Thread-2): 00:50:19 | 13 of 17 OK created incremental model public.sat_wheat_gbp_details... [INSERT 0 0 in 0.21s]
2022-02-07 21:50:19.666975 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:50:19.667365 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:50:19.669364 (Thread-2): 00:50:19 | 15 of 17 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-07 21:50:19.670207 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:50:19.670849 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:50:19.679796 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:50:19.690069 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:50:19.695667 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-07 21:50:19.699354 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:50:19.700063 (Thread-2): finished collecting timing info
2022-02-07 21:50:19.706308 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:50:19.711882 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:50:19.713734 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:50:19.713966 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp005019651395'
        
      order by ordinal_position

  
2022-02-07 21:50:19.714237 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp005019711445"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:50:19.714659 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:50:19.723242 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:50:19.728504 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:50:19.728800 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.734640 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:50:19.739927 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:50:19.740168 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:50:19.740375 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.744099 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:50:19.744579 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-07 21:50:19.745838 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:50:19.746162 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:50:19.746308 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp005019711445'
        
      order by ordinal_position

  
2022-02-07 21:50:19.749840 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:50:19.751076 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:50:19.751593 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:50:19.751769 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp005019651395"
    );
  
2022-02-07 21:50:19.753738 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:50:19.754158 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:50:19.755741 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:50:19.760994 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:50:19.761286 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:50:19.761507 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.761730 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:50:19.765228 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:50:19.767598 (Thread-1): finished collecting timing info
2022-02-07 21:50:19.767929 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:50:19.768164 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-07 21:50:19.775927 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:50:19.776345 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:50:19.778441 (Thread-1): 00:50:19 | 14 of 17 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.15s]
2022-02-07 21:50:19.779116 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:50:19.779589 (Thread-1): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 21:50:19.781869 (Thread-1): 00:50:19 | 16 of 17 START view model public.dds_rate_gbp_usd.................... [RUN]
2022-02-07 21:50:19.782703 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:50:19.783092 (Thread-1): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 21:50:19.793464 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-07 21:50:19.793722 (Thread-2): SQL status: SELECT 11 in 0.02 seconds
2022-02-07 21:50:19.795639 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:50:19.796094 (Thread-1): finished collecting timing info
2022-02-07 21:50:19.806651 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:50:19.806921 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:50:19.807100 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop view if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 21:50:19.807343 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp005019711445"
    );
  
2022-02-07 21:50:19.807552 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:50:19.809258 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:50:19.810768 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:50:19.811044 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:50:19.811258 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:50:19.813421 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:50:19.816469 (Thread-2): finished collecting timing info
2022-02-07 21:50:19.817144 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-07 21:50:19.820900 (Thread-2): 00:50:19 | 15 of 17 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.15s]
2022-02-07 21:50:19.821311 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:50:19.821808 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:50:19.826693 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:50:19.827212 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:50:19.827746 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop view if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:50:19.829078 (Thread-2): 00:50:19 | 17 of 17 START view model public.dds_wheat_msk....................... [RUN]
2022-02-07 21:50:19.830114 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:50:19.830532 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:50:19.836206 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:50:19.843322 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-07 21:50:19.846425 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 21:50:19.847264 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:50:19.847557 (Thread-2): finished collecting timing info
2022-02-07 21:50:19.848680 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-07 21:50:19.859298 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:50:19.859844 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-07 21:50:19.860127 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:50:19.861118 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:50:19.861480 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:50:19.861787 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */

  create view "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );

2022-02-07 21:50:19.867759 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:50:19.872490 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:50:19.872768 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-07 21:50:19.874658 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:50:19.874955 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:50:19.876287 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-07 21:50:19.879955 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:50:19.880331 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:50:19.880622 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 21:50:19.880988 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-07 21:50:19.882550 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:50:19.884628 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 21:50:19.884921 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:50:19.889576 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:50:19.890002 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop view if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:50:19.890577 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:50:19.890990 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-07 21:50:19.891745 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:50:19.895043 (Thread-1): finished collecting timing info
2022-02-07 21:50:19.895377 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:50:19.895615 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-07 21:50:19.895855 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:50:19.896120 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */

  create view "postgres"."public"."dds_wheat_msk__dbt_tmp" as (
    with dds_wheat_msk as(
    select sm.tradedate  as tradedate
        ,cast(sm.value as decimal(18,2)) as value
        ,cast(sm.open as decimal(18,2)) as open
        ,cast(sm.close as decimal(18,2)) as close
        ,cast(sm.high as decimal(18,2)) as high
        ,cast(sm.low as decimal(18,2)) as low
        ,cast(sm.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hm
    left join "postgres"."public"."sat_wheat_msk_details" as sm
    on hm.date_pk=sm.date_pk
)
select * from dds_wheat_msk
  );

2022-02-07 21:50:19.897944 (Thread-1): 00:50:19 | 16 of 17 OK created view model public.dds_rate_gbp_usd............... [CREATE VIEW in 0.11s]
2022-02-07 21:50:19.898891 (Thread-1): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 21:50:19.902976 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 21:50:19.908361 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:50:19.908590 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-07 21:50:19.910294 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:50:19.913900 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:50:19.914136 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-07 21:50:19.915898 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:50:19.917655 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 21:50:19.917909 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:50:19.918061 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 21:50:19.920386 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:50:19.923317 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:50:19.923569 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 21:50:19.926878 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:50:19.930190 (Thread-2): finished collecting timing info
2022-02-07 21:50:19.930880 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-07 21:50:19.933211 (Thread-2): 00:50:19 | 17 of 17 OK created view model public.dds_wheat_msk.................. [CREATE VIEW in 0.10s]
2022-02-07 21:50:19.933692 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:50:19.936968 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:50:19.937307 (MainThread): Using postgres connection "master".
2022-02-07 21:50:19.937472 (MainThread): On master: BEGIN
2022-02-07 21:50:19.937640 (MainThread): Opening a new connection, currently in state closed
2022-02-07 21:50:19.948601 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:50:19.948890 (MainThread): On master: COMMIT
2022-02-07 21:50:19.949079 (MainThread): Using postgres connection "master".
2022-02-07 21:50:19.949245 (MainThread): On master: COMMIT
2022-02-07 21:50:19.950512 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:50:19.950862 (MainThread): On master: Close
2022-02-07 21:50:19.951798 (MainThread): 00:50:19 | 
2022-02-07 21:50:19.952291 (MainThread): 00:50:19 | Finished running 6 view models, 2 table models, 9 incremental models in 2.21s.
2022-02-07 21:50:19.952845 (MainThread): Connection 'master' was properly closed.
2022-02-07 21:50:19.953163 (MainThread): Connection 'model.project_otus_dbt.dds_rate_gbp_usd' was properly closed.
2022-02-07 21:50:19.953396 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_msk' was properly closed.
2022-02-07 21:50:20.087512 (MainThread): 
2022-02-07 21:50:20.087890 (MainThread): Completed with 1 error and 0 warnings:
2022-02-07 21:50:20.088168 (MainThread): 
2022-02-07 21:50:20.088559 (MainThread): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
2022-02-07 21:50:20.089003 (MainThread):   column "link_date_pk" does not exist
2022-02-07 21:50:20.089366 (MainThread):   LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
2022-02-07 21:50:20.089691 (MainThread):                       ^
2022-02-07 21:50:20.089994 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:50:20.090324 (MainThread): 
Done. PASS=16 WARN=0 ERROR=1 SKIP=0 TOTAL=17
2022-02-07 21:50:20.090836 (MainThread): Flushing usage events
2022-02-07 21:52:29.089049 (MainThread): Running with dbt=0.19.0
2022-02-07 21:52:29.180231 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 21:52:29.181004 (MainThread): Tracking: do not track
2022-02-07 21:52:29.255839 (MainThread): Partial parsing not enabled
2022-02-07 21:52:29.256722 (MainThread): Parsing macros/adapters.sql
2022-02-07 21:52:29.283393 (MainThread): Parsing macros/catalog.sql
2022-02-07 21:52:29.289163 (MainThread): Parsing macros/relations.sql
2022-02-07 21:52:29.292619 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 21:52:29.298561 (MainThread): Parsing macros/core.sql
2022-02-07 21:52:29.307057 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 21:52:29.386470 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 21:52:29.389409 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 21:52:29.391829 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 21:52:29.413140 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 21:52:29.416732 (MainThread): Parsing macros/etc/query.sql
2022-02-07 21:52:29.419076 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 21:52:29.420782 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 21:52:29.431077 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 21:52:29.452581 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 21:52:29.454355 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 21:52:29.493933 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 21:52:29.528050 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 21:52:29.537597 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 21:52:29.540242 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 21:52:29.556731 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 21:52:29.563295 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 21:52:29.571203 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 21:52:29.577784 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 21:52:29.579677 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 21:52:29.581337 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 21:52:29.583228 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 21:52:29.588282 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 21:52:29.591072 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 21:52:29.594143 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 21:52:29.596036 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 21:52:29.606406 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 21:52:29.608740 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 21:52:29.610614 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 21:52:29.613437 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 21:52:29.614511 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 21:52:29.616915 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 21:52:29.620141 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 21:52:29.622000 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 21:52:29.624133 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 21:52:29.626755 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 21:52:29.635686 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 21:52:29.639691 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 21:52:29.642443 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 21:52:29.643970 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 21:52:29.646036 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 21:52:29.648738 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 21:52:29.651350 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 21:52:29.660127 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 21:52:29.663168 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 21:52:29.665789 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 21:52:29.667997 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 21:52:29.670877 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 21:52:29.672678 (MainThread): Parsing macros/sql/star.sql
2022-02-07 21:52:29.676486 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 21:52:29.678593 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 21:52:29.685539 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 21:52:29.688116 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 21:52:29.697849 (MainThread): Parsing macros/sql/union.sql
2022-02-07 21:52:29.706126 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 21:52:29.708082 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 21:52:29.712459 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 21:52:29.715988 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 21:52:29.719492 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 21:52:29.725656 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 21:52:29.730442 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 21:52:29.732030 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 21:52:29.733770 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 21:52:29.736110 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 21:52:29.739427 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 21:52:29.740689 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 21:52:29.742131 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 21:52:29.743475 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 21:52:29.766352 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 21:52:29.768242 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 21:52:29.770465 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 21:52:29.772334 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 21:52:29.774704 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 21:52:29.780763 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 21:52:29.784503 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 21:52:29.787126 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 21:52:29.788736 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 21:52:29.790696 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 21:52:29.792829 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 21:52:29.795887 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 21:52:29.797795 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 21:52:29.802986 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 21:52:29.805479 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 21:52:29.809036 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 21:52:29.809904 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 21:52:29.812204 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 21:52:29.815238 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 21:52:29.820117 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 21:52:29.829019 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 21:52:29.832180 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 21:52:29.832695 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 21:52:29.844858 (MainThread): Parsing macros/tables/link.sql
2022-02-07 21:52:29.860076 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 21:52:29.877667 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 21:52:29.888635 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 21:52:29.893134 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 21:52:29.909035 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 21:52:29.916462 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 21:52:29.939818 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 21:52:29.941231 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 21:52:29.959342 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 21:52:29.964932 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 21:52:29.981392 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 21:52:29.986189 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 21:52:30.002091 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 21:52:30.006899 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 21:52:30.024282 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 21:52:30.035972 (MainThread): Partial parsing not enabled
2022-02-07 21:52:30.146857 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:52:30.219681 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:52:30.313560 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:52:30.338376 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:52:30.362884 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:52:30.386795 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:52:30.429920 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:52:30.445787 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:52:30.461192 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:52:30.476397 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:52:30.596176 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:52:30.622628 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:52:30.642611 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:52:30.660763 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:52:30.670428 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:52:30.679855 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 21:52:30.688290 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:52:30.706973 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:52:31.442807 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.report
- models.project_otus_dbt.prestage

2022-02-07 21:52:31.559124 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 21:52:31.560242 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 21:52:31.562242 (MainThread): 
2022-02-07 21:52:31.562950 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:52:31.584931 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 21:52:31.594655 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 21:52:31.594937 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 21:52:31.595030 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 21:52:31.609806 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 21:52:31.613851 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 21:52:31.645364 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 21:52:31.651758 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:52:31.651971 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 21:52:31.652056 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 21:52:31.665236 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:52:31.665557 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:52:31.665754 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 21:52:31.672685 (ThreadPoolExecutor-1_0): SQL status: SELECT 23 in 0.01 seconds
2022-02-07 21:52:31.697397 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 21:52:31.698911 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 21:52:31.733619 (MainThread): Using postgres connection "master".
2022-02-07 21:52:31.733872 (MainThread): On master: BEGIN
2022-02-07 21:52:31.733991 (MainThread): Opening a new connection, currently in state init
2022-02-07 21:52:31.745801 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:52:31.746035 (MainThread): Using postgres connection "master".
2022-02-07 21:52:31.746147 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 21:52:32.032376 (MainThread): SQL status: SELECT 14 in 0.29 seconds
2022-02-07 21:52:32.046642 (MainThread): On master: ROLLBACK
2022-02-07 21:52:32.048143 (MainThread): Using postgres connection "master".
2022-02-07 21:52:32.048344 (MainThread): On master: BEGIN
2022-02-07 21:52:32.050680 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:52:32.051017 (MainThread): On master: COMMIT
2022-02-07 21:52:32.051236 (MainThread): Using postgres connection "master".
2022-02-07 21:52:32.051440 (MainThread): On master: COMMIT
2022-02-07 21:52:32.062778 (MainThread): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:52:32.063041 (MainThread): On master: Close
2022-02-07 21:52:32.063426 (MainThread): 00:52:32 | Concurrency: 2 threads (target='dev')
2022-02-07 21:52:32.063657 (MainThread): 00:52:32 | 
2022-02-07 21:52:32.069738 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:52:32.070087 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:52:32.073059 (Thread-1): 00:52:32 | 1 of 17 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-07 21:52:32.074490 (Thread-2): 00:52:32 | 2 of 17 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-07 21:52:32.075455 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:52:32.076010 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:52:32.076676 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:52:32.087741 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:52:32.160334 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:52:32.162178 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:52:32.162433 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 21:52:32.162656 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-07 21:52:32.162899 (Thread-2): Opening a new connection, currently in state init
2022-02-07 21:52:32.163107 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:52:32.174080 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:52:32.174362 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:52:32.174569 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:32.176972 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:52:32.177210 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:52:32.177332 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:32.183317 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 21:52:32.249978 (Thread-1): SQL status: SELECT 6 in 0.07 seconds
2022-02-07 21:52:32.253345 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:52:32.264486 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:52:32.264750 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:32.265071 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:32.268990 (Thread-1): SQL status: SELECT 6 in 0.00 seconds
2022-02-07 21:52:32.273262 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:52:32.273483 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 21:52:32.279979 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:52:32.280218 (Thread-1): finished collecting timing info
2022-02-07 21:52:32.296559 (Thread-2): finished collecting timing info
2022-02-07 21:52:32.306596 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:52:32.315854 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:52:32.316070 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 21:52:32.316281 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 21:52:32.317910 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:52:32.318250 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:52:32.321387 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:52:32.324306 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:52:32.324656 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:52:32.324868 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:52:32.326638 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:52:32.326880 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:52:32.330988 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:52:32.332306 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:52:32.332896 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:52:32.333127 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:52:32.333294 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:52:32.333548 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:52:32.338757 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:52:32.354352 (Thread-2): SQL status: CREATE VIEW in 0.02 seconds
2022-02-07 21:52:32.355877 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:52:32.359683 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:52:32.359976 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-07 21:52:32.360287 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-07 21:52:32.362671 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:32.362913 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:32.365950 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:52:32.368614 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:52:32.368911 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-07 21:52:32.369164 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 21:52:32.371379 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:32.371725 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:32.379249 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:52:32.380714 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:52:32.380989 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:52:32.381180 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:52:32.381371 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:52:32.381528 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:52:32.384185 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:52:32.389582 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:52:32.389800 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:52:32.389973 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:52:32.392680 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:52:32.393084 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:52:32.397352 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:52:32.400557 (Thread-1): finished collecting timing info
2022-02-07 21:52:32.400950 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:52:32.401228 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-07 21:52:32.404109 (Thread-2): finished collecting timing info
2022-02-07 21:52:32.404613 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 21:52:32.406801 (Thread-1): 00:52:32 | 1 of 17 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.33s]
2022-02-07 21:52:32.408873 (Thread-2): 00:52:32 | 2 of 17 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.33s]
2022-02-07 21:52:32.409328 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:52:32.409667 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:52:32.409998 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:52:32.410983 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:52:32.413612 (Thread-1): 00:52:32 | 3 of 17 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-07 21:52:32.414966 (Thread-2): 00:52:32 | 4 of 17 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-07 21:52:32.415659 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:52:32.416431 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:52:32.417060 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:52:32.417406 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:52:32.444883 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:52:32.450388 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-07 21:52:32.456071 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:52:32.458847 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:52:32.459592 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 21:52:32.459832 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:52:32.471258 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:52:32.471512 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:52:32.471615 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:32.476358 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:52:32.476795 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:52:32.477088 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:32.483011 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:52:32.490941 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:52:32.491183 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:52:32.491381 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:32.498313 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:52:32.498826 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:32.503480 (Thread-2): SQL status: SELECT 7 in 0.00 seconds
2022-02-07 21:52:32.508788 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:52:32.509067 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:52:32.515407 (Thread-2): finished collecting timing info
2022-02-07 21:52:32.519234 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:52:32.530483 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:52:32.531001 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 21:52:32.531582 (Thread-1): finished collecting timing info
2022-02-07 21:52:32.538108 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:52:32.541113 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:52:32.544529 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:52:32.544912 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-07 21:52:32.545141 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:52:32.546692 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:52:32.546979 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:52:32.552861 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:52:32.554393 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:52:32.554730 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:52:32.555546 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:52:32.555804 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:52:32.556669 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:52:32.558833 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:52:32.559799 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:52:32.560106 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:52:32.560397 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 21:52:32.566037 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:52:32.566326 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:52:32.566542 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-07 21:52:32.571667 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:52:32.572175 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-07 21:52:32.573793 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:32.574097 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:32.578440 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:52:32.582198 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:52:32.582641 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-07 21:52:32.582976 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-07 21:52:32.585147 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:32.585520 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:32.587396 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:52:32.588923 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:52:32.589243 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:52:32.589585 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:52:32.589861 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:52:32.590125 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:52:32.593291 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:52:32.593581 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:52:32.596632 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:52:32.600468 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:52:32.600835 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:52:32.601113 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:52:32.605457 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:52:32.608700 (Thread-2): finished collecting timing info
2022-02-07 21:52:32.609017 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:52:32.609290 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 21:52:32.612061 (Thread-1): finished collecting timing info
2022-02-07 21:52:32.612613 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-07 21:52:32.614864 (Thread-2): 00:52:32 | 4 of 17 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.20s]
2022-02-07 21:52:32.616959 (Thread-1): 00:52:32 | 3 of 17 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.20s]
2022-02-07 21:52:32.617455 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:52:32.617861 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:52:32.618543 (Thread-2): Began running node model.project_otus_dbt.dim_day
2022-02-07 21:52:32.619393 (Thread-1): Began running node model.project_otus_dbt.dim_week
2022-02-07 21:52:32.621441 (Thread-2): 00:52:32 | 5 of 17 START table model public.dim_day............................. [RUN]
2022-02-07 21:52:32.623369 (Thread-1): 00:52:32 | 6 of 17 START table model public.dim_week............................ [RUN]
2022-02-07 21:52:32.624162 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:52:32.624925 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:52:32.625288 (Thread-2): Compiling model.project_otus_dbt.dim_day
2022-02-07 21:52:32.625719 (Thread-1): Compiling model.project_otus_dbt.dim_week
2022-02-07 21:52:32.633829 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:52:32.640485 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:52:32.641360 (Thread-2): finished collecting timing info
2022-02-07 21:52:32.641840 (Thread-1): finished collecting timing info
2022-02-07 21:52:32.690540 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:52:32.696008 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-07 21:52:32.697590 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:52:32.697852 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:52:32.698172 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-07 21:52:32.699942 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:52:32.709039 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:52:32.712585 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:52:32.712807 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:52:32.713014 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:52:32.716899 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:52:32.717622 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:52:32.718718 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:52:32.724852 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:52:32.725397 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:52:32.726936 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:52:32.727715 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:52:32.727905 (Thread-2): On model.project_otus_dbt.dim_day: BEGIN
2022-02-07 21:52:32.728121 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:52:32.728463 (Thread-1): On model.project_otus_dbt.dim_week: BEGIN
2022-02-07 21:52:32.729644 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:52:32.729872 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:52:32.730034 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:52:32.730229 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:52:32.730405 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-07 21:52:32.730629 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 day')
        as t(date)
        )

select * from dim_day
order by date desc
  );
2022-02-07 21:52:32.739230 (Thread-1): SQL status: SELECT 731 in 0.01 seconds
2022-02-07 21:52:32.744048 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:52:32.744273 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-07 21:52:32.745870 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:32.749972 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:52:32.750227 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-07 21:52:32.751790 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:32.753619 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:52:32.753845 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:52:32.753981 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:52:32.756394 (Thread-2): SQL status: SELECT 5114 in 0.03 seconds
2022-02-07 21:52:32.761564 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:52:32.761793 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:52:32.761968 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-07 21:52:32.765059 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:52:32.765684 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:52:32.767162 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:32.771215 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:52:32.771443 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:52:32.771617 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-07 21:52:32.774965 (Thread-1): finished collecting timing info
2022-02-07 21:52:32.775658 (Thread-1): On model.project_otus_dbt.dim_week: Close
2022-02-07 21:52:32.777777 (Thread-1): 00:52:32 | 6 of 17 OK created table model public.dim_week....................... [SELECT 731 in 0.15s]
2022-02-07 21:52:32.778052 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:32.778486 (Thread-1): Finished running node model.project_otus_dbt.dim_week
2022-02-07 21:52:32.780209 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:52:32.780726 (Thread-1): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 21:52:32.781387 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:52:32.783073 (Thread-1): 00:52:32 | 7 of 17 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-07 21:52:32.783473 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:52:32.784330 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:52:32.786025 (Thread-1): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 21:52:32.792816 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:52:32.802394 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:52:32.807916 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:52:32.812162 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 21:52:32.813051 (Thread-1): finished collecting timing info
2022-02-07 21:52:32.822069 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:52:32.831133 (Thread-2): finished collecting timing info
2022-02-07 21:52:32.836746 (Thread-2): On model.project_otus_dbt.dim_day: Close
2022-02-07 21:52:32.851168 (Thread-2): 00:52:32 | 5 of 17 OK created table model public.dim_day........................ [SELECT 5114 in 0.22s]
2022-02-07 21:52:32.862621 (Thread-2): Finished running node model.project_otus_dbt.dim_day
2022-02-07 21:52:32.868180 (Thread-2): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 21:52:32.870192 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:52:32.871876 (Thread-2): 00:52:32 | 8 of 17 START incremental model public.sat_rate_gbp_usd_details...... [RUN]
2022-02-07 21:52:32.872147 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp005232865440"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:52:32.872823 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:52:32.873036 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:52:32.873324 (Thread-2): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 21:52:32.903076 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 21:52:32.903365 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:52:32.910102 (Thread-2): finished collecting timing info
2022-02-07 21:52:32.912987 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:52:32.923653 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:52:32.924029 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-07 21:52:32.924273 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp005232921867"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:52:32.924939 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:52:32.926024 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:52:32.926447 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:52:32.926727 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp005232865440'
        
      order by ordinal_position

  
2022-02-07 21:52:32.934932 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:52:32.942636 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:52:32.942976 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:32.949252 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:52:32.961199 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 21:52:32.965666 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:52:32.972317 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:52:32.972601 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:32.972888 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-07 21:52:32.975487 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:52:32.975866 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:52:32.976059 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp005232921867'
        
      order by ordinal_position

  
2022-02-07 21:52:32.978027 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:52:32.979677 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 21:52:32.980280 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:52:32.980501 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp005232865440"
    );
  
2022-02-07 21:52:32.982262 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:52:32.983639 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 21:52:32.983884 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:52:32.983970 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 21:52:32.987523 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:52:32.987838 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:52:32.991177 (Thread-1): finished collecting timing info
2022-02-07 21:52:32.998941 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:52:32.999290 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-07 21:52:32.999615 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:33.002384 (Thread-1): 00:52:32 | 7 of 17 OK created incremental model public.hub_rate_gbp_usd......... [INSERT 0 0 in 0.22s]
2022-02-07 21:52:33.002968 (Thread-1): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 21:52:33.003386 (Thread-1): Began running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:52:33.005820 (Thread-1): 00:52:32 | 9 of 17 START incremental model public.link_wheat_gbp_rate........... [RUN]
2022-02-07 21:52:33.006123 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:52:33.006866 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:52:33.015115 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:52:33.015459 (Thread-1): Compiling model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:52:33.015746 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:33.034513 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:52:33.034838 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:52:33.036985 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 21:52:33.037788 (Thread-1): finished collecting timing info
2022-02-07 21:52:33.048988 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:52:33.049990 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.link_wheat_gbp_rate"
2022-02-07 21:52:33.050279 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp005232921867"
    );
  
2022-02-07 21:52:33.051145 (Thread-1): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:52:33.051506 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: BEGIN
2022-02-07 21:52:33.051806 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:52:33.052574 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:52:33.054178 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 21:52:33.054402 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:52:33.054482 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 21:52:33.056738 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:52:33.058986 (Thread-2): finished collecting timing info
2022-02-07 21:52:33.059304 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-07 21:52:33.061784 (Thread-2): 00:52:33 | 8 of 17 OK created incremental model public.sat_rate_gbp_usd_details. [INSERT 0 0 in 0.19s]
2022-02-07 21:52:33.062276 (Thread-2): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 21:52:33.062684 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:52:33.065701 (Thread-2): 00:52:33 | 10 of 17 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-07 21:52:33.066404 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:52:33.067171 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:52:33.067488 (Thread-1): Using postgres connection "model.project_otus_dbt.link_wheat_gbp_rate".
2022-02-07 21:52:33.067963 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:52:33.068365 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.link_wheat_gbp_rate"} */

      

  create  table "postgres"."public"."link_wheat_gbp_rate"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (
   
SELECT * FROM (
    SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY LINK_DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as l
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.LINK_DATE_PK, a.DATE_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:52:33.081831 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:52:33.082233 (Thread-1): Postgres error: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^

2022-02-07 21:52:33.082438 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: ROLLBACK
2022-02-07 21:52:33.082683 (Thread-2): finished collecting timing info
2022-02-07 21:52:33.094124 (Thread-1): finished collecting timing info
2022-02-07 21:52:33.099213 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:52:33.099802 (Thread-1): On model.project_otus_dbt.link_wheat_gbp_rate: Close
2022-02-07 21:52:33.100127 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp005233095932"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:52:33.102652 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:52:33.101001 (Thread-1): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "link_date_pk" does not exist
LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                    ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 132, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
  column "link_date_pk" does not exist
  LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
                      ^
  compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:52:33.107557 (Thread-1): 00:52:33 | 9 of 17 ERROR creating incremental model public.link_wheat_gbp_rate.. [ERROR in 0.10s]
2022-02-07 21:52:33.108016 (Thread-1): Finished running node model.project_otus_dbt.link_wheat_gbp_rate
2022-02-07 21:52:33.108537 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:52:33.110983 (Thread-1): 00:52:33 | 11 of 17 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-07 21:52:33.111904 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:52:33.112365 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:52:33.140424 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 21:52:33.143268 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:52:33.148997 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:52:33.149875 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-07 21:52:33.150993 (Thread-1): finished collecting timing info
2022-02-07 21:52:33.157038 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:52:33.162626 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:52:33.163903 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:52:33.164141 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp005233095932'
        
      order by ordinal_position

  
2022-02-07 21:52:33.164425 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp005233161318"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:52:33.164851 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:52:33.175580 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:52:33.184401 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:52:33.184808 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:33.189346 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:52:33.189719 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 21:52:33.194838 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:52:33.201267 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:52:33.201563 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:33.201809 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-07 21:52:33.203410 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:52:33.203697 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:52:33.203872 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp005233161318'
        
      order by ordinal_position

  
2022-02-07 21:52:33.206445 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:52:33.208079 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:52:33.208764 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:52:33.209025 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp005233095932"
    );
  
2022-02-07 21:52:33.210890 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:52:33.212816 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:52:33.213089 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:52:33.213281 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:52:33.221466 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:52:33.221745 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:52:33.222032 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:33.225681 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:52:33.228250 (Thread-2): finished collecting timing info
2022-02-07 21:52:33.228711 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-07 21:52:33.228874 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:52:33.231143 (Thread-2): 00:52:33 | 10 of 17 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.16s]
2022-02-07 21:52:33.237965 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:52:33.238410 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:52:33.238655 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:33.239109 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:52:33.241659 (Thread-2): 00:52:33 | 12 of 17 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-07 21:52:33.242306 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:52:33.242567 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:52:33.250190 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:52:33.257347 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:52:33.260913 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:52:33.261607 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:52:33.261978 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp005233161318"
    );
  
2022-02-07 21:52:33.262273 (Thread-2): finished collecting timing info
2022-02-07 21:52:33.269752 (Thread-1): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-07 21:52:33.276789 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:52:33.279221 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:52:33.279612 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:52:33.279948 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp005233274804"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:52:33.280222 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:52:33.280463 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:52:33.283168 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:52:33.286089 (Thread-1): finished collecting timing info
2022-02-07 21:52:33.286439 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-07 21:52:33.288353 (Thread-1): 00:52:33 | 11 of 17 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.18s]
2022-02-07 21:52:33.288704 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:52:33.289059 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:52:33.291372 (Thread-1): 00:52:33 | 13 of 17 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-07 21:52:33.292900 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:52:33.293247 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:52:33.311510 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:52:33.327815 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:52:33.398018 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:52:33.398499 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-07 21:52:33.398889 (Thread-1): finished collecting timing info
2022-02-07 21:52:33.405201 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:52:33.408642 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:52:33.409015 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:52:33.409256 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp005233406901"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:52:33.409532 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp005233274804'
        
      order by ordinal_position

  
2022-02-07 21:52:33.409768 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:52:33.418638 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:52:33.423085 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:52:33.423349 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:33.428515 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:52:33.433662 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:52:33.433890 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 21:52:33.434092 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:33.439901 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:52:33.440439 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-07 21:52:33.442141 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:52:33.442432 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:52:33.442654 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp005233406901'
        
      order by ordinal_position

  
2022-02-07 21:52:33.445078 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:52:33.446404 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:52:33.447121 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:52:33.447393 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp005233274804"
    );
  
2022-02-07 21:52:33.448921 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:52:33.450568 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:52:33.450850 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:52:33.451050 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:52:33.452741 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:52:33.458926 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:52:33.459194 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:52:33.459405 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:33.461905 (Thread-2): finished collecting timing info
2022-02-07 21:52:33.462603 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-07 21:52:33.465864 (Thread-2): 00:52:33 | 12 of 17 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.22s]
2022-02-07 21:52:33.466395 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:52:33.466909 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:52:33.469614 (Thread-2): 00:52:33 | 14 of 17 START incremental model public.hub_wheat_gbp................ [RUN]
2022-02-07 21:52:33.469856 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:52:33.470479 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:52:33.479864 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:52:33.480141 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:52:33.480415 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:33.494854 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:52:33.495609 (Thread-1): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:52:33.495958 (Thread-2): finished collecting timing info
2022-02-07 21:52:33.497500 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:52:33.509091 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:52:33.509392 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp005233506624"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:52:33.509736 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:52:33.510214 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:52:33.510564 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp005233406901"
    );
  
2022-02-07 21:52:33.512271 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:52:33.514317 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:52:33.514661 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:52:33.514890 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:52:33.517362 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:52:33.521311 (Thread-1): finished collecting timing info
2022-02-07 21:52:33.521861 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-07 21:52:33.524512 (Thread-1): 00:52:33 | 13 of 17 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.23s]
2022-02-07 21:52:33.524938 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:52:33.525433 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:52:33.527518 (Thread-1): 00:52:33 | 15 of 17 START incremental model public.sat_wheat_gbp_details........ [RUN]
2022-02-07 21:52:33.528344 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:52:33.529072 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:52:33.540326 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:52:33.550820 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:52:33.559927 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:52:33.560168 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-07 21:52:33.560857 (Thread-1): finished collecting timing info
2022-02-07 21:52:33.567217 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:52:33.572982 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:52:33.574665 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:52:33.574940 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp005233506624'
        
      order by ordinal_position

  
2022-02-07 21:52:33.575245 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp005233571656"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:52:33.575796 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:52:33.584842 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:52:33.589910 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:52:33.590285 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:33.595772 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:52:33.602439 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:52:33.602727 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:52:33.602914 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:33.606953 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:52:33.607486 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-07 21:52:33.608644 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:52:33.608924 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:52:33.609061 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp005233571656'
        
      order by ordinal_position

  
2022-02-07 21:52:33.611143 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:52:33.612255 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:52:33.612991 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:52:33.613361 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp005233506624"
    );
  
2022-02-07 21:52:33.614994 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:52:33.616551 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:52:33.616781 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:52:33.616913 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:52:33.618672 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:52:33.623249 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:52:33.623475 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:52:33.623665 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:33.626068 (Thread-2): finished collecting timing info
2022-02-07 21:52:33.626601 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-07 21:52:33.628587 (Thread-2): 00:52:33 | 14 of 17 OK created incremental model public.hub_wheat_gbp........... [INSERT 0 0 in 0.16s]
2022-02-07 21:52:33.629090 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:52:33.629426 (Thread-2): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 21:52:33.631290 (Thread-2): 00:52:33 | 16 of 17 START view model public.dds_rate_gbp_usd.................... [RUN]
2022-02-07 21:52:33.632148 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:52:33.632724 (Thread-2): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 21:52:33.633090 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:52:33.649052 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-07 21:52:33.649695 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:52:33.650064 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:52:33.650403 (Thread-2): finished collecting timing info
2022-02-07 21:52:33.660896 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:52:33.662116 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:52:33.663360 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:52:33.663759 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop view if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 21:52:33.664284 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:52:33.664832 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:52:33.665071 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp005233571656"
    );
  
2022-02-07 21:52:33.666752 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:52:33.668905 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:52:33.669633 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:52:33.669933 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:52:33.672504 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:52:33.675370 (Thread-1): finished collecting timing info
2022-02-07 21:52:33.675877 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-07 21:52:33.678419 (Thread-1): 00:52:33 | 15 of 17 OK created incremental model public.sat_wheat_gbp_details... [INSERT 0 0 in 0.15s]
2022-02-07 21:52:33.678670 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:52:33.679043 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:52:33.683523 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:52:33.683946 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:52:33.684290 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop view if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:52:33.686052 (Thread-1): 00:52:33 | 17 of 17 START view model public.dds_wheat_msk....................... [RUN]
2022-02-07 21:52:33.687344 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:52:33.687857 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:52:33.688184 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:52:33.698622 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 21:52:33.700686 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-07 21:52:33.701556 (Thread-1): finished collecting timing info
2022-02-07 21:52:33.702120 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:52:33.712705 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:52:33.712966 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-07 21:52:33.713282 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-07 21:52:33.713785 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:52:33.715298 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:52:33.715669 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:52:33.715858 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */

  create view "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );

2022-02-07 21:52:33.720394 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 21:52:33.726688 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:52:33.727045 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd" rename to "dds_rate_gbp_usd__dbt_backup"
2022-02-07 21:52:33.728707 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:33.729020 (Thread-1): SQL status: DROP VIEW in 0.02 seconds
2022-02-07 21:52:33.732398 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:52:33.737250 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:52:33.737607 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-07 21:52:33.737910 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 21:52:33.739690 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:52:33.740090 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:33.741428 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 21:52:33.742882 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-07 21:52:33.743456 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:52:33.743714 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-07 21:52:33.744143 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:52:33.744493 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-07 21:52:33.746082 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:52:33.746280 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:52:33.746439 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:52:33.746642 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */

  create view "postgres"."public"."dds_wheat_msk__dbt_tmp" as (
    with dds_wheat_msk as(
    select sm.tradedate  as tradedate
        ,cast(sm.value as decimal(18,2)) as value
        ,cast(sm.open as decimal(18,2)) as open
        ,cast(sm.close as decimal(18,2)) as close
        ,cast(sm.high as decimal(18,2)) as high
        ,cast(sm.low as decimal(18,2)) as low
        ,cast(sm.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hm
    left join "postgres"."public"."sat_wheat_msk_details" as sm
    on hm.date_pk=sm.date_pk
)
select * from dds_wheat_msk
  );

2022-02-07 21:52:33.749358 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:52:33.749944 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop view if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:52:33.753269 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 21:52:33.758307 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:52:33.758569 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:52:33.758810 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-07 21:52:33.761885 (Thread-2): finished collecting timing info
2022-02-07 21:52:33.762548 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-07 21:52:33.765469 (Thread-2): 00:52:33 | 16 of 17 OK created view model public.dds_rate_gbp_usd............... [CREATE VIEW in 0.13s]
2022-02-07 21:52:33.765766 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:33.766268 (Thread-2): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 21:52:33.770898 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:52:33.772060 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-07 21:52:33.773961 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:52:33.775323 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 21:52:33.775541 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:52:33.775691 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 21:52:33.778001 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:52:33.780898 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:52:33.781098 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 21:52:33.784386 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:52:33.787324 (Thread-1): finished collecting timing info
2022-02-07 21:52:33.787879 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-07 21:52:33.789968 (Thread-1): 00:52:33 | 17 of 17 OK created view model public.dds_wheat_msk.................. [CREATE VIEW in 0.10s]
2022-02-07 21:52:33.790258 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:52:33.792727 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:52:33.793000 (MainThread): Using postgres connection "master".
2022-02-07 21:52:33.793135 (MainThread): On master: BEGIN
2022-02-07 21:52:33.793274 (MainThread): Opening a new connection, currently in state closed
2022-02-07 21:52:33.803675 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:52:33.804051 (MainThread): On master: COMMIT
2022-02-07 21:52:33.804307 (MainThread): Using postgres connection "master".
2022-02-07 21:52:33.804559 (MainThread): On master: COMMIT
2022-02-07 21:52:33.805864 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:52:33.806150 (MainThread): On master: Close
2022-02-07 21:52:33.806923 (MainThread): 00:52:33 | 
2022-02-07 21:52:33.807376 (MainThread): 00:52:33 | Finished running 6 view models, 2 table models, 9 incremental models in 2.24s.
2022-02-07 21:52:33.807698 (MainThread): Connection 'master' was properly closed.
2022-02-07 21:52:33.807905 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_msk' was properly closed.
2022-02-07 21:52:33.808085 (MainThread): Connection 'model.project_otus_dbt.dds_rate_gbp_usd' was properly closed.
2022-02-07 21:52:33.914990 (MainThread): 
2022-02-07 21:52:33.915320 (MainThread): Completed with 1 error and 0 warnings:
2022-02-07 21:52:33.915557 (MainThread): 
2022-02-07 21:52:33.915837 (MainThread): Database Error in model link_wheat_gbp_rate (models/raw_vault/links/link_wheat_gbp_rate.sql)
2022-02-07 21:52:33.916112 (MainThread):   column "link_date_pk" does not exist
2022-02-07 21:52:33.916378 (MainThread):   LINE 12:     SELECT LINK_DATE_PK, DATE_PK, LOAD_DATE, RECORD_SOURCE,
2022-02-07 21:52:33.916707 (MainThread):                       ^
2022-02-07 21:52:33.916957 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/raw_vault/links/link_wheat_gbp_rate.sql
2022-02-07 21:52:33.917274 (MainThread): 
Done. PASS=16 WARN=0 ERROR=1 SKIP=0 TOTAL=17
2022-02-07 21:52:33.917676 (MainThread): Flushing usage events
2022-02-07 21:59:34.865955 (MainThread): Running with dbt=0.19.0
2022-02-07 21:59:34.934057 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-02-07 21:59:34.934980 (MainThread): Tracking: do not track
2022-02-07 21:59:35.049702 (MainThread): Partial parsing not enabled
2022-02-07 21:59:35.051329 (MainThread): Parsing macros/adapters.sql
2022-02-07 21:59:35.083268 (MainThread): Parsing macros/catalog.sql
2022-02-07 21:59:35.087103 (MainThread): Parsing macros/relations.sql
2022-02-07 21:59:35.089372 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 21:59:35.092703 (MainThread): Parsing macros/core.sql
2022-02-07 21:59:35.098857 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 21:59:35.145078 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 21:59:35.147157 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 21:59:35.148844 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 21:59:35.157535 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 21:59:35.160771 (MainThread): Parsing macros/etc/query.sql
2022-02-07 21:59:35.162196 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 21:59:35.163377 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 21:59:35.173961 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 21:59:35.197129 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 21:59:35.198916 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 21:59:35.226181 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 21:59:35.242478 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 21:59:35.248142 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 21:59:35.249942 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 21:59:35.262382 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 21:59:35.266854 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 21:59:35.273239 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 21:59:35.279316 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 21:59:35.281076 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 21:59:35.282505 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 21:59:35.284211 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 21:59:35.288141 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 21:59:35.290038 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 21:59:35.292239 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 21:59:35.293414 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 21:59:35.303464 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 21:59:35.305689 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 21:59:35.309000 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 21:59:35.314251 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 21:59:35.316010 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 21:59:35.320504 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 21:59:35.326357 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 21:59:35.329552 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 21:59:35.333582 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 21:59:35.338750 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 21:59:35.350899 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 21:59:35.356322 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 21:59:35.360081 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 21:59:35.361935 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 21:59:35.364319 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 21:59:35.366553 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 21:59:35.368534 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 21:59:35.375285 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 21:59:35.376808 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 21:59:35.378718 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 21:59:35.381016 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 21:59:35.388074 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 21:59:35.392352 (MainThread): Parsing macros/sql/star.sql
2022-02-07 21:59:35.399133 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 21:59:35.401184 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 21:59:35.405421 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 21:59:35.407289 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 21:59:35.415113 (MainThread): Parsing macros/sql/union.sql
2022-02-07 21:59:35.423130 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 21:59:35.425043 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 21:59:35.429624 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 21:59:35.433301 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 21:59:35.436826 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 21:59:35.442857 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 21:59:35.452108 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 21:59:35.455603 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 21:59:35.459674 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 21:59:35.466090 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 21:59:35.474668 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 21:59:35.478343 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 21:59:35.482242 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 21:59:35.485632 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 21:59:35.524833 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 21:59:35.527021 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 21:59:35.529497 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 21:59:35.531607 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 21:59:35.533551 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 21:59:35.539673 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 21:59:35.543628 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 21:59:35.546206 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 21:59:35.547834 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 21:59:35.549554 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 21:59:35.551752 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 21:59:35.554758 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 21:59:35.556901 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 21:59:35.562778 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 21:59:35.565459 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 21:59:35.569140 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 21:59:35.570119 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 21:59:35.572840 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 21:59:35.575922 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 21:59:35.580820 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 21:59:35.593691 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 21:59:35.602430 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 21:59:35.603980 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 21:59:35.617219 (MainThread): Parsing macros/tables/link.sql
2022-02-07 21:59:35.627383 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 21:59:35.639887 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 21:59:35.648216 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 21:59:35.652413 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 21:59:35.666981 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 21:59:35.673693 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 21:59:35.706171 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 21:59:35.709367 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 21:59:35.738209 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 21:59:35.749187 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 21:59:35.757512 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 21:59:35.759561 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 21:59:35.767316 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 21:59:35.770622 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 21:59:35.783613 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 21:59:35.796609 (MainThread): Partial parsing not enabled
2022-02-07 21:59:35.888818 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:59:35.988705 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:59:36.027887 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:59:36.056814 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:59:36.079571 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:59:36.116252 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:59:36.140574 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:59:36.168951 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:59:36.188193 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:59:36.348816 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:59:36.377346 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:59:36.400160 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:59:36.422423 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:59:36.433860 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:59:36.443757 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 21:59:36.456300 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 21:59:36.466365 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:59:36.478383 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:59:37.301454 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.report
- models.project_otus_dbt.raw_vault.links

2022-02-07 21:59:37.474687 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 21:59:37.475392 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 21:59:37.477085 (MainThread): 
2022-02-07 21:59:37.477799 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:59:37.482781 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 21:59:37.500599 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 21:59:37.500802 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 21:59:37.500883 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 21:59:37.515238 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 21:59:37.519698 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 21:59:37.574932 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 21:59:37.590178 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:59:37.590610 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 21:59:37.590952 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 21:59:37.603581 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:59:37.603823 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:59:37.603913 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 21:59:37.607653 (ThreadPoolExecutor-1_0): SQL status: SELECT 23 in 0.00 seconds
2022-02-07 21:59:37.624636 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 21:59:37.626036 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 21:59:37.654123 (MainThread): Using postgres connection "master".
2022-02-07 21:59:37.654330 (MainThread): On master: BEGIN
2022-02-07 21:59:37.654411 (MainThread): Opening a new connection, currently in state init
2022-02-07 21:59:37.667059 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:59:37.667265 (MainThread): Using postgres connection "master".
2022-02-07 21:59:37.667334 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 21:59:38.003932 (MainThread): SQL status: SELECT 14 in 0.34 seconds
2022-02-07 21:59:38.021034 (MainThread): On master: ROLLBACK
2022-02-07 21:59:38.022363 (MainThread): Using postgres connection "master".
2022-02-07 21:59:38.022559 (MainThread): On master: BEGIN
2022-02-07 21:59:38.024621 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:59:38.025086 (MainThread): On master: COMMIT
2022-02-07 21:59:38.025314 (MainThread): Using postgres connection "master".
2022-02-07 21:59:38.025528 (MainThread): On master: COMMIT
2022-02-07 21:59:38.026831 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:38.027048 (MainThread): On master: Close
2022-02-07 21:59:38.027432 (MainThread): 00:59:38 | Concurrency: 2 threads (target='dev')
2022-02-07 21:59:38.027673 (MainThread): 00:59:38 | 
2022-02-07 21:59:38.032551 (Thread-1): Began running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-07 21:59:38.032998 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_gbp
2022-02-07 21:59:38.035902 (Thread-1): 00:59:38 | 1 of 4 START seed file public.source_rate_gbp_usd.................... [RUN]
2022-02-07 21:59:38.038724 (Thread-2): 00:59:38 | 2 of 4 START seed file public.source_wheat_gbp....................... [RUN]
2022-02-07 21:59:38.040009 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 21:59:38.041292 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 21:59:38.041734 (Thread-1): finished collecting timing info
2022-02-07 21:59:38.042468 (Thread-2): finished collecting timing info
2022-02-07 21:59:38.264903 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 21:59:38.266603 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 21:59:38.266813 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: BEGIN
2022-02-07 21:59:38.267043 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: BEGIN
2022-02-07 21:59:38.267244 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:59:38.267438 (Thread-2): Opening a new connection, currently in state init
2022-02-07 21:59:38.280262 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:59:38.280729 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 21:59:38.281054 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_rate_gbp_usd"} */
truncate table "postgres"."public"."source_rate_gbp_usd"
2022-02-07 21:59:38.281690 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:59:38.282070 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 21:59:38.282228 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_gbp"} */
truncate table "postgres"."public"."source_wheat_gbp"
2022-02-07 21:59:38.289766 (Thread-1): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 21:59:38.290045 (Thread-2): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 21:59:38.308452 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-07 21:59:38.311112 (Thread-2): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-07 21:59:38.350751 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 21:59:38.356370 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: 
            insert into "postgres"."public"."source_rate_gbp_usd" (TRADEDATE, PRICE, OPEN, HIGH, LOW, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s...
2022-02-07 21:59:38.358151 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 21:59:38.365026 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: 
            insert into "postgres"."public"."source_wheat_gbp" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-07 21:59:38.372523 (Thread-1): SQL status: INSERT 0 548 in 0.01 seconds
2022-02-07 21:59:38.377496 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_rate_gbp_usd"
2022-02-07 21:59:38.380123 (Thread-2): SQL status: INSERT 0 531 in 0.01 seconds
2022-02-07 21:59:38.386167 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_gbp"
2022-02-07 21:59:38.389693 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-07 21:59:38.390452 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 21:59:38.390745 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-07 21:59:38.396023 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-07 21:59:38.396325 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 21:59:38.396612 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-07 21:59:38.397025 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:59:38.400313 (Thread-1): finished collecting timing info
2022-02-07 21:59:38.400797 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: Close
2022-02-07 21:59:38.400987 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:38.404064 (Thread-2): finished collecting timing info
2022-02-07 21:59:38.405858 (Thread-1): 00:59:38 | 1 of 4 OK loaded seed file public.source_rate_gbp_usd................ [INSERT 548 in 0.37s]
2022-02-07 21:59:38.406219 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: Close
2022-02-07 21:59:38.406793 (Thread-1): Finished running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-07 21:59:38.407557 (Thread-1): Began running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 21:59:38.409278 (Thread-2): 00:59:38 | 2 of 4 OK loaded seed file public.source_wheat_gbp................... [INSERT 531 in 0.37s]
2022-02-07 21:59:38.411361 (Thread-1): 00:59:38 | 3 of 4 START seed file public.source_wheat_msk....................... [RUN]
2022-02-07 21:59:38.412096 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_gbp
2022-02-07 21:59:38.413049 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 21:59:38.413674 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 21:59:38.414479 (Thread-1): finished collecting timing info
2022-02-07 21:59:38.416487 (Thread-2): 00:59:38 | 4 of 4 START seed file public.source_wheat_usa....................... [RUN]
2022-02-07 21:59:38.429059 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 21:59:38.434610 (Thread-2): finished collecting timing info
2022-02-07 21:59:38.468521 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 21:59:38.468936 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: BEGIN
2022-02-07 21:59:38.469217 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:59:38.496590 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 21:59:38.496857 (Thread-1): SQL status: BEGIN in 0.03 seconds
2022-02-07 21:59:38.497051 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: BEGIN
2022-02-07 21:59:38.497317 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 21:59:38.497527 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:59:38.497754 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_msk"} */
truncate table "postgres"."public"."source_wheat_msk"
2022-02-07 21:59:38.504935 (Thread-1): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 21:59:38.517220 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 21:59:38.517508 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:59:38.517699 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: 
            insert into "postgres"."public"."source_wheat_msk" (BOARDID, SECID, TRADEDATE, SHORTNAME, NAME, CLOSE, OPEN, HIGH, LOW, VALUE, DURATION, YIELD, DECIMALS, CAPITALIZATION, CURRENCYID, DIVISOR, TRADINGSESSION, VOLUME) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%...
2022-02-07 21:59:38.517968 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 21:59:38.522769 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_usa"} */
truncate table "postgres"."public"."source_wheat_usa"
2022-02-07 21:59:38.527495 (Thread-2): SQL status: TRUNCATE TABLE in 0.00 seconds
2022-02-07 21:59:38.540083 (Thread-1): SQL status: INSERT 0 216 in 0.02 seconds
2022-02-07 21:59:38.545996 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_msk"
2022-02-07 21:59:38.546641 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 21:59:38.547052 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: 
            insert into "postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-07 21:59:38.555455 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 21:59:38.555690 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 21:59:38.555771 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 21:59:38.562245 (Thread-2): SQL status: INSERT 0 547 in 0.02 seconds
2022-02-07 21:59:38.562473 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:59:38.563021 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_usa"
2022-02-07 21:59:38.564752 (Thread-1): finished collecting timing info
2022-02-07 21:59:38.565319 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: Close
2022-02-07 21:59:38.566129 (Thread-1): 00:59:38 | 3 of 4 OK loaded seed file public.source_wheat_msk................... [INSERT 216 in 0.15s]
2022-02-07 21:59:38.566738 (Thread-1): Finished running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 21:59:38.572680 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-07 21:59:38.572955 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 21:59:38.573111 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-07 21:59:38.577808 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:38.579961 (Thread-2): finished collecting timing info
2022-02-07 21:59:38.580267 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: Close
2022-02-07 21:59:38.581101 (Thread-2): 00:59:38 | 4 of 4 OK loaded seed file public.source_wheat_usa................... [INSERT 547 in 0.15s]
2022-02-07 21:59:38.581418 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 21:59:38.584977 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:59:38.585255 (MainThread): Using postgres connection "master".
2022-02-07 21:59:38.585379 (MainThread): On master: BEGIN
2022-02-07 21:59:38.585517 (MainThread): Opening a new connection, currently in state closed
2022-02-07 21:59:38.598727 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:59:38.599027 (MainThread): On master: COMMIT
2022-02-07 21:59:38.599183 (MainThread): Using postgres connection "master".
2022-02-07 21:59:38.599331 (MainThread): On master: COMMIT
2022-02-07 21:59:38.600656 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:38.601053 (MainThread): On master: Close
2022-02-07 21:59:38.602213 (MainThread): 00:59:38 | 
2022-02-07 21:59:38.602860 (MainThread): 00:59:38 | Finished running 4 seeds in 1.12s.
2022-02-07 21:59:38.603460 (MainThread): Connection 'master' was properly closed.
2022-02-07 21:59:38.603852 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_msk' was properly closed.
2022-02-07 21:59:38.604240 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_usa' was properly closed.
2022-02-07 21:59:38.783773 (MainThread): 
2022-02-07 21:59:38.784020 (MainThread): Completed successfully
2022-02-07 21:59:38.784237 (MainThread): 
Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
2022-02-07 21:59:38.784566 (MainThread): Flushing usage events
2022-02-07 21:59:42.414369 (MainThread): Running with dbt=0.19.0
2022-02-07 21:59:42.482344 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 21:59:42.482906 (MainThread): Tracking: do not track
2022-02-07 21:59:42.545881 (MainThread): Partial parsing not enabled
2022-02-07 21:59:42.546767 (MainThread): Parsing macros/adapters.sql
2022-02-07 21:59:42.565386 (MainThread): Parsing macros/catalog.sql
2022-02-07 21:59:42.567622 (MainThread): Parsing macros/relations.sql
2022-02-07 21:59:42.568942 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 21:59:42.571288 (MainThread): Parsing macros/core.sql
2022-02-07 21:59:42.575039 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 21:59:42.611885 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 21:59:42.613835 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 21:59:42.615358 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 21:59:42.624045 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 21:59:42.625794 (MainThread): Parsing macros/etc/query.sql
2022-02-07 21:59:42.626943 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 21:59:42.627887 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 21:59:42.638170 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 21:59:42.682082 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 21:59:42.685104 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 21:59:42.733288 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 21:59:42.764933 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 21:59:42.773729 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 21:59:42.776280 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 21:59:42.792157 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 21:59:42.797204 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 21:59:42.803837 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 21:59:42.818436 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 21:59:42.823075 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 21:59:42.826774 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 21:59:42.831175 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 21:59:42.839538 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 21:59:42.842860 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 21:59:42.846450 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 21:59:42.848371 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 21:59:42.862901 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 21:59:42.865726 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 21:59:42.868057 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 21:59:42.871382 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 21:59:42.872589 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 21:59:42.875039 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 21:59:42.878368 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 21:59:42.880427 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 21:59:42.882609 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 21:59:42.885259 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 21:59:42.892196 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 21:59:42.895640 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 21:59:42.898117 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 21:59:42.899511 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 21:59:42.902329 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 21:59:42.904613 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 21:59:42.906858 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 21:59:42.914683 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 21:59:42.917067 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 21:59:42.919661 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 21:59:42.922725 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 21:59:42.926837 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 21:59:42.929571 (MainThread): Parsing macros/sql/star.sql
2022-02-07 21:59:42.934139 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 21:59:42.936120 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 21:59:42.940764 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 21:59:42.942789 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 21:59:42.951458 (MainThread): Parsing macros/sql/union.sql
2022-02-07 21:59:42.963641 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 21:59:42.966584 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 21:59:42.973562 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 21:59:42.978827 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 21:59:42.984338 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 21:59:42.994014 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 21:59:43.003620 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 21:59:43.007050 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 21:59:43.011000 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 21:59:43.018070 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 21:59:43.026160 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 21:59:43.029562 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 21:59:43.032474 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 21:59:43.035026 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 21:59:43.069791 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 21:59:43.072256 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 21:59:43.075117 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 21:59:43.077321 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 21:59:43.079328 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 21:59:43.085619 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 21:59:43.089987 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 21:59:43.092965 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 21:59:43.094719 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 21:59:43.096487 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 21:59:43.098663 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 21:59:43.104114 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 21:59:43.108081 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 21:59:43.119563 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 21:59:43.124664 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 21:59:43.131124 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 21:59:43.132543 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 21:59:43.136437 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 21:59:43.141370 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 21:59:43.148173 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 21:59:43.160302 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 21:59:43.163923 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 21:59:43.164716 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 21:59:43.174912 (MainThread): Parsing macros/tables/link.sql
2022-02-07 21:59:43.184766 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 21:59:43.196912 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 21:59:43.217027 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 21:59:43.227188 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 21:59:43.254121 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 21:59:43.263628 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 21:59:43.284397 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 21:59:43.285806 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 21:59:43.305133 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 21:59:43.311297 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 21:59:43.322004 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 21:59:43.325277 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 21:59:43.340148 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 21:59:43.345926 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 21:59:43.374919 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 21:59:43.394940 (MainThread): Partial parsing not enabled
2022-02-07 21:59:43.502101 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:59:43.617574 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:59:43.660493 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:59:43.686763 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:59:43.707143 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:59:43.737717 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:59:43.760044 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:59:43.784489 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:59:43.805577 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:59:43.906374 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:59:43.945545 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:59:43.981225 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:59:44.004768 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:59:44.016066 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:59:44.034456 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 21:59:44.062010 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 21:59:44.077567 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:59:44.093758 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:59:44.830599 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.report
- models.project_otus_dbt.raw_vault.links

2022-02-07 21:59:44.981520 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 21:59:44.982519 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 21:59:44.985248 (MainThread): 
2022-02-07 21:59:44.986754 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:59:45.029584 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 21:59:45.051644 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 21:59:45.051971 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 21:59:45.052239 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 21:59:45.068191 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 21:59:45.072469 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 21:59:45.102924 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 21:59:45.114826 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:59:45.115141 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 21:59:45.115331 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 21:59:45.127240 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:59:45.127498 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 21:59:45.127635 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 21:59:45.132570 (ThreadPoolExecutor-1_0): SQL status: SELECT 23 in 0.00 seconds
2022-02-07 21:59:45.150683 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 21:59:45.152051 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 21:59:45.187458 (MainThread): Using postgres connection "master".
2022-02-07 21:59:45.187708 (MainThread): On master: BEGIN
2022-02-07 21:59:45.187805 (MainThread): Opening a new connection, currently in state init
2022-02-07 21:59:45.198520 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:59:45.198765 (MainThread): Using postgres connection "master".
2022-02-07 21:59:45.198897 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 21:59:45.509275 (MainThread): SQL status: SELECT 14 in 0.31 seconds
2022-02-07 21:59:45.539344 (MainThread): On master: ROLLBACK
2022-02-07 21:59:45.540899 (MainThread): Using postgres connection "master".
2022-02-07 21:59:45.541237 (MainThread): On master: BEGIN
2022-02-07 21:59:45.543910 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:59:45.544385 (MainThread): On master: COMMIT
2022-02-07 21:59:45.544660 (MainThread): Using postgres connection "master".
2022-02-07 21:59:45.544911 (MainThread): On master: COMMIT
2022-02-07 21:59:45.546539 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:45.546981 (MainThread): On master: Close
2022-02-07 21:59:45.547776 (MainThread): 00:59:45 | Concurrency: 2 threads (target='dev')
2022-02-07 21:59:45.548366 (MainThread): 00:59:45 | 
2022-02-07 21:59:45.564927 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:59:45.565254 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:59:45.567973 (Thread-1): 00:59:45 | 1 of 18 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-07 21:59:45.569665 (Thread-2): 00:59:45 | 2 of 18 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-07 21:59:45.570638 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:59:45.571673 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:59:45.572107 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:59:45.572458 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:59:45.650693 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:59:45.654984 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:59:45.655294 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 21:59:45.655733 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-07 21:59:45.656135 (Thread-2): Opening a new connection, currently in state init
2022-02-07 21:59:45.656568 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:59:45.671968 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:59:45.672248 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 21:59:45.672480 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:59:45.672788 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:59:45.673048 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:45.673356 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:45.683435 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-07 21:59:45.751467 (Thread-2): SQL status: SELECT 18 in 0.08 seconds
2022-02-07 21:59:45.756202 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:59:45.761898 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:45.764051 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:59:45.764435 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:45.769963 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-07 21:59:45.770211 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 21:59:45.778273 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:59:45.787360 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:59:45.788115 (Thread-2): finished collecting timing info
2022-02-07 21:59:45.788563 (Thread-1): finished collecting timing info
2022-02-07 21:59:45.841981 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:59:45.843393 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:59:45.843606 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 21:59:45.843849 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 21:59:45.845637 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:59:45.846023 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:59:45.850005 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:59:45.853670 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:59:45.854025 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:59:45.854238 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:59:45.855920 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:59:45.856154 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:59:45.860548 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 21:59:45.862605 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 21:59:45.863357 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:59:45.863544 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:59:45.863764 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:59:45.864079 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:59:45.868579 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 21:59:45.874958 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:59:45.877521 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:59:45.882164 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:59:45.882534 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-07 21:59:45.882753 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-07 21:59:45.884725 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:59:45.888488 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:59:45.888738 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 21:59:45.889008 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-07 21:59:45.892571 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:59:45.893105 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 21:59:45.895303 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:59:45.895591 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:59:45.904820 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:59:45.906212 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:59:45.906494 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:59:45.906710 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:59:45.906914 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 21:59:45.907157 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 21:59:45.912940 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:59:45.918987 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:59:45.920619 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 21:59:45.923544 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 21:59:45.923824 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 21:59:45.924115 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:59:45.929709 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:59:45.932238 (Thread-2): finished collecting timing info
2022-02-07 21:59:45.932529 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:59:45.932801 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 21:59:45.936081 (Thread-1): finished collecting timing info
2022-02-07 21:59:45.936666 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-07 21:59:45.940390 (Thread-2): 00:59:45 | 2 of 18 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.37s]
2022-02-07 21:59:45.942958 (Thread-1): 00:59:45 | 1 of 18 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.37s]
2022-02-07 21:59:45.943540 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 21:59:45.944022 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 21:59:45.944496 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:59:45.945286 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:59:45.947872 (Thread-2): 00:59:45 | 3 of 18 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-07 21:59:45.949561 (Thread-1): 00:59:45 | 4 of 18 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-07 21:59:45.950257 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:59:45.950866 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:59:45.951174 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:59:45.951545 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:59:45.981487 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:59:45.986936 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 21:59:45.987825 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:59:45.988102 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:59:45.988351 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-07 21:59:45.989309 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:59:45.998867 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:59:45.999108 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:59:45.999233 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.003057 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:59:46.003407 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:59:46.003645 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.010543 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:59:46.017930 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:59:46.018238 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:59:46.018504 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.025695 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:59:46.026146 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.031644 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:59:46.031978 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 21:59:46.041125 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:59:46.047955 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:59:46.048918 (Thread-2): finished collecting timing info
2022-02-07 21:59:46.054521 (Thread-1): finished collecting timing info
2022-02-07 21:59:46.058104 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:59:46.068827 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 21:59:46.070599 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:59:46.070987 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-07 21:59:46.072106 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:59:46.072339 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:59:46.076067 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:59:46.081685 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:59:46.081914 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:59:46.082234 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:59:46.083775 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:59:46.083979 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:59:46.085532 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 21:59:46.086635 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 21:59:46.087293 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:59:46.087443 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:59:46.087624 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:59:46.088221 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 21:59:46.091580 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 21:59:46.095721 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:59:46.095972 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 21:59:46.096150 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-07 21:59:46.103833 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:59:46.104272 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-07 21:59:46.106023 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:59:46.106258 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:59:46.109903 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:59:46.113439 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:59:46.113792 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-07 21:59:46.114009 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-07 21:59:46.116068 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:59:46.116454 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:59:46.118307 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:59:46.119817 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:59:46.120098 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:59:46.120372 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:59:46.120590 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 21:59:46.120852 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 21:59:46.123485 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:46.127433 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 21:59:46.127708 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:59:46.127919 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 21:59:46.130599 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 21:59:46.131113 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 21:59:46.134564 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:59:46.134833 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:59:46.137870 (Thread-2): finished collecting timing info
2022-02-07 21:59:46.142031 (Thread-1): finished collecting timing info
2022-02-07 21:59:46.142574 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 21:59:46.142854 (Thread-1): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-07 21:59:46.145254 (Thread-2): 00:59:46 | 3 of 18 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.19s]
2022-02-07 21:59:46.147279 (Thread-1): 00:59:46 | 4 of 18 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.20s]
2022-02-07 21:59:46.147637 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 21:59:46.148025 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 21:59:46.148495 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_gbp
2022-02-07 21:59:46.149339 (Thread-1): Began running node model.project_otus_dbt.dim_day
2022-02-07 21:59:46.151805 (Thread-2): 00:59:46 | 5 of 18 START table model public.dds_wheat_gbp....................... [RUN]
2022-02-07 21:59:46.154785 (Thread-1): 00:59:46 | 6 of 18 START table model public.dim_day............................. [RUN]
2022-02-07 21:59:46.155779 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 21:59:46.156549 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:59:46.156852 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_gbp
2022-02-07 21:59:46.157188 (Thread-1): Compiling model.project_otus_dbt.dim_day
2022-02-07 21:59:46.165944 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-07 21:59:46.173738 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:59:46.174430 (Thread-1): finished collecting timing info
2022-02-07 21:59:46.174789 (Thread-2): finished collecting timing info
2022-02-07 21:59:46.208165 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:59:46.213574 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-07 21:59:46.219055 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:59:46.228308 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 21:59:46.228536 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_tmp" cascade
2022-02-07 21:59:46.228624 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:59:46.235184 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 21:59:46.240408 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:59:46.241076 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:59:46.243112 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:59:46.243380 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:59:46.251628 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 21:59:46.256009 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 21:59:46.256674 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-07 21:59:46.257322 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:59:46.257545 (Thread-1): On model.project_otus_dbt.dim_day: BEGIN
2022-02-07 21:59:46.258259 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:59:46.260002 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-07 21:59:46.260212 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:59:46.260575 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:59:46.260759 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 day')
        as t(date)
        )

select * from dim_day
order by date desc
  );
2022-02-07 21:59:46.260957 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 21:59:46.261222 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: BEGIN
2022-02-07 21:59:46.262225 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:59:46.262469 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 21:59:46.262597 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */


  create  table "postgres"."public"."dds_wheat_gbp__dbt_tmp"
  as (
    with gbp as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,cast(su.price as decimal(18,2))/100.0*rt.rate as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from public.hub_wheat_gbp as hu
    left join public.sat_wheat_gbp_details as su
    on hu.date_pk=su.date_pk
    left join public.dds_rate_gbp_usd as rt
    on hu.date_pk=rt.date_pk
)
select * from gbp
  );
2022-02-07 21:59:46.272990 (Thread-2): SQL status: SELECT 531 in 0.01 seconds
2022-02-07 21:59:46.277952 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 21:59:46.278185 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp__dbt_tmp" rename to "dds_wheat_gbp"
2022-02-07 21:59:46.279716 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:59:46.281122 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-07 21:59:46.281340 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 21:59:46.281420 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-07 21:59:46.283879 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:46.286512 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 21:59:46.286742 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-07 21:59:46.287326 (Thread-1): SQL status: SELECT 5114 in 0.03 seconds
2022-02-07 21:59:46.293114 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:59:46.293367 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:59:46.296697 (Thread-2): finished collecting timing info
2022-02-07 21:59:46.297140 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-07 21:59:46.297372 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: Close
2022-02-07 21:59:46.300146 (Thread-2): 00:59:46 | 5 of 18 OK created table model public.dds_wheat_gbp.................. [SELECT 531 in 0.14s]
2022-02-07 21:59:46.300448 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:59:46.300783 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_gbp
2022-02-07 21:59:46.305188 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:59:46.305709 (Thread-2): Began running node model.project_otus_dbt.dim_week
2022-02-07 21:59:46.306387 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-07 21:59:46.308466 (Thread-2): 00:59:46 | 7 of 18 START table model public.dim_week............................ [RUN]
2022-02-07 21:59:46.309376 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:59:46.309776 (Thread-2): Compiling model.project_otus_dbt.dim_week
2022-02-07 21:59:46.315859 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 21:59:46.316202 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:59:46.317745 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:59:46.318274 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:59:46.318703 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 21:59:46.318895 (Thread-2): finished collecting timing info
2022-02-07 21:59:46.332033 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:59:46.332584 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:59:46.335865 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 21:59:46.336313 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-07 21:59:46.336677 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 21:59:46.336973 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:59:46.342697 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:59:46.346428 (Thread-1): finished collecting timing info
2022-02-07 21:59:46.347027 (Thread-1): On model.project_otus_dbt.dim_day: Close
2022-02-07 21:59:46.349331 (Thread-1): 00:59:46 | 6 of 18 OK created table model public.dim_day........................ [SELECT 5114 in 0.19s]
2022-02-07 21:59:46.349682 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:59:46.350168 (Thread-1): Finished running node model.project_otus_dbt.dim_day
2022-02-07 21:59:46.356730 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:59:46.357140 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:59:46.357736 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:59:46.359229 (Thread-1): 00:59:46 | 8 of 18 START incremental model public.hub_wheat_msk................. [RUN]
2022-02-07 21:59:46.360002 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:59:46.360253 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:59:46.366210 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:59:46.374566 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:59:46.376562 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 21:59:46.377374 (Thread-1): finished collecting timing info
2022-02-07 21:59:46.377798 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:59:46.388780 (Thread-2): On model.project_otus_dbt.dim_week: BEGIN
2022-02-07 21:59:46.400897 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:59:46.406452 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:59:46.411987 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-07 21:59:46.417342 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:59:46.417688 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp005946413113"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:59:46.417800 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:59:46.428610 (Thread-2): SQL status: SELECT 731 in 0.01 seconds
2022-02-07 21:59:46.434288 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:59:46.434571 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 21:59:46.434818 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-07 21:59:46.441326 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:59:46.441768 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-07 21:59:46.443028 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:59:46.443270 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:59:46.443501 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:59:46.447249 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:59:46.447579 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp005946413113'
        
      order by ordinal_position

  
2022-02-07 21:59:46.447808 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-07 21:59:46.449773 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:59:46.451270 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:59:46.451511 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:59:46.451660 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 21:59:46.454521 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:46.457804 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 21:59:46.458041 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 21:59:46.458740 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:59:46.465280 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:59:46.465564 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:59:46.465793 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.470550 (Thread-2): finished collecting timing info
2022-02-07 21:59:46.471328 (Thread-2): On model.project_otus_dbt.dim_week: Close
2022-02-07 21:59:46.473349 (Thread-2): 00:59:46 | 7 of 18 OK created table model public.dim_week....................... [SELECT 731 in 0.16s]
2022-02-07 21:59:46.473765 (Thread-2): Finished running node model.project_otus_dbt.dim_week
2022-02-07 21:59:46.474144 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:59:46.476131 (Thread-2): 00:59:46 | 9 of 18 START incremental model public.sat_wheat_msk_details......... [RUN]
2022-02-07 21:59:46.476989 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:59:46.477331 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:59:46.477591 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:59:46.486274 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:59:46.497679 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.512357 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:59:46.513401 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:59:46.514462 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 21:59:46.515281 (Thread-2): finished collecting timing info
2022-02-07 21:59:46.520869 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:59:46.526276 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp005946413113"
    );
  
2022-02-07 21:59:46.526652 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:59:46.526955 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp005946524750"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:59:46.527100 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:59:46.528347 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:59:46.530111 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:59:46.530359 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 21:59:46.530501 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 21:59:46.532979 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:46.535539 (Thread-1): finished collecting timing info
2022-02-07 21:59:46.535996 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-07 21:59:46.538346 (Thread-1): 00:59:46 | 8 of 18 OK created incremental model public.hub_wheat_msk............ [INSERT 0 0 in 0.18s]
2022-02-07 21:59:46.538802 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 21:59:46.539361 (Thread-1): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 21:59:46.541848 (Thread-1): 00:59:46 | 10 of 18 START incremental model public.hub_rate_gbp_usd............. [RUN]
2022-02-07 21:59:46.543017 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:59:46.543361 (Thread-1): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 21:59:46.558628 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 21:59:46.558919 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:59:46.563829 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:59:46.564160 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-07 21:59:46.564636 (Thread-1): finished collecting timing info
2022-02-07 21:59:46.571314 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:59:46.576939 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:59:46.578314 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:59:46.578536 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp005946524750'
        
      order by ordinal_position

  
2022-02-07 21:59:46.578792 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp005946576063"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:59:46.579243 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:59:46.588344 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:59:46.594250 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:59:46.594575 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.600072 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 21:59:46.605028 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:59:46.605305 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:59:46.605544 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.609081 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:59:46.609668 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-07 21:59:46.610779 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:59:46.611088 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:59:46.611251 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp005946576063'
        
      order by ordinal_position

  
2022-02-07 21:59:46.614037 (Thread-2): SQL status: SELECT 12 in 0.00 seconds
2022-02-07 21:59:46.615879 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 21:59:46.616402 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:59:46.616571 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp005946524750"
    );
  
2022-02-07 21:59:46.618106 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:59:46.619764 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:59:46.620047 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 21:59:46.620127 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 21:59:46.621276 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:59:46.625437 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:59:46.625671 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 21:59:46.625853 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.628278 (Thread-2): finished collecting timing info
2022-02-07 21:59:46.629024 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-07 21:59:46.631941 (Thread-2): 00:59:46 | 9 of 18 OK created incremental model public.sat_wheat_msk_details.... [INSERT 0 0 in 0.15s]
2022-02-07 21:59:46.632349 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 21:59:46.632910 (Thread-2): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 21:59:46.633410 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 21:59:46.635185 (Thread-2): 00:59:46 | 11 of 18 START incremental model public.sat_rate_gbp_usd_details..... [RUN]
2022-02-07 21:59:46.640252 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:59:46.641189 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:59:46.641444 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.641791 (Thread-2): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 21:59:46.652965 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:59:46.659651 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 21:59:46.666629 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 21:59:46.667177 (Thread-2): finished collecting timing info
2022-02-07 21:59:46.667591 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:59:46.675545 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:59:46.675791 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp005946576063"
    );
  
2022-02-07 21:59:46.676242 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp005946674106"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:59:46.676735 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:59:46.678069 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:59:46.679706 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 21:59:46.679969 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 21:59:46.680134 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 21:59:46.682326 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:46.684697 (Thread-1): finished collecting timing info
2022-02-07 21:59:46.685131 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-07 21:59:46.687028 (Thread-1): 00:59:46 | 10 of 18 OK created incremental model public.hub_rate_gbp_usd........ [INSERT 0 0 in 0.14s]
2022-02-07 21:59:46.687625 (Thread-1): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 21:59:46.688135 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:59:46.690821 (Thread-1): 00:59:46 | 12 of 18 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-07 21:59:46.691754 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:59:46.692180 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:59:46.705513 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:59:46.705816 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:59:46.712069 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:59:46.712440 (Thread-1): finished collecting timing info
2022-02-07 21:59:46.712870 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-07 21:59:46.722751 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:59:46.723371 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp005946721241"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:59:46.723569 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:59:46.724891 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:59:46.725259 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:59:46.725442 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp005946674106'
        
      order by ordinal_position

  
2022-02-07 21:59:46.733797 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:59:46.740723 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:59:46.740956 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.743617 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 21:59:46.748280 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:59:46.748541 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:59:46.748748 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-07 21:59:46.755375 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:59:46.755849 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.757164 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:59:46.757395 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:59:46.757503 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp005946721241'
        
      order by ordinal_position

  
2022-02-07 21:59:46.760497 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:59:46.761873 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 21:59:46.762375 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:59:46.762516 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp005946674106"
    );
  
2022-02-07 21:59:46.764132 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:59:46.765625 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 21:59:46.765916 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 21:59:46.766043 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 21:59:46.766389 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:59:46.817347 (Thread-2): SQL status: COMMIT in 0.05 seconds
2022-02-07 21:59:46.821562 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:59:46.824911 (Thread-2): finished collecting timing info
2022-02-07 21:59:46.825583 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.826126 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-07 21:59:46.830051 (Thread-2): 00:59:46 | 11 of 18 OK created incremental model public.sat_rate_gbp_usd_details [INSERT 0 0 in 0.19s]
2022-02-07 21:59:46.830580 (Thread-2): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 21:59:46.831461 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:59:46.835503 (Thread-2): 00:59:46 | 13 of 18 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-07 21:59:46.835851 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:59:46.836640 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:59:46.844286 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:59:46.844640 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:59:46.845060 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.867106 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:59:46.868478 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 21:59:46.875219 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:59:46.875899 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:59:46.876259 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp005946721241"
    );
  
2022-02-07 21:59:46.876904 (Thread-2): finished collecting timing info
2022-02-07 21:59:46.883334 (Thread-1): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-07 21:59:46.888049 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:59:46.889859 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:59:46.890195 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp005946886480"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:59:46.890536 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 21:59:46.890941 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:59:46.891313 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 21:59:46.894670 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:46.897959 (Thread-1): finished collecting timing info
2022-02-07 21:59:46.898364 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-07 21:59:46.901448 (Thread-1): 00:59:46 | 12 of 18 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.21s]
2022-02-07 21:59:46.901949 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 21:59:46.902743 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:59:46.905865 (Thread-1): 00:59:46 | 14 of 18 START incremental model public.hub_wheat_gbp................ [RUN]
2022-02-07 21:59:46.906650 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:59:46.907087 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:59:46.922763 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:59:46.923031 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:59:46.928990 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:59:46.929736 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-07 21:59:46.930143 (Thread-1): finished collecting timing info
2022-02-07 21:59:46.936501 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:59:46.942019 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:59:46.942342 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:59:46.942572 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp005946886480'
        
      order by ordinal_position

  
2022-02-07 21:59:46.942833 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp005946939257"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:59:46.943364 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:59:46.952791 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:59:46.957969 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:59:46.958325 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.963555 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:59:46.968787 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:59:46.969025 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:59:46.969213 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:46.974207 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:59:46.974781 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-07 21:59:46.976114 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:59:46.976452 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:59:46.976665 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp005946939257'
        
      order by ordinal_position

  
2022-02-07 21:59:46.979258 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:59:46.980963 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 21:59:46.981666 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:59:46.981862 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp005946886480"
    );
  
2022-02-07 21:59:46.983469 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:59:46.985285 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:59:46.985740 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:59:46.986233 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 21:59:46.996567 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:59:46.997017 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 21:59:46.997419 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:47.000128 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:47.002823 (Thread-2): finished collecting timing info
2022-02-07 21:59:47.003309 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:59:47.003529 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-07 21:59:47.008154 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:59:47.008598 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:47.010978 (Thread-2): 00:59:47 | 13 of 18 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.17s]
2022-02-07 21:59:47.011702 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 21:59:47.012175 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:59:47.014520 (Thread-2): 00:59:47 | 15 of 18 START incremental model public.sat_wheat_gbp_details........ [RUN]
2022-02-07 21:59:47.015727 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:59:47.016154 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:59:47.022290 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 21:59:47.028857 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 21:59:47.040686 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:59:47.041227 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:59:47.041541 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp005946939257"
    );
  
2022-02-07 21:59:47.041840 (Thread-2): finished collecting timing info
2022-02-07 21:59:47.048705 (Thread-1): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-07 21:59:47.051880 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:59:47.054030 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:59:47.054466 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp005947049078"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 21:59:47.054780 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 21:59:47.055068 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:59:47.055330 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 21:59:47.058521 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:47.061319 (Thread-1): finished collecting timing info
2022-02-07 21:59:47.061713 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-07 21:59:47.064305 (Thread-1): 00:59:47 | 14 of 18 OK created incremental model public.hub_wheat_gbp........... [INSERT 0 0 in 0.16s]
2022-02-07 21:59:47.064834 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 21:59:47.065407 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:59:47.068912 (Thread-1): 00:59:47 | 16 of 18 START table model public.dds_wheat_msk...................... [RUN]
2022-02-07 21:59:47.069726 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:59:47.070184 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:59:47.080889 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 21:59:47.081137 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 21:59:47.085712 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:59:47.086115 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-07 21:59:47.086390 (Thread-1): finished collecting timing info
2022-02-07 21:59:47.092966 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:59:47.097898 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:59:47.098287 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:59:47.098598 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-07 21:59:47.098866 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp005947049078'
        
      order by ordinal_position

  
2022-02-07 21:59:47.099282 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:59:47.108978 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 21:59:47.115091 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:59:47.115335 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 21:59:47.115571 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:47.118822 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:59:47.119343 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 21:59:47.120462 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:59:47.122429 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 21:59:47.123093 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:59:47.123291 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-07 21:59:47.123952 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:59:47.128611 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:59:47.128875 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:59:47.129116 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 21:59:47.129379 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:59:47.129939 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */


  create  table "postgres"."public"."dds_wheat_msk__dbt_tmp"
  as (
    with dds_wheat_msk as(
    select sm.tradedate  as tradedate
        ,cast(sm.value as decimal(18,2)) as value
        ,cast(sm.open as decimal(18,2)) as open
        ,cast(sm.close as decimal(18,2)) as close
        ,cast(sm.high as decimal(18,2)) as high
        ,cast(sm.low as decimal(18,2)) as low
        ,cast(sm.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hm
    left join "postgres"."public"."sat_wheat_msk_details" as sm
    on hm.date_pk=sm.date_pk
)
select * from dds_wheat_msk
  );
2022-02-07 21:59:47.133908 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 21:59:47.135568 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 21:59:47.135815 (Thread-1): SQL status: SELECT 216 in 0.01 seconds
2022-02-07 21:59:47.142147 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:59:47.142406 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-07 21:59:47.142654 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:59:47.142848 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp005947049078"
    );
  
2022-02-07 21:59:47.144180 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 21:59:47.144471 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:59:47.146109 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:59:47.150004 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:59:47.150349 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 21:59:47.150564 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-07 21:59:47.150892 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 21:59:47.152521 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:59:47.154079 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 21:59:47.154331 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:47.154521 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:59:47.156659 (Thread-2): finished collecting timing info
2022-02-07 21:59:47.157028 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 21:59:47.157261 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-07 21:59:47.159286 (Thread-2): 00:59:47 | 15 of 18 OK created incremental model public.sat_wheat_gbp_details... [INSERT 0 0 in 0.14s]
2022-02-07 21:59:47.160007 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 21:59:47.160264 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:47.160676 (Thread-2): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 21:59:47.164702 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 21:59:47.166255 (Thread-2): 00:59:47 | 17 of 18 START table model public.dds_rate_gbp_usd................... [RUN]
2022-02-07 21:59:47.166717 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop view if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 21:59:47.167401 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:59:47.167996 (Thread-2): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 21:59:47.176405 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 21:59:47.179593 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-07 21:59:47.182938 (Thread-1): finished collecting timing info
2022-02-07 21:59:47.183807 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-07 21:59:47.184161 (Thread-2): finished collecting timing info
2022-02-07 21:59:47.186705 (Thread-1): 00:59:47 | 16 of 18 OK created table model public.dds_wheat_msk................. [SELECT 216 in 0.12s]
2022-02-07 21:59:47.198990 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:59:47.199595 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 21:59:47.199819 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 21:59:47.200187 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_usa
2022-02-07 21:59:47.200960 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 21:59:47.202372 (Thread-1): 00:59:47 | 18 of 18 START table model public.dds_wheat_usa...................... [RUN]
2022-02-07 21:59:47.203657 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 21:59:47.204133 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_usa
2022-02-07 21:59:47.214645 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-07 21:59:47.215181 (Thread-1): finished collecting timing info
2022-02-07 21:59:47.222299 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 21:59:47.224737 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 21:59:47.228546 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:59:47.228898 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_tmp" cascade
2022-02-07 21:59:47.229202 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop view if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:59:47.229504 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 21:59:47.231241 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:59:47.232828 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-07 21:59:47.233521 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:59:47.233785 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-07 21:59:47.235155 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:59:47.235421 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:59:47.235505 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */


  create  table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp"
  as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );
2022-02-07 21:59:47.241816 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 21:59:47.246703 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 21:59:47.247032 (Thread-2): SQL status: SELECT 548 in 0.01 seconds
2022-02-07 21:59:47.247243 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-07 21:59:47.252458 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:59:47.252979 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd" rename to "dds_rate_gbp_usd__dbt_backup"
2022-02-07 21:59:47.253995 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 21:59:47.255995 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-07 21:59:47.256221 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:59:47.259934 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:59:47.260228 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-07 21:59:47.260489 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 21:59:47.260842 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: BEGIN
2022-02-07 21:59:47.262088 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 21:59:47.262359 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 21:59:47.263543 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-07 21:59:47.263828 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 21:59:47.264022 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:59:47.264216 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */


  create  table "postgres"."public"."dds_wheat_usa__dbt_tmp"
  as (
    with usa as (
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,cast(su.price as decimal(18,2))/100.0/2.7 as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_usa" as hu
    left join "postgres"."public"."sat_wheat_usa_details" as su
    on hu.date_pk=su.date_pk;
)
select * from usa;
  );
2022-02-07 21:59:47.264397 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-07 21:59:47.266152 (Thread-1): Postgres error: syntax error at or near ";"
LINE 15:     on hu.date_pk=su.date_pk;
                                     ^

2022-02-07 21:59:47.266427 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: ROLLBACK
2022-02-07 21:59:47.267486 (Thread-1): finished collecting timing info
2022-02-07 21:59:47.267942 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:47.268156 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: Close
2022-02-07 21:59:47.271544 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 21:59:47.272113 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop view if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-07 21:59:47.272883 (Thread-1): Database Error in model dds_wheat_usa (models/dds/dds_wheat_usa.sql)
  syntax error at or near ";"
  LINE 15:     on hu.date_pk=su.date_pk;
                                       ^
  compiled SQL at target/run/project_otus_dbt/models/dds/dds_wheat_usa.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near ";"
LINE 15:     on hu.date_pk=su.date_pk;
                                     ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 63, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model dds_wheat_usa (models/dds/dds_wheat_usa.sql)
  syntax error at or near ";"
  LINE 15:     on hu.date_pk=su.date_pk;
                                       ^
  compiled SQL at target/run/project_otus_dbt/models/dds/dds_wheat_usa.sql
2022-02-07 21:59:47.276501 (Thread-1): 00:59:47 | 18 of 18 ERROR creating table model public.dds_wheat_usa............. [ERROR in 0.07s]
2022-02-07 21:59:47.276727 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 21:59:47.277017 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_usa
2022-02-07 21:59:47.281059 (Thread-2): finished collecting timing info
2022-02-07 21:59:47.282055 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-07 21:59:47.284602 (Thread-2): 00:59:47 | 17 of 18 OK created table model public.dds_rate_gbp_usd.............. [SELECT 548 in 0.12s]
2022-02-07 21:59:47.285196 (Thread-2): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 21:59:47.287713 (MainThread): Acquiring new postgres connection "master".
2022-02-07 21:59:47.288240 (MainThread): Using postgres connection "master".
2022-02-07 21:59:47.288433 (MainThread): On master: BEGIN
2022-02-07 21:59:47.288585 (MainThread): Opening a new connection, currently in state closed
2022-02-07 21:59:47.298692 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 21:59:47.298942 (MainThread): On master: COMMIT
2022-02-07 21:59:47.299056 (MainThread): Using postgres connection "master".
2022-02-07 21:59:47.299162 (MainThread): On master: COMMIT
2022-02-07 21:59:47.300187 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 21:59:47.300458 (MainThread): On master: Close
2022-02-07 21:59:47.301275 (MainThread): 00:59:47 | 
2022-02-07 21:59:47.301578 (MainThread): 00:59:47 | Finished running 4 view models, 6 table models, 8 incremental models in 2.32s.
2022-02-07 21:59:47.301837 (MainThread): Connection 'master' was properly closed.
2022-02-07 21:59:47.302084 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_usa' was properly closed.
2022-02-07 21:59:47.302262 (MainThread): Connection 'model.project_otus_dbt.dds_rate_gbp_usd' was properly closed.
2022-02-07 21:59:47.424584 (MainThread): 
2022-02-07 21:59:47.424917 (MainThread): Completed with 1 error and 0 warnings:
2022-02-07 21:59:47.425151 (MainThread): 
2022-02-07 21:59:47.425359 (MainThread): Database Error in model dds_wheat_usa (models/dds/dds_wheat_usa.sql)
2022-02-07 21:59:47.425636 (MainThread):   syntax error at or near ";"
2022-02-07 21:59:47.425903 (MainThread):   LINE 15:     on hu.date_pk=su.date_pk;
2022-02-07 21:59:47.426211 (MainThread):                                        ^
2022-02-07 21:59:47.426467 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/dds/dds_wheat_usa.sql
2022-02-07 21:59:47.426802 (MainThread): 
Done. PASS=17 WARN=0 ERROR=1 SKIP=0 TOTAL=18
2022-02-07 21:59:47.427240 (MainThread): Flushing usage events
2022-02-07 21:59:58.931829 (MainThread): Running with dbt=0.19.0
2022-02-07 21:59:59.041765 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-02-07 21:59:59.043049 (MainThread): Tracking: do not track
2022-02-07 21:59:59.125476 (MainThread): Partial parsing not enabled
2022-02-07 21:59:59.126690 (MainThread): Parsing macros/adapters.sql
2022-02-07 21:59:59.150667 (MainThread): Parsing macros/catalog.sql
2022-02-07 21:59:59.153134 (MainThread): Parsing macros/relations.sql
2022-02-07 21:59:59.154561 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 21:59:59.156999 (MainThread): Parsing macros/core.sql
2022-02-07 21:59:59.160634 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 21:59:59.223110 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 21:59:59.226766 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 21:59:59.229720 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 21:59:59.253358 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 21:59:59.257371 (MainThread): Parsing macros/etc/query.sql
2022-02-07 21:59:59.259613 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 21:59:59.261473 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 21:59:59.277437 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 21:59:59.305674 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 21:59:59.307893 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 21:59:59.339211 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 21:59:59.356357 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 21:59:59.362056 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 21:59:59.363999 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 21:59:59.376147 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 21:59:59.385514 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 21:59:59.400577 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 21:59:59.414463 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 21:59:59.417717 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 21:59:59.420345 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 21:59:59.423541 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 21:59:59.429965 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 21:59:59.432696 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 21:59:59.435631 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 21:59:59.437183 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 21:59:59.449662 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 21:59:59.452171 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 21:59:59.454178 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 21:59:59.456974 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 21:59:59.458165 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 21:59:59.460585 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 21:59:59.463704 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 21:59:59.465438 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 21:59:59.467286 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 21:59:59.469656 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 21:59:59.479234 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 21:59:59.485422 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 21:59:59.490070 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 21:59:59.492547 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 21:59:59.495458 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 21:59:59.497679 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 21:59:59.499974 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 21:59:59.508057 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 21:59:59.509932 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 21:59:59.512102 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 21:59:59.514772 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 21:59:59.518325 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 21:59:59.520707 (MainThread): Parsing macros/sql/star.sql
2022-02-07 21:59:59.525368 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 21:59:59.527503 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 21:59:59.532646 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 21:59:59.537985 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 21:59:59.556145 (MainThread): Parsing macros/sql/union.sql
2022-02-07 21:59:59.565144 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 21:59:59.567271 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 21:59:59.572039 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 21:59:59.575713 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 21:59:59.579290 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 21:59:59.585623 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 21:59:59.590227 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 21:59:59.591838 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 21:59:59.593659 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 21:59:59.596041 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 21:59:59.599375 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 21:59:59.600659 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 21:59:59.602006 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 21:59:59.603237 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 21:59:59.666094 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 21:59:59.670345 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 21:59:59.674930 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 21:59:59.678104 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 21:59:59.680392 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 21:59:59.686808 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 21:59:59.690973 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 21:59:59.694322 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 21:59:59.696231 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 21:59:59.698273 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 21:59:59.700688 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 21:59:59.704118 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 21:59:59.706190 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 21:59:59.712809 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 21:59:59.715753 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 21:59:59.720043 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 21:59:59.721205 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 21:59:59.724177 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 21:59:59.728126 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 21:59:59.734056 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 21:59:59.745867 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 21:59:59.750488 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 21:59:59.751507 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 21:59:59.764660 (MainThread): Parsing macros/tables/link.sql
2022-02-07 21:59:59.779915 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 21:59:59.792792 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 21:59:59.801474 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 21:59:59.805992 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 21:59:59.821252 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 21:59:59.828108 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 21:59:59.845759 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 21:59:59.847103 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 21:59:59.866397 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 21:59:59.878385 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 21:59:59.896417 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 21:59:59.899805 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 21:59:59.914108 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 21:59:59.920079 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 21:59:59.942787 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 21:59:59.952474 (MainThread): Partial parsing not enabled
2022-02-07 22:00:00.046135 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:00.206727 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:00.242552 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:00.290423 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:00.331608 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:00.388202 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:00.428056 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:00.463803 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:00.485402 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:00.651875 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:00.674918 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:00.706258 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:00.738543 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:00.755676 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:00.768512 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:00.782118 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:00.793857 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:00.813145 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:01.615747 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.raw_vault.links
- models.project_otus_dbt.report

2022-02-07 22:00:01.788510 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 22:00:01.790372 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 22:00:01.793626 (MainThread): 
2022-02-07 22:00:01.794434 (MainThread): Acquiring new postgres connection "master".
2022-02-07 22:00:01.800760 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 22:00:01.813280 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 22:00:01.813493 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 22:00:01.813601 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 22:00:01.824970 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 22:00:01.827824 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 22:00:01.855383 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 22:00:01.862422 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 22:00:01.862644 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 22:00:01.862736 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 22:00:01.873363 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:01.873657 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 22:00:01.873816 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 22:00:01.879092 (ThreadPoolExecutor-1_0): SQL status: SELECT 24 in 0.01 seconds
2022-02-07 22:00:01.900778 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 22:00:01.902330 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 22:00:01.931713 (MainThread): Using postgres connection "master".
2022-02-07 22:00:01.931930 (MainThread): On master: BEGIN
2022-02-07 22:00:01.932014 (MainThread): Opening a new connection, currently in state init
2022-02-07 22:00:01.943262 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:01.943577 (MainThread): Using postgres connection "master".
2022-02-07 22:00:01.943766 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 22:00:02.256030 (MainThread): SQL status: SELECT 10 in 0.31 seconds
2022-02-07 22:00:02.276760 (MainThread): On master: ROLLBACK
2022-02-07 22:00:02.278368 (MainThread): Using postgres connection "master".
2022-02-07 22:00:02.278617 (MainThread): On master: BEGIN
2022-02-07 22:00:02.281183 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:02.281631 (MainThread): On master: COMMIT
2022-02-07 22:00:02.281931 (MainThread): Using postgres connection "master".
2022-02-07 22:00:02.282214 (MainThread): On master: COMMIT
2022-02-07 22:00:02.283816 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:02.284056 (MainThread): On master: Close
2022-02-07 22:00:02.284501 (MainThread): 01:00:02 | Concurrency: 2 threads (target='dev')
2022-02-07 22:00:02.284771 (MainThread): 01:00:02 | 
2022-02-07 22:00:02.300291 (Thread-1): Began running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-07 22:00:02.300829 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_gbp
2022-02-07 22:00:02.304706 (Thread-1): 01:00:02 | 1 of 4 START seed file public.source_rate_gbp_usd.................... [RUN]
2022-02-07 22:00:02.307779 (Thread-2): 01:00:02 | 2 of 4 START seed file public.source_wheat_gbp....................... [RUN]
2022-02-07 22:00:02.309233 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 22:00:02.310611 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 22:00:02.311208 (Thread-1): finished collecting timing info
2022-02-07 22:00:02.312141 (Thread-2): finished collecting timing info
2022-02-07 22:00:02.450684 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 22:00:02.520502 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: BEGIN
2022-02-07 22:00:02.521451 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 22:00:02.521680 (Thread-2): Opening a new connection, currently in state init
2022-02-07 22:00:02.521894 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: BEGIN
2022-02-07 22:00:02.522404 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:02.534315 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:02.534623 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 22:00:02.534817 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_gbp"} */
truncate table "postgres"."public"."source_wheat_gbp"
2022-02-07 22:00:02.539553 (Thread-2): SQL status: TRUNCATE TABLE in 0.00 seconds
2022-02-07 22:00:02.554001 (Thread-1): SQL status: BEGIN in 0.03 seconds
2022-02-07 22:00:02.557955 (Thread-2): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-07 22:00:02.558221 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 22:00:02.558519 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_rate_gbp_usd"} */
truncate table "postgres"."public"."source_rate_gbp_usd"
2022-02-07 22:00:02.574061 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 22:00:02.574362 (Thread-1): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 22:00:02.574574 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: 
            insert into "postgres"."public"."source_wheat_gbp" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-07 22:00:02.597523 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 22:00:02.597765 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: 
            insert into "postgres"."public"."source_rate_gbp_usd" (TRADEDATE, PRICE, OPEN, HIGH, LOW, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s...
2022-02-07 22:00:02.604607 (Thread-2): SQL status: INSERT 0 531 in 0.01 seconds
2022-02-07 22:00:02.610304 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_gbp"
2022-02-07 22:00:02.610630 (Thread-1): SQL status: INSERT 0 548 in 0.01 seconds
2022-02-07 22:00:02.611489 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_rate_gbp_usd"
2022-02-07 22:00:02.620408 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-07 22:00:02.620660 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-07 22:00:02.620773 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-07 22:00:02.625060 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-07 22:00:02.625300 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:02.625554 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-07 22:00:02.627594 (Thread-2): finished collecting timing info
2022-02-07 22:00:02.628018 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-07 22:00:02.628271 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: Close
2022-02-07 22:00:02.629164 (Thread-2): 01:00:02 | 2 of 4 OK loaded seed file public.source_wheat_gbp................... [INSERT 531 in 0.32s]
2022-02-07 22:00:02.629545 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_gbp
2022-02-07 22:00:02.629984 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 22:00:02.632585 (Thread-2): 01:00:02 | 3 of 4 START seed file public.source_wheat_msk....................... [RUN]
2022-02-07 22:00:02.632806 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:02.633261 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 22:00:02.635813 (Thread-1): finished collecting timing info
2022-02-07 22:00:02.636341 (Thread-2): finished collecting timing info
2022-02-07 22:00:02.636825 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: Close
2022-02-07 22:00:02.653320 (Thread-1): 01:00:02 | 1 of 4 OK loaded seed file public.source_rate_gbp_usd................ [INSERT 548 in 0.34s]
2022-02-07 22:00:02.664288 (Thread-1): Finished running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-07 22:00:02.675257 (Thread-1): Began running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 22:00:02.679795 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 22:00:02.681445 (Thread-1): 01:00:02 | 4 of 4 START seed file public.source_wheat_usa....................... [RUN]
2022-02-07 22:00:02.682030 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: BEGIN
2022-02-07 22:00:02.682592 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 22:00:02.682829 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:02.683227 (Thread-1): finished collecting timing info
2022-02-07 22:00:02.706068 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 22:00:02.711751 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 22:00:02.717377 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_msk"} */
truncate table "postgres"."public"."source_wheat_msk"
2022-02-07 22:00:02.722145 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 22:00:02.722587 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: BEGIN
2022-02-07 22:00:02.722701 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:02.728863 (Thread-2): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 22:00:02.744758 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 22:00:02.745088 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 22:00:02.745450 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: 
            insert into "postgres"."public"."source_wheat_msk" (BOARDID, SECID, TRADEDATE, SHORTNAME, NAME, CLOSE, OPEN, HIGH, LOW, VALUE, DURATION, YIELD, DECIMALS, CAPITALIZATION, CURRENCYID, DIVISOR, TRADINGSESSION, VOLUME) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%...
2022-02-07 22:00:02.745836 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 22:00:02.750084 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_usa"} */
truncate table "postgres"."public"."source_wheat_usa"
2022-02-07 22:00:02.755455 (Thread-1): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-07 22:00:02.766305 (Thread-2): SQL status: INSERT 0 216 in 0.02 seconds
2022-02-07 22:00:02.772234 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_msk"
2022-02-07 22:00:02.788326 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 22:00:02.788770 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: 
            insert into "postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-07 22:00:02.798640 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 22:00:02.798930 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-07 22:00:02.799098 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-07 22:00:02.801510 (Thread-1): SQL status: INSERT 0 547 in 0.01 seconds
2022-02-07 22:00:02.802155 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_usa"
2022-02-07 22:00:02.805215 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-07 22:00:02.805469 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:00:02.805724 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-07 22:00:02.808771 (Thread-2): finished collecting timing info
2022-02-07 22:00:02.809304 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-07 22:00:02.809658 (Thread-2): On seed.project_otus_dbt.source_wheat_msk: Close
2022-02-07 22:00:02.811309 (Thread-2): 01:00:02 | 3 of 4 OK loaded seed file public.source_wheat_msk................... [INSERT 216 in 0.18s]
2022-02-07 22:00:02.811785 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_msk
2022-02-07 22:00:02.812980 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:02.815163 (Thread-1): finished collecting timing info
2022-02-07 22:00:02.815495 (Thread-1): On seed.project_otus_dbt.source_wheat_usa: Close
2022-02-07 22:00:02.816393 (Thread-1): 01:00:02 | 4 of 4 OK loaded seed file public.source_wheat_usa................... [INSERT 547 in 0.13s]
2022-02-07 22:00:02.816686 (Thread-1): Finished running node seed.project_otus_dbt.source_wheat_usa
2022-02-07 22:00:02.819028 (MainThread): Acquiring new postgres connection "master".
2022-02-07 22:00:02.819273 (MainThread): Using postgres connection "master".
2022-02-07 22:00:02.819383 (MainThread): On master: BEGIN
2022-02-07 22:00:02.819552 (MainThread): Opening a new connection, currently in state closed
2022-02-07 22:00:02.829786 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:02.830031 (MainThread): On master: COMMIT
2022-02-07 22:00:02.830142 (MainThread): Using postgres connection "master".
2022-02-07 22:00:02.830249 (MainThread): On master: COMMIT
2022-02-07 22:00:02.831313 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:02.831546 (MainThread): On master: Close
2022-02-07 22:00:02.832055 (MainThread): 01:00:02 | 
2022-02-07 22:00:02.832287 (MainThread): 01:00:02 | Finished running 4 seeds in 1.04s.
2022-02-07 22:00:02.832459 (MainThread): Connection 'master' was properly closed.
2022-02-07 22:00:02.832589 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_usa' was properly closed.
2022-02-07 22:00:02.832702 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_msk' was properly closed.
2022-02-07 22:00:02.939352 (MainThread): 
2022-02-07 22:00:02.939707 (MainThread): Completed successfully
2022-02-07 22:00:02.939934 (MainThread): 
Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
2022-02-07 22:00:02.940248 (MainThread): Flushing usage events
2022-02-07 22:00:06.936649 (MainThread): Running with dbt=0.19.0
2022-02-07 22:00:07.064903 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 22:00:07.066332 (MainThread): Tracking: do not track
2022-02-07 22:00:07.162144 (MainThread): Partial parsing not enabled
2022-02-07 22:00:07.163455 (MainThread): Parsing macros/adapters.sql
2022-02-07 22:00:07.186196 (MainThread): Parsing macros/catalog.sql
2022-02-07 22:00:07.190042 (MainThread): Parsing macros/relations.sql
2022-02-07 22:00:07.192288 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 22:00:07.195228 (MainThread): Parsing macros/core.sql
2022-02-07 22:00:07.199765 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 22:00:07.255526 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 22:00:07.259000 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 22:00:07.262259 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 22:00:07.275042 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 22:00:07.277115 (MainThread): Parsing macros/etc/query.sql
2022-02-07 22:00:07.278338 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 22:00:07.279524 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 22:00:07.288093 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 22:00:07.307471 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 22:00:07.309363 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 22:00:07.336584 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 22:00:07.366864 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 22:00:07.378331 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 22:00:07.381655 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 22:00:07.408799 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 22:00:07.414216 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 22:00:07.421090 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 22:00:07.427793 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 22:00:07.429699 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 22:00:07.431330 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 22:00:07.433338 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 22:00:07.437215 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 22:00:07.439351 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 22:00:07.441611 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 22:00:07.442905 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 22:00:07.452014 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 22:00:07.454361 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 22:00:07.456232 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 22:00:07.458721 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 22:00:07.459787 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 22:00:07.461925 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 22:00:07.464773 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 22:00:07.466503 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 22:00:07.468450 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 22:00:07.473050 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 22:00:07.487644 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 22:00:07.491644 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 22:00:07.494308 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 22:00:07.495771 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 22:00:07.497690 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 22:00:07.499360 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 22:00:07.500957 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 22:00:07.506472 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 22:00:07.507887 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 22:00:07.509630 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 22:00:07.512461 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 22:00:07.516678 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 22:00:07.519610 (MainThread): Parsing macros/sql/star.sql
2022-02-07 22:00:07.525140 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 22:00:07.527873 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 22:00:07.534321 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 22:00:07.537316 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 22:00:07.548684 (MainThread): Parsing macros/sql/union.sql
2022-02-07 22:00:07.558998 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 22:00:07.561132 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 22:00:07.566506 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 22:00:07.572721 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 22:00:07.578560 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 22:00:07.587828 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 22:00:07.593982 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 22:00:07.596079 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 22:00:07.598065 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 22:00:07.600707 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 22:00:07.604516 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 22:00:07.605865 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 22:00:07.607201 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 22:00:07.608487 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 22:00:07.632148 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 22:00:07.634115 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 22:00:07.636375 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 22:00:07.638279 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 22:00:07.640233 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 22:00:07.646379 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 22:00:07.650241 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 22:00:07.652858 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 22:00:07.654538 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 22:00:07.656222 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 22:00:07.658294 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 22:00:07.662068 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 22:00:07.664181 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 22:00:07.669895 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 22:00:07.672618 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 22:00:07.676740 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 22:00:07.677750 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 22:00:07.681658 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 22:00:07.688835 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 22:00:07.701149 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 22:00:07.719005 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 22:00:07.724499 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 22:00:07.725400 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 22:00:07.741242 (MainThread): Parsing macros/tables/link.sql
2022-02-07 22:00:07.754577 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 22:00:07.768244 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 22:00:07.784607 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 22:00:07.795169 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 22:00:07.823989 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 22:00:07.834026 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 22:00:07.864923 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 22:00:07.868255 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 22:00:07.905961 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 22:00:07.914133 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 22:00:07.923143 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 22:00:07.925009 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 22:00:07.937268 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 22:00:07.946707 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 22:00:07.977105 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 22:00:07.993510 (MainThread): Partial parsing not enabled
2022-02-07 22:00:08.112849 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:08.204720 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:08.246577 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:08.280069 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:08.326128 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:08.380564 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:08.399211 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:08.432228 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:08.459198 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:08.616771 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:08.641430 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:08.661473 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:08.684969 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:08.697471 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:08.707613 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:08.720126 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:08.729907 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:08.741857 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:09.485661 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.raw_vault.links
- models.project_otus_dbt.report

2022-02-07 22:00:09.676120 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 22:00:09.677311 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 22:00:09.680745 (MainThread): 
2022-02-07 22:00:09.681547 (MainThread): Acquiring new postgres connection "master".
2022-02-07 22:00:09.720435 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 22:00:09.744765 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 22:00:09.745114 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 22:00:09.745371 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 22:00:09.762346 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 22:00:09.767453 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 22:00:09.806191 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 22:00:09.822177 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 22:00:09.822578 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 22:00:09.822878 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 22:00:09.840007 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-02-07 22:00:09.840416 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 22:00:09.840685 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 22:00:09.847534 (ThreadPoolExecutor-1_0): SQL status: SELECT 24 in 0.01 seconds
2022-02-07 22:00:09.879993 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 22:00:09.881571 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 22:00:09.921667 (MainThread): Using postgres connection "master".
2022-02-07 22:00:09.922013 (MainThread): On master: BEGIN
2022-02-07 22:00:09.922272 (MainThread): Opening a new connection, currently in state init
2022-02-07 22:00:09.939196 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 22:00:09.939684 (MainThread): Using postgres connection "master".
2022-02-07 22:00:09.939959 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 22:00:10.236848 (MainThread): SQL status: SELECT 10 in 0.30 seconds
2022-02-07 22:00:10.247834 (MainThread): On master: ROLLBACK
2022-02-07 22:00:10.249192 (MainThread): Using postgres connection "master".
2022-02-07 22:00:10.249454 (MainThread): On master: BEGIN
2022-02-07 22:00:10.251740 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:10.252132 (MainThread): On master: COMMIT
2022-02-07 22:00:10.252393 (MainThread): Using postgres connection "master".
2022-02-07 22:00:10.252619 (MainThread): On master: COMMIT
2022-02-07 22:00:10.254039 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:10.254307 (MainThread): On master: Close
2022-02-07 22:00:10.254867 (MainThread): 01:00:10 | Concurrency: 2 threads (target='dev')
2022-02-07 22:00:10.255242 (MainThread): 01:00:10 | 
2022-02-07 22:00:10.261105 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 22:00:10.261514 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 22:00:10.263198 (Thread-1): 01:00:10 | 1 of 18 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-07 22:00:10.264894 (Thread-2): 01:00:10 | 2 of 18 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-07 22:00:10.265842 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:10.266642 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:10.266973 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 22:00:10.267305 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 22:00:10.329127 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:10.330023 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:10.330374 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-07 22:00:10.330699 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 22:00:10.331078 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:10.331418 (Thread-2): Opening a new connection, currently in state init
2022-02-07 22:00:10.342461 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:10.342693 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:10.342822 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:10.343891 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:10.344098 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:10.344204 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:10.353087 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-07 22:00:10.360592 (Thread-2): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 22:00:10.423375 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:10.432611 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:10.432881 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:10.433150 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:10.447503 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 22:00:10.454622 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 22:00:10.455125 (Thread-2): finished collecting timing info
2022-02-07 22:00:10.466565 (Thread-1): SQL status: SELECT 6 in 0.03 seconds
2022-02-07 22:00:10.484408 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 22:00:10.503445 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:10.503783 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 22:00:10.504197 (Thread-1): finished collecting timing info
2022-02-07 22:00:10.511653 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 22:00:10.521185 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:10.522908 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:10.523237 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 22:00:10.523534 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 22:00:10.525396 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:10.525785 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:10.530140 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:10.536702 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 22:00:10.537124 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:00:10.538828 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:10.539288 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:00:10.539600 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:10.541632 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 22:00:10.542361 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:10.542641 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:00:10.546514 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 22:00:10.558737 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:10.558992 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-07 22:00:10.560917 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:10.565157 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:10.565434 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-07 22:00:10.566602 (Thread-2): SQL status: CREATE VIEW in 0.03 seconds
2022-02-07 22:00:10.572572 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 22:00:10.574216 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:10.585392 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-07 22:00:10.586172 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 22:00:10.586683 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:10.587077 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 22:00:10.588586 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:10.593084 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:10.593373 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:00:10.593632 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 22:00:10.600742 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:10.601391 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:00:10.603354 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:10.605213 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 22:00:10.605495 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:10.605790 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:10.609473 (Thread-1): finished collecting timing info
2022-02-07 22:00:10.609999 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 22:00:10.610347 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-07 22:00:10.612933 (Thread-1): 01:00:10 | 1 of 18 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.35s]
2022-02-07 22:00:10.613393 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 22:00:10.614047 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 22:00:10.614922 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:10.617124 (Thread-1): 01:00:10 | 3 of 18 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-07 22:00:10.620624 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:10.621548 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:10.621843 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 22:00:10.622212 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 22:00:10.636101 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 22:00:10.642400 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:10.645833 (Thread-2): finished collecting timing info
2022-02-07 22:00:10.646289 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 22:00:10.646561 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 22:00:10.646959 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:10.650799 (Thread-2): 01:00:10 | 2 of 18 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.38s]
2022-02-07 22:00:10.651169 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 22:00:10.651570 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 22:00:10.654364 (Thread-2): 01:00:10 | 4 of 18 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-07 22:00:10.655313 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:10.655545 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 22:00:10.671275 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 22:00:10.672142 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:10.672355 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:10.672567 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-07 22:00:10.672788 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:10.672994 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:10.711448 (Thread-2): SQL status: BEGIN in 0.04 seconds
2022-02-07 22:00:10.711736 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:10.711877 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:10.719011 (Thread-1): SQL status: SELECT 7 in 0.05 seconds
2022-02-07 22:00:10.726573 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:10.726876 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:10.736972 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 22:00:10.743913 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 22:00:10.744460 (Thread-1): finished collecting timing info
2022-02-07 22:00:10.744905 (Thread-2): SQL status: SELECT 7 in 0.03 seconds
2022-02-07 22:00:10.753875 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:10.763000 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:10.763262 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 22:00:10.763583 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:10.765317 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:10.769151 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:10.769398 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 22:00:10.771519 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:10.773301 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 22:00:10.773911 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:10.774131 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:00:10.777007 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 22:00:10.785270 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 22:00:10.791553 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 22:00:10.796818 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:10.797305 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-07 22:00:10.797661 (Thread-2): finished collecting timing info
2022-02-07 22:00:10.804973 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 22:00:10.807554 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:10.811415 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:10.811770 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-07 22:00:10.812066 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-07 22:00:10.813621 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:10.816512 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:10.816738 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:10.817045 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 22:00:10.818170 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 22:00:10.818553 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:10.818654 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 22:00:10.819792 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:10.821194 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 22:00:10.821735 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:10.821980 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:10.822160 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:00:10.825666 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:10.826311 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 22:00:10.830631 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:10.833157 (Thread-1): finished collecting timing info
2022-02-07 22:00:10.833479 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 22:00:10.833715 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 22:00:10.840527 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:10.840986 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-07 22:00:10.842858 (Thread-1): 01:00:10 | 3 of 18 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.22s]
2022-02-07 22:00:10.843363 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 22:00:10.843754 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_gbp
2022-02-07 22:00:10.845926 (Thread-1): 01:00:10 | 5 of 18 START table model public.dds_wheat_gbp....................... [RUN]
2022-02-07 22:00:10.846534 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:10.847909 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:10.852318 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:10.852830 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_gbp
2022-02-07 22:00:10.853181 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-07 22:00:10.862203 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-07 22:00:10.863090 (Thread-1): finished collecting timing info
2022-02-07 22:00:10.869689 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 22:00:10.876737 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 22:00:10.882230 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:10.887906 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 22:00:10.888997 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:10.890092 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_tmp" cascade
2022-02-07 22:00:10.890307 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:10.892059 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:10.895334 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:10.895608 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 22:00:10.899303 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:10.902834 (Thread-2): finished collecting timing info
2022-02-07 22:00:10.903186 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:00:10.903403 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-07 22:00:10.906739 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:10.907226 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-07 22:00:10.908949 (Thread-2): 01:00:10 | 4 of 18 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.25s]
2022-02-07 22:00:10.909518 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 22:00:10.910032 (Thread-2): Began running node model.project_otus_dbt.dim_day
2022-02-07 22:00:10.910605 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:10.912479 (Thread-2): 01:00:10 | 6 of 18 START table model public.dim_day............................. [RUN]
2022-02-07 22:00:10.923443 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-07 22:00:10.924174 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:10.924760 (Thread-2): Compiling model.project_otus_dbt.dim_day
2022-02-07 22:00:10.933172 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 22:00:10.933557 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:10.933985 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: BEGIN
2022-02-07 22:00:10.934576 (Thread-2): finished collecting timing info
2022-02-07 22:00:10.941498 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:10.945067 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:10.945330 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:10.945587 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-07 22:00:10.945826 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */


  create  table "postgres"."public"."dds_wheat_gbp__dbt_tmp"
  as (
    with gbp as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,cast(su.price as decimal(18,2))/100.0*rt.rate as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from public.hub_wheat_gbp as hu
    left join public.sat_wheat_gbp_details as su
    on hu.date_pk=su.date_pk
    left join public.dds_rate_gbp_usd as rt
    on hu.date_pk=rt.date_pk
)
select * from gbp
  );
2022-02-07 22:00:10.946084 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:10.959108 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:00:10.963438 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:10.963707 (Thread-1): SQL status: SELECT 531 in 0.02 seconds
2022-02-07 22:00:10.963978 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 22:00:10.969242 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:10.969750 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp" rename to "dds_wheat_gbp__dbt_backup"
2022-02-07 22:00:10.971307 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:10.971574 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:10.976045 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:10.977767 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 22:00:10.978205 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp__dbt_tmp" rename to "dds_wheat_gbp"
2022-02-07 22:00:10.979320 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:10.979692 (Thread-2): On model.project_otus_dbt.dim_day: BEGIN
2022-02-07 22:00:10.980552 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:10.982175 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-07 22:00:10.982400 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:10.982607 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:10.982830 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:10.983074 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-07 22:00:10.983296 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 day')
        as t(date)
        )

select * from dim_day
order by date desc
  );
2022-02-07 22:00:10.989668 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:00:10.992950 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:10.993188 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-07 22:00:10.999254 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:00:11.002863 (Thread-1): finished collecting timing info
2022-02-07 22:00:11.003351 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: Close
2022-02-07 22:00:11.005809 (Thread-1): 01:00:10 | 5 of 18 OK created table model public.dds_wheat_gbp.................. [SELECT 531 in 0.16s]
2022-02-07 22:00:11.006203 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_gbp
2022-02-07 22:00:11.006618 (Thread-1): Began running node model.project_otus_dbt.dim_week
2022-02-07 22:00:11.009141 (Thread-1): 01:00:10 | 7 of 18 START table model public.dim_week............................ [RUN]
2022-02-07 22:00:11.010289 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:11.010774 (Thread-1): Compiling model.project_otus_dbt.dim_week
2022-02-07 22:00:11.020532 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 22:00:11.021113 (Thread-1): finished collecting timing info
2022-02-07 22:00:11.028558 (Thread-2): SQL status: SELECT 5114 in 0.04 seconds
2022-02-07 22:00:11.038953 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:11.040470 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:11.040720 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-07 22:00:11.041006 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-07 22:00:11.041763 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:11.043361 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:11.047674 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:11.048019 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-07 22:00:11.049679 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:11.051673 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 22:00:11.052014 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:11.052175 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 22:00:11.054625 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:00:11.058453 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:11.058693 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:00:11.058927 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 22:00:11.065100 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:11.065572 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 22:00:11.066905 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:11.068574 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 22:00:11.069135 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:11.069378 (Thread-1): On model.project_otus_dbt.dim_week: BEGIN
2022-02-07 22:00:11.070705 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:11.071035 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:00:11.071255 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:11.074800 (Thread-2): finished collecting timing info
2022-02-07 22:00:11.075309 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-07 22:00:11.075654 (Thread-2): On model.project_otus_dbt.dim_day: Close
2022-02-07 22:00:11.079416 (Thread-2): 01:00:11 | 6 of 18 OK created table model public.dim_day........................ [SELECT 5114 in 0.15s]
2022-02-07 22:00:11.079939 (Thread-2): Finished running node model.project_otus_dbt.dim_day
2022-02-07 22:00:11.080417 (Thread-2): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 22:00:11.083077 (Thread-2): 01:00:11 | 8 of 18 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-07 22:00:11.083911 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:11.084256 (Thread-2): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 22:00:11.099725 (Thread-1): SQL status: SELECT 731 in 0.02 seconds
2022-02-07 22:00:11.104409 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 22:00:11.111570 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:11.112030 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-07 22:00:11.112413 (Thread-2): finished collecting timing info
2022-02-07 22:00:11.118735 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 22:00:11.134783 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:11.140317 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-07 22:00:11.152511 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 22:00:11.155951 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:11.157755 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 22:00:11.158093 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp010011150519"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:11.158366 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:11.158595 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:11.158830 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 22:00:11.162492 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:11.165717 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:11.165956 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 22:00:11.169533 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:11.172584 (Thread-1): finished collecting timing info
2022-02-07 22:00:11.172985 (Thread-1): On model.project_otus_dbt.dim_week: Close
2022-02-07 22:00:11.174882 (Thread-1): 01:00:11 | 7 of 18 OK created table model public.dim_week....................... [SELECT 731 in 0.16s]
2022-02-07 22:00:11.175202 (Thread-1): Finished running node model.project_otus_dbt.dim_week
2022-02-07 22:00:11.175465 (Thread-1): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 22:00:11.177766 (Thread-1): 01:00:11 | 9 of 18 START incremental model public.sat_rate_gbp_usd_details...... [RUN]
2022-02-07 22:00:11.178509 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:11.179004 (Thread-1): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 22:00:11.179469 (Thread-2): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 22:00:11.201816 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:11.207298 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-07 22:00:11.210016 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 22:00:11.210780 (Thread-1): finished collecting timing info
2022-02-07 22:00:11.216988 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:11.222555 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:11.222792 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:11.222948 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp010011150519'
        
      order by ordinal_position

  
2022-02-07 22:00:11.223187 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp010011220599"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:11.223606 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:11.260767 (Thread-2): SQL status: SELECT 4 in 0.04 seconds
2022-02-07 22:00:11.265676 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:11.265934 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.270002 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 22:00:11.276261 (Thread-1): SQL status: SELECT 0 in 0.05 seconds
2022-02-07 22:00:11.281532 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:11.285922 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:11.286306 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.286560 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-07 22:00:11.288220 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:11.288486 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:11.288641 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp010011220599'
        
      order by ordinal_position

  
2022-02-07 22:00:11.291218 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 22:00:11.292305 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 22:00:11.292813 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:11.292990 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp010011150519"
    );
  
2022-02-07 22:00:11.294281 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:00:11.296093 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 22:00:11.296361 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:11.296463 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 22:00:11.298745 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:11.301476 (Thread-2): finished collecting timing info
2022-02-07 22:00:11.301907 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-07 22:00:11.303989 (Thread-2): 01:00:11 | 8 of 18 OK created incremental model public.hub_rate_gbp_usd......... [INSERT 0 0 in 0.22s]
2022-02-07 22:00:11.304345 (Thread-2): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 22:00:11.304682 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 22:00:11.307198 (Thread-2): 01:00:11 | 10 of 18 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-07 22:00:11.308093 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:11.308494 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-07 22:00:11.321034 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 22:00:11.321264 (Thread-1): SQL status: SELECT 11 in 0.03 seconds
2022-02-07 22:00:11.328096 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:11.328524 (Thread-2): finished collecting timing info
2022-02-07 22:00:11.329156 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.339826 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:11.340131 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp010011338057"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:11.340254 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:11.345956 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:00:11.351580 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:11.351868 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.356483 (Thread-1): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 22:00:11.358667 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 22:00:11.359251 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:11.359464 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp010011220599"
    );
  
2022-02-07 22:00:11.360457 (Thread-2): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 22:00:11.364520 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:11.364742 (Thread-1): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-07 22:00:11.364943 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-07 22:00:11.366484 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 22:00:11.366885 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:11.367014 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 22:00:11.367938 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:11.368208 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:11.368367 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp010011338057'
        
      order by ordinal_position

  
2022-02-07 22:00:11.369110 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:11.371669 (Thread-1): finished collecting timing info
2022-02-07 22:00:11.372042 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-07 22:00:11.374058 (Thread-1): 01:00:11 | 9 of 18 OK created incremental model public.sat_rate_gbp_usd_details. [INSERT 0 0 in 0.19s]
2022-02-07 22:00:11.374485 (Thread-1): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 22:00:11.374912 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 22:00:11.377092 (Thread-1): 01:00:11 | 11 of 18 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-07 22:00:11.378354 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:11.378661 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:11.378971 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 22:00:11.386031 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:11.396914 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.409202 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 22:00:11.409965 (Thread-1): finished collecting timing info
2022-02-07 22:00:11.419270 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:11.422274 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:11.428333 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:11.428608 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp010011420617"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:11.428918 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.429211 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:11.434066 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 22:00:11.435290 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 22:00:11.435888 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:11.436068 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp010011338057"
    );
  
2022-02-07 22:00:11.437557 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:00:11.439503 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 22:00:11.439787 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:11.439928 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 22:00:11.442008 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:11.444274 (Thread-2): finished collecting timing info
2022-02-07 22:00:11.444661 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-07 22:00:11.446818 (Thread-2): 01:00:11 | 10 of 18 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.14s]
2022-02-07 22:00:11.447170 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 22:00:11.447632 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 22:00:11.450163 (Thread-2): 01:00:11 | 12 of 18 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-07 22:00:11.450966 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:11.451242 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-07 22:00:11.462714 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 22:00:11.465482 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 22:00:11.469726 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:11.470285 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-07 22:00:11.470741 (Thread-2): finished collecting timing info
2022-02-07 22:00:11.480004 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:11.480283 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:11.480511 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp010011478111"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:11.480812 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:11.481115 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:11.481363 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp010011420617'
        
      order by ordinal_position

  
2022-02-07 22:00:11.495272 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 22:00:11.500649 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:11.500872 (Thread-2): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 22:00:11.501045 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.505092 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:11.505591 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-07 22:00:11.506744 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:11.506999 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:11.507142 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp010011478111'
        
      order by ordinal_position

  
2022-02-07 22:00:11.510219 (Thread-1): SQL status: SELECT 12 in 0.00 seconds
2022-02-07 22:00:11.516696 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:11.516956 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:11.517159 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.571349 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:11.571905 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.576232 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 22:00:11.580737 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:11.580998 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 22:00:11.581199 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.582916 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 22:00:11.584004 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:11.584285 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp010011420617"
    );
  
2022-02-07 22:00:11.586167 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:00:11.588158 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 22:00:11.588442 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:11.588632 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:11.589684 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 22:00:11.590018 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 22:00:11.591091 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:11.591501 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp010011478111"
    );
  
2022-02-07 22:00:11.593008 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:11.593271 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:00:11.595445 (Thread-1): finished collecting timing info
2022-02-07 22:00:11.596962 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 22:00:11.597281 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-07 22:00:11.597492 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:11.597757 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 22:00:11.600473 (Thread-1): 01:00:11 | 11 of 18 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.22s]
2022-02-07 22:00:11.601086 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 22:00:11.601610 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 22:00:11.603942 (Thread-1): 01:00:11 | 13 of 18 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-07 22:00:11.604343 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:11.605513 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:11.608039 (Thread-2): finished collecting timing info
2022-02-07 22:00:11.608594 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 22:00:11.608929 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-07 22:00:11.628383 (Thread-2): 01:00:11 | 12 of 18 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.18s]
2022-02-07 22:00:11.638980 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 22:00:11.639286 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 22:00:11.639868 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 22:00:11.641570 (Thread-2): 01:00:11 | 14 of 18 START incremental model public.hub_wheat_gbp................ [RUN]
2022-02-07 22:00:11.642142 (Thread-1): finished collecting timing info
2022-02-07 22:00:11.643762 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:11.654629 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-07 22:00:11.656952 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:11.667641 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp010011653247"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:11.671478 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 22:00:11.671747 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:11.672666 (Thread-2): finished collecting timing info
2022-02-07 22:00:11.688261 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:11.688589 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp010011685274"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:11.688909 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:11.702577 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 22:00:11.708636 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:11.708914 (Thread-2): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 22:00:11.709167 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-07 22:00:11.713360 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:11.713864 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-07 22:00:11.715091 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:11.715409 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:11.715612 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:11.715836 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:11.716133 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp010011653247'
        
      order by ordinal_position

  
2022-02-07 22:00:11.716372 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp010011685274'
        
      order by ordinal_position

  
2022-02-07 22:00:11.725860 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:00:11.731463 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:11.731693 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:11.731887 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.736737 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:11.737302 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.742301 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:00:11.748378 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:11.751037 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:11.756906 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:11.757169 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.757474 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.762877 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 22:00:11.764125 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 22:00:11.764415 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:00:11.766257 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 22:00:11.766875 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:11.767203 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp010011685274"
    );
  
2022-02-07 22:00:11.767507 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:11.767926 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp010011653247"
    );
  
2022-02-07 22:00:11.769150 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:00:11.770822 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 22:00:11.771055 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:00:11.771271 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:11.772878 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 22:00:11.773218 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 22:00:11.773557 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:11.774014 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 22:00:11.776632 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:11.779237 (Thread-2): finished collecting timing info
2022-02-07 22:00:11.779588 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:00:11.779819 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-07 22:00:11.782302 (Thread-1): finished collecting timing info
2022-02-07 22:00:11.782873 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-07 22:00:11.784837 (Thread-2): 01:00:11 | 14 of 18 OK created incremental model public.hub_wheat_gbp........... [INSERT 0 0 in 0.14s]
2022-02-07 22:00:11.787344 (Thread-1): 01:00:11 | 13 of 18 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.18s]
2022-02-07 22:00:11.787886 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 22:00:11.788787 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 22:00:11.789637 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 22:00:11.791344 (Thread-2): 01:00:11 | 15 of 18 START incremental model public.sat_wheat_gbp_details........ [RUN]
2022-02-07 22:00:11.791854 (Thread-1): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 22:00:11.793225 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:11.794801 (Thread-1): 01:00:11 | 16 of 18 START table model public.dds_rate_gbp_usd................... [RUN]
2022-02-07 22:00:11.795273 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 22:00:11.796059 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:11.806993 (Thread-1): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 22:00:11.821606 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 22:00:11.829173 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-07 22:00:11.829799 (Thread-2): finished collecting timing info
2022-02-07 22:00:11.830357 (Thread-1): finished collecting timing info
2022-02-07 22:00:11.838759 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:11.849043 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:11.849331 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp010011837159"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:11.849639 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 22:00:11.849951 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:11.850161 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:11.860788 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:00:11.863948 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:11.864307 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:00:11.865773 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:11.867481 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-07 22:00:11.867936 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:11.868063 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-07 22:00:11.869239 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:11.869487 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:11.869606 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */


  create  table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp"
  as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );
2022-02-07 22:00:11.874060 (Thread-2): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 22:00:11.878219 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:11.878452 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-07 22:00:11.878812 (Thread-1): SQL status: SELECT 548 in 0.01 seconds
2022-02-07 22:00:11.883877 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:11.884110 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:11.884302 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd" rename to "dds_rate_gbp_usd__dbt_backup"
2022-02-07 22:00:11.884558 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:11.884998 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp010011837159'
        
      order by ordinal_position

  
2022-02-07 22:00:11.886265 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:11.889827 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:11.890058 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-07 22:00:11.891587 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:11.893086 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-07 22:00:11.893331 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:11.893483 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-07 22:00:11.893746 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:00:11.898634 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:11.898894 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:00:11.899178 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.902126 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:11.902575 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:00:11.906211 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:11.910324 (Thread-1): finished collecting timing info
2022-02-07 22:00:11.910724 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:00:11.910992 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-07 22:00:11.917770 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:11.918138 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:11.920437 (Thread-1): 01:00:11 | 16 of 18 OK created table model public.dds_rate_gbp_usd.............. [SELECT 548 in 0.12s]
2022-02-07 22:00:11.921101 (Thread-1): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 22:00:11.921479 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 22:00:11.923415 (Thread-1): 01:00:11 | 17 of 18 START table model public.dds_wheat_msk...................... [RUN]
2022-02-07 22:00:11.923984 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:11.924229 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-07 22:00:11.931249 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:00:11.934803 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 22:00:11.936597 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 22:00:11.937410 (Thread-1): finished collecting timing info
2022-02-07 22:00:11.947962 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:11.948276 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:11.948480 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-07 22:00:11.948787 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp010011837159"
    );
  
2022-02-07 22:00:11.949077 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:11.950869 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:00:11.952533 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 22:00:11.952813 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:11.953005 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 22:00:11.955413 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:11.958018 (Thread-2): finished collecting timing info
2022-02-07 22:00:11.958843 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-07 22:00:11.962605 (Thread-2): 01:00:11 | 15 of 18 OK created incremental model public.sat_wheat_gbp_details... [INSERT 0 0 in 0.17s]
2022-02-07 22:00:11.963841 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 22:00:11.964816 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_usa
2022-02-07 22:00:11.967861 (Thread-2): 01:00:11 | 18 of 18 START table model public.dds_wheat_usa...................... [RUN]
2022-02-07 22:00:11.968176 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 22:00:11.968944 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:11.972870 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:11.973264 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_usa
2022-02-07 22:00:11.973487 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 22:00:11.985739 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-07 22:00:11.985983 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:11.987979 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 22:00:11.988594 (Thread-2): finished collecting timing info
2022-02-07 22:00:12.003072 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:12.003384 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:12.003564 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_tmp" cascade
2022-02-07 22:00:12.003799 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-07 22:00:12.004037 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:12.005747 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:12.006106 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:12.006402 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */


  create  table "postgres"."public"."dds_wheat_msk__dbt_tmp"
  as (
    with dds_wheat_msk as(
    select sm.tradedate  as tradedate
        ,cast(sm.value as decimal(18,2)) as value
        ,cast(sm.open as decimal(18,2)) as open
        ,cast(sm.close as decimal(18,2)) as close
        ,cast(sm.high as decimal(18,2)) as high
        ,cast(sm.low as decimal(18,2)) as low
        ,cast(sm.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hm
    left join "postgres"."public"."sat_wheat_msk_details" as sm
    on hm.date_pk=sm.date_pk
)
select * from dds_wheat_msk
  );
2022-02-07 22:00:12.012013 (Thread-1): SQL status: SELECT 216 in 0.01 seconds
2022-02-07 22:00:12.017014 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:12.017320 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-07 22:00:12.018869 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:12.023917 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:12.024251 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 22:00:12.024450 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-07 22:00:12.027916 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:12.028447 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-07 22:00:12.029616 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:12.029901 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:12.031449 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-07 22:00:12.032986 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 22:00:12.033658 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:12.034058 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 22:00:12.034474 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:12.034751 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: BEGIN
2022-02-07 22:00:12.036289 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:12.036704 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:12.036947 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:12.037152 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */


  create  table "postgres"."public"."dds_wheat_usa__dbt_tmp"
  as (
    with usa as (
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,cast(su.price as decimal(18,2))/100.0/2.7 as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_usa" as hu
    left join "postgres"."public"."sat_wheat_usa_details" as su
    on hu.date_pk=su.date_pk
)
select * from usa;
  );
2022-02-07 22:00:12.040595 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:12.041186 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 22:00:12.042597 (Thread-2): Postgres error: syntax error at or near ";"
LINE 17: select * from usa;
                          ^

2022-02-07 22:00:12.042937 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: ROLLBACK
2022-02-07 22:00:12.044332 (Thread-2): finished collecting timing info
2022-02-07 22:00:12.044798 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: Close
2022-02-07 22:00:12.045845 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:12.049939 (Thread-1): finished collecting timing info
2022-02-07 22:00:12.050328 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-07 22:00:12.053047 (Thread-1): 01:00:12 | 17 of 18 OK created table model public.dds_wheat_msk................. [SELECT 216 in 0.13s]
2022-02-07 22:00:12.054027 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 22:00:12.045422 (Thread-2): Database Error in model dds_wheat_usa (models/dds/dds_wheat_usa.sql)
  syntax error at or near ";"
  LINE 17: select * from usa;
                            ^
  compiled SQL at target/run/project_otus_dbt/models/dds/dds_wheat_usa.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near ";"
LINE 17: select * from usa;
                          ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 63, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model dds_wheat_usa (models/dds/dds_wheat_usa.sql)
  syntax error at or near ";"
  LINE 17: select * from usa;
                            ^
  compiled SQL at target/run/project_otus_dbt/models/dds/dds_wheat_usa.sql
2022-02-07 22:00:12.058120 (Thread-2): 01:00:12 | 18 of 18 ERROR creating table model public.dds_wheat_usa............. [ERROR in 0.09s]
2022-02-07 22:00:12.058506 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_usa
2022-02-07 22:00:12.061365 (MainThread): Acquiring new postgres connection "master".
2022-02-07 22:00:12.061753 (MainThread): Using postgres connection "master".
2022-02-07 22:00:12.061924 (MainThread): On master: BEGIN
2022-02-07 22:00:12.062073 (MainThread): Opening a new connection, currently in state closed
2022-02-07 22:00:12.073966 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:12.074280 (MainThread): On master: COMMIT
2022-02-07 22:00:12.074465 (MainThread): Using postgres connection "master".
2022-02-07 22:00:12.074638 (MainThread): On master: COMMIT
2022-02-07 22:00:12.075859 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:12.076215 (MainThread): On master: Close
2022-02-07 22:00:12.077218 (MainThread): 01:00:12 | 
2022-02-07 22:00:12.077658 (MainThread): 01:00:12 | Finished running 4 view models, 6 table models, 8 incremental models in 2.40s.
2022-02-07 22:00:12.077974 (MainThread): Connection 'master' was properly closed.
2022-02-07 22:00:12.078222 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_msk' was properly closed.
2022-02-07 22:00:12.078419 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_usa' was properly closed.
2022-02-07 22:00:12.214529 (MainThread): 
2022-02-07 22:00:12.214801 (MainThread): Completed with 1 error and 0 warnings:
2022-02-07 22:00:12.214977 (MainThread): 
2022-02-07 22:00:12.215162 (MainThread): Database Error in model dds_wheat_usa (models/dds/dds_wheat_usa.sql)
2022-02-07 22:00:12.215335 (MainThread):   syntax error at or near ";"
2022-02-07 22:00:12.215510 (MainThread):   LINE 17: select * from usa;
2022-02-07 22:00:12.215683 (MainThread):                             ^
2022-02-07 22:00:12.215864 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/dds/dds_wheat_usa.sql
2022-02-07 22:00:12.216080 (MainThread): 
Done. PASS=17 WARN=0 ERROR=1 SKIP=0 TOTAL=18
2022-02-07 22:00:12.216395 (MainThread): Flushing usage events
2022-02-07 22:00:22.654958 (MainThread): Running with dbt=0.19.0
2022-02-07 22:00:22.765984 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 22:00:22.766722 (MainThread): Tracking: do not track
2022-02-07 22:00:22.820377 (MainThread): Partial parsing not enabled
2022-02-07 22:00:22.821389 (MainThread): Parsing macros/adapters.sql
2022-02-07 22:00:22.842641 (MainThread): Parsing macros/catalog.sql
2022-02-07 22:00:22.847972 (MainThread): Parsing macros/relations.sql
2022-02-07 22:00:22.851728 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 22:00:22.857490 (MainThread): Parsing macros/core.sql
2022-02-07 22:00:22.866699 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 22:00:22.932574 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 22:00:22.936045 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 22:00:22.938622 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 22:00:22.947831 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 22:00:22.949710 (MainThread): Parsing macros/etc/query.sql
2022-02-07 22:00:22.950948 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 22:00:22.952084 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 22:00:22.961902 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 22:00:22.992763 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 22:00:22.995820 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 22:00:23.036414 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 22:00:23.055415 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 22:00:23.061998 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 22:00:23.064249 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 22:00:23.078681 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 22:00:23.083835 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 22:00:23.090788 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 22:00:23.097535 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 22:00:23.099368 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 22:00:23.101912 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 22:00:23.104970 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 22:00:23.110986 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 22:00:23.113763 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 22:00:23.117388 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 22:00:23.119203 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 22:00:23.133050 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 22:00:23.135966 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 22:00:23.138170 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 22:00:23.141389 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 22:00:23.142583 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 22:00:23.145145 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 22:00:23.148662 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 22:00:23.150822 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 22:00:23.152976 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 22:00:23.155561 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 22:00:23.162475 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 22:00:23.166088 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 22:00:23.168536 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 22:00:23.169867 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 22:00:23.171539 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 22:00:23.172920 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 22:00:23.174285 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 22:00:23.179208 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 22:00:23.180618 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 22:00:23.182183 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 22:00:23.184143 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 22:00:23.186698 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 22:00:23.188362 (MainThread): Parsing macros/sql/star.sql
2022-02-07 22:00:23.191833 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 22:00:23.193693 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 22:00:23.197904 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 22:00:23.199734 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 22:00:23.206821 (MainThread): Parsing macros/sql/union.sql
2022-02-07 22:00:23.214879 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 22:00:23.216731 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 22:00:23.220986 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 22:00:23.224387 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 22:00:23.229271 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 22:00:23.242482 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 22:00:23.254443 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 22:00:23.257777 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 22:00:23.261950 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 22:00:23.266967 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 22:00:23.273395 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 22:00:23.275686 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 22:00:23.278166 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 22:00:23.280261 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 22:00:23.310755 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 22:00:23.312922 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 22:00:23.315503 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 22:00:23.317566 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 22:00:23.319621 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 22:00:23.330283 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 22:00:23.339578 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 22:00:23.346435 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 22:00:23.350561 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 22:00:23.354302 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 22:00:23.359216 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 22:00:23.365388 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 22:00:23.368757 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 22:00:23.378795 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 22:00:23.382892 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 22:00:23.387989 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 22:00:23.389291 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 22:00:23.392764 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 22:00:23.397320 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 22:00:23.403389 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 22:00:23.413285 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 22:00:23.416400 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 22:00:23.416911 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 22:00:23.426931 (MainThread): Parsing macros/tables/link.sql
2022-02-07 22:00:23.440608 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 22:00:23.470155 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 22:00:23.484942 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 22:00:23.491470 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 22:00:23.511120 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 22:00:23.519255 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 22:00:23.537311 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 22:00:23.538624 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 22:00:23.574364 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 22:00:23.589691 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 22:00:23.605167 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 22:00:23.606797 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 22:00:23.613221 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 22:00:23.615706 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 22:00:23.626472 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 22:00:23.638016 (MainThread): Partial parsing not enabled
2022-02-07 22:00:23.743214 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:23.843077 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:23.864342 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:23.891369 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:23.931362 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:23.973345 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:23.995023 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:24.014782 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:24.036007 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:24.144263 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:24.175958 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:24.206666 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:24.234013 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:24.244835 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:24.260225 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:24.291343 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:24.303529 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:24.315301 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:25.100560 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.report
- models.project_otus_dbt.raw_vault.links

2022-02-07 22:00:25.309763 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 22:00:25.311086 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 22:00:25.315379 (MainThread): 
2022-02-07 22:00:25.316210 (MainThread): Acquiring new postgres connection "master".
2022-02-07 22:00:25.361815 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 22:00:25.390811 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 22:00:25.391240 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 22:00:25.391578 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 22:00:25.416732 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.03 seconds
2022-02-07 22:00:25.422320 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 22:00:25.478455 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 22:00:25.494277 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 22:00:25.494714 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 22:00:25.495048 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 22:00:25.507404 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:25.507755 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 22:00:25.507986 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 22:00:25.513437 (ThreadPoolExecutor-1_0): SQL status: SELECT 24 in 0.01 seconds
2022-02-07 22:00:25.548440 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 22:00:25.550246 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 22:00:25.614224 (MainThread): Using postgres connection "master".
2022-02-07 22:00:25.614615 (MainThread): On master: BEGIN
2022-02-07 22:00:25.614925 (MainThread): Opening a new connection, currently in state init
2022-02-07 22:00:25.630958 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-07 22:00:25.631328 (MainThread): Using postgres connection "master".
2022-02-07 22:00:25.631603 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 22:00:25.985056 (MainThread): SQL status: SELECT 10 in 0.35 seconds
2022-02-07 22:00:25.996602 (MainThread): On master: ROLLBACK
2022-02-07 22:00:25.998230 (MainThread): Using postgres connection "master".
2022-02-07 22:00:25.998435 (MainThread): On master: BEGIN
2022-02-07 22:00:26.000632 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:26.000850 (MainThread): On master: COMMIT
2022-02-07 22:00:26.000924 (MainThread): Using postgres connection "master".
2022-02-07 22:00:26.001016 (MainThread): On master: COMMIT
2022-02-07 22:00:26.002208 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:26.002420 (MainThread): On master: Close
2022-02-07 22:00:26.002831 (MainThread): 01:00:25 | Concurrency: 2 threads (target='dev')
2022-02-07 22:00:26.003028 (MainThread): 01:00:25 | 
2022-02-07 22:00:26.016032 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 22:00:26.016409 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 22:00:26.018142 (Thread-1): 01:00:26 | 1 of 18 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-07 22:00:26.020271 (Thread-2): 01:00:26 | 2 of 18 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-07 22:00:26.021014 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:26.021553 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:26.021917 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 22:00:26.022333 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 22:00:26.104341 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:26.107386 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:26.107706 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-07 22:00:26.108094 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 22:00:26.108398 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:26.108612 (Thread-2): Opening a new connection, currently in state init
2022-02-07 22:00:26.120872 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:26.121156 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:26.121312 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:26.123772 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 22:00:26.124074 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:26.124175 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:26.136166 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 22:00:26.136635 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-07 22:00:26.214756 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:26.215184 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:26.215370 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:26.215640 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:26.219793 (Thread-2): SQL status: SELECT 18 in 0.00 seconds
2022-02-07 22:00:26.228091 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-07 22:00:26.230510 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 22:00:26.239920 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 22:00:26.240763 (Thread-2): finished collecting timing info
2022-02-07 22:00:26.246663 (Thread-1): finished collecting timing info
2022-02-07 22:00:26.281085 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:26.286513 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 22:00:26.287918 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:26.288375 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 22:00:26.289577 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:26.295273 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 22:00:26.295690 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:26.301390 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:26.301811 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 22:00:26.302283 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:00:26.304272 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:26.304527 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:26.313900 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 22:00:26.316200 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 22:00:26.317406 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:26.317795 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:00:26.318625 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:26.318904 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:00:26.325396 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 22:00:26.331496 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 22:00:26.355039 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:26.355831 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:26.356107 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-07 22:00:26.356436 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-07 22:00:26.359179 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:26.359671 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:26.365518 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:26.370379 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:26.370794 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-07 22:00:26.371100 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 22:00:26.374236 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:26.374589 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:26.392246 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 22:00:26.398609 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:26.399526 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 22:00:26.399823 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 22:00:26.400285 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:26.400798 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 22:00:26.403861 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:26.409967 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:00:26.413780 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:00:26.418532 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:00:26.418948 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:00:26.419304 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 22:00:26.423578 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:26.429166 (Thread-1): finished collecting timing info
2022-02-07 22:00:26.429794 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 22:00:26.430154 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-07 22:00:26.434656 (Thread-2): finished collecting timing info
2022-02-07 22:00:26.435511 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 22:00:26.438883 (Thread-1): 01:00:26 | 1 of 18 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.42s]
2022-02-07 22:00:26.441977 (Thread-2): 01:00:26 | 2 of 18 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.42s]
2022-02-07 22:00:26.442532 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 22:00:26.443132 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 22:00:26.444116 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 22:00:26.445419 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 22:00:26.448658 (Thread-1): 01:00:26 | 3 of 18 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-07 22:00:26.451884 (Thread-2): 01:00:26 | 4 of 18 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-07 22:00:26.452833 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:26.453526 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:26.453842 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 22:00:26.454199 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 22:00:26.488052 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:26.493513 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 22:00:26.498985 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:26.501319 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:26.501893 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-07 22:00:26.502146 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:26.514960 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:26.515293 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:26.515555 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:26.516126 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 22:00:26.516372 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:26.516536 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:26.525974 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 22:00:26.535099 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:26.535392 (Thread-2): SQL status: SELECT 7 in 0.02 seconds
2022-02-07 22:00:26.535591 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:26.543455 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:26.544015 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:26.548196 (Thread-1): SQL status: SELECT 7 in 0.00 seconds
2022-02-07 22:00:26.554987 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 22:00:26.555244 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 22:00:26.561020 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 22:00:26.561479 (Thread-1): finished collecting timing info
2022-02-07 22:00:26.571546 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:26.571830 (Thread-2): finished collecting timing info
2022-02-07 22:00:26.572289 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 22:00:26.580409 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:26.580784 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-07 22:00:26.582130 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:26.582423 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:26.588681 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:26.591749 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:26.592239 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 22:00:26.592536 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 22:00:26.594267 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:26.594602 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:26.596109 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 22:00:26.598464 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 22:00:26.599420 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:26.599743 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:00:26.600064 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:26.600333 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:00:26.603713 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 22:00:26.603973 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 22:00:26.610697 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:26.615300 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:26.615751 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-07 22:00:26.616002 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-07 22:00:26.618146 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:26.618404 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:26.621261 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:26.627203 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:26.627416 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-07 22:00:26.627696 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-07 22:00:26.629562 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:26.629777 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:26.630915 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 22:00:26.632233 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 22:00:26.632483 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:26.632688 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:26.632871 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 22:00:26.633062 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 22:00:26.635872 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:26.638674 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:00:26.638916 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:00:26.639470 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 22:00:26.642405 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:00:26.642829 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 22:00:26.646204 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:00:26.650972 (Thread-1): finished collecting timing info
2022-02-07 22:00:26.651387 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 22:00:26.651754 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 22:00:26.656388 (Thread-2): finished collecting timing info
2022-02-07 22:00:26.657053 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-07 22:00:26.658701 (Thread-1): 01:00:26 | 3 of 18 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.21s]
2022-02-07 22:00:26.662563 (Thread-2): 01:00:26 | 4 of 18 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.21s]
2022-02-07 22:00:26.663001 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 22:00:26.663367 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_gbp
2022-02-07 22:00:26.663572 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 22:00:26.664689 (Thread-1): 01:00:26 | 5 of 18 START table model public.dds_wheat_gbp....................... [RUN]
2022-02-07 22:00:26.665865 (Thread-2): Began running node model.project_otus_dbt.dim_day
2022-02-07 22:00:26.666856 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:26.670183 (Thread-2): 01:00:26 | 6 of 18 START table model public.dim_day............................. [RUN]
2022-02-07 22:00:26.670569 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_gbp
2022-02-07 22:00:26.676668 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:26.677526 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-07 22:00:26.677855 (Thread-2): Compiling model.project_otus_dbt.dim_day
2022-02-07 22:00:26.689757 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 22:00:26.690240 (Thread-1): finished collecting timing info
2022-02-07 22:00:26.690998 (Thread-2): finished collecting timing info
2022-02-07 22:00:26.723826 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:26.729262 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_tmp" cascade
2022-02-07 22:00:26.729758 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:26.729978 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:26.730240 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-07 22:00:26.730755 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:26.742109 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:00:26.745050 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:26.745303 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:00:26.745523 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-07 22:00:26.750791 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:26.751342 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 22:00:26.752565 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:26.752884 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:26.769094 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-07 22:00:26.769756 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 22:00:26.770478 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:26.770725 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: BEGIN
2022-02-07 22:00:26.771277 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:26.771605 (Thread-2): On model.project_otus_dbt.dim_day: BEGIN
2022-02-07 22:00:26.772289 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:26.772669 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:26.772972 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */


  create  table "postgres"."public"."dds_wheat_gbp__dbt_tmp"
  as (
    with gbp as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,cast(su.price as decimal(18,2))/100.0*rt.rate as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from public.hub_wheat_gbp as hu
    left join public.sat_wheat_gbp_details as su
    on hu.date_pk=su.date_pk
    left join public.dds_rate_gbp_usd as rt
    on hu.date_pk=rt.date_pk
)
select * from gbp
  );
2022-02-07 22:00:26.773332 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:26.773662 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:26.773815 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 day')
        as t(date)
        )

select * from dim_day
order by date desc
  );
2022-02-07 22:00:26.785441 (Thread-1): SQL status: SELECT 531 in 0.01 seconds
2022-02-07 22:00:26.791714 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:26.791999 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp" rename to "dds_wheat_gbp__dbt_backup"
2022-02-07 22:00:26.793751 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:26.798970 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:26.799223 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp__dbt_tmp" rename to "dds_wheat_gbp"
2022-02-07 22:00:26.800888 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:26.802385 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-07 22:00:26.802659 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:26.802843 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-07 22:00:26.806383 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:26.810082 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:00:26.810297 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-07 22:00:26.812869 (Thread-2): SQL status: SELECT 5114 in 0.04 seconds
2022-02-07 22:00:26.817680 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:26.817905 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-07 22:00:26.819637 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:26.823196 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:26.823494 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:00:26.823754 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-07 22:00:26.826723 (Thread-1): finished collecting timing info
2022-02-07 22:00:26.827435 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: Close
2022-02-07 22:00:26.829961 (Thread-1): 01:00:26 | 5 of 18 OK created table model public.dds_wheat_gbp.................. [SELECT 531 in 0.16s]
2022-02-07 22:00:26.830253 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:26.830655 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_gbp
2022-02-07 22:00:26.832741 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 22:00:26.833316 (Thread-1): Began running node model.project_otus_dbt.dim_week
2022-02-07 22:00:26.833791 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:26.835751 (Thread-1): 01:00:26 | 7 of 18 START table model public.dim_week............................ [RUN]
2022-02-07 22:00:26.836168 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 22:00:26.837169 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:26.837854 (Thread-1): Compiling model.project_otus_dbt.dim_week
2022-02-07 22:00:26.844720 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 22:00:26.844980 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:00:26.849274 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:00:26.849865 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 22:00:26.850207 (Thread-1): finished collecting timing info
2022-02-07 22:00:26.860833 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:26.861107 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:00:26.861310 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-07 22:00:26.864769 (Thread-2): finished collecting timing info
2022-02-07 22:00:26.865274 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:26.865610 (Thread-2): On model.project_otus_dbt.dim_day: Close
2022-02-07 22:00:26.869605 (Thread-2): 01:00:26 | 6 of 18 OK created table model public.dim_day........................ [SELECT 5114 in 0.19s]
2022-02-07 22:00:26.870016 (Thread-2): Finished running node model.project_otus_dbt.dim_day
2022-02-07 22:00:26.870421 (Thread-2): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 22:00:26.873681 (Thread-2): 01:00:26 | 8 of 18 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-07 22:00:26.874558 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:26.874864 (Thread-2): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 22:00:26.895873 (Thread-1): SQL status: DROP TABLE in 0.03 seconds
2022-02-07 22:00:26.896813 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 22:00:26.901808 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:26.902582 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 22:00:26.902975 (Thread-2): finished collecting timing info
2022-02-07 22:00:26.909623 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:00:26.916656 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 22:00:26.947424 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:26.947759 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:26.947948 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp010026942438"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:26.948210 (Thread-1): On model.project_otus_dbt.dim_week: BEGIN
2022-02-07 22:00:26.948429 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:26.949905 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:26.950271 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:26.950492 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-07 22:00:26.961891 (Thread-1): SQL status: SELECT 731 in 0.01 seconds
2022-02-07 22:00:26.967569 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:26.967821 (Thread-2): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 22:00:26.968070 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-07 22:00:26.973329 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:26.973806 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-07 22:00:26.975068 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:26.975364 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:26.975554 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:26.979388 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:26.979827 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp010026942438'
        
      order by ordinal_position

  
2022-02-07 22:00:26.980058 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-07 22:00:26.981739 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:26.983002 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 22:00:26.983203 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:26.983310 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 22:00:26.986970 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:26.990223 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:00:26.990467 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:26.990657 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 22:00:26.997689 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:26.998069 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.002188 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:27.005643 (Thread-1): finished collecting timing info
2022-02-07 22:00:27.006055 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:27.006350 (Thread-1): On model.project_otus_dbt.dim_week: Close
2022-02-07 22:00:27.014648 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:27.015163 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.017463 (Thread-1): 01:00:27 | 7 of 18 OK created table model public.dim_week....................... [SELECT 731 in 0.18s]
2022-02-07 22:00:27.018171 (Thread-1): Finished running node model.project_otus_dbt.dim_week
2022-02-07 22:00:27.018496 (Thread-1): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 22:00:27.020445 (Thread-1): 01:00:27 | 9 of 18 START incremental model public.sat_rate_gbp_usd_details...... [RUN]
2022-02-07 22:00:27.021169 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:27.021479 (Thread-1): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 22:00:27.037921 (Thread-2): SQL status: SELECT 4 in 0.02 seconds
2022-02-07 22:00:27.042123 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 22:00:27.043525 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 22:00:27.044186 (Thread-1): finished collecting timing info
2022-02-07 22:00:27.049725 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:27.052758 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:27.053041 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp010026942438"
    );
  
2022-02-07 22:00:27.053290 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp010027051150"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:27.053696 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:27.055130 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:00:27.057158 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 22:00:27.057445 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:00:27.057595 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 22:00:27.059768 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:27.062370 (Thread-2): finished collecting timing info
2022-02-07 22:00:27.062894 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-07 22:00:27.065423 (Thread-2): 01:00:27 | 8 of 18 OK created incremental model public.hub_rate_gbp_usd......... [INSERT 0 0 in 0.19s]
2022-02-07 22:00:27.065805 (Thread-2): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 22:00:27.066098 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 22:00:27.069391 (Thread-2): 01:00:27 | 10 of 18 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-07 22:00:27.070229 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:27.070444 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-07 22:00:27.083282 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 22:00:27.083531 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 22:00:27.088418 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:27.088746 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-07 22:00:27.088989 (Thread-2): finished collecting timing info
2022-02-07 22:00:27.095372 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:27.099682 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:27.100010 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:27.100340 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp010027097989"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:27.100704 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp010027051150'
        
      order by ordinal_position

  
2022-02-07 22:00:27.100974 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:27.111763 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:00:27.118378 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:27.118677 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.123037 (Thread-2): SQL status: SELECT 0 in 0.02 seconds
2022-02-07 22:00:27.127552 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:27.127808 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:00:27.128019 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-07 22:00:27.134593 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:27.135068 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.136272 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:27.136569 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:27.136768 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp010027097989'
        
      order by ordinal_position

  
2022-02-07 22:00:27.140693 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:00:27.142484 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 22:00:27.143186 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:27.143450 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp010027051150"
    );
  
2022-02-07 22:00:27.145113 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:00:27.145407 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:27.146811 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 22:00:27.152128 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:27.152507 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:00:27.152769 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.153002 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 22:00:27.155748 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:27.158218 (Thread-1): finished collecting timing info
2022-02-07 22:00:27.158730 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-07 22:00:27.158937 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:27.166477 (Thread-1): 01:00:27 | 9 of 18 OK created incremental model public.sat_rate_gbp_usd_details. [INSERT 0 0 in 0.14s]
2022-02-07 22:00:27.167521 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:27.167909 (Thread-1): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 22:00:27.168178 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.168746 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 22:00:27.172409 (Thread-1): 01:00:27 | 11 of 18 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-07 22:00:27.173259 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:27.173680 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 22:00:27.180961 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:27.187710 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 22:00:27.201355 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 22:00:27.202103 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:27.202429 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp010027097989"
    );
  
2022-02-07 22:00:27.202739 (Thread-1): finished collecting timing info
2022-02-07 22:00:27.209191 (Thread-2): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-07 22:00:27.212861 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:27.214281 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 22:00:27.214599 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp010027210940"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:27.214872 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:00:27.215171 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:27.215394 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 22:00:27.218394 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:27.221322 (Thread-2): finished collecting timing info
2022-02-07 22:00:27.221688 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-07 22:00:27.224016 (Thread-2): 01:00:27 | 10 of 18 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.15s]
2022-02-07 22:00:27.224519 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 22:00:27.224898 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 22:00:27.228096 (Thread-2): 01:00:27 | 12 of 18 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-07 22:00:27.229670 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:27.230157 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-07 22:00:27.248360 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 22:00:27.248632 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 22:00:27.253224 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:27.253557 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-07 22:00:27.253896 (Thread-2): finished collecting timing info
2022-02-07 22:00:27.260249 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:27.265843 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:27.268639 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:27.268904 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp010027210940'
        
      order by ordinal_position

  
2022-02-07 22:00:27.269200 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp010027265490"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:27.269668 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:27.277938 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 22:00:27.282750 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:27.283127 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.287433 (Thread-1): SQL status: SELECT 12 in 0.00 seconds
2022-02-07 22:00:27.294422 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:27.294662 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 22:00:27.294882 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.354716 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:27.355198 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-07 22:00:27.356692 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:27.356959 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:27.357070 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp010027265490'
        
      order by ordinal_position

  
2022-02-07 22:00:27.361580 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 22:00:27.363036 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 22:00:27.363603 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:27.363824 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp010027210940"
    );
  
2022-02-07 22:00:27.365641 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:00:27.367113 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 22:00:27.367341 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:27.367534 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:00:27.373491 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:27.373844 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 22:00:27.374246 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.377172 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:27.379635 (Thread-1): finished collecting timing info
2022-02-07 22:00:27.379998 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:27.380224 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-07 22:00:27.386514 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:27.386849 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.389051 (Thread-1): 01:00:27 | 11 of 18 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.21s]
2022-02-07 22:00:27.389674 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 22:00:27.389991 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 22:00:27.392244 (Thread-1): 01:00:27 | 13 of 18 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-07 22:00:27.393504 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:27.393903 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 22:00:27.400592 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:27.407422 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 22:00:27.418671 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 22:00:27.419289 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:27.419582 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp010027265490"
    );
  
2022-02-07 22:00:27.419951 (Thread-1): finished collecting timing info
2022-02-07 22:00:27.426604 (Thread-2): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-07 22:00:27.431771 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:27.433535 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 22:00:27.433843 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp010027428782"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:27.434100 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:00:27.434345 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:27.434577 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 22:00:27.437596 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:27.440928 (Thread-2): finished collecting timing info
2022-02-07 22:00:27.441309 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-07 22:00:27.444127 (Thread-2): 01:00:27 | 12 of 18 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.21s]
2022-02-07 22:00:27.444598 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 22:00:27.445011 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 22:00:27.447565 (Thread-2): 01:00:27 | 14 of 18 START incremental model public.hub_wheat_gbp................ [RUN]
2022-02-07 22:00:27.448448 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:27.448772 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-07 22:00:27.462369 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 22:00:27.462625 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 22:00:27.466998 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:27.467354 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-07 22:00:27.467680 (Thread-2): finished collecting timing info
2022-02-07 22:00:27.474074 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:27.479050 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:27.479302 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:27.479671 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp010027476977"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:27.479893 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp010027428782'
        
      order by ordinal_position

  
2022-02-07 22:00:27.480140 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:27.488432 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:00:27.494668 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:27.494985 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.499564 (Thread-1): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 22:00:27.506128 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:27.506378 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 22:00:27.506631 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.510647 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:27.511220 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-07 22:00:27.512673 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:27.512931 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:27.513070 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp010027476977'
        
      order by ordinal_position

  
2022-02-07 22:00:27.514934 (Thread-1): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 22:00:27.516408 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 22:00:27.516925 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:27.517148 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp010027428782"
    );
  
2022-02-07 22:00:27.518811 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:00:27.520477 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 22:00:27.520727 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:00:27.520850 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 22:00:27.521800 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:27.527533 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:27.527762 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:00:27.528015 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.530505 (Thread-1): finished collecting timing info
2022-02-07 22:00:27.531118 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-07 22:00:27.533242 (Thread-1): 01:00:27 | 13 of 18 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.14s]
2022-02-07 22:00:27.533561 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 22:00:27.534200 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 22:00:27.537376 (Thread-1): 01:00:27 | 15 of 18 START incremental model public.sat_wheat_gbp_details........ [RUN]
2022-02-07 22:00:27.538126 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:27.538883 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:27.544173 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:27.544649 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 22:00:27.544911 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.565069 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 22:00:27.565362 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:00:27.567325 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 22:00:27.567912 (Thread-1): finished collecting timing info
2022-02-07 22:00:27.574123 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:27.579643 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp010027476977"
    );
  
2022-02-07 22:00:27.580066 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:27.580386 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp010027578079"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:00:27.580543 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:27.581977 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:00:27.583882 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 22:00:27.584144 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:00:27.584317 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 22:00:27.586668 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:27.589273 (Thread-2): finished collecting timing info
2022-02-07 22:00:27.589811 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-07 22:00:27.591848 (Thread-2): 01:00:27 | 14 of 18 OK created incremental model public.hub_wheat_gbp........... [INSERT 0 0 in 0.14s]
2022-02-07 22:00:27.592228 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 22:00:27.592619 (Thread-2): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 22:00:27.595368 (Thread-2): 01:00:27 | 16 of 18 START table model public.dds_rate_gbp_usd................... [RUN]
2022-02-07 22:00:27.596807 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:27.597367 (Thread-2): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 22:00:27.609298 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-07 22:00:27.609691 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 22:00:27.617942 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:27.618324 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-07 22:00:27.618712 (Thread-2): finished collecting timing info
2022-02-07 22:00:27.625127 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:27.628298 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:27.628557 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:27.628847 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 22:00:27.629300 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp010027578079'
        
      order by ordinal_position

  
2022-02-07 22:00:27.629785 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:27.639956 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:00:27.646919 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:27.647183 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 22:00:27.647420 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.651319 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:27.651853 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:00:27.653187 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:27.655433 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-07 22:00:27.656130 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:27.656436 (Thread-1): SQL status: SELECT 11 in 0.00 seconds
2022-02-07 22:00:27.656657 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-07 22:00:27.662640 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:27.663128 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:00:27.664279 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:27.664609 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:27.664810 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */


  create  table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp"
  as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );
2022-02-07 22:00:27.669209 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:00:27.671093 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 22:00:27.671836 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:27.672139 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp010027578079"
    );
  
2022-02-07 22:00:27.673918 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:00:27.675781 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 22:00:27.676114 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:00:27.676418 (Thread-2): SQL status: SELECT 548 in 0.01 seconds
2022-02-07 22:00:27.676629 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 22:00:27.682414 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:27.682813 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd" rename to "dds_rate_gbp_usd__dbt_backup"
2022-02-07 22:00:27.684320 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:27.688057 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:27.688297 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:00:27.688488 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-07 22:00:27.691116 (Thread-1): finished collecting timing info
2022-02-07 22:00:27.691864 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-07 22:00:27.694814 (Thread-1): 01:00:27 | 15 of 18 OK created incremental model public.sat_wheat_gbp_details... [INSERT 0 0 in 0.15s]
2022-02-07 22:00:27.695142 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:27.695568 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 22:00:27.698320 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-07 22:00:27.698981 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 22:00:27.699930 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:27.701523 (Thread-1): 01:00:27 | 17 of 18 START table model public.dds_wheat_msk...................... [RUN]
2022-02-07 22:00:27.701955 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-07 22:00:27.702787 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:27.703469 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-07 22:00:27.711152 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:00:27.720367 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:00:27.721793 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 22:00:27.722032 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:00:27.722880 (Thread-1): finished collecting timing info
2022-02-07 22:00:27.733029 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:00:27.735582 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:27.739227 (Thread-2): finished collecting timing info
2022-02-07 22:00:27.739750 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-07 22:00:27.740050 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-07 22:00:27.740355 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:00:27.744707 (Thread-2): 01:00:27 | 16 of 18 OK created table model public.dds_rate_gbp_usd.............. [SELECT 548 in 0.15s]
2022-02-07 22:00:27.745109 (Thread-2): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 22:00:27.745537 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_usa
2022-02-07 22:00:27.747827 (Thread-2): 01:00:27 | 18 of 18 START table model public.dds_wheat_usa...................... [RUN]
2022-02-07 22:00:27.748723 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:27.749114 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_usa
2022-02-07 22:00:27.763576 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 22:00:27.766253 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-07 22:00:27.770839 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:27.771441 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 22:00:27.771863 (Thread-2): finished collecting timing info
2022-02-07 22:00:27.778320 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:00:27.784146 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:27.786079 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 22:00:27.786532 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_tmp" cascade
2022-02-07 22:00:27.787117 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:00:27.787836 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:27.788139 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-07 22:00:27.789606 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:27.789892 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:27.790116 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */


  create  table "postgres"."public"."dds_wheat_msk__dbt_tmp"
  as (
    with dds_wheat_msk as(
    select sm.tradedate  as tradedate
        ,cast(sm.value as decimal(18,2)) as value
        ,cast(sm.open as decimal(18,2)) as open
        ,cast(sm.close as decimal(18,2)) as close
        ,cast(sm.high as decimal(18,2)) as high
        ,cast(sm.low as decimal(18,2)) as low
        ,cast(sm.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hm
    left join "postgres"."public"."sat_wheat_msk_details" as sm
    on hm.date_pk=sm.date_pk
)
select * from dds_wheat_msk
  );
2022-02-07 22:00:27.795016 (Thread-1): SQL status: SELECT 216 in 0.00 seconds
2022-02-07 22:00:27.800155 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:27.800497 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-07 22:00:27.801922 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:27.805854 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:27.806122 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 22:00:27.806391 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-07 22:00:27.809892 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:27.810334 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-07 22:00:27.811430 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:27.812828 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-07 22:00:27.813031 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:27.814919 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 22:00:27.815150 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:27.815352 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 22:00:27.815524 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:27.815786 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: BEGIN
2022-02-07 22:00:27.817043 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:00:27.817329 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:27.817476 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */


  create  table "postgres"."public"."dds_wheat_usa__dbt_tmp"
  as (
    with usa as (
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,cast(su.price as decimal(18,2))/100.0/2.7 as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_usa" as hu
    left join "postgres"."public"."sat_wheat_usa_details" as su
    on hu.date_pk=su.date_pk
)
select * from usa
  );
2022-02-07 22:00:27.818272 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:27.821557 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:00:27.821800 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 22:00:27.825497 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:27.828487 (Thread-1): finished collecting timing info
2022-02-07 22:00:27.828816 (Thread-2): SQL status: SELECT 547 in 0.01 seconds
2022-02-07 22:00:27.829039 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-07 22:00:27.832908 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:27.833349 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa__dbt_tmp" rename to "dds_wheat_usa"
2022-02-07 22:00:27.836297 (Thread-1): 01:00:27 | 17 of 18 OK created table model public.dds_wheat_msk................. [SELECT 216 in 0.13s]
2022-02-07 22:00:27.836967 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 22:00:27.838170 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:00:27.840005 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-07 22:00:27.840279 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:27.840407 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-07 22:00:27.842802 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:27.845895 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:00:27.846121 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-07 22:00:27.847282 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:00:27.850027 (Thread-2): finished collecting timing info
2022-02-07 22:00:27.850354 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: Close
2022-02-07 22:00:27.852338 (Thread-2): 01:00:27 | 18 of 18 OK created table model public.dds_wheat_usa................. [SELECT 547 in 0.10s]
2022-02-07 22:00:27.852674 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_usa
2022-02-07 22:00:27.855024 (MainThread): Acquiring new postgres connection "master".
2022-02-07 22:00:27.855272 (MainThread): Using postgres connection "master".
2022-02-07 22:00:27.855416 (MainThread): On master: BEGIN
2022-02-07 22:00:27.855558 (MainThread): Opening a new connection, currently in state closed
2022-02-07 22:00:27.864787 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:00:27.865056 (MainThread): On master: COMMIT
2022-02-07 22:00:27.865191 (MainThread): Using postgres connection "master".
2022-02-07 22:00:27.865318 (MainThread): On master: COMMIT
2022-02-07 22:00:27.866418 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:00:27.866681 (MainThread): On master: Close
2022-02-07 22:00:27.867517 (MainThread): 01:00:27 | 
2022-02-07 22:00:27.867995 (MainThread): 01:00:27 | Finished running 4 view models, 6 table models, 8 incremental models in 2.55s.
2022-02-07 22:00:27.868590 (MainThread): Connection 'master' was properly closed.
2022-02-07 22:00:27.868872 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_msk' was properly closed.
2022-02-07 22:00:27.869094 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_usa' was properly closed.
2022-02-07 22:00:27.980542 (MainThread): 
2022-02-07 22:00:27.980763 (MainThread): Completed successfully
2022-02-07 22:00:27.980939 (MainThread): 
Done. PASS=18 WARN=0 ERROR=0 SKIP=0 TOTAL=18
2022-02-07 22:00:27.981166 (MainThread): Flushing usage events
2022-02-07 22:03:42.010816 (MainThread): Running with dbt=0.19.0
2022-02-07 22:03:42.090452 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 22:03:42.091225 (MainThread): Tracking: do not track
2022-02-07 22:03:42.160041 (MainThread): Partial parsing not enabled
2022-02-07 22:03:42.160968 (MainThread): Parsing macros/adapters.sql
2022-02-07 22:03:42.180093 (MainThread): Parsing macros/catalog.sql
2022-02-07 22:03:42.182811 (MainThread): Parsing macros/relations.sql
2022-02-07 22:03:42.185198 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 22:03:42.189648 (MainThread): Parsing macros/core.sql
2022-02-07 22:03:42.196413 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 22:03:42.248248 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 22:03:42.250583 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 22:03:42.252499 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 22:03:42.260989 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 22:03:42.262993 (MainThread): Parsing macros/etc/query.sql
2022-02-07 22:03:42.264262 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 22:03:42.265297 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 22:03:42.274067 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 22:03:42.297302 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 22:03:42.299087 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 22:03:42.327127 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 22:03:42.359784 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 22:03:42.371924 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 22:03:42.375162 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 22:03:42.392622 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 22:03:42.400296 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 22:03:42.408342 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 22:03:42.415572 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 22:03:42.418170 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 22:03:42.420997 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 22:03:42.423811 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 22:03:42.430203 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 22:03:42.433344 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 22:03:42.436978 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 22:03:42.438915 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 22:03:42.453048 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 22:03:42.456309 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 22:03:42.458979 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 22:03:42.462955 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 22:03:42.464358 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 22:03:42.467646 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 22:03:42.471679 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 22:03:42.473713 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 22:03:42.475634 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 22:03:42.478080 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 22:03:42.485996 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 22:03:42.489864 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 22:03:42.492810 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 22:03:42.494529 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 22:03:42.496592 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 22:03:42.498398 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 22:03:42.500146 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 22:03:42.506004 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 22:03:42.507443 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 22:03:42.509234 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 22:03:42.511463 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 22:03:42.514487 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 22:03:42.516429 (MainThread): Parsing macros/sql/star.sql
2022-02-07 22:03:42.520631 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 22:03:42.522927 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 22:03:42.527410 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 22:03:42.531009 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 22:03:42.541380 (MainThread): Parsing macros/sql/union.sql
2022-02-07 22:03:42.552654 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 22:03:42.555182 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 22:03:42.560022 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 22:03:42.563724 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 22:03:42.567520 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 22:03:42.574201 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 22:03:42.578914 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 22:03:42.580550 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 22:03:42.582536 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 22:03:42.585402 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 22:03:42.589094 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 22:03:42.590480 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 22:03:42.591779 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 22:03:42.593056 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 22:03:42.615571 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 22:03:42.617449 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 22:03:42.619704 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 22:03:42.621677 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 22:03:42.623482 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 22:03:42.629332 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 22:03:42.635862 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 22:03:42.641547 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 22:03:42.644925 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 22:03:42.648449 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 22:03:42.652224 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 22:03:42.657365 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 22:03:42.660444 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 22:03:42.669625 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 22:03:42.673535 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 22:03:42.678683 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 22:03:42.680089 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 22:03:42.683480 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 22:03:42.687592 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 22:03:42.693840 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 22:03:42.704980 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 22:03:42.708374 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 22:03:42.708945 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 22:03:42.719282 (MainThread): Parsing macros/tables/link.sql
2022-02-07 22:03:42.729244 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 22:03:42.740636 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 22:03:42.749218 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 22:03:42.753579 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 22:03:42.768274 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 22:03:42.775071 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 22:03:42.792187 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 22:03:42.793509 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 22:03:42.811385 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 22:03:42.816824 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 22:03:42.823341 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 22:03:42.824752 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 22:03:42.830430 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 22:03:42.832715 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 22:03:42.842997 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 22:03:42.852342 (MainThread): Partial parsing not enabled
2022-02-07 22:03:42.937552 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:03:43.040534 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:03:43.064871 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:03:43.089053 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:03:43.110378 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:03:43.140143 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:03:43.154869 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:03:43.169290 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:03:43.183566 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:03:43.311261 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:03:43.330093 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:03:43.349937 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:03:43.369762 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:03:43.380719 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:03:43.390022 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:03:43.401738 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:03:43.414371 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:03:43.426027 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:03:44.209998 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.raw_vault.links
- models.project_otus_dbt.report

2022-02-07 22:03:44.360047 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 22:03:44.360639 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 22:03:44.363012 (MainThread): 
2022-02-07 22:03:44.363604 (MainThread): Acquiring new postgres connection "master".
2022-02-07 22:03:44.383756 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 22:03:44.400778 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 22:03:44.401054 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 22:03:44.401175 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 22:03:44.416221 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.02 seconds
2022-02-07 22:03:44.422196 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 22:03:44.472610 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 22:03:44.486420 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 22:03:44.487306 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 22:03:44.489722 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 22:03:44.521298 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.03 seconds
2022-02-07 22:03:44.523632 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 22:03:44.526210 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 22:03:44.548861 (ThreadPoolExecutor-1_0): SQL status: SELECT 25 in 0.02 seconds
2022-02-07 22:03:44.579996 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 22:03:44.581316 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 22:03:44.620600 (MainThread): Using postgres connection "master".
2022-02-07 22:03:44.620837 (MainThread): On master: BEGIN
2022-02-07 22:03:44.620963 (MainThread): Opening a new connection, currently in state init
2022-02-07 22:03:44.632191 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:03:44.632498 (MainThread): Using postgres connection "master".
2022-02-07 22:03:44.632824 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 22:03:44.963185 (MainThread): SQL status: SELECT 10 in 0.33 seconds
2022-02-07 22:03:44.978885 (MainThread): On master: ROLLBACK
2022-02-07 22:03:44.980318 (MainThread): Using postgres connection "master".
2022-02-07 22:03:44.980508 (MainThread): On master: BEGIN
2022-02-07 22:03:44.982808 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:03:44.983113 (MainThread): On master: COMMIT
2022-02-07 22:03:44.983266 (MainThread): Using postgres connection "master".
2022-02-07 22:03:44.983410 (MainThread): On master: COMMIT
2022-02-07 22:03:44.985138 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:03:44.985510 (MainThread): On master: Close
2022-02-07 22:03:44.986228 (MainThread): 01:03:44 | Concurrency: 2 threads (target='dev')
2022-02-07 22:03:44.986865 (MainThread): 01:03:44 | 
2022-02-07 22:03:44.992102 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 22:03:44.992387 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 22:03:44.993657 (Thread-1): 01:03:44 | 1 of 18 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-07 22:03:44.995649 (Thread-2): 01:03:44 | 2 of 18 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-07 22:03:44.996322 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:03:44.996964 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:03:44.997339 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 22:03:44.997614 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 22:03:45.054539 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:03:45.055555 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:03:45.055894 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-07 22:03:45.056112 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-07 22:03:45.056386 (Thread-2): Opening a new connection, currently in state init
2022-02-07 22:03:45.056574 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:03:45.072040 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 22:03:45.072348 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-07 22:03:45.072546 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:03:45.072875 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:03:45.073226 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:45.073489 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:45.082028 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-07 22:03:45.093634 (Thread-2): SQL status: SELECT 7 in 0.02 seconds
2022-02-07 22:03:45.173466 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:03:45.174116 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:03:45.174317 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:45.174508 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:45.179755 (Thread-1): SQL status: SELECT 6 in 0.00 seconds
2022-02-07 22:03:45.185318 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 22:03:45.185629 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 22:03:45.195680 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 22:03:45.195992 (Thread-1): finished collecting timing info
2022-02-07 22:03:45.222981 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:03:45.223250 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 22:03:45.223526 (Thread-2): finished collecting timing info
2022-02-07 22:03:45.229677 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 22:03:45.239118 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:03:45.243341 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:03:45.243635 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:03:45.243998 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-07 22:03:45.245674 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:03:45.246059 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:03:45.254390 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 22:03:45.260429 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:03:45.261041 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 22:03:45.261453 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:03:45.261614 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:03:45.262486 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:03:45.264387 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 22:03:45.264891 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:03:45.265096 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:03:45.266552 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 22:03:45.278938 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 22:03:45.300538 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:03:45.304586 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:03:45.305110 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-07 22:03:45.305679 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-07 22:03:45.308413 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:45.308698 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:45.312929 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:03:45.318254 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:03:45.318707 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-07 22:03:45.318987 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-07 22:03:45.321593 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:45.321982 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:45.331881 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 22:03:45.334420 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 22:03:45.335090 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:03:45.335679 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:03:45.336160 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 22:03:45.336590 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 22:03:45.341772 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:03:45.342144 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:03:45.351849 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:03:45.356448 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:03:45.356960 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 22:03:45.357258 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:03:45.362229 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:03:45.367482 (Thread-2): finished collecting timing info
2022-02-07 22:03:45.368052 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 22:03:45.368382 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-07 22:03:45.372871 (Thread-1): finished collecting timing info
2022-02-07 22:03:45.373657 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-07 22:03:45.376967 (Thread-2): 01:03:45 | 2 of 18 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.38s]
2022-02-07 22:03:45.380707 (Thread-1): 01:03:45 | 1 of 18 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.38s]
2022-02-07 22:03:45.381146 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 22:03:45.381607 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 22:03:45.382139 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 22:03:45.383132 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 22:03:45.386261 (Thread-2): 01:03:45 | 3 of 18 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-07 22:03:45.389609 (Thread-1): 01:03:45 | 4 of 18 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-07 22:03:45.390909 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:03:45.392105 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:03:45.392614 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 22:03:45.393187 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 22:03:45.434741 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:03:45.440267 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 22:03:45.444558 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:03:45.445027 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:03:45.445448 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 22:03:45.446362 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:03:45.458981 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:03:45.459313 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:03:45.459709 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:03:45.460017 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:03:45.460288 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:45.460512 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:45.472926 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 22:03:45.481571 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:03:45.481791 (Thread-1): SQL status: SELECT 7 in 0.02 seconds
2022-02-07 22:03:45.482375 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:45.496263 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:03:45.496541 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:45.502338 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-07 22:03:45.502741 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 22:03:45.512967 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 22:03:45.524903 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 22:03:45.525580 (Thread-2): finished collecting timing info
2022-02-07 22:03:45.526171 (Thread-1): finished collecting timing info
2022-02-07 22:03:45.546797 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:03:45.552343 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 22:03:45.554016 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:03:45.554555 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 22:03:45.556083 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:03:45.556422 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:03:45.560063 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:03:45.563893 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:03:45.564239 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 22:03:45.564468 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 22:03:45.566225 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:03:45.566513 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:03:45.568415 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 22:03:45.572564 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 22:03:45.573463 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:03:45.573729 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:03:45.573941 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:03:45.574183 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:03:45.579187 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-02-07 22:03:45.586577 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 22:03:45.588928 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:03:45.596534 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:03:45.596816 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-07 22:03:45.597153 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-07 22:03:45.599918 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:45.600293 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:45.606665 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:03:45.611381 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:03:45.611782 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 22:03:45.612128 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-07 22:03:45.614165 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:45.614458 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:45.616560 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 22:03:45.619576 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 22:03:45.620040 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:03:45.620432 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:03:45.620802 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 22:03:45.621444 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 22:03:45.625003 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:03:45.628770 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:03:45.629192 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:03:45.629502 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 22:03:45.633678 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:03:45.634396 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 22:03:45.639979 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 22:03:45.643721 (Thread-1): finished collecting timing info
2022-02-07 22:03:45.644131 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 22:03:45.644404 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 22:03:45.648209 (Thread-2): finished collecting timing info
2022-02-07 22:03:45.649044 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 22:03:45.653670 (Thread-1): 01:03:45 | 4 of 18 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.26s]
2022-02-07 22:03:45.658120 (Thread-2): 01:03:45 | 3 of 18 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.26s]
2022-02-07 22:03:45.658887 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 22:03:45.659614 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 22:03:45.660071 (Thread-1): Began running node model.project_otus_dbt.dim_day
2022-02-07 22:03:45.660739 (Thread-2): Began running node model.project_otus_dbt.dim_week
2022-02-07 22:03:45.663183 (Thread-1): 01:03:45 | 5 of 18 START table model public.dim_day............................. [RUN]
2022-02-07 22:03:45.665008 (Thread-2): 01:03:45 | 6 of 18 START table model public.dim_week............................ [RUN]
2022-02-07 22:03:45.666134 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:03:45.667037 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:03:45.667441 (Thread-1): Compiling model.project_otus_dbt.dim_day
2022-02-07 22:03:45.667870 (Thread-2): Compiling model.project_otus_dbt.dim_week
2022-02-07 22:03:45.677127 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 22:03:45.689269 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 22:03:45.690121 (Thread-1): finished collecting timing info
2022-02-07 22:03:45.690628 (Thread-2): finished collecting timing info
2022-02-07 22:03:45.738873 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:03:45.744437 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-07 22:03:45.745183 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:03:45.745458 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:03:45.745711 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-07 22:03:45.746239 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:03:45.757912 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:03:45.758188 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:03:45.761939 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:03:45.765680 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:03:45.766184 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 22:03:45.766480 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 22:03:45.768275 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:03:45.768591 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:03:45.776346 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 22:03:45.778381 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 22:03:45.779329 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:03:45.779625 (Thread-2): On model.project_otus_dbt.dim_week: BEGIN
2022-02-07 22:03:45.779911 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:03:45.780209 (Thread-1): On model.project_otus_dbt.dim_day: BEGIN
2022-02-07 22:03:45.781235 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:03:45.781456 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:03:45.781628 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:03:45.781895 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:03:45.782212 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-07 22:03:45.782529 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 day')
        as t(date)
        )

select * from dim_day
order by date desc
  );
2022-02-07 22:03:45.792256 (Thread-2): SQL status: SELECT 731 in 0.01 seconds
2022-02-07 22:03:45.798572 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:03:45.798952 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-07 22:03:45.800901 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:45.805482 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:03:45.805763 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-07 22:03:45.807365 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:45.809038 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 22:03:45.809253 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:03:45.809420 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 22:03:45.813075 (Thread-1): SQL status: SELECT 5114 in 0.03 seconds
2022-02-07 22:03:45.819864 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:03:45.820170 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:03:45.820399 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-07 22:03:45.823215 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:03:45.823785 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 22:03:45.825133 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:45.828911 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:03:45.829140 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-07 22:03:45.829898 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:03:45.833501 (Thread-2): finished collecting timing info
2022-02-07 22:03:45.833922 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:45.834247 (Thread-2): On model.project_otus_dbt.dim_week: Close
2022-02-07 22:03:45.836181 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 22:03:45.837083 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:03:45.839939 (Thread-2): 01:03:45 | 6 of 18 OK created table model public.dim_week....................... [SELECT 731 in 0.17s]
2022-02-07 22:03:45.840227 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 22:03:45.840619 (Thread-2): Finished running node model.project_otus_dbt.dim_week
2022-02-07 22:03:45.841046 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 22:03:45.842590 (Thread-2): 01:03:45 | 7 of 18 START incremental model public.hub_wheat_gbp................. [RUN]
2022-02-07 22:03:45.843557 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:03:45.843819 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:03:45.844103 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-07 22:03:45.846884 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:03:45.858678 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 22:03:45.866857 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 22:03:45.867697 (Thread-2): finished collecting timing info
2022-02-07 22:03:45.875510 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:03:45.885957 (Thread-1): finished collecting timing info
2022-02-07 22:03:45.898736 (Thread-1): On model.project_otus_dbt.dim_day: Close
2022-02-07 22:03:45.911621 (Thread-1): 01:03:45 | 5 of 18 OK created table model public.dim_day........................ [SELECT 5114 in 0.24s]
2022-02-07 22:03:45.920548 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:03:45.920927 (Thread-1): Finished running node model.project_otus_dbt.dim_day
2022-02-07 22:03:45.921264 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp010345913731"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:03:45.921745 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 22:03:45.922865 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:03:45.925145 (Thread-1): 01:03:45 | 8 of 18 START incremental model public.sat_wheat_gbp_details......... [RUN]
2022-02-07 22:03:45.926576 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:03:45.927074 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 22:03:45.956074 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 22:03:45.956332 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 22:03:45.962435 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:03:45.962799 (Thread-1): finished collecting timing info
2022-02-07 22:03:45.963236 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-07 22:03:45.973693 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:03:45.974155 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp010345972097"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:03:45.974324 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:03:45.975916 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:03:45.976291 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:03:45.976423 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp010345913731'
        
      order by ordinal_position

  
2022-02-07 22:03:45.986831 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:03:45.995530 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:03:45.995795 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.000513 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 22:03:46.005405 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:03:46.005659 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:03:46.005859 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-07 22:03:46.015815 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:03:46.016395 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.018075 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:03:46.018637 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:03:46.019092 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp010345972097'
        
      order by ordinal_position

  
2022-02-07 22:03:46.022128 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:03:46.023839 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 22:03:46.024527 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:03:46.024777 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp010345913731"
    );
  
2022-02-07 22:03:46.026441 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:03:46.028053 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 22:03:46.028295 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:03:46.028438 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 22:03:46.028878 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:03:46.035291 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:03:46.035588 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:03:46.036048 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.038519 (Thread-2): finished collecting timing info
2022-02-07 22:03:46.039223 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-07 22:03:46.042129 (Thread-2): 01:03:46 | 7 of 18 OK created incremental model public.hub_wheat_gbp............ [INSERT 0 0 in 0.20s]
2022-02-07 22:03:46.042543 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 22:03:46.042909 (Thread-2): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 22:03:46.046020 (Thread-2): 01:03:46 | 9 of 18 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-07 22:03:46.046334 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:03:46.046848 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:03:46.053753 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:03:46.054072 (Thread-2): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 22:03:46.054318 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.071067 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 22:03:46.071731 (Thread-2): finished collecting timing info
2022-02-07 22:03:46.072146 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:03:46.080724 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:03:46.082783 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 22:03:46.083435 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp010346078832"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:03:46.084541 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:03:46.085486 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:03:46.086128 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp010345972097"
    );
  
2022-02-07 22:03:46.088360 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:03:46.090422 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 22:03:46.090710 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:03:46.090925 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 22:03:46.093341 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:03:46.095900 (Thread-1): finished collecting timing info
2022-02-07 22:03:46.096311 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-07 22:03:46.098684 (Thread-1): 01:03:46 | 8 of 18 OK created incremental model public.sat_wheat_gbp_details.... [INSERT 0 0 in 0.17s]
2022-02-07 22:03:46.099381 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 22:03:46.100160 (Thread-1): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 22:03:46.103874 (Thread-1): 01:03:46 | 10 of 18 START incremental model public.sat_rate_gbp_usd_details..... [RUN]
2022-02-07 22:03:46.104892 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:03:46.105311 (Thread-1): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 22:03:46.113334 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 22:03:46.122855 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:03:46.128295 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-07 22:03:46.138205 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 22:03:46.138445 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:03:46.139081 (Thread-1): finished collecting timing info
2022-02-07 22:03:46.139554 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:03:46.148959 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:03:46.149370 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp010346078832'
        
      order by ordinal_position

  
2022-02-07 22:03:46.149788 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp010346147105"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:03:46.150334 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:03:46.162677 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:03:46.170419 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:03:46.170676 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.175849 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 22:03:46.180665 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:03:46.180908 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-07 22:03:46.181105 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.188283 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:03:46.188767 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-07 22:03:46.189986 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:03:46.190420 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:03:46.190621 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp010346147105'
        
      order by ordinal_position

  
2022-02-07 22:03:46.193152 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 22:03:46.194634 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 22:03:46.195495 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:03:46.195819 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp010346078832"
    );
  
2022-02-07 22:03:46.197509 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:03:46.200122 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 22:03:46.200604 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:03:46.201033 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:03:46.201399 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 22:03:46.210353 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:03:46.210842 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.213243 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:03:46.216839 (Thread-2): finished collecting timing info
2022-02-07 22:03:46.217521 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-07 22:03:46.217858 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:03:46.226053 (Thread-2): 01:03:46 | 9 of 18 OK created incremental model public.hub_rate_gbp_usd......... [INSERT 0 0 in 0.18s]
2022-02-07 22:03:46.228571 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:03:46.229060 (Thread-2): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 22:03:46.229369 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.229912 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 22:03:46.234421 (Thread-2): 01:03:46 | 11 of 18 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-07 22:03:46.235526 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:03:46.236302 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-07 22:03:46.245171 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:03:46.255442 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 22:03:46.264132 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 22:03:46.264920 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:03:46.265452 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp010346147105"
    );
  
2022-02-07 22:03:46.266160 (Thread-2): finished collecting timing info
2022-02-07 22:03:46.273013 (Thread-1): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-07 22:03:46.281374 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 22:03:46.281941 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:03:46.289518 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 22:03:46.296637 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:03:46.297030 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:03:46.297329 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp010346293614"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:03:46.301484 (Thread-1): finished collecting timing info
2022-02-07 22:03:46.302331 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:03:46.302954 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-07 22:03:46.307337 (Thread-1): 01:03:46 | 10 of 18 OK created incremental model public.sat_rate_gbp_usd_details [INSERT 0 0 in 0.20s]
2022-02-07 22:03:46.307936 (Thread-1): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 22:03:46.310443 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 22:03:46.313306 (Thread-1): 01:03:46 | 12 of 18 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-07 22:03:46.314345 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:03:46.314824 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 22:03:46.351818 (Thread-2): SQL status: SELECT 0 in 0.05 seconds
2022-02-07 22:03:46.373005 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:03:46.374715 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 22:03:46.375055 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-07 22:03:46.376156 (Thread-1): finished collecting timing info
2022-02-07 22:03:46.386170 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:03:46.392036 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:03:46.392622 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp010346293614'
        
      order by ordinal_position

  
2022-02-07 22:03:46.412247 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:03:46.412611 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp010346407782"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:03:46.413122 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:03:46.422345 (Thread-2): SQL status: SELECT 4 in 0.03 seconds
2022-02-07 22:03:46.441216 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:03:46.441680 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.447967 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:03:46.536814 (Thread-1): SQL status: SELECT 0 in 0.12 seconds
2022-02-07 22:03:46.538675 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:03:46.543758 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:03:46.544319 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.544666 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-07 22:03:46.546192 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:03:46.546478 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:03:46.546635 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp010346407782'
        
      order by ordinal_position

  
2022-02-07 22:03:46.550635 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:03:46.552612 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 22:03:46.553267 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:03:46.553484 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp010346293614"
    );
  
2022-02-07 22:03:46.555005 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:03:46.556692 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 22:03:46.556957 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:03:46.557113 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 22:03:46.559932 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:03:46.562606 (Thread-2): finished collecting timing info
2022-02-07 22:03:46.563012 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-07 22:03:46.566521 (Thread-2): 01:03:46 | 11 of 18 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.33s]
2022-02-07 22:03:46.567049 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 22:03:46.568683 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 22:03:46.572898 (Thread-2): 01:03:46 | 13 of 18 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-07 22:03:46.574596 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:03:46.575206 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-07 22:03:46.586217 (Thread-1): SQL status: SELECT 11 in 0.04 seconds
2022-02-07 22:03:46.603218 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:03:46.606147 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 22:03:46.606512 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.607617 (Thread-2): finished collecting timing info
2022-02-07 22:03:46.620797 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:03:46.624167 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:03:46.631630 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:03:46.632030 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp010346621733"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:03:46.632481 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.632892 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:03:46.639320 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:03:46.640967 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 22:03:46.641705 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:03:46.642024 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp010346407782"
    );
  
2022-02-07 22:03:46.643864 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:03:46.645461 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 22:03:46.645746 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:03:46.645908 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 22:03:46.648664 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:03:46.652265 (Thread-1): finished collecting timing info
2022-02-07 22:03:46.652656 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-07 22:03:46.654767 (Thread-1): 01:03:46 | 12 of 18 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.34s]
2022-02-07 22:03:46.655186 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 22:03:46.655798 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 22:03:46.662664 (Thread-1): 01:03:46 | 14 of 18 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-07 22:03:46.663829 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:03:46.664307 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 22:03:46.684335 (Thread-2): SQL status: SELECT 0 in 0.05 seconds
2022-02-07 22:03:46.694829 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:03:46.702456 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 22:03:46.702917 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-07 22:03:46.703750 (Thread-1): finished collecting timing info
2022-02-07 22:03:46.709894 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:03:46.717116 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:03:46.717498 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:03:46.717858 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp010346713814"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:03:46.718188 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp010346621733'
        
      order by ordinal_position

  
2022-02-07 22:03:46.718481 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:03:46.735367 (Thread-2): SQL status: SELECT 4 in 0.02 seconds
2022-02-07 22:03:46.740904 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:03:46.741131 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.751211 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:03:46.759122 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:03:46.759368 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.764265 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-07 22:03:46.766778 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 22:03:46.767742 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:03:46.768188 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp010346621733"
    );
  
2022-02-07 22:03:46.771162 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:03:46.772914 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 22:03:46.773129 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:03:46.773212 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 22:03:46.777266 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:03:46.780242 (Thread-2): finished collecting timing info
2022-02-07 22:03:46.780811 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-07 22:03:46.786179 (Thread-2): 01:03:46 | 13 of 18 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.21s]
2022-02-07 22:03:46.786570 (Thread-1): SQL status: SELECT 0 in 0.07 seconds
2022-02-07 22:03:46.787019 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 22:03:46.795040 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:03:46.795445 (Thread-2): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 22:03:46.796133 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-07 22:03:46.798953 (Thread-2): 01:03:46 | 15 of 18 START table model public.dds_rate_gbp_usd................... [RUN]
2022-02-07 22:03:46.800982 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:03:46.801393 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:03:46.801949 (Thread-2): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 22:03:46.802620 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:03:46.815414 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-07 22:03:46.815864 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp010346713814'
        
      order by ordinal_position

  
2022-02-07 22:03:46.817143 (Thread-2): finished collecting timing info
2022-02-07 22:03:46.832329 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:03:46.833190 (Thread-1): SQL status: SELECT 12 in 0.02 seconds
2022-02-07 22:03:46.833586 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 22:03:46.839819 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:03:46.840108 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:03:46.840392 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.845853 (Thread-1): SQL status: SELECT 12 in 0.00 seconds
2022-02-07 22:03:46.853347 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:03:46.853634 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:03:46.856929 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 22:03:46.860888 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:03:46.861119 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 22:03:46.861325 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:03:46.863103 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 22:03:46.863936 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:03:46.864140 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp010346713814"
    );
  
2022-02-07 22:03:46.864916 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:03:46.868131 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-07 22:03:46.868524 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:03:46.870565 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 22:03:46.870805 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:03:46.870945 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 22:03:46.871148 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:03:46.871440 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-07 22:03:46.872550 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:03:46.872857 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:03:46.873036 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */


  create  table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp"
  as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );
2022-02-07 22:03:46.873705 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:03:46.876304 (Thread-1): finished collecting timing info
2022-02-07 22:03:46.876766 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-07 22:03:46.878876 (Thread-1): 01:03:46 | 14 of 18 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.21s]
2022-02-07 22:03:46.879218 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 22:03:46.879559 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_usa
2022-02-07 22:03:46.883166 (Thread-1): 01:03:46 | 16 of 18 START table model public.dds_wheat_usa...................... [RUN]
2022-02-07 22:03:46.884515 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:03:46.885009 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_usa
2022-02-07 22:03:46.885285 (Thread-2): SQL status: SELECT 548 in 0.01 seconds
2022-02-07 22:03:46.904866 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-07 22:03:46.905745 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:03:46.906176 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd" rename to "dds_rate_gbp_usd__dbt_backup"
2022-02-07 22:03:46.906544 (Thread-1): finished collecting timing info
2022-02-07 22:03:46.913235 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 22:03:46.922075 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:03:46.922379 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:03:46.922577 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-07 22:03:46.922837 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_tmp" cascade
2022-02-07 22:03:46.923232 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:03:46.924545 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:46.926426 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-07 22:03:46.926702 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:03:46.926839 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-07 22:03:46.929252 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:03:46.932910 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:03:46.933265 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:03:46.936213 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:03:46.940573 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:03:46.940826 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:03:46.941053 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-07 22:03:46.943962 (Thread-2): finished collecting timing info
2022-02-07 22:03:46.944525 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-07 22:03:46.946751 (Thread-2): 01:03:46 | 15 of 18 OK created table model public.dds_rate_gbp_usd.............. [SELECT 548 in 0.14s]
2022-02-07 22:03:46.946992 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:03:46.947392 (Thread-2): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 22:03:46.949576 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-07 22:03:46.950031 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 22:03:46.952022 (Thread-2): 01:03:46 | 17 of 18 START table model public.dds_wheat_msk...................... [RUN]
2022-02-07 22:03:46.952896 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:03:46.953275 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:03:46.953581 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-07 22:03:46.953912 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: BEGIN
2022-02-07 22:03:46.964606 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 22:03:46.965453 (Thread-2): finished collecting timing info
2022-02-07 22:03:46.971514 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:03:46.975752 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:03:46.976004 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:03:46.976228 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-07 22:03:46.976456 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */


  create  table "postgres"."public"."dds_wheat_usa__dbt_tmp"
  as (
    with usa as (
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,cast(su.price as decimal(18,2))/100.0/2.7 as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_usa" as hu
    left join "postgres"."public"."sat_wheat_usa_details" as su
    on hu.date_pk=su.date_pk
)
select * from usa
  );
2022-02-07 22:03:46.976656 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:03:46.989309 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:03:46.992771 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:03:46.993073 (Thread-1): SQL status: SELECT 547 in 0.02 seconds
2022-02-07 22:03:46.993399 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 22:03:46.997919 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:03:46.998426 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa" rename to "dds_wheat_usa__dbt_backup"
2022-02-07 22:03:46.999839 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:03:47.000149 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:47.001853 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 22:03:47.005238 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:03:47.005758 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa__dbt_tmp" rename to "dds_wheat_usa"
2022-02-07 22:03:47.006211 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:03:47.006437 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-07 22:03:47.007457 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:47.007808 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:03:47.009016 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-07 22:03:47.009281 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:03:47.009520 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:03:47.009723 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */


  create  table "postgres"."public"."dds_wheat_msk__dbt_tmp"
  as (
    with dds_wheat_msk as(
    select su.tradedate  as tradedate
        ,cast(su.value as decimal(18,2)) as value
        ,cast(su.open as decimal(18,2)) as open
        ,cast(su.close as decimal(18,2)) as close
        ,cast(su.high as decimal(18,2)) as high
        ,cast(su.low as decimal(18,2)) as low
        ,cast(su.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hu
    left join "postgres"."public"."sat_wheat_msk_details" as su
    on hu.date_pk=su.date_pk
)
select * from dds_wheat_msk
  );
2022-02-07 22:03:47.009908 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-07 22:03:47.013352 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:03:47.016706 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:03:47.016982 (Thread-2): SQL status: SELECT 216 in 0.01 seconds
2022-02-07 22:03:47.017181 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-07 22:03:47.022685 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:03:47.023060 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-07 22:03:47.024512 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:47.028064 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:03:47.028334 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:03:47.028501 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-07 22:03:47.031626 (Thread-1): finished collecting timing info
2022-02-07 22:03:47.032194 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: Close
2022-02-07 22:03:47.034113 (Thread-1): 01:03:47 | 16 of 18 OK created table model public.dds_wheat_usa................. [SELECT 547 in 0.15s]
2022-02-07 22:03:47.034382 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:47.034791 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_usa
2022-02-07 22:03:47.036666 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 22:03:47.037132 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_gbp
2022-02-07 22:03:47.037633 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:03:47.038889 (Thread-1): 01:03:47 | 18 of 18 START table model public.dds_wheat_gbp...................... [RUN]
2022-02-07 22:03:47.039256 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 22:03:47.039904 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:03:47.040460 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_gbp
2022-02-07 22:03:47.053094 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:03:47.054558 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-07 22:03:47.057127 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:03:47.057595 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 22:03:47.057975 (Thread-1): finished collecting timing info
2022-02-07 22:03:47.066297 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:03:47.067508 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:03:47.070685 (Thread-2): finished collecting timing info
2022-02-07 22:03:47.071142 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_tmp" cascade
2022-02-07 22:03:47.071389 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-07 22:03:47.071640 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:03:47.073568 (Thread-2): 01:03:47 | 17 of 18 OK created table model public.dds_wheat_msk................. [SELECT 216 in 0.12s]
2022-02-07 22:03:47.074181 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 22:03:47.084712 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:03:47.087648 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:03:47.087846 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-07 22:03:47.089048 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:03:47.090695 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-07 22:03:47.091138 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:03:47.091272 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: BEGIN
2022-02-07 22:03:47.092833 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:03:47.093071 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:03:47.093155 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */


  create  table "postgres"."public"."dds_wheat_gbp__dbt_tmp"
  as (
    with gbp as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,cast(su.price as decimal(18,2))/100.0*rt.rate as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_gbp" as hu
    left join "postgres"."public"."sat_wheat_gbp_details" as su
    on hu.date_pk=su.date_pk
    left join "postgres"."public"."dds_rate_gbp_usd" as rt
    on hu.date_pk=rt.date_pk
)
select * from gbp
  );
2022-02-07 22:03:47.103626 (Thread-1): SQL status: SELECT 531 in 0.01 seconds
2022-02-07 22:03:47.108172 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:03:47.108699 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp" rename to "dds_wheat_gbp__dbt_backup"
2022-02-07 22:03:47.110664 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:47.113770 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:03:47.113973 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp__dbt_tmp" rename to "dds_wheat_gbp"
2022-02-07 22:03:47.115328 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:03:47.116525 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-07 22:03:47.116684 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:03:47.116786 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-07 22:03:47.121274 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:03:47.123994 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:03:47.124228 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-07 22:03:47.129097 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:03:47.131874 (Thread-1): finished collecting timing info
2022-02-07 22:03:47.132189 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: Close
2022-02-07 22:03:47.133845 (Thread-1): 01:03:47 | 18 of 18 OK created table model public.dds_wheat_gbp................. [SELECT 531 in 0.09s]
2022-02-07 22:03:47.134126 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_gbp
2022-02-07 22:03:47.136881 (MainThread): Acquiring new postgres connection "master".
2022-02-07 22:03:47.137180 (MainThread): Using postgres connection "master".
2022-02-07 22:03:47.137312 (MainThread): On master: BEGIN
2022-02-07 22:03:47.137450 (MainThread): Opening a new connection, currently in state closed
2022-02-07 22:03:47.147871 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:03:47.148123 (MainThread): On master: COMMIT
2022-02-07 22:03:47.148244 (MainThread): Using postgres connection "master".
2022-02-07 22:03:47.148359 (MainThread): On master: COMMIT
2022-02-07 22:03:47.149412 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:03:47.149683 (MainThread): On master: Close
2022-02-07 22:03:47.150245 (MainThread): 01:03:47 | 
2022-02-07 22:03:47.150520 (MainThread): 01:03:47 | Finished running 4 view models, 6 table models, 8 incremental models in 2.79s.
2022-02-07 22:03:47.150699 (MainThread): Connection 'master' was properly closed.
2022-02-07 22:03:47.150845 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_gbp' was properly closed.
2022-02-07 22:03:47.150916 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_msk' was properly closed.
2022-02-07 22:03:47.281668 (MainThread): 
2022-02-07 22:03:47.281954 (MainThread): Completed successfully
2022-02-07 22:03:47.282197 (MainThread): 
Done. PASS=18 WARN=0 ERROR=0 SKIP=0 TOTAL=18
2022-02-07 22:03:47.282545 (MainThread): Flushing usage events
2022-02-07 22:20:36.825006 (MainThread): Running with dbt=0.19.0
2022-02-07 22:20:37.041310 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-07 22:20:37.043415 (MainThread): Tracking: do not track
2022-02-07 22:20:37.176916 (MainThread): Partial parsing not enabled
2022-02-07 22:20:37.180147 (MainThread): Parsing macros/adapters.sql
2022-02-07 22:20:37.210351 (MainThread): Parsing macros/catalog.sql
2022-02-07 22:20:37.214995 (MainThread): Parsing macros/relations.sql
2022-02-07 22:20:37.218393 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-07 22:20:37.224503 (MainThread): Parsing macros/core.sql
2022-02-07 22:20:37.233189 (MainThread): Parsing macros/adapters/common.sql
2022-02-07 22:20:37.297183 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-07 22:20:37.300144 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-07 22:20:37.302565 (MainThread): Parsing macros/etc/datetime.sql
2022-02-07 22:20:37.316292 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-07 22:20:37.319698 (MainThread): Parsing macros/etc/query.sql
2022-02-07 22:20:37.322135 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-07 22:20:37.324514 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-07 22:20:37.342613 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-07 22:20:37.368826 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-07 22:20:37.371846 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-07 22:20:37.417687 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-07 22:20:37.447391 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-07 22:20:37.455734 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-07 22:20:37.458910 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-07 22:20:37.476731 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-07 22:20:37.484037 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-07 22:20:37.491965 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-07 22:20:37.499810 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-07 22:20:37.503351 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-07 22:20:37.506020 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-07 22:20:37.509532 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-07 22:20:37.515969 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-07 22:20:37.518880 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-07 22:20:37.522368 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-07 22:20:37.524674 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-07 22:20:37.538480 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-07 22:20:37.541910 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-07 22:20:37.546244 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-07 22:20:37.551236 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-07 22:20:37.552924 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-07 22:20:37.556801 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-07 22:20:37.563080 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-07 22:20:37.566942 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-07 22:20:37.572857 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-07 22:20:37.579036 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-07 22:20:37.600652 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-07 22:20:37.606532 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-07 22:20:37.612824 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-07 22:20:37.615867 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-07 22:20:37.621298 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-07 22:20:37.627340 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-07 22:20:37.633221 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-07 22:20:37.641074 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-07 22:20:37.644175 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-07 22:20:37.648022 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-07 22:20:37.651854 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-07 22:20:37.656140 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-07 22:20:37.658756 (MainThread): Parsing macros/sql/star.sql
2022-02-07 22:20:37.664949 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-07 22:20:37.667339 (MainThread): Parsing macros/sql/pivot.sql
2022-02-07 22:20:37.672743 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-07 22:20:37.675386 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-07 22:20:37.686045 (MainThread): Parsing macros/sql/union.sql
2022-02-07 22:20:37.699806 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-07 22:20:37.702803 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-07 22:20:37.709090 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-07 22:20:37.713913 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-07 22:20:37.719332 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-07 22:20:37.727211 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-07 22:20:37.732474 (MainThread): Parsing macros/sql/groupby.sql
2022-02-07 22:20:37.734501 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-07 22:20:37.736733 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-07 22:20:37.739613 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-07 22:20:37.743575 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-07 22:20:37.745095 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-07 22:20:37.746944 (MainThread): Parsing macros/logger/log_info.sql
2022-02-07 22:20:37.750145 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-07 22:20:37.787243 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-07 22:20:37.789700 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-07 22:20:37.793977 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-07 22:20:37.797506 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-07 22:20:37.800815 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-07 22:20:37.811946 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-07 22:20:37.818281 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-07 22:20:37.822923 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-07 22:20:37.825290 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-07 22:20:37.827548 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-07 22:20:37.830282 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-07 22:20:37.833548 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-07 22:20:37.835808 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-07 22:20:37.845696 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-07 22:20:37.848973 (MainThread): Parsing macros/internal/alias.sql
2022-02-07 22:20:37.854847 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-07 22:20:37.856327 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-07 22:20:37.859628 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-07 22:20:37.863557 (MainThread): Parsing macros/internal/multikey.sql
2022-02-07 22:20:37.869981 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-07 22:20:37.880856 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-07 22:20:37.884456 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-07 22:20:37.885675 (MainThread): Parsing macros/tables/hub.sql
2022-02-07 22:20:37.911154 (MainThread): Parsing macros/tables/link.sql
2022-02-07 22:20:37.932397 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-07 22:20:37.950715 (MainThread): Parsing macros/tables/sat.sql
2022-02-07 22:20:37.959732 (MainThread): Parsing macros/tables/t_link.sql
2022-02-07 22:20:37.964143 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-07 22:20:37.991601 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-07 22:20:37.998851 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-07 22:20:38.018345 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-07 22:20:38.020161 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-07 22:20:38.042775 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-07 22:20:38.049362 (MainThread): Parsing macros/supporting/hash.sql
2022-02-07 22:20:38.057589 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-07 22:20:38.061442 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-07 22:20:38.074914 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-07 22:20:38.081782 (MainThread): Parsing macros/staging/stage.sql
2022-02-07 22:20:38.100050 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-07 22:20:38.113198 (MainThread): Partial parsing not enabled
2022-02-07 22:20:38.280226 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:20:38.437405 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:20:38.471193 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:20:38.500571 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:20:38.528261 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:20:38.584046 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:20:38.613276 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:20:38.637317 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:20:38.659048 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:20:38.971132 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:20:39.031704 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:20:39.092901 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:20:39.125683 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:20:39.146049 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:20:39.161972 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:20:39.181742 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:20:39.200260 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:20:39.216836 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:20:40.234161 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.report
- models.project_otus_dbt.raw_vault.links

2022-02-07 22:20:40.422509 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-07 22:20:40.424060 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-07 22:20:40.427486 (MainThread): 
2022-02-07 22:20:40.428541 (MainThread): Acquiring new postgres connection "master".
2022-02-07 22:20:40.465282 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-07 22:20:40.486281 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-07 22:20:40.486603 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-07 22:20:40.486871 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-07 22:20:40.623190 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.14 seconds
2022-02-07 22:20:40.629274 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-07 22:20:40.751454 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-07 22:20:40.771776 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 22:20:40.772240 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-07 22:20:40.772651 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-07 22:20:41.109682 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.34 seconds
2022-02-07 22:20:41.110248 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-07 22:20:41.110554 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-07 22:20:41.302608 (ThreadPoolExecutor-1_0): SQL status: SELECT 25 in 0.19 seconds
2022-02-07 22:20:41.368335 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-07 22:20:41.370975 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-07 22:20:41.489621 (MainThread): Using postgres connection "master".
2022-02-07 22:20:41.489988 (MainThread): On master: BEGIN
2022-02-07 22:20:41.490212 (MainThread): Opening a new connection, currently in state init
2022-02-07 22:20:41.549284 (MainThread): SQL status: BEGIN in 0.06 seconds
2022-02-07 22:20:41.549939 (MainThread): Using postgres connection "master".
2022-02-07 22:20:41.550197 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-07 22:20:42.583781 (MainThread): SQL status: SELECT 10 in 1.03 seconds
2022-02-07 22:20:42.614603 (MainThread): On master: ROLLBACK
2022-02-07 22:20:42.616709 (MainThread): Using postgres connection "master".
2022-02-07 22:20:42.617022 (MainThread): On master: BEGIN
2022-02-07 22:20:42.619882 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:20:42.620351 (MainThread): On master: COMMIT
2022-02-07 22:20:42.620649 (MainThread): Using postgres connection "master".
2022-02-07 22:20:42.620793 (MainThread): On master: COMMIT
2022-02-07 22:20:42.622859 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:20:42.623195 (MainThread): On master: Close
2022-02-07 22:20:42.624161 (MainThread): 01:20:42 | Concurrency: 2 threads (target='dev')
2022-02-07 22:20:42.624758 (MainThread): 01:20:42 | 
2022-02-07 22:20:42.634322 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 22:20:42.634889 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 22:20:42.639377 (Thread-1): 01:20:42 | 1 of 18 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-07 22:20:42.642679 (Thread-2): 01:20:42 | 2 of 18 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-07 22:20:42.643877 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:20:42.644985 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:20:42.645448 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 22:20:42.645794 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 22:20:42.742762 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:20:42.744248 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:20:42.744738 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-07 22:20:42.745296 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-07 22:20:42.745912 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:20:42.746547 (Thread-2): Opening a new connection, currently in state init
2022-02-07 22:20:42.781557 (Thread-1): SQL status: BEGIN in 0.04 seconds
2022-02-07 22:20:42.782129 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:20:42.782564 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:42.840454 (Thread-2): SQL status: BEGIN in 0.09 seconds
2022-02-07 22:20:42.841127 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:20:42.841745 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:43.007826 (Thread-1): SQL status: SELECT 6 in 0.22 seconds
2022-02-07 22:20:43.117926 (Thread-2): SQL status: SELECT 7 in 0.28 seconds
2022-02-07 22:20:43.130783 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:20:43.136838 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:43.144726 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:20:43.145139 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:43.163280 (Thread-1): SQL status: SELECT 6 in 0.02 seconds
2022-02-07 22:20:43.182044 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 22:20:43.185545 (Thread-1): finished collecting timing info
2022-02-07 22:20:43.194301 (Thread-2): SQL status: SELECT 7 in 0.05 seconds
2022-02-07 22:20:43.241993 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 22:20:43.276223 (Thread-2): finished collecting timing info
2022-02-07 22:20:43.303346 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:20:43.311195 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 22:20:43.320920 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:20:43.321321 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-07 22:20:43.327016 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 22:20:43.333985 (Thread-1): SQL status: DROP VIEW in 0.02 seconds
2022-02-07 22:20:43.335478 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:20:43.342691 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:20:43.343311 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 22:20:43.343726 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:20:43.345992 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:20:43.354078 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 22:20:43.363660 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-07 22:20:43.368302 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-07 22:20:43.370100 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:20:43.372577 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:20:43.376052 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:20:43.376548 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:20:43.504622 (Thread-2): SQL status: CREATE VIEW in 0.13 seconds
2022-02-07 22:20:43.505109 (Thread-1): SQL status: CREATE VIEW in 0.13 seconds
2022-02-07 22:20:43.555102 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:20:43.555634 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:20:43.556056 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-07 22:20:43.556553 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-07 22:20:43.567801 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 22:20:43.585413 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:20:43.586064 (Thread-1): SQL status: ALTER TABLE in 0.03 seconds
2022-02-07 22:20:43.586684 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-07 22:20:43.607472 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 22:20:43.608372 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:20:43.619459 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-07 22:20:43.627299 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 22:20:43.627928 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:20:43.628294 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-07 22:20:43.629112 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:20:43.633457 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 22:20:43.633881 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:20:43.634196 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-07 22:20:43.643411 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:20:43.663937 (Thread-1): SQL status: COMMIT in 0.03 seconds
2022-02-07 22:20:43.666083 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-07 22:20:43.672008 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-07 22:20:43.672451 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-07 22:20:43.673009 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:20:43.692168 (Thread-2): SQL status: DROP VIEW in 0.02 seconds
2022-02-07 22:20:43.699753 (Thread-1): SQL status: DROP VIEW in 0.03 seconds
2022-02-07 22:20:43.699625 (Thread-2): finished collecting timing info
2022-02-07 22:20:43.705754 (Thread-1): finished collecting timing info
2022-02-07 22:20:43.706662 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-07 22:20:43.707258 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-07 22:20:43.711013 (Thread-2): 01:20:43 | 2 of 18 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 1.06s]
2022-02-07 22:20:43.720492 (Thread-1): 01:20:43 | 1 of 18 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 1.07s]
2022-02-07 22:20:43.721138 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-07 22:20:43.721786 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-07 22:20:43.722463 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 22:20:43.723645 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 22:20:43.728849 (Thread-2): 01:20:43 | 3 of 18 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-07 22:20:43.731629 (Thread-1): 01:20:43 | 4 of 18 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-07 22:20:43.732826 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:20:43.733762 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:20:43.734171 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 22:20:43.734583 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 22:20:43.824344 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:20:43.832559 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-07 22:20:43.838320 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:20:43.849677 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:20:43.850142 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-07 22:20:43.850426 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:20:43.863756 (Thread-2): SQL status: BEGIN in 0.03 seconds
2022-02-07 22:20:43.864380 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:20:43.864878 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:43.866427 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-07 22:20:43.866841 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:20:43.867120 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:43.896214 (Thread-1): SQL status: SELECT 7 in 0.03 seconds
2022-02-07 22:20:43.914128 (Thread-2): SQL status: SELECT 18 in 0.05 seconds
2022-02-07 22:20:43.914541 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:20:43.925750 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:43.936113 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:20:43.936650 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:43.945907 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-07 22:20:43.952023 (Thread-1): SQL status: SELECT 7 in 0.02 seconds
2022-02-07 22:20:43.956270 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 22:20:43.970158 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 22:20:43.972894 (Thread-1): finished collecting timing info
2022-02-07 22:20:43.974079 (Thread-2): finished collecting timing info
2022-02-07 22:20:43.992113 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:20:43.997847 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-07 22:20:44.000266 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:20:44.000731 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-07 22:20:44.002061 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:20:44.002344 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:20:44.007775 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:20:44.014209 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:20:44.014500 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 22:20:44.014829 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 22:20:44.016807 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:20:44.017127 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-07 22:20:44.018887 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-07 22:20:44.022345 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-07 22:20:44.025430 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:20:44.026048 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:20:44.026733 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:20:44.027129 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-07 22:20:44.036887 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-07 22:20:44.047580 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:20:44.047949 (Thread-2): SQL status: CREATE VIEW in 0.02 seconds
2022-02-07 22:20:44.048326 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-07 22:20:44.059162 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:20:44.060293 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-07 22:20:44.064391 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:20:44.070015 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 22:20:44.071498 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:20:44.078369 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:20:44.078803 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-07 22:20:44.079290 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-07 22:20:44.082015 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:20:44.084450 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 22:20:44.084895 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:20:44.085299 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-07 22:20:44.085680 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-07 22:20:44.088030 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 22:20:44.088802 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:20:44.089147 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-07 22:20:44.098501 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:20:44.098843 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:20:44.105848 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-07 22:20:44.110979 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-07 22:20:44.111420 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-07 22:20:44.111762 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-07 22:20:44.119642 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-07 22:20:44.127305 (Thread-2): finished collecting timing info
2022-02-07 22:20:44.127872 (Thread-1): SQL status: DROP VIEW in 0.02 seconds
2022-02-07 22:20:44.128304 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-07 22:20:44.132985 (Thread-1): finished collecting timing info
2022-02-07 22:20:44.133840 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-07 22:20:44.136837 (Thread-2): 01:20:44 | 3 of 18 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.40s]
2022-02-07 22:20:44.137361 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-07 22:20:44.143054 (Thread-2): Began running node model.project_otus_dbt.dim_day
2022-02-07 22:20:44.145496 (Thread-1): 01:20:44 | 4 of 18 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.41s]
2022-02-07 22:20:44.148528 (Thread-2): 01:20:44 | 5 of 18 START table model public.dim_day............................. [RUN]
2022-02-07 22:20:44.149355 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-07 22:20:44.150382 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:20:44.150919 (Thread-1): Began running node model.project_otus_dbt.dim_week
2022-02-07 22:20:44.151989 (Thread-2): Compiling model.project_otus_dbt.dim_day
2022-02-07 22:20:44.154407 (Thread-1): 01:20:44 | 6 of 18 START table model public.dim_week............................ [RUN]
2022-02-07 22:20:44.168038 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 22:20:44.168914 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:20:44.169999 (Thread-1): Compiling model.project_otus_dbt.dim_week
2022-02-07 22:20:44.192118 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 22:20:44.192561 (Thread-2): finished collecting timing info
2022-02-07 22:20:44.216314 (Thread-1): finished collecting timing info
2022-02-07 22:20:44.231590 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:20:44.237224 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-07 22:20:44.242878 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:20:44.243383 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:20:44.244004 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-07 22:20:44.244302 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:20:44.260801 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 22:20:44.261153 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 22:20:44.266110 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:20:44.272321 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:20:44.272673 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 22:20:44.273114 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 22:20:44.275082 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:20:44.275383 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:20:44.283061 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-07 22:20:44.285479 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-07 22:20:44.287035 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:20:44.287633 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:20:44.288096 (Thread-2): On model.project_otus_dbt.dim_day: BEGIN
2022-02-07 22:20:44.288839 (Thread-1): On model.project_otus_dbt.dim_week: BEGIN
2022-02-07 22:20:44.290956 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:20:44.291342 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:20:44.291688 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:20:44.292090 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:20:44.292423 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 day')
        as t(date)
        )

select * from dim_day
order by date desc
  );
2022-02-07 22:20:44.292708 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-07 22:20:44.380415 (Thread-1): SQL status: SELECT 731 in 0.09 seconds
2022-02-07 22:20:44.400701 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:20:44.401200 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-07 22:20:44.404600 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:20:44.413226 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:20:44.413667 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-07 22:20:44.415893 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:20:44.418668 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 22:20:44.419079 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:20:44.419554 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-07 22:20:44.429165 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:20:44.435722 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-07 22:20:44.436264 (Thread-2): SQL status: SELECT 5114 in 0.14 seconds
2022-02-07 22:20:44.436636 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-07 22:20:44.447441 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:20:44.448065 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-07 22:20:44.450282 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:20:44.457541 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:20:44.459219 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-07 22:20:44.461773 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:20:44.464060 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 22:20:44.464357 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:20:44.464540 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-07 22:20:44.467350 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:20:44.474218 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-07 22:20:44.474908 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-07 22:20:44.482047 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:20:44.482406 (Thread-1): SQL status: DROP TABLE in 0.03 seconds
2022-02-07 22:20:44.488556 (Thread-2): finished collecting timing info
2022-02-07 22:20:44.494694 (Thread-1): finished collecting timing info
2022-02-07 22:20:44.495437 (Thread-2): On model.project_otus_dbt.dim_day: Close
2022-02-07 22:20:44.495842 (Thread-1): On model.project_otus_dbt.dim_week: Close
2022-02-07 22:20:44.500230 (Thread-2): 01:20:44 | 5 of 18 OK created table model public.dim_day........................ [SELECT 5114 in 0.35s]
2022-02-07 22:20:44.504856 (Thread-1): 01:20:44 | 6 of 18 OK created table model public.dim_week....................... [SELECT 731 in 0.33s]
2022-02-07 22:20:44.505646 (Thread-2): Finished running node model.project_otus_dbt.dim_day
2022-02-07 22:20:44.506507 (Thread-1): Finished running node model.project_otus_dbt.dim_week
2022-02-07 22:20:44.507277 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 22:20:44.508391 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 22:20:44.511423 (Thread-2): 01:20:44 | 7 of 18 START incremental model public.hub_wheat_gbp................. [RUN]
2022-02-07 22:20:44.514281 (Thread-1): 01:20:44 | 8 of 18 START incremental model public.sat_wheat_gbp_details......... [RUN]
2022-02-07 22:20:44.515575 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:20:44.516621 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:20:44.517029 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-07 22:20:44.517453 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 22:20:44.581076 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 22:20:44.622137 (Thread-2): finished collecting timing info
2022-02-07 22:20:44.624562 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 22:20:44.657084 (Thread-1): finished collecting timing info
2022-02-07 22:20:44.812241 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:20:44.814217 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:20:44.815061 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp012044780595"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:20:44.815969 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp012044784934"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:20:44.816689 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:20:44.817242 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:20:44.908966 (Thread-2): SQL status: SELECT 0 in 0.09 seconds
2022-02-07 22:20:44.922412 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:20:44.922940 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-07 22:20:44.925614 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:20:44.926657 (Thread-1): SQL status: SELECT 0 in 0.11 seconds
2022-02-07 22:20:44.927253 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:20:44.933807 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp012044784934'
        
      order by ordinal_position

  
2022-02-07 22:20:44.947677 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:20:44.948185 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-07 22:20:44.951100 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:20:44.951681 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:20:44.952322 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp012044780595'
        
      order by ordinal_position

  
2022-02-07 22:20:44.976864 (Thread-2): SQL status: SELECT 4 in 0.04 seconds
2022-02-07 22:20:44.986595 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:20:44.987294 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:45.002450 (Thread-1): SQL status: SELECT 11 in 0.05 seconds
2022-02-07 22:20:45.017810 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:20:45.018560 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:45.034371 (Thread-2): SQL status: SELECT 4 in 0.05 seconds
2022-02-07 22:20:45.054508 (Thread-1): SQL status: SELECT 11 in 0.04 seconds
2022-02-07 22:20:45.080102 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:20:45.081525 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:20:45.082017 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:45.082628 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:45.089928 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:20:45.092570 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-07 22:20:45.093677 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:20:45.094065 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp012044784934"
    );
  
2022-02-07 22:20:45.099601 (Thread-1): SQL status: SELECT 11 in 0.02 seconds
2022-02-07 22:20:45.099975 (Thread-2): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-07 22:20:45.110382 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-07 22:20:45.117873 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 22:20:45.118735 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-07 22:20:45.119135 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-07 22:20:45.120260 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:20:45.120683 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp012044780595"
    );
  
2022-02-07 22:20:45.124752 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:20:45.127064 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 22:20:45.127633 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:20:45.128092 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-07 22:20:45.134789 (Thread-2): finished collecting timing info
2022-02-07 22:20:45.135666 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-07 22:20:45.138793 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-07 22:20:45.144187 (Thread-2): 01:20:45 | 7 of 18 OK created incremental model public.hub_wheat_gbp............ [INSERT 0 0 in 0.63s]
2022-02-07 22:20:45.144721 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-07 22:20:45.145147 (Thread-2): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 22:20:45.171111 (Thread-1): SQL status: COMMIT in 0.03 seconds
2022-02-07 22:20:45.172636 (Thread-2): 01:20:45 | 9 of 18 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-07 22:20:45.178923 (Thread-1): finished collecting timing info
2022-02-07 22:20:45.180827 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:20:45.181577 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-07 22:20:45.182354 (Thread-2): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 22:20:45.199771 (Thread-1): 01:20:45 | 8 of 18 OK created incremental model public.sat_wheat_gbp_details.... [INSERT 0 0 in 0.67s]
2022-02-07 22:20:45.209802 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-07 22:20:45.225218 (Thread-1): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 22:20:45.233840 (Thread-1): 01:20:45 | 10 of 18 START incremental model public.sat_rate_gbp_usd_details..... [RUN]
2022-02-07 22:20:45.249628 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:20:45.256354 (Thread-1): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 22:20:45.259334 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 22:20:45.293148 (Thread-2): finished collecting timing info
2022-02-07 22:20:45.315452 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 22:20:45.322415 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:20:45.322984 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp012045318051"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:20:45.323481 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:20:45.324576 (Thread-1): finished collecting timing info
2022-02-07 22:20:45.353306 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:20:45.353760 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp012045342524"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:20:45.354037 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:20:45.391042 (Thread-2): SQL status: SELECT 0 in 0.07 seconds
2022-02-07 22:20:45.409229 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:20:45.409821 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-07 22:20:45.411842 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:20:45.412257 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:20:45.412555 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp012045318051'
        
      order by ordinal_position

  
2022-02-07 22:20:45.431656 (Thread-1): SQL status: SELECT 0 in 0.08 seconds
2022-02-07 22:20:45.440809 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:20:45.441535 (Thread-2): SQL status: SELECT 4 in 0.03 seconds
2022-02-07 22:20:45.442071 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-07 22:20:45.454425 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:20:45.455476 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:45.457204 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:20:45.457690 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:20:45.458053 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp012045342524'
        
      order by ordinal_position

  
2022-02-07 22:20:45.464667 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:20:45.473897 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:20:45.474255 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:45.479809 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:20:45.481691 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-07 22:20:45.482948 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:20:45.483232 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp012045318051"
    );
  
2022-02-07 22:20:45.484995 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:20:45.487161 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 22:20:45.487518 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-07 22:20:45.487879 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-07 22:20:45.489630 (Thread-1): SQL status: SELECT 11 in 0.03 seconds
2022-02-07 22:20:45.497275 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:20:45.497602 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:20:45.497871 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:45.500861 (Thread-2): finished collecting timing info
2022-02-07 22:20:45.501718 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-07 22:20:45.506388 (Thread-2): 01:20:45 | 9 of 18 OK created incremental model public.hub_rate_gbp_usd......... [INSERT 0 0 in 0.32s]
2022-02-07 22:20:45.507304 (Thread-2): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-07 22:20:45.508177 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 22:20:45.511181 (Thread-2): 01:20:45 | 11 of 18 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-07 22:20:45.511464 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:20:45.512195 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:20:45.522487 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:20:45.523172 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-07 22:20:45.523802 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:45.548843 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:20:45.557978 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-07 22:20:45.568209 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 22:20:45.570720 (Thread-2): finished collecting timing info
2022-02-07 22:20:45.577048 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:20:45.577537 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp012045342524"
    );
  
2022-02-07 22:20:45.591624 (Thread-1): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-07 22:20:45.600158 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 22:20:45.605929 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-07 22:20:45.607629 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:20:45.608052 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-07 22:20:45.608584 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp012045602057"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:20:45.609519 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:20:45.614619 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:20:45.620319 (Thread-1): finished collecting timing info
2022-02-07 22:20:45.621153 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-07 22:20:45.634114 (Thread-1): 01:20:45 | 10 of 18 OK created incremental model public.sat_rate_gbp_usd_details [INSERT 0 0 in 0.37s]
2022-02-07 22:20:45.634748 (Thread-1): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-07 22:20:45.635413 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 22:20:45.640160 (Thread-1): 01:20:45 | 12 of 18 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-07 22:20:45.642272 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:20:45.642855 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 22:20:45.682861 (Thread-2): SQL status: SELECT 0 in 0.07 seconds
2022-02-07 22:20:45.710277 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:20:45.715833 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-07 22:20:45.725385 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 22:20:45.725747 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:20:45.726301 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:20:45.726598 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp012045602057'
        
      order by ordinal_position

  
2022-02-07 22:20:45.727149 (Thread-1): finished collecting timing info
2022-02-07 22:20:45.743281 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:20:45.743574 (Thread-2): SQL status: SELECT 4 in 0.02 seconds
2022-02-07 22:20:45.743816 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp012045740985"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:20:45.754017 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:20:45.754401 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:20:45.754834 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:45.761650 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:20:45.865298 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:20:45.865662 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:45.872257 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:20:45.875205 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-07 22:20:45.876686 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:20:45.877028 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp012045602057"
    );
  
2022-02-07 22:20:45.878950 (Thread-1): SQL status: SELECT 0 in 0.12 seconds
2022-02-07 22:20:45.879465 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:20:45.894225 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:20:45.896810 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 22:20:45.897437 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-07 22:20:45.897909 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-07 22:20:45.898976 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-07 22:20:45.900238 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:20:45.900603 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:20:45.900826 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp012045740985'
        
      order by ordinal_position

  
2022-02-07 22:20:45.904018 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:20:45.910448 (Thread-2): finished collecting timing info
2022-02-07 22:20:45.910973 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-07 22:20:45.914398 (Thread-2): 01:20:45 | 11 of 18 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.40s]
2022-02-07 22:20:45.914906 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-07 22:20:45.915428 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 22:20:45.921413 (Thread-2): 01:20:45 | 13 of 18 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-07 22:20:45.922730 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:20:45.923384 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-07 22:20:45.930781 (Thread-1): SQL status: SELECT 12 in 0.03 seconds
2022-02-07 22:20:45.949910 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:20:45.955718 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:45.958854 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 22:20:45.960519 (Thread-2): finished collecting timing info
2022-02-07 22:20:45.971248 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 22:20:45.979945 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:20:45.990304 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:20:45.990773 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp012045976983"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:20:45.991191 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:45.991600 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:20:45.999266 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-07 22:20:46.001412 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-07 22:20:46.002513 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:20:46.002900 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp012045740985"
    );
  
2022-02-07 22:20:46.005079 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:20:46.007614 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 22:20:46.007890 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-07 22:20:46.007987 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-07 22:20:46.011232 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:20:46.015058 (Thread-1): finished collecting timing info
2022-02-07 22:20:46.015616 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-07 22:20:46.018611 (Thread-1): 01:20:46 | 12 of 18 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.37s]
2022-02-07 22:20:46.019259 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-07 22:20:46.019829 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 22:20:46.023258 (Thread-1): 01:20:46 | 14 of 18 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-07 22:20:46.024864 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:20:46.025319 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 22:20:46.031605 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-07 22:20:46.050620 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:20:46.056219 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-07 22:20:46.068774 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:20:46.074430 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:20:46.076225 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 22:20:46.076516 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp012045976983'
        
      order by ordinal_position

  
2022-02-07 22:20:46.077738 (Thread-1): finished collecting timing info
2022-02-07 22:20:46.094616 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:20:46.095162 (Thread-2): SQL status: SELECT 4 in 0.02 seconds
2022-02-07 22:20:46.095476 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp012046091925"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-07 22:20:46.103481 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:20:46.103868 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:20:46.104263 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:46.111484 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:20:46.123951 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:20:46.124216 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:46.130535 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-07 22:20:46.132968 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-07 22:20:46.134135 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:20:46.134516 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp012045976983"
    );
  
2022-02-07 22:20:46.137082 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:20:46.142053 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 22:20:46.142636 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-07 22:20:46.143290 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-07 22:20:46.146685 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:20:46.151002 (Thread-2): finished collecting timing info
2022-02-07 22:20:46.151952 (Thread-1): SQL status: SELECT 0 in 0.05 seconds
2022-02-07 22:20:46.152502 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-07 22:20:46.161715 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:20:46.162454 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-07 22:20:46.166448 (Thread-2): 01:20:46 | 13 of 18 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.24s]
2022-02-07 22:20:46.167448 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-07 22:20:46.168087 (Thread-2): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 22:20:46.174144 (Thread-2): 01:20:46 | 15 of 18 START table model public.dds_rate_gbp_usd................... [RUN]
2022-02-07 22:20:46.174560 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:20:46.175513 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:20:46.176171 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:20:46.176999 (Thread-2): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 22:20:46.177664 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp012046091925'
        
      order by ordinal_position

  
2022-02-07 22:20:46.204804 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-07 22:20:46.205221 (Thread-1): SQL status: SELECT 11 in 0.02 seconds
2022-02-07 22:20:46.217349 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:20:46.218844 (Thread-2): finished collecting timing info
2022-02-07 22:20:46.220005 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:46.242440 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:20:46.242858 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-07 22:20:46.243174 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:20:46.243511 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:20:46.253219 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:20:46.254314 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-07 22:20:46.261441 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-07 22:20:46.264094 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-07 22:20:46.265124 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:20:46.265563 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp012046091925"
    );
  
2022-02-07 22:20:46.268319 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-07 22:20:46.272252 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 22:20:46.273128 (Thread-2): SQL status: DROP TABLE in 0.03 seconds
2022-02-07 22:20:46.273676 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-07 22:20:46.282115 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:20:46.282633 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-07 22:20:46.283063 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:20:46.285046 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:20:46.291162 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-07 22:20:46.291894 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:20:46.295194 (Thread-1): finished collecting timing info
2022-02-07 22:20:46.295794 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-07 22:20:46.299090 (Thread-1): 01:20:46 | 14 of 18 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.27s]
2022-02-07 22:20:46.299633 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:20:46.300257 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-07 22:20:46.300629 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-07 22:20:46.301479 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 22:20:46.305467 (Thread-1): 01:20:46 | 16 of 18 START table model public.dds_wheat_msk...................... [RUN]
2022-02-07 22:20:46.305873 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:20:46.306987 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:20:46.307528 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:20:46.307902 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-07 22:20:46.308153 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */


  create  table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp"
  as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );
2022-02-07 22:20:46.329566 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 22:20:46.330308 (Thread-1): finished collecting timing info
2022-02-07 22:20:46.347732 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:20:46.348023 (Thread-2): SQL status: SELECT 548 in 0.03 seconds
2022-02-07 22:20:46.348266 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-07 22:20:46.357973 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:20:46.358301 (Thread-1): Opening a new connection, currently in state closed
2022-02-07 22:20:46.358643 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd" rename to "dds_rate_gbp_usd__dbt_backup"
2022-02-07 22:20:46.361038 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:20:46.367570 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:20:46.368015 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-07 22:20:46.370937 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:20:46.373674 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-07 22:20:46.374059 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:20:46.374415 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-07 22:20:46.376675 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 22:20:46.381823 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:20:46.382119 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-07 22:20:46.382349 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 22:20:46.386994 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-07 22:20:46.387701 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-07 22:20:46.389092 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:20:46.391402 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-07 22:20:46.393620 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:20:46.394056 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-07 22:20:46.396164 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:20:46.396668 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:20:46.397124 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:20:46.404820 (Thread-2): finished collecting timing info
2022-02-07 22:20:46.405487 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */


  create  table "postgres"."public"."dds_wheat_msk__dbt_tmp"
  as (
    with dds_wheat_msk as(
    select su.tradedate  as tradedate
        ,case when su.value=0 and su.volume>0 then cast(su.volume*su.close as decimal(18,2))
            else cast(su.value as decimal(18,2))
            end as value_all
        ,cast(su.open as decimal(18,2)) as open
        ,cast(su.close as decimal(18,2)) as close
        ,cast(su.high as decimal(18,2)) as high
        ,cast(su.low as decimal(18,2)) as low
        ,cast(su.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hu
    left join "postgres"."public"."sat_wheat_msk_details" as su
    on hu.date_pk=su.date_pk
)
select * from dds_wheat_msk
  );
2022-02-07 22:20:46.406026 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-07 22:20:46.410609 (Thread-2): 01:20:46 | 15 of 18 OK created table model public.dds_rate_gbp_usd.............. [SELECT 548 in 0.23s]
2022-02-07 22:20:46.411217 (Thread-2): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-07 22:20:46.411845 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_usa
2022-02-07 22:20:46.415205 (Thread-2): 01:20:46 | 17 of 18 START table model public.dds_wheat_usa...................... [RUN]
2022-02-07 22:20:46.416673 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:20:46.417204 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_usa
2022-02-07 22:20:46.428123 (Thread-1): SQL status: SELECT 216 in 0.02 seconds
2022-02-07 22:20:46.442970 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-07 22:20:46.447262 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:20:46.447999 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-07 22:20:46.448631 (Thread-2): finished collecting timing info
2022-02-07 22:20:46.463842 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:20:46.464136 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_tmp" cascade
2022-02-07 22:20:46.464295 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:20:46.480754 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 22:20:46.487239 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:20:46.487635 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-07 22:20:46.489644 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:20:46.491593 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-07 22:20:46.492686 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:20:46.493195 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: BEGIN
2022-02-07 22:20:46.494964 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:20:46.495278 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:20:46.495470 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */


  create  table "postgres"."public"."dds_wheat_usa__dbt_tmp"
  as (
    with usa as (
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,cast(su.price as decimal(18,2))/100.0/2.7 as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_usa" as hu
    left join "postgres"."public"."sat_wheat_usa_details" as su
    on hu.date_pk=su.date_pk
)
select * from usa
  );
2022-02-07 22:20:46.515996 (Thread-2): SQL status: SELECT 547 in 0.02 seconds
2022-02-07 22:20:46.526204 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:20:46.526616 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa" rename to "dds_wheat_usa__dbt_backup"
2022-02-07 22:20:46.528893 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:20:46.534087 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:20:46.534592 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa__dbt_tmp" rename to "dds_wheat_usa"
2022-02-07 22:20:46.537066 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:20:46.539951 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-07 22:20:46.540381 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:20:46.540779 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-07 22:20:46.544516 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:20:46.550116 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-07 22:20:46.550551 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-07 22:20:46.560380 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:20:46.565655 (Thread-2): finished collecting timing info
2022-02-07 22:20:46.566269 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: Close
2022-02-07 22:20:46.572778 (Thread-2): 01:20:46 | 17 of 18 OK created table model public.dds_wheat_usa................. [SELECT 547 in 0.15s]
2022-02-07 22:20:46.573521 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_usa
2022-02-07 22:20:46.574709 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_gbp
2022-02-07 22:20:46.579934 (Thread-2): 01:20:46 | 18 of 18 START table model public.dds_wheat_gbp...................... [RUN]
2022-02-07 22:20:46.580974 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:20:46.581535 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_gbp
2022-02-07 22:20:46.615439 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-07 22:20:46.618018 (Thread-2): finished collecting timing info
2022-02-07 22:20:46.639866 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:20:46.640260 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_tmp" cascade
2022-02-07 22:20:46.640611 (Thread-2): Opening a new connection, currently in state closed
2022-02-07 22:20:46.658627 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-07 22:20:46.668916 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:20:46.669287 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-07 22:20:46.671020 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-07 22:20:46.674193 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-07 22:20:46.675442 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:20:46.675889 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: BEGIN
2022-02-07 22:20:46.677795 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-07 22:20:46.678629 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:20:46.679279 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */


  create  table "postgres"."public"."dds_wheat_gbp__dbt_tmp"
  as (
    with gbp as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,cast(su.price as decimal(18,2))/100.0*rt.rate as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_gbp" as hu
    left join "postgres"."public"."sat_wheat_gbp_details" as su
    on hu.date_pk=su.date_pk
    left join "postgres"."public"."dds_rate_gbp_usd" as rt
    on hu.date_pk=rt.date_pk
)
select * from gbp
  );
2022-02-07 22:20:46.706215 (Thread-2): SQL status: SELECT 531 in 0.03 seconds
2022-02-07 22:20:46.714262 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:20:46.714688 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp" rename to "dds_wheat_gbp__dbt_backup"
2022-02-07 22:20:46.718130 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:20:46.725054 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:20:46.725372 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp__dbt_tmp" rename to "dds_wheat_gbp"
2022-02-07 22:20:46.727514 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:20:46.730192 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-07 22:20:46.730474 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:20:46.730622 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-07 22:20:46.734192 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:20:46.739206 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-07 22:20:46.739611 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-07 22:20:46.746551 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:20:46.752824 (Thread-2): finished collecting timing info
2022-02-07 22:20:46.753727 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: Close
2022-02-07 22:20:46.757954 (Thread-2): 01:20:46 | 18 of 18 OK created table model public.dds_wheat_gbp................. [SELECT 531 in 0.17s]
2022-02-07 22:20:46.758467 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_gbp
2022-02-07 22:20:47.189352 (Thread-1): SQL status: ALTER TABLE in 0.74 seconds
2022-02-07 22:20:47.196455 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:20:47.196908 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-07 22:20:47.199586 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-07 22:20:47.202499 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 22:20:47.202866 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:20:47.203060 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-07 22:20:47.207944 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:20:47.221109 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-07 22:20:47.222592 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-07 22:20:47.228256 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-07 22:20:47.234296 (Thread-1): finished collecting timing info
2022-02-07 22:20:47.235046 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-07 22:20:47.238736 (Thread-1): 01:20:47 | 16 of 18 OK created table model public.dds_wheat_msk................. [SELECT 216 in 0.93s]
2022-02-07 22:20:47.239817 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-07 22:20:47.243417 (MainThread): Acquiring new postgres connection "master".
2022-02-07 22:20:47.243955 (MainThread): Using postgres connection "master".
2022-02-07 22:20:47.244371 (MainThread): On master: BEGIN
2022-02-07 22:20:47.244766 (MainThread): Opening a new connection, currently in state closed
2022-02-07 22:20:47.259777 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-07 22:20:47.260236 (MainThread): On master: COMMIT
2022-02-07 22:20:47.260484 (MainThread): Using postgres connection "master".
2022-02-07 22:20:47.260723 (MainThread): On master: COMMIT
2022-02-07 22:20:47.262152 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-07 22:20:47.262530 (MainThread): On master: Close
2022-02-07 22:20:47.263560 (MainThread): 01:20:47 | 
2022-02-07 22:20:47.264014 (MainThread): 01:20:47 | Finished running 4 view models, 6 table models, 8 incremental models in 6.84s.
2022-02-07 22:20:47.264360 (MainThread): Connection 'master' was properly closed.
2022-02-07 22:20:47.264571 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_msk' was properly closed.
2022-02-07 22:20:47.264865 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_gbp' was properly closed.
2022-02-07 22:20:47.632986 (MainThread): 
2022-02-07 22:20:47.633549 (MainThread): Completed successfully
2022-02-07 22:20:47.634037 (MainThread): 
Done. PASS=18 WARN=0 ERROR=0 SKIP=0 TOTAL=18
2022-02-07 22:20:47.634646 (MainThread): Flushing usage events
2022-02-08 08:39:22.082815 (MainThread): Running with dbt=0.19.0
2022-02-08 08:39:22.293641 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-08 08:39:22.296339 (MainThread): Tracking: do not track
2022-02-08 08:39:22.450557 (MainThread): Partial parsing not enabled
2022-02-08 08:39:22.452903 (MainThread): Parsing macros/adapters.sql
2022-02-08 08:39:22.485919 (MainThread): Parsing macros/catalog.sql
2022-02-08 08:39:22.489232 (MainThread): Parsing macros/relations.sql
2022-02-08 08:39:22.491591 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-08 08:39:22.499219 (MainThread): Parsing macros/core.sql
2022-02-08 08:39:22.506418 (MainThread): Parsing macros/adapters/common.sql
2022-02-08 08:39:22.574511 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-08 08:39:22.577512 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-08 08:39:22.580232 (MainThread): Parsing macros/etc/datetime.sql
2022-02-08 08:39:22.592022 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-08 08:39:22.595746 (MainThread): Parsing macros/etc/query.sql
2022-02-08 08:39:22.597982 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-08 08:39:22.600033 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-08 08:39:22.610986 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-08 08:39:22.641031 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-08 08:39:22.644151 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-08 08:39:22.686636 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-08 08:39:22.709311 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-08 08:39:22.720163 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-08 08:39:22.723289 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-08 08:39:22.739719 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-08 08:39:22.745588 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-08 08:39:22.754787 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-08 08:39:22.763068 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-08 08:39:22.765613 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-08 08:39:22.767340 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-08 08:39:22.769468 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-08 08:39:22.773386 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-08 08:39:22.775357 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-08 08:39:22.777373 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-08 08:39:22.778509 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-08 08:39:22.788470 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-08 08:39:22.790754 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-08 08:39:22.792459 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-08 08:39:22.794979 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-08 08:39:22.795962 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-08 08:39:22.798147 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-08 08:39:22.801616 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-08 08:39:22.803446 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-08 08:39:22.805441 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-08 08:39:22.807802 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-08 08:39:22.814888 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-08 08:39:22.818704 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-08 08:39:22.821392 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-08 08:39:22.822840 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-08 08:39:22.824750 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-08 08:39:22.826483 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-08 08:39:22.827974 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-08 08:39:22.833576 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-08 08:39:22.835113 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-08 08:39:22.836997 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-08 08:39:22.839507 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-08 08:39:22.843530 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-08 08:39:22.846555 (MainThread): Parsing macros/sql/star.sql
2022-02-08 08:39:22.852461 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-08 08:39:22.855467 (MainThread): Parsing macros/sql/pivot.sql
2022-02-08 08:39:22.862253 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-08 08:39:22.865149 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-08 08:39:22.877458 (MainThread): Parsing macros/sql/union.sql
2022-02-08 08:39:22.886716 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-08 08:39:22.888718 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-08 08:39:22.893251 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-08 08:39:22.897123 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-08 08:39:22.901372 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-08 08:39:22.908170 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-08 08:39:22.913179 (MainThread): Parsing macros/sql/groupby.sql
2022-02-08 08:39:22.914835 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-08 08:39:22.916664 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-08 08:39:22.919195 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-08 08:39:22.923109 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-08 08:39:22.924588 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-08 08:39:22.926267 (MainThread): Parsing macros/logger/log_info.sql
2022-02-08 08:39:22.928123 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-08 08:39:22.964224 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-08 08:39:22.966317 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-08 08:39:22.969120 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-08 08:39:22.971169 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-08 08:39:22.973366 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-08 08:39:22.980265 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-08 08:39:22.984439 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-08 08:39:22.987574 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-08 08:39:22.989523 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-08 08:39:22.991393 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-08 08:39:22.993761 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-08 08:39:22.997070 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-08 08:39:22.999050 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-08 08:39:23.006792 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-08 08:39:23.010278 (MainThread): Parsing macros/internal/alias.sql
2022-02-08 08:39:23.014467 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-08 08:39:23.015950 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-08 08:39:23.018750 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-08 08:39:23.022368 (MainThread): Parsing macros/internal/multikey.sql
2022-02-08 08:39:23.028396 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-08 08:39:23.039514 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-08 08:39:23.043110 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-08 08:39:23.043942 (MainThread): Parsing macros/tables/hub.sql
2022-02-08 08:39:23.055332 (MainThread): Parsing macros/tables/link.sql
2022-02-08 08:39:23.066626 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-08 08:39:23.082707 (MainThread): Parsing macros/tables/sat.sql
2022-02-08 08:39:23.094841 (MainThread): Parsing macros/tables/t_link.sql
2022-02-08 08:39:23.100837 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-08 08:39:23.125788 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-08 08:39:23.139544 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-08 08:39:23.169241 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-08 08:39:23.172096 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-08 08:39:23.202133 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-08 08:39:23.212033 (MainThread): Parsing macros/supporting/hash.sql
2022-02-08 08:39:23.224660 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-08 08:39:23.227842 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-08 08:39:23.236944 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-08 08:39:23.240344 (MainThread): Parsing macros/staging/stage.sql
2022-02-08 08:39:23.253408 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-08 08:39:23.267721 (MainThread): Partial parsing not enabled
2022-02-08 08:39:23.388481 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 08:39:23.543588 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 08:39:23.581835 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 08:39:23.608569 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 08:39:23.635245 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 08:39:23.683904 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 08:39:23.702477 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 08:39:23.718763 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 08:39:23.733931 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 08:39:23.850554 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 08:39:23.883342 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 08:39:23.911875 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 08:39:23.944665 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 08:39:23.960520 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 08:39:23.973984 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 08:39:23.989963 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 08:39:24.004086 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 08:39:24.016947 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 08:39:24.889436 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.raw_vault.links
- models.project_otus_dbt.report

2022-02-08 08:39:25.082394 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-08 08:39:25.083255 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-08 08:39:25.085811 (MainThread): 
2022-02-08 08:39:25.086558 (MainThread): Acquiring new postgres connection "master".
2022-02-08 08:39:25.121589 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-08 08:39:25.137250 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-08 08:39:25.137627 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-08 08:39:25.138322 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-08 08:39:25.205640 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.07 seconds
2022-02-08 08:39:25.210162 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-08 08:39:25.252368 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-08 08:39:25.260245 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 08:39:25.260470 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-08 08:39:25.260595 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-08 08:39:25.277267 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-02-08 08:39:25.277529 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 08:39:25.277689 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-08 08:39:25.297995 (ThreadPoolExecutor-1_0): SQL status: SELECT 25 in 0.02 seconds
2022-02-08 08:39:25.319470 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-08 08:39:25.320865 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-08 08:39:25.351188 (MainThread): Using postgres connection "master".
2022-02-08 08:39:25.351406 (MainThread): On master: BEGIN
2022-02-08 08:39:25.351490 (MainThread): Opening a new connection, currently in state init
2022-02-08 08:39:25.363049 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 08:39:25.363304 (MainThread): Using postgres connection "master".
2022-02-08 08:39:25.363422 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-08 08:39:25.717207 (MainThread): SQL status: SELECT 10 in 0.35 seconds
2022-02-08 08:39:25.729685 (MainThread): On master: ROLLBACK
2022-02-08 08:39:25.731470 (MainThread): Using postgres connection "master".
2022-02-08 08:39:25.731804 (MainThread): On master: BEGIN
2022-02-08 08:39:25.733802 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-08 08:39:25.734077 (MainThread): On master: COMMIT
2022-02-08 08:39:25.734228 (MainThread): Using postgres connection "master".
2022-02-08 08:39:25.734371 (MainThread): On master: COMMIT
2022-02-08 08:39:25.735454 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 08:39:25.735676 (MainThread): On master: Close
2022-02-08 08:39:25.736131 (MainThread): 11:39:25 | Concurrency: 2 threads (target='dev')
2022-02-08 08:39:25.736420 (MainThread): 11:39:25 | 
2022-02-08 08:39:25.740901 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 08:39:25.741237 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 08:39:25.743545 (Thread-1): 11:39:25 | 1 of 18 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-08 08:39:25.745243 (Thread-2): 11:39:25 | 2 of 18 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-08 08:39:25.746123 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 08:39:25.747309 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 08:39:25.747711 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 08:39:25.748220 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 08:39:25.809419 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 08:39:25.811709 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 08:39:25.811976 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-08 08:39:25.812217 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-08 08:39:25.812471 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 08:39:25.812698 (Thread-2): Opening a new connection, currently in state init
2022-02-08 08:39:25.824391 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 08:39:25.824866 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 08:39:25.825122 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:25.843957 (Thread-2): SQL status: BEGIN in 0.03 seconds
2022-02-08 08:39:25.844233 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 08:39:25.844419 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:25.877803 (Thread-1): SQL status: SELECT 6 in 0.05 seconds
2022-02-08 08:39:25.955542 (Thread-2): SQL status: SELECT 7 in 0.11 seconds
2022-02-08 08:39:25.960184 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 08:39:25.967636 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 08:39:25.967922 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:25.968363 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:25.974800 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-08 08:39:25.982072 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-08 08:39:25.981867 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 08:39:25.988577 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 08:39:25.990216 (Thread-2): finished collecting timing info
2022-02-08 08:39:25.996270 (Thread-1): finished collecting timing info
2022-02-08 08:39:26.061786 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 08:39:26.062440 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 08:39:26.062698 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-08 08:39:26.062989 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 08:39:26.069188 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 08:39:26.069476 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 08:39:26.074701 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 08:39:26.078940 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 08:39:26.079282 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 08:39:26.079550 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 08:39:26.081591 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 08:39:26.081849 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 08:39:26.087335 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 08:39:26.089166 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 08:39:26.090195 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 08:39:26.090580 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 08:39:26.090818 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 08:39:26.091094 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 08:39:26.132860 (Thread-1): SQL status: CREATE VIEW in 0.04 seconds
2022-02-08 08:39:26.133139 (Thread-2): SQL status: CREATE VIEW in 0.04 seconds
2022-02-08 08:39:26.142140 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 08:39:26.146941 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 08:39:26.147285 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-08 08:39:26.147499 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-08 08:39:26.154931 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 08:39:26.155209 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 08:39:26.158551 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 08:39:26.163163 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 08:39:26.163546 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-08 08:39:26.163766 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-08 08:39:26.166095 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 08:39:26.166388 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 08:39:26.173596 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 08:39:26.175575 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 08:39:26.175927 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 08:39:26.176227 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 08:39:26.176496 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 08:39:26.176696 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 08:39:26.185384 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 08:39:26.185654 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 08:39:26.190063 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 08:39:26.193318 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 08:39:26.193645 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 08:39:26.193866 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 08:39:26.201944 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 08:39:26.204735 (Thread-2): finished collecting timing info
2022-02-08 08:39:26.205035 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 08:39:26.205241 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-08 08:39:26.208189 (Thread-1): finished collecting timing info
2022-02-08 08:39:26.208753 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-08 08:39:26.210609 (Thread-2): 11:39:26 | 2 of 18 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.46s]
2022-02-08 08:39:26.213540 (Thread-1): 11:39:26 | 1 of 18 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.47s]
2022-02-08 08:39:26.214081 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 08:39:26.214605 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 08:39:26.215196 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 08:39:26.216108 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 08:39:26.220054 (Thread-2): 11:39:26 | 3 of 18 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-08 08:39:26.222082 (Thread-1): 11:39:26 | 4 of 18 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-08 08:39:26.222791 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 08:39:26.223538 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 08:39:26.223887 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 08:39:26.224203 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 08:39:26.255402 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 08:39:26.256869 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 08:39:26.257080 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-08 08:39:26.257332 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-08 08:39:26.257583 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 08:39:26.257754 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 08:39:26.270499 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 08:39:26.270773 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 08:39:26.270990 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:26.280043 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-08 08:39:26.288680 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 08:39:26.288912 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:26.293945 (Thread-2): SQL status: SELECT 18 in 0.00 seconds
2022-02-08 08:39:26.301609 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 08:39:26.302943 (Thread-2): finished collecting timing info
2022-02-08 08:39:26.312301 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 08:39:26.312563 (Thread-1): SQL status: BEGIN in 0.05 seconds
2022-02-08 08:39:26.312791 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-08 08:39:26.313049 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 08:39:26.313364 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:26.314492 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 08:39:26.318111 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 08:39:26.318351 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 08:39:26.319632 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 08:39:26.321396 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 08:39:26.321678 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-08 08:39:26.328372 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 08:39:26.328732 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:26.328957 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 08:39:26.329424 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 08:39:26.334046 (Thread-1): SQL status: SELECT 7 in 0.00 seconds
2022-02-08 08:39:26.340030 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 08:39:26.341831 (Thread-1): finished collecting timing info
2022-02-08 08:39:26.347699 (Thread-2): SQL status: CREATE VIEW in 0.02 seconds
2022-02-08 08:39:26.351675 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 08:39:26.357531 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 08:39:26.357749 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-08 08:39:26.357959 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-08 08:39:26.359879 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 08:39:26.364277 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 08:39:26.364532 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 08:39:26.364765 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 08:39:26.368571 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 08:39:26.369207 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-08 08:39:26.370492 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 08:39:26.372212 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 08:39:26.372806 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 08:39:26.374423 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 08:39:26.374921 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 08:39:26.375169 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 08:39:26.375392 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 08:39:26.375592 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 08:39:26.378676 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 08:39:26.381815 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 08:39:26.382105 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 08:39:26.386175 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-08 08:39:26.391231 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 08:39:26.391468 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 08:39:26.391696 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-08 08:39:26.394934 (Thread-2): finished collecting timing info
2022-02-08 08:39:26.395502 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-08 08:39:26.397217 (Thread-2): 11:39:26 | 3 of 18 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.17s]
2022-02-08 08:39:26.397558 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 08:39:26.397919 (Thread-2): Began running node model.project_otus_dbt.dim_day
2022-02-08 08:39:26.399870 (Thread-2): 11:39:26 | 5 of 18 START table model public.dim_day............................. [RUN]
2022-02-08 08:39:26.400199 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 08:39:26.401416 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 08:39:26.406488 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 08:39:26.406888 (Thread-2): Compiling model.project_otus_dbt.dim_day
2022-02-08 08:39:26.407133 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-08 08:39:26.413821 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 08:39:26.415126 (Thread-2): finished collecting timing info
2022-02-08 08:39:26.421616 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 08:39:26.428774 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 08:39:26.434321 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 08:39:26.439832 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 08:39:26.442495 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 08:39:26.442911 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-08 08:39:26.443122 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 08:39:26.445635 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 08:39:26.449390 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 08:39:26.449606 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 08:39:26.454211 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 08:39:26.454741 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 08:39:26.457545 (Thread-1): finished collecting timing info
2022-02-08 08:39:26.461353 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 08:39:26.461766 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-08 08:39:26.461995 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 08:39:26.465451 (Thread-1): 11:39:26 | 4 of 18 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.24s]
2022-02-08 08:39:26.465763 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 08:39:26.466174 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 08:39:26.474005 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 08:39:26.474383 (Thread-1): Began running node model.project_otus_dbt.dim_week
2022-02-08 08:39:26.476668 (Thread-1): 11:39:26 | 6 of 18 START table model public.dim_week............................ [RUN]
2022-02-08 08:39:26.477472 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 08:39:26.477714 (Thread-1): Compiling model.project_otus_dbt.dim_week
2022-02-08 08:39:26.478047 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 08:39:26.485443 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 08:39:26.485682 (Thread-2): On model.project_otus_dbt.dim_day: BEGIN
2022-02-08 08:39:26.486831 (Thread-1): finished collecting timing info
2022-02-08 08:39:26.487439 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 08:39:26.496132 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 08:39:26.496391 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 08:39:26.496629 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-08 08:39:26.496862 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 day')
        as t(date)
        )

select * from dim_day
order by date desc
  );
2022-02-08 08:39:26.497072 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 08:39:26.508951 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 08:39:26.512743 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 08:39:26.512987 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 08:39:26.514320 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 08:39:26.516319 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 08:39:26.517499 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 08:39:26.517734 (Thread-1): On model.project_otus_dbt.dim_week: BEGIN
2022-02-08 08:39:26.519086 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 08:39:26.519357 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 08:39:26.519512 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-08 08:39:26.533333 (Thread-1): SQL status: SELECT 731 in 0.01 seconds
2022-02-08 08:39:26.541026 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 08:39:26.541316 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-08 08:39:26.544417 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 08:39:26.548576 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 08:39:26.548836 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-08 08:39:26.551122 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 08:39:26.553047 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 08:39:26.553316 (Thread-2): SQL status: SELECT 5114 in 0.06 seconds
2022-02-08 08:39:26.553505 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 08:39:26.558333 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 08:39:26.558739 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 08:39:26.558975 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-08 08:39:26.561633 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 08:39:26.565256 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 08:39:26.565477 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 08:39:26.565650 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-08 08:39:26.568594 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 08:39:26.569055 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 08:39:26.570432 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 08:39:26.572047 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 08:39:26.572301 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 08:39:26.572449 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 08:39:26.574643 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 08:39:26.577597 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 08:39:26.577891 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 08:39:26.612297 (Thread-1): SQL status: DROP TABLE in 0.04 seconds
2022-02-08 08:39:26.615773 (Thread-1): finished collecting timing info
2022-02-08 08:39:26.616122 (Thread-2): SQL status: DROP TABLE in 0.04 seconds
2022-02-08 08:39:26.616390 (Thread-1): On model.project_otus_dbt.dim_week: Close
2022-02-08 08:39:26.619527 (Thread-2): finished collecting timing info
2022-02-08 08:39:26.620210 (Thread-2): On model.project_otus_dbt.dim_day: Close
2022-02-08 08:39:26.622627 (Thread-1): 11:39:26 | 6 of 18 OK created table model public.dim_week....................... [SELECT 731 in 0.14s]
2022-02-08 08:39:26.626767 (Thread-2): 11:39:26 | 5 of 18 OK created table model public.dim_day........................ [SELECT 5114 in 0.22s]
2022-02-08 08:39:26.627079 (Thread-1): Finished running node model.project_otus_dbt.dim_week
2022-02-08 08:39:26.627365 (Thread-2): Finished running node model.project_otus_dbt.dim_day
2022-02-08 08:39:26.627592 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 08:39:26.628214 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 08:39:26.629994 (Thread-1): 11:39:26 | 7 of 18 START incremental model public.hub_wheat_gbp................. [RUN]
2022-02-08 08:39:26.631668 (Thread-2): 11:39:26 | 8 of 18 START incremental model public.sat_wheat_gbp_details......... [RUN]
2022-02-08 08:39:26.632409 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 08:39:26.633213 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 08:39:26.633502 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-08 08:39:26.633868 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 08:39:26.648740 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 08:39:26.690066 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 08:39:26.690601 (Thread-1): finished collecting timing info
2022-02-08 08:39:26.707092 (Thread-2): finished collecting timing info
2022-02-08 08:39:26.731890 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 08:39:26.737434 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp113926721003"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 08:39:26.737951 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 08:39:26.738200 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 08:39:26.738443 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp113926735912"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 08:39:26.739288 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 08:39:26.771051 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-08 08:39:26.775598 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 08:39:26.775839 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-08 08:39:26.776442 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 08:39:26.780535 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 08:39:26.780762 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 08:39:26.781000 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-08 08:39:26.781268 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 08:39:26.781715 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp113926721003'
        
      order by ordinal_position

  
2022-02-08 08:39:26.782910 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 08:39:26.783175 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 08:39:26.783262 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp113926735912'
        
      order by ordinal_position

  
2022-02-08 08:39:26.797045 (Thread-1): SQL status: SELECT 4 in 0.02 seconds
2022-02-08 08:39:26.803625 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 08:39:26.803888 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:26.806726 (Thread-2): SQL status: SELECT 11 in 0.02 seconds
2022-02-08 08:39:26.811999 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 08:39:26.812240 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 08:39:26.812468 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:26.822325 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 08:39:26.822743 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:26.826734 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 08:39:26.827809 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 08:39:26.829025 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 08:39:26.829319 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 08:39:26.829500 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp113926721003"
    );
  
2022-02-08 08:39:26.835726 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 08:39:26.836394 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:26.839025 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 08:39:26.840726 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 08:39:26.841039 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 08:39:26.841233 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 08:39:26.844246 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 08:39:26.844534 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 08:39:26.846438 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 08:39:26.849344 (Thread-1): finished collecting timing info
2022-02-08 08:39:26.850209 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-08 08:39:26.853918 (Thread-1): 11:39:26 | 7 of 18 OK created incremental model public.hub_wheat_gbp............ [INSERT 0 0 in 0.22s]
2022-02-08 08:39:26.854410 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 08:39:26.854940 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 08:39:26.855328 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp113926735912"
    );
  
2022-02-08 08:39:26.856011 (Thread-1): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 08:39:26.859024 (Thread-1): 11:39:26 | 9 of 18 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-08 08:39:26.859317 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 08:39:26.860096 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 08:39:26.862865 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 08:39:26.863387 (Thread-1): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 08:39:26.863904 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 08:39:26.875015 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 08:39:26.882328 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 08:39:26.883045 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 08:39:26.886490 (Thread-2): finished collecting timing info
2022-02-08 08:39:26.886998 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-08 08:39:26.887273 (Thread-1): finished collecting timing info
2022-02-08 08:39:26.897693 (Thread-2): 11:39:26 | 8 of 18 OK created incremental model public.sat_wheat_gbp_details.... [INSERT 0 0 in 0.26s]
2022-02-08 08:39:26.908541 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 08:39:26.908959 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 08:39:26.909587 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp113926904268"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 08:39:26.910166 (Thread-2): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 08:39:26.910896 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 08:39:26.912904 (Thread-2): 11:39:26 | 10 of 18 START incremental model public.sat_rate_gbp_usd_details..... [RUN]
2022-02-08 08:39:26.914552 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 08:39:26.915000 (Thread-2): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 08:39:26.954919 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 08:39:26.955864 (Thread-2): finished collecting timing info
2022-02-08 08:39:26.962079 (Thread-1): SQL status: SELECT 0 in 0.05 seconds
2022-02-08 08:39:26.972040 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 08:39:26.975908 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 08:39:26.976187 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-08 08:39:26.976576 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp113926973115"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 08:39:26.977187 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 08:39:26.978222 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 08:39:26.978574 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 08:39:26.978893 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp113926904268'
        
      order by ordinal_position

  
2022-02-08 08:39:26.988972 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 08:39:26.993860 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 08:39:26.994304 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:27.000516 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 08:39:27.005945 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 08:39:27.006195 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:27.010438 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 08:39:27.012035 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 08:39:27.012704 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 08:39:27.012874 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp113926904268"
    );
  
2022-02-08 08:39:27.014882 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 08:39:27.015336 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 08:39:27.016991 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 08:39:27.021785 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 08:39:27.022151 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 08:39:27.022397 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-08 08:39:27.022644 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 08:39:27.024109 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 08:39:27.024385 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 08:39:27.024582 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp113926973115'
        
      order by ordinal_position

  
2022-02-08 08:39:27.025574 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 08:39:27.028062 (Thread-1): finished collecting timing info
2022-02-08 08:39:27.028478 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-08 08:39:27.030548 (Thread-1): 11:39:27 | 9 of 18 OK created incremental model public.hub_rate_gbp_usd......... [INSERT 0 0 in 0.17s]
2022-02-08 08:39:27.030898 (Thread-1): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 08:39:27.031226 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 08:39:27.033382 (Thread-1): 11:39:27 | 11 of 18 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-08 08:39:27.034530 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 08:39:27.035084 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-08 08:39:27.044570 (Thread-2): SQL status: SELECT 11 in 0.02 seconds
2022-02-08 08:39:27.055608 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 08:39:27.056742 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 08:39:27.057139 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:27.057464 (Thread-1): finished collecting timing info
2022-02-08 08:39:27.067136 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 08:39:27.067364 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 08:39:27.067544 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp113927065524"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 08:39:27.072678 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 08:39:27.073065 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 08:39:27.073461 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:27.080613 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 08:39:27.082111 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 08:39:27.083657 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 08:39:27.083899 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp113926973115"
    );
  
2022-02-08 08:39:27.085593 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 08:39:27.087118 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 08:39:27.087293 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 08:39:27.087406 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 08:39:27.089845 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 08:39:27.092224 (Thread-2): finished collecting timing info
2022-02-08 08:39:27.092633 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-08 08:39:27.094906 (Thread-2): 11:39:27 | 10 of 18 OK created incremental model public.sat_rate_gbp_usd_details [INSERT 0 0 in 0.18s]
2022-02-08 08:39:27.095277 (Thread-2): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 08:39:27.095586 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 08:39:27.097907 (Thread-2): 11:39:27 | 12 of 18 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-08 08:39:27.099210 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 08:39:27.099559 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 08:39:27.118484 (Thread-1): SQL status: SELECT 0 in 0.05 seconds
2022-02-08 08:39:27.122974 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 08:39:27.128301 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 08:39:27.128918 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-08 08:39:27.129550 (Thread-2): finished collecting timing info
2022-02-08 08:39:27.135762 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 08:39:27.140206 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 08:39:27.140538 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 08:39:27.140762 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp113927138579"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 08:39:27.140958 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp113927065524'
        
      order by ordinal_position

  
2022-02-08 08:39:27.141246 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 08:39:27.151755 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 08:39:27.157688 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 08:39:27.157933 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:27.162330 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 08:39:27.214977 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 08:39:27.215219 (Thread-2): SQL status: SELECT 0 in 0.07 seconds
2022-02-08 08:39:27.215527 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:27.221728 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 08:39:27.222330 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-08 08:39:27.223781 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 08:39:27.224186 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 08:39:27.224409 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp113927138579'
        
      order by ordinal_position

  
2022-02-08 08:39:27.226958 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 08:39:27.228095 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 08:39:27.228860 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 08:39:27.229065 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp113927065524"
    );
  
2022-02-08 08:39:27.230525 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 08:39:27.232244 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 08:39:27.232506 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 08:39:27.232658 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 08:39:27.235307 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 08:39:27.237694 (Thread-1): finished collecting timing info
2022-02-08 08:39:27.238173 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-08 08:39:27.240489 (Thread-1): 11:39:27 | 11 of 18 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.21s]
2022-02-08 08:39:27.240848 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 08:39:27.241150 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 08:39:27.243614 (Thread-1): 11:39:27 | 13 of 18 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-08 08:39:27.243896 (Thread-2): SQL status: SELECT 12 in 0.02 seconds
2022-02-08 08:39:27.244597 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 08:39:27.250244 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 08:39:27.250675 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-08 08:39:27.250995 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:27.263545 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 08:39:27.264089 (Thread-1): finished collecting timing info
2022-02-08 08:39:27.274757 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 08:39:27.275234 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 08:39:27.275460 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp113927273021"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 08:39:27.281738 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 08:39:27.282010 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 08:39:27.282245 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:27.287783 (Thread-2): SQL status: SELECT 12 in 0.00 seconds
2022-02-08 08:39:27.289259 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 08:39:27.289905 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 08:39:27.290137 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp113927138579"
    );
  
2022-02-08 08:39:27.291626 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 08:39:27.293281 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 08:39:27.293530 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 08:39:27.293670 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 08:39:27.296054 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 08:39:27.298439 (Thread-2): finished collecting timing info
2022-02-08 08:39:27.298810 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-08 08:39:27.300635 (Thread-2): 11:39:27 | 12 of 18 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.20s]
2022-02-08 08:39:27.301034 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 08:39:27.301526 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 08:39:27.305387 (Thread-2): 11:39:27 | 14 of 18 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-08 08:39:27.306457 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 08:39:27.307107 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 08:39:27.326965 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 08:39:27.331168 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 08:39:27.336074 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 08:39:27.336622 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-08 08:39:27.337011 (Thread-2): finished collecting timing info
2022-02-08 08:39:27.343591 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 08:39:27.346315 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 08:39:27.346750 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 08:39:27.347070 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp113927344278"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 08:39:27.347378 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp113927273021'
        
      order by ordinal_position

  
2022-02-08 08:39:27.347612 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 08:39:27.355779 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 08:39:27.361072 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 08:39:27.361408 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:27.366085 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 08:39:27.371821 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 08:39:27.372052 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:27.376047 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 08:39:27.377268 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 08:39:27.377939 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 08:39:27.378207 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp113927273021"
    );
  
2022-02-08 08:39:27.379761 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 08:39:27.381246 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 08:39:27.381521 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-08 08:39:27.381752 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 08:39:27.385728 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 08:39:27.386062 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 08:39:27.386276 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-08 08:39:27.387788 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 08:39:27.388062 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 08:39:27.388212 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp113927344278'
        
      order by ordinal_position

  
2022-02-08 08:39:27.388869 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 08:39:27.391134 (Thread-1): finished collecting timing info
2022-02-08 08:39:27.391504 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-08 08:39:27.393453 (Thread-1): 11:39:27 | 13 of 18 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.15s]
2022-02-08 08:39:27.393833 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 08:39:27.394161 (Thread-1): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 08:39:27.396308 (Thread-1): 11:39:27 | 15 of 18 START table model public.dds_rate_gbp_usd................... [RUN]
2022-02-08 08:39:27.397075 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 08:39:27.397480 (Thread-1): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 08:39:27.408361 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 08:39:27.408678 (Thread-2): SQL status: SELECT 11 in 0.02 seconds
2022-02-08 08:39:27.414336 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 08:39:27.414574 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:27.414969 (Thread-1): finished collecting timing info
2022-02-08 08:39:27.423805 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 08:39:27.424064 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 08:39:27.424252 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 08:39:27.430665 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 08:39:27.430939 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 08:39:27.431176 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 08:39:27.435898 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-08 08:39:27.437418 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 08:39:27.438008 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 08:39:27.438154 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp113927344278"
    );
  
2022-02-08 08:39:27.440026 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 08:39:27.442291 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 08:39:27.442663 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 08:39:27.442927 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 08:39:27.444781 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 08:39:27.448018 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 08:39:27.448264 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 08:39:27.448498 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 08:39:27.452803 (Thread-2): finished collecting timing info
2022-02-08 08:39:27.453410 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-08 08:39:27.455553 (Thread-2): 11:39:27 | 14 of 18 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.15s]
2022-02-08 08:39:27.455820 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 08:39:27.457909 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 08:39:27.458348 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 08:39:27.459081 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 08:39:27.461413 (Thread-2): 11:39:27 | 16 of 18 START table model public.dds_wheat_msk...................... [RUN]
2022-02-08 08:39:27.462582 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 08:39:27.463201 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-08 08:39:27.463595 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 08:39:27.472992 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 08:39:27.473345 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-08 08:39:27.474005 (Thread-2): finished collecting timing info
2022-02-08 08:39:27.480373 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 08:39:27.482984 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 08:39:27.483210 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 08:39:27.483421 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-08 08:39:27.483610 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */


  create  table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp"
  as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );
2022-02-08 08:39:27.483880 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 08:39:27.498822 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 08:39:27.503382 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 08:39:27.503618 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 08:39:27.504930 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 08:39:27.506596 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 08:39:27.507205 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 08:39:27.507433 (Thread-1): SQL status: SELECT 548 in 0.02 seconds
2022-02-08 08:39:27.507618 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-08 08:39:27.512386 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 08:39:27.512987 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd" rename to "dds_rate_gbp_usd__dbt_backup"
2022-02-08 08:39:27.514235 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 08:39:27.514519 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 08:39:27.514728 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 08:39:27.518222 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 08:39:27.518603 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */


  create  table "postgres"."public"."dds_wheat_msk__dbt_tmp"
  as (
    with dds_wheat_msk as(
    select cast(su.tradedate as date) as tradedate
        ,hu.date_pk
        ,case when su.value=0 and su.volume>0 then cast(su.volume*su.close as decimal(18,2))
            else cast(su.value as decimal(18,2))
            end as value_all
        ,cast(su.open as decimal(18,2)) as open
        ,cast(su.close as decimal(18,2)) as close
        ,cast(su.high as decimal(18,2)) as high
        ,cast(su.low as decimal(18,2)) as low
        ,cast(su.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hu
    left join "postgres"."public"."sat_wheat_msk_details" as su
    on hu.date_pk=su.date_pk
)
select * from dds_wheat_msk
  );
2022-02-08 08:39:27.518833 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-08 08:39:27.520523 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 08:39:27.522017 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 08:39:27.522250 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 08:39:27.522372 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 08:39:27.525256 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 08:39:27.528392 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 08:39:27.528634 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 08:39:27.533840 (Thread-2): SQL status: SELECT 216 in 0.01 seconds
2022-02-08 08:39:27.540756 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 08:39:27.541042 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 08:39:27.541346 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-08 08:39:27.544871 (Thread-1): finished collecting timing info
2022-02-08 08:39:27.545600 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-08 08:39:27.548840 (Thread-1): 11:39:27 | 15 of 18 OK created table model public.dds_rate_gbp_usd.............. [SELECT 548 in 0.15s]
2022-02-08 08:39:27.549134 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 08:39:27.549565 (Thread-1): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 08:39:27.554813 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 08:39:27.555398 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 08:39:27.556189 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-08 08:39:27.559029 (Thread-1): 11:39:27 | 17 of 18 START table model public.dds_wheat_usa...................... [RUN]
2022-02-08 08:39:27.560087 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 08:39:27.560396 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_usa
2022-02-08 08:39:27.566282 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 08:39:27.570920 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 08:39:27.572773 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 08:39:27.573233 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 08:39:27.573406 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 08:39:27.573703 (Thread-1): finished collecting timing info
2022-02-08 08:39:27.581245 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 08:39:27.583944 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 08:39:27.586970 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 08:39:27.587272 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_tmp" cascade
2022-02-08 08:39:27.587475 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 08:39:27.587720 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 08:39:27.594001 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 08:39:27.597278 (Thread-2): finished collecting timing info
2022-02-08 08:39:27.597774 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-08 08:39:27.600154 (Thread-2): 11:39:27 | 16 of 18 OK created table model public.dds_wheat_msk................. [SELECT 216 in 0.14s]
2022-02-08 08:39:27.600417 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 08:39:27.600728 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 08:39:27.604929 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 08:39:27.605370 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 08:39:27.605915 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 08:39:27.607551 (Thread-2): 11:39:27 | 18 of 18 START table model public.dds_wheat_gbp...................... [RUN]
2022-02-08 08:39:27.608701 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 08:39:27.609078 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_gbp
2022-02-08 08:39:27.614656 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 08:39:27.619546 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 08:39:27.621492 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 08:39:27.622372 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 08:39:27.622560 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: BEGIN
2022-02-08 08:39:27.623025 (Thread-2): finished collecting timing info
2022-02-08 08:39:27.629206 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 08:39:27.634322 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 08:39:27.634598 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 08:39:27.634854 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_tmp" cascade
2022-02-08 08:39:27.635192 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */


  create  table "postgres"."public"."dds_wheat_usa__dbt_tmp"
  as (
    with usa as (
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0/2.7 as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_usa" as hu
    left join "postgres"."public"."sat_wheat_usa_details" as su
    on hu.date_pk=su.date_pk
)
select * from usa
  );
2022-02-08 08:39:27.635476 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 08:39:27.647898 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 08:39:27.651592 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 08:39:27.651815 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 08:39:27.653146 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 08:39:27.654612 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 08:39:27.654844 (Thread-1): SQL status: SELECT 547 in 0.02 seconds
2022-02-08 08:39:27.659745 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 08:39:27.660016 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa" rename to "dds_wheat_usa__dbt_backup"
2022-02-08 08:39:27.660324 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 08:39:27.660543 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: BEGIN
2022-02-08 08:39:27.661767 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 08:39:27.662122 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 08:39:27.665736 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 08:39:27.666079 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 08:39:27.666302 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa__dbt_tmp" rename to "dds_wheat_usa"
2022-02-08 08:39:27.666589 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */


  create  table "postgres"."public"."dds_wheat_gbp__dbt_tmp"
  as (
    with gbp as(
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0*rt.rate as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_gbp" as hu
    left join "postgres"."public"."sat_wheat_gbp_details" as su
    on hu.date_pk=su.date_pk
    left join "postgres"."public"."dds_rate_gbp_usd" as rt
    on hu.date_pk=rt.date_pk
)
select * from gbp
  );
2022-02-08 08:39:27.668267 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 08:39:27.669845 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 08:39:27.670089 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 08:39:27.670236 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 08:39:27.672879 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 08:39:27.675719 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 08:39:27.675946 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 08:39:27.683007 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 08:39:27.686162 (Thread-1): finished collecting timing info
2022-02-08 08:39:27.686476 (Thread-2): SQL status: SELECT 531 in 0.02 seconds
2022-02-08 08:39:27.686681 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: Close
2022-02-08 08:39:27.691641 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 08:39:27.692094 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp" rename to "dds_wheat_gbp__dbt_backup"
2022-02-08 08:39:27.694637 (Thread-1): 11:39:27 | 17 of 18 OK created table model public.dds_wheat_usa................. [SELECT 547 in 0.13s]
2022-02-08 08:39:27.695357 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 08:39:27.697261 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 08:39:27.701128 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 08:39:27.701410 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp__dbt_tmp" rename to "dds_wheat_gbp"
2022-02-08 08:39:27.703019 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 08:39:27.705108 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 08:39:27.705345 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 08:39:27.705475 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 08:39:27.708782 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 08:39:27.712918 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 08:39:27.713150 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 08:39:27.717827 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 08:39:27.720938 (Thread-2): finished collecting timing info
2022-02-08 08:39:27.721344 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: Close
2022-02-08 08:39:27.723363 (Thread-2): 11:39:27 | 18 of 18 OK created table model public.dds_wheat_gbp................. [SELECT 531 in 0.11s]
2022-02-08 08:39:27.723903 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 08:39:27.726328 (MainThread): Acquiring new postgres connection "master".
2022-02-08 08:39:27.726815 (MainThread): Using postgres connection "master".
2022-02-08 08:39:27.726999 (MainThread): On master: BEGIN
2022-02-08 08:39:27.727149 (MainThread): Opening a new connection, currently in state closed
2022-02-08 08:39:27.737678 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 08:39:27.737934 (MainThread): On master: COMMIT
2022-02-08 08:39:27.738046 (MainThread): Using postgres connection "master".
2022-02-08 08:39:27.738154 (MainThread): On master: COMMIT
2022-02-08 08:39:27.739094 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 08:39:27.739311 (MainThread): On master: Close
2022-02-08 08:39:27.739865 (MainThread): 11:39:27 | 
2022-02-08 08:39:27.740131 (MainThread): 11:39:27 | Finished running 4 view models, 6 table models, 8 incremental models in 2.65s.
2022-02-08 08:39:27.740339 (MainThread): Connection 'master' was properly closed.
2022-02-08 08:39:27.740460 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_usa' was properly closed.
2022-02-08 08:39:27.740602 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_gbp' was properly closed.
2022-02-08 08:39:27.850405 (MainThread): 
2022-02-08 08:39:27.850813 (MainThread): Completed successfully
2022-02-08 08:39:27.851195 (MainThread): 
Done. PASS=18 WARN=0 ERROR=0 SKIP=0 TOTAL=18
2022-02-08 08:39:27.852096 (MainThread): Flushing usage events
2022-02-08 09:57:45.884439 (MainThread): Running with dbt=0.19.0
2022-02-08 09:57:46.267679 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-08 09:57:46.270372 (MainThread): Tracking: do not track
2022-02-08 09:57:46.444632 (MainThread): Partial parsing not enabled
2022-02-08 09:57:46.450016 (MainThread): Parsing macros/adapters.sql
2022-02-08 09:57:46.491319 (MainThread): Parsing macros/catalog.sql
2022-02-08 09:57:46.495960 (MainThread): Parsing macros/relations.sql
2022-02-08 09:57:46.498578 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-08 09:57:46.504549 (MainThread): Parsing macros/core.sql
2022-02-08 09:57:46.511873 (MainThread): Parsing macros/adapters/common.sql
2022-02-08 09:57:46.593433 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-08 09:57:46.599535 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-08 09:57:46.604206 (MainThread): Parsing macros/etc/datetime.sql
2022-02-08 09:57:46.629682 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-08 09:57:46.632415 (MainThread): Parsing macros/etc/query.sql
2022-02-08 09:57:46.634412 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-08 09:57:46.636093 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-08 09:57:46.650090 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-08 09:57:46.692360 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-08 09:57:46.696648 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-08 09:57:46.744918 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-08 09:57:46.774876 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-08 09:57:46.784101 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-08 09:57:46.787858 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-08 09:57:46.813852 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-08 09:57:46.822038 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-08 09:57:46.832683 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-08 09:57:46.849014 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-08 09:57:46.852261 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-08 09:57:46.854971 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-08 09:57:46.858058 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-08 09:57:46.864156 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-08 09:57:46.867690 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-08 09:57:46.871084 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-08 09:57:46.873418 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-08 09:57:46.889503 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-08 09:57:46.892726 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-08 09:57:46.895581 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-08 09:57:46.899723 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-08 09:57:46.901490 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-08 09:57:46.904833 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-08 09:57:46.909561 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-08 09:57:46.912331 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-08 09:57:46.916123 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-08 09:57:46.920047 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-08 09:57:46.933648 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-08 09:57:46.939218 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-08 09:57:46.943114 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-08 09:57:46.945666 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-08 09:57:46.948671 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-08 09:57:46.952201 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-08 09:57:46.955203 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-08 09:57:46.963759 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-08 09:57:46.965888 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-08 09:57:46.968493 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-08 09:57:46.972393 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-08 09:57:46.978278 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-08 09:57:46.983373 (MainThread): Parsing macros/sql/star.sql
2022-02-08 09:57:46.989304 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-08 09:57:46.992178 (MainThread): Parsing macros/sql/pivot.sql
2022-02-08 09:57:46.999202 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-08 09:57:47.002136 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-08 09:57:47.015295 (MainThread): Parsing macros/sql/union.sql
2022-02-08 09:57:47.029483 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-08 09:57:47.033764 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-08 09:57:47.044128 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-08 09:57:47.049974 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-08 09:57:47.059569 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-08 09:57:47.072875 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-08 09:57:47.083434 (MainThread): Parsing macros/sql/groupby.sql
2022-02-08 09:57:47.086834 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-08 09:57:47.091037 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-08 09:57:47.102929 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-08 09:57:47.111746 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-08 09:57:47.118710 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-08 09:57:47.122114 (MainThread): Parsing macros/logger/log_info.sql
2022-02-08 09:57:47.124712 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-08 09:57:47.169971 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-08 09:57:47.173193 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-08 09:57:47.177276 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-08 09:57:47.180424 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-08 09:57:47.183581 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-08 09:57:47.195021 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-08 09:57:47.202087 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-08 09:57:47.212310 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-08 09:57:47.218601 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-08 09:57:47.224955 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-08 09:57:47.231933 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-08 09:57:47.238272 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-08 09:57:47.241691 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-08 09:57:47.258260 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-08 09:57:47.264432 (MainThread): Parsing macros/internal/alias.sql
2022-02-08 09:57:47.271221 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-08 09:57:47.273239 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-08 09:57:47.277858 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-08 09:57:47.284097 (MainThread): Parsing macros/internal/multikey.sql
2022-02-08 09:57:47.292689 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-08 09:57:47.307852 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-08 09:57:47.314645 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-08 09:57:47.316143 (MainThread): Parsing macros/tables/hub.sql
2022-02-08 09:57:47.333860 (MainThread): Parsing macros/tables/link.sql
2022-02-08 09:57:47.350889 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-08 09:57:47.370309 (MainThread): Parsing macros/tables/sat.sql
2022-02-08 09:57:47.385741 (MainThread): Parsing macros/tables/t_link.sql
2022-02-08 09:57:47.394152 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-08 09:57:47.430064 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-08 09:57:47.450655 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-08 09:57:47.495836 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-08 09:57:47.498793 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-08 09:57:47.544797 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-08 09:57:47.557886 (MainThread): Parsing macros/supporting/hash.sql
2022-02-08 09:57:47.570825 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-08 09:57:47.573601 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-08 09:57:47.584298 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-08 09:57:47.589747 (MainThread): Parsing macros/staging/stage.sql
2022-02-08 09:57:47.607686 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-08 09:57:47.630900 (MainThread): Partial parsing not enabled
2022-02-08 09:57:47.828923 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 09:57:48.024922 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 09:57:48.082529 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 09:57:48.117627 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 09:57:48.153487 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 09:57:48.213171 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 09:57:48.239367 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 09:57:48.263294 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 09:57:48.287329 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 09:57:48.510568 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 09:57:48.551800 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 09:57:48.596299 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 09:57:48.644381 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 09:57:48.667393 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 09:57:48.683143 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 09:57:48.709467 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 09:57:48.730548 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 09:57:48.749722 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 09:57:50.020183 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.raw_vault.links
- models.project_otus_dbt.report

2022-02-08 09:57:50.401175 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-08 09:57:50.405102 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-08 09:57:50.410117 (MainThread): 
2022-02-08 09:57:50.411262 (MainThread): Acquiring new postgres connection "master".
2022-02-08 09:57:50.457544 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-08 09:57:50.478110 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-08 09:57:50.478406 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-08 09:57:50.478538 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-08 09:57:50.614763 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.14 seconds
2022-02-08 09:57:50.621409 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-08 09:57:50.680897 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-08 09:57:50.703929 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 09:57:50.704476 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-08 09:57:50.704947 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-08 09:57:50.776308 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.07 seconds
2022-02-08 09:57:50.776772 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 09:57:50.777185 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-08 09:57:50.836007 (ThreadPoolExecutor-1_0): SQL status: SELECT 25 in 0.06 seconds
2022-02-08 09:57:50.882149 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-08 09:57:50.884578 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-08 09:57:50.968451 (MainThread): Using postgres connection "master".
2022-02-08 09:57:50.968851 (MainThread): On master: BEGIN
2022-02-08 09:57:50.969055 (MainThread): Opening a new connection, currently in state init
2022-02-08 09:57:51.004130 (MainThread): SQL status: BEGIN in 0.04 seconds
2022-02-08 09:57:51.004832 (MainThread): Using postgres connection "master".
2022-02-08 09:57:51.005375 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-08 09:57:51.568627 (MainThread): SQL status: SELECT 10 in 0.56 seconds
2022-02-08 09:57:51.584474 (MainThread): On master: ROLLBACK
2022-02-08 09:57:51.586654 (MainThread): Using postgres connection "master".
2022-02-08 09:57:51.586963 (MainThread): On master: BEGIN
2022-02-08 09:57:51.590013 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-08 09:57:51.590331 (MainThread): On master: COMMIT
2022-02-08 09:57:51.590461 (MainThread): Using postgres connection "master".
2022-02-08 09:57:51.590656 (MainThread): On master: COMMIT
2022-02-08 09:57:51.592262 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 09:57:51.592773 (MainThread): On master: Close
2022-02-08 09:57:51.594071 (MainThread): 12:57:51 | Concurrency: 2 threads (target='dev')
2022-02-08 09:57:51.594903 (MainThread): 12:57:51 | 
2022-02-08 09:57:51.602400 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 09:57:51.602904 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 09:57:51.605541 (Thread-1): 12:57:51 | 1 of 18 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-08 09:57:51.607115 (Thread-2): 12:57:51 | 2 of 18 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-08 09:57:51.608143 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 09:57:51.608564 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 09:57:51.609315 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 09:57:51.620500 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 09:57:51.707023 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 09:57:51.707728 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 09:57:51.708008 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-08 09:57:51.708330 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-08 09:57:51.708691 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 09:57:51.708956 (Thread-2): Opening a new connection, currently in state init
2022-02-08 09:57:51.726803 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-08 09:57:51.727121 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 09:57:51.727264 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:51.749784 (Thread-2): SQL status: BEGIN in 0.04 seconds
2022-02-08 09:57:51.750141 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 09:57:51.750337 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:51.875799 (Thread-2): SQL status: SELECT 7 in 0.13 seconds
2022-02-08 09:57:51.883625 (Thread-1): SQL status: SELECT 6 in 0.16 seconds
2022-02-08 09:57:51.972104 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 09:57:51.975907 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 09:57:51.976290 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:51.976652 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:51.984056 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-08 09:57:51.998615 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 09:57:51.999020 (Thread-1): SQL status: SELECT 6 in 0.02 seconds
2022-02-08 09:57:52.021369 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 09:57:52.021762 (Thread-2): finished collecting timing info
2022-02-08 09:57:52.049804 (Thread-1): finished collecting timing info
2022-02-08 09:57:52.114800 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 09:57:52.115337 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 09:57:52.115763 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 09:57:52.116327 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-08 09:57:52.124381 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 09:57:52.124797 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 09:57:52.129087 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 09:57:52.134026 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 09:57:52.134714 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 09:57:52.135185 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 09:57:52.137668 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 09:57:52.138116 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 09:57:52.145326 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 09:57:52.148727 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 09:57:52.150370 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 09:57:52.150901 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 09:57:52.151211 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 09:57:52.151704 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 09:57:52.196807 (Thread-1): SQL status: CREATE VIEW in 0.04 seconds
2022-02-08 09:57:52.197191 (Thread-2): SQL status: CREATE VIEW in 0.04 seconds
2022-02-08 09:57:52.214996 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 09:57:52.220763 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-08 09:57:52.221212 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 09:57:52.221911 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-08 09:57:52.227207 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 09:57:52.227605 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 09:57:52.237635 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 09:57:52.239152 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 09:57:52.239438 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-08 09:57:52.239772 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-08 09:57:52.244974 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 09:57:52.251692 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 09:57:52.255348 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 09:57:52.258146 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 09:57:52.258660 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 09:57:52.259160 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 09:57:52.259688 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 09:57:52.260450 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 09:57:52.269625 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 09:57:52.270072 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 09:57:52.279166 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 09:57:52.285134 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 09:57:52.284578 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 09:57:52.285857 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 09:57:52.303656 (Thread-1): SQL status: DROP VIEW in 0.02 seconds
2022-02-08 09:57:52.308082 (Thread-1): finished collecting timing info
2022-02-08 09:57:52.308589 (Thread-2): SQL status: DROP VIEW in 0.02 seconds
2022-02-08 09:57:52.309018 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-08 09:57:52.315017 (Thread-2): finished collecting timing info
2022-02-08 09:57:52.316011 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-08 09:57:52.320681 (Thread-1): 12:57:52 | 1 of 18 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.71s]
2022-02-08 09:57:52.324902 (Thread-2): 12:57:52 | 2 of 18 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.71s]
2022-02-08 09:57:52.325646 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 09:57:52.326357 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 09:57:52.327243 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 09:57:52.328967 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 09:57:52.333045 (Thread-1): 12:57:52 | 3 of 18 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-08 09:57:52.336892 (Thread-2): 12:57:52 | 4 of 18 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-08 09:57:52.338568 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 09:57:52.339815 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 09:57:52.340361 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 09:57:52.340970 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 09:57:52.413251 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 09:57:52.418111 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 09:57:52.418596 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-08 09:57:52.419163 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-08 09:57:52.419769 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 09:57:52.420614 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 09:57:52.444357 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-08 09:57:52.444844 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 09:57:52.445130 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:52.446392 (Thread-2): SQL status: BEGIN in 0.03 seconds
2022-02-08 09:57:52.446821 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 09:57:52.447112 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:52.467531 (Thread-2): SQL status: SELECT 7 in 0.02 seconds
2022-02-08 09:57:52.477328 (Thread-1): SQL status: SELECT 18 in 0.03 seconds
2022-02-08 09:57:52.489307 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 09:57:52.495135 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:52.499242 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 09:57:52.500109 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:52.515965 (Thread-1): SQL status: SELECT 18 in 0.02 seconds
2022-02-08 09:57:52.528636 (Thread-2): SQL status: SELECT 7 in 0.03 seconds
2022-02-08 09:57:52.530200 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 09:57:52.542771 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 09:57:52.543551 (Thread-1): finished collecting timing info
2022-02-08 09:57:52.555504 (Thread-2): finished collecting timing info
2022-02-08 09:57:52.569183 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 09:57:52.575195 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-08 09:57:52.583963 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 09:57:52.584422 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-08 09:57:52.585239 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 09:57:52.592875 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 09:57:52.597802 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 09:57:52.607036 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 09:57:52.607583 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 09:57:52.608159 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 09:57:52.611507 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 09:57:52.612221 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 09:57:52.618758 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 09:57:52.621808 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 09:57:52.624772 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 09:57:52.625270 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 09:57:52.625824 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 09:57:52.626443 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 09:57:52.641634 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-08 09:57:52.648160 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 09:57:52.648457 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-08 09:57:52.648771 (Thread-2): SQL status: CREATE VIEW in 0.02 seconds
2022-02-08 09:57:52.657723 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 09:57:52.660409 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 09:57:52.667354 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 09:57:52.668350 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-08 09:57:52.667809 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-08 09:57:52.671289 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 09:57:52.674878 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 09:57:52.675307 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 09:57:52.675771 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 09:57:52.682974 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 09:57:52.683421 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 09:57:52.684062 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-08 09:57:52.690417 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 09:57:52.690857 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 09:57:52.698245 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 09:57:52.702984 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 09:57:52.704119 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 09:57:52.705130 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 09:57:52.706360 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 09:57:52.711567 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 09:57:52.717699 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 09:57:52.718186 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 09:57:52.718666 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 09:57:52.726789 (Thread-1): finished collecting timing info
2022-02-08 09:57:52.728015 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-08 09:57:52.732143 (Thread-1): 12:57:52 | 3 of 18 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.39s]
2022-02-08 09:57:52.732828 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 09:57:52.734386 (Thread-1): Began running node model.project_otus_dbt.dim_day
2022-02-08 09:57:52.739171 (Thread-1): 12:57:52 | 5 of 18 START table model public.dim_day............................. [RUN]
2022-02-08 09:57:52.740514 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 09:57:52.742210 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 09:57:52.749229 (Thread-2): finished collecting timing info
2022-02-08 09:57:52.749960 (Thread-1): Compiling model.project_otus_dbt.dim_day
2022-02-08 09:57:52.750588 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-08 09:57:52.766556 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 09:57:52.770810 (Thread-2): 12:57:52 | 4 of 18 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.43s]
2022-02-08 09:57:52.772175 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 09:57:52.773120 (Thread-2): Began running node model.project_otus_dbt.dim_week
2022-02-08 09:57:52.785981 (Thread-2): 12:57:52 | 6 of 18 START table model public.dim_week............................ [RUN]
2022-02-08 09:57:52.786836 (Thread-1): finished collecting timing info
2022-02-08 09:57:52.788348 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 09:57:52.799786 (Thread-2): Compiling model.project_otus_dbt.dim_week
2022-02-08 09:57:52.830695 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 09:57:52.855484 (Thread-2): finished collecting timing info
2022-02-08 09:57:52.857308 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 09:57:52.868602 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-08 09:57:52.874489 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 09:57:52.878807 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 09:57:52.879294 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-08 09:57:52.879862 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 09:57:52.897425 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 09:57:52.903996 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 09:57:52.904410 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 09:57:52.906803 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 09:57:52.914553 (Thread-2): SQL status: DROP TABLE in 0.03 seconds
2022-02-08 09:57:52.927959 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 09:57:52.931914 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 09:57:52.933110 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 09:57:52.936285 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 09:57:52.939683 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 09:57:52.940373 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 09:57:52.941304 (Thread-1): On model.project_otus_dbt.dim_day: BEGIN
2022-02-08 09:57:52.942504 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 09:57:52.943200 (Thread-2): On model.project_otus_dbt.dim_week: BEGIN
2022-02-08 09:57:52.944396 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 09:57:52.945700 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 09:57:52.946208 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 day')
        as t(date)
        )

select * from dim_day
order by date desc
  );
2022-02-08 09:57:52.948294 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 09:57:52.948897 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 09:57:52.949298 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-08 09:57:52.982398 (Thread-2): SQL status: SELECT 731 in 0.03 seconds
2022-02-08 09:57:52.994745 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 09:57:52.995243 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-08 09:57:52.999262 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 09:57:53.006027 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 09:57:53.006435 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-08 09:57:53.010097 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 09:57:53.012687 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 09:57:53.013179 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 09:57:53.013455 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 09:57:53.019514 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 09:57:53.025522 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 09:57:53.025927 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 09:57:53.042237 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 09:57:53.048097 (Thread-2): finished collecting timing info
2022-02-08 09:57:53.048793 (Thread-2): On model.project_otus_dbt.dim_week: Close
2022-02-08 09:57:53.052560 (Thread-2): 12:57:53 | 6 of 18 OK created table model public.dim_week....................... [SELECT 731 in 0.26s]
2022-02-08 09:57:53.053152 (Thread-2): Finished running node model.project_otus_dbt.dim_week
2022-02-08 09:57:53.053853 (Thread-2): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 09:57:53.057875 (Thread-2): 12:57:53 | 7 of 18 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-08 09:57:53.058482 (Thread-1): SQL status: SELECT 5114 in 0.11 seconds
2022-02-08 09:57:53.059612 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 09:57:53.075662 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 09:57:53.076254 (Thread-2): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 09:57:53.076878 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-08 09:57:53.097101 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 09:57:53.115889 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 09:57:53.120900 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 09:57:53.121456 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-08 09:57:53.123493 (Thread-2): finished collecting timing info
2022-02-08 09:57:53.135677 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 09:57:53.143556 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 09:57:53.149605 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 09:57:53.155380 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 09:57:53.173510 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 09:57:53.184130 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 09:57:53.189849 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 09:57:53.209978 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 09:57:53.223203 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 09:57:53.223667 (Thread-1): finished collecting timing info
2022-02-08 09:57:53.224470 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp125753208161"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 09:57:53.225134 (Thread-1): On model.project_otus_dbt.dim_day: Close
2022-02-08 09:57:53.225710 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 09:57:53.230796 (Thread-1): 12:57:53 | 5 of 18 OK created table model public.dim_day........................ [SELECT 5114 in 0.49s]
2022-02-08 09:57:53.231660 (Thread-1): Finished running node model.project_otus_dbt.dim_day
2022-02-08 09:57:53.232359 (Thread-1): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 09:57:53.236945 (Thread-1): 12:57:53 | 8 of 18 START incremental model public.sat_rate_gbp_usd_details...... [RUN]
2022-02-08 09:57:53.238102 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 09:57:53.238622 (Thread-1): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 09:57:53.289247 (Thread-2): SQL status: SELECT 0 in 0.06 seconds
2022-02-08 09:57:53.291505 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 09:57:53.301821 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 09:57:53.302850 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-08 09:57:53.304136 (Thread-1): finished collecting timing info
2022-02-08 09:57:53.311313 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 09:57:53.317502 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 09:57:53.323293 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp125753208161'
        
      order by ordinal_position

  
2022-02-08 09:57:53.328478 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 09:57:53.329421 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp125753324463"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 09:57:53.329894 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 09:57:53.369091 (Thread-2): SQL status: SELECT 4 in 0.04 seconds
2022-02-08 09:57:53.381280 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 09:57:53.381834 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:53.392568 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 09:57:53.414548 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 09:57:53.415132 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:53.424192 (Thread-1): SQL status: SELECT 0 in 0.09 seconds
2022-02-08 09:57:53.431772 (Thread-2): SQL status: SELECT 4 in 0.02 seconds
2022-02-08 09:57:53.435351 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 09:57:53.437293 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 09:57:53.438140 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-08 09:57:53.439678 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 09:57:53.440173 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp125753208161"
    );
  
2022-02-08 09:57:53.441724 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 09:57:53.442159 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 09:57:53.442531 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp125753324463'
        
      order by ordinal_position

  
2022-02-08 09:57:53.445659 (Thread-2): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-08 09:57:53.448219 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 09:57:53.448620 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 09:57:53.448804 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 09:57:53.453940 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 09:57:53.459405 (Thread-2): finished collecting timing info
2022-02-08 09:57:53.460109 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-08 09:57:53.464529 (Thread-2): 12:57:53 | 7 of 18 OK created incremental model public.hub_rate_gbp_usd......... [INSERT 0 0 in 0.40s]
2022-02-08 09:57:53.465327 (Thread-2): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 09:57:53.466020 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 09:57:53.472733 (Thread-2): 12:57:53 | 9 of 18 START incremental model public.hub_wheat_gbp................. [RUN]
2022-02-08 09:57:53.474580 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 09:57:53.475521 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-08 09:57:53.486383 (Thread-1): SQL status: SELECT 11 in 0.04 seconds
2022-02-08 09:57:53.507533 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 09:57:53.513412 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:53.516120 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 09:57:53.517881 (Thread-2): finished collecting timing info
2022-02-08 09:57:53.531011 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 09:57:53.544173 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 09:57:53.548861 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 09:57:53.549332 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp125753534943"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 09:57:53.550213 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:53.550890 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 09:57:53.561949 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 09:57:53.564495 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 09:57:53.565837 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 09:57:53.566446 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp125753324463"
    );
  
2022-02-08 09:57:53.569274 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 09:57:53.574167 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 09:57:53.574887 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 09:57:53.575301 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 09:57:53.579887 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 09:57:53.586793 (Thread-1): finished collecting timing info
2022-02-08 09:57:53.587729 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-08 09:57:53.591912 (Thread-1): 12:57:53 | 8 of 18 OK created incremental model public.sat_rate_gbp_usd_details. [INSERT 0 0 in 0.35s]
2022-02-08 09:57:53.592556 (Thread-1): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 09:57:53.593487 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 09:57:53.597683 (Thread-1): 12:57:53 | 10 of 18 START incremental model public.sat_wheat_gbp_details........ [RUN]
2022-02-08 09:57:53.599575 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 09:57:53.600308 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 09:57:53.613919 (Thread-2): SQL status: SELECT 0 in 0.06 seconds
2022-02-08 09:57:53.634103 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 09:57:53.640077 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-08 09:57:53.653384 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 09:57:53.659122 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 09:57:53.663051 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 09:57:53.663533 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp125753534943'
        
      order by ordinal_position

  
2022-02-08 09:57:53.665129 (Thread-1): finished collecting timing info
2022-02-08 09:57:53.685158 (Thread-2): SQL status: SELECT 4 in 0.02 seconds
2022-02-08 09:57:53.687525 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 09:57:53.697715 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 09:57:53.698797 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:53.698202 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp125753682769"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 09:57:53.699562 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 09:57:53.710018 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 09:57:53.720092 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 09:57:53.720690 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:53.730915 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 09:57:53.733117 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 09:57:53.734179 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 09:57:53.734537 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp125753534943"
    );
  
2022-02-08 09:57:53.737709 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 09:57:53.740823 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 09:57:53.741306 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 09:57:53.741669 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 09:57:53.747397 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 09:57:53.752853 (Thread-2): finished collecting timing info
2022-02-08 09:57:53.753901 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-08 09:57:53.761164 (Thread-2): 12:57:53 | 9 of 18 OK created incremental model public.hub_wheat_gbp............ [INSERT 0 0 in 0.28s]
2022-02-08 09:57:53.761768 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 09:57:53.762298 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 09:57:53.768707 (Thread-2): 12:57:53 | 11 of 18 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-08 09:57:53.776621 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 09:57:53.777020 (Thread-1): SQL status: SELECT 0 in 0.08 seconds
2022-02-08 09:57:53.777496 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-08 09:57:53.795870 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 09:57:53.801597 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-08 09:57:53.810519 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 09:57:53.810851 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 09:57:53.811379 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 09:57:53.811516 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp125753682769'
        
      order by ordinal_position

  
2022-02-08 09:57:53.811981 (Thread-2): finished collecting timing info
2022-02-08 09:57:53.824066 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 09:57:53.824433 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 09:57:53.824838 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp125753821726"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 09:57:53.834264 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 09:57:53.834972 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 09:57:53.835498 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:53.842029 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 09:57:53.848470 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 09:57:53.848923 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:53.855258 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 09:57:53.860023 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 09:57:53.861237 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 09:57:53.861658 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp125753682769"
    );
  
2022-02-08 09:57:53.864822 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 09:57:53.866606 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 09:57:53.866975 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 09:57:53.867184 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 09:57:53.870625 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 09:57:53.873336 (Thread-1): finished collecting timing info
2022-02-08 09:57:53.873800 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-08 09:57:53.876154 (Thread-1): 12:57:53 | 10 of 18 OK created incremental model public.sat_wheat_gbp_details... [INSERT 0 0 in 0.28s]
2022-02-08 09:57:53.876649 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 09:57:53.877082 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 09:57:53.878065 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 09:57:53.880557 (Thread-1): 12:57:53 | 12 of 18 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-08 09:57:53.888371 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 09:57:53.889371 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 09:57:53.889824 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-08 09:57:53.890488 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 09:57:53.897686 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 09:57:53.903509 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 09:57:53.909283 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp125753821726'
        
      order by ordinal_position

  
2022-02-08 09:57:53.923029 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 09:57:53.923886 (Thread-1): finished collecting timing info
2022-02-08 09:57:53.931289 (Thread-2): SQL status: SELECT 4 in 0.02 seconds
2022-02-08 09:57:53.936392 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 09:57:53.942286 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 09:57:53.942707 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp125753934177"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 09:57:53.943121 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:53.943459 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 09:57:53.951676 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 09:57:54.038887 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 09:57:54.039565 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:54.048406 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 09:57:54.050639 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 09:57:54.052194 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 09:57:54.052658 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp125753821726"
    );
  
2022-02-08 09:57:54.055438 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 09:57:54.059473 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 09:57:54.060203 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 09:57:54.060705 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 09:57:54.067334 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 09:57:54.070652 (Thread-2): finished collecting timing info
2022-02-08 09:57:54.071139 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-08 09:57:54.073742 (Thread-2): 12:57:54 | 11 of 18 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.30s]
2022-02-08 09:57:54.074149 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 09:57:54.074585 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 09:57:54.078748 (Thread-2): 12:57:54 | 13 of 18 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-08 09:57:54.080366 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 09:57:54.081240 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-08 09:57:54.087608 (Thread-1): SQL status: SELECT 0 in 0.14 seconds
2022-02-08 09:57:54.108695 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 09:57:54.113223 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 09:57:54.113762 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-08 09:57:54.115490 (Thread-2): finished collecting timing info
2022-02-08 09:57:54.122650 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 09:57:54.128490 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 09:57:54.132202 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 09:57:54.133071 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp125754129872"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 09:57:54.133210 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 09:57:54.132642 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp125753934177'
        
      order by ordinal_position

  
2022-02-08 09:57:54.152938 (Thread-1): SQL status: SELECT 12 in 0.02 seconds
2022-02-08 09:57:54.164517 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 09:57:54.164994 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:54.174779 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 09:57:54.184919 (Thread-2): SQL status: SELECT 0 in 0.05 seconds
2022-02-08 09:57:54.187152 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 09:57:54.197911 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 09:57:54.198959 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-08 09:57:54.198403 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:54.201524 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 09:57:54.201962 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 09:57:54.202244 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp125754129872'
        
      order by ordinal_position

  
2022-02-08 09:57:54.209839 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 09:57:54.212831 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 09:57:54.214214 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 09:57:54.214837 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp125753934177"
    );
  
2022-02-08 09:57:54.217843 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 09:57:54.220432 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 09:57:54.220822 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 09:57:54.221096 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 09:57:54.226192 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 09:57:54.231817 (Thread-1): finished collecting timing info
2022-02-08 09:57:54.232530 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-08 09:57:54.236430 (Thread-1): 12:57:54 | 12 of 18 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.34s]
2022-02-08 09:57:54.237125 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 09:57:54.237735 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 09:57:54.241577 (Thread-1): 12:57:54 | 14 of 18 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-08 09:57:54.244196 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 09:57:54.245074 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 09:57:54.245537 (Thread-2): SQL status: SELECT 4 in 0.04 seconds
2022-02-08 09:57:54.270860 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 09:57:54.277059 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:54.297323 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 09:57:54.310002 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 09:57:54.314606 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 09:57:54.315426 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:54.316326 (Thread-1): finished collecting timing info
2022-02-08 09:57:54.329011 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 09:57:54.331090 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 09:57:54.339471 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 09:57:54.340050 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp125754335306"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 09:57:54.340439 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 09:57:54.340876 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 09:57:54.341815 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp125754129872"
    );
  
2022-02-08 09:57:54.344973 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 09:57:54.347771 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 09:57:54.348234 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 09:57:54.348531 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 09:57:54.353602 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 09:57:54.359209 (Thread-2): finished collecting timing info
2022-02-08 09:57:54.363462 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-08 09:57:54.372761 (Thread-2): 12:57:54 | 13 of 18 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.29s]
2022-02-08 09:57:54.374144 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 09:57:54.375449 (Thread-2): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 09:57:54.379124 (Thread-2): 12:57:54 | 15 of 18 START table model public.dds_rate_gbp_usd................... [RUN]
2022-02-08 09:57:54.380380 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 09:57:54.381007 (Thread-2): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 09:57:54.402678 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 09:57:54.403617 (Thread-1): SQL status: SELECT 0 in 0.06 seconds
2022-02-08 09:57:54.412598 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 09:57:54.413122 (Thread-2): finished collecting timing info
2022-02-08 09:57:54.413854 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-08 09:57:54.432484 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 09:57:54.432961 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 09:57:54.433367 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 09:57:54.433717 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 09:57:54.434508 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 09:57:54.434910 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp125754335306'
        
      order by ordinal_position

  
2022-02-08 09:57:54.452582 (Thread-1): SQL status: SELECT 11 in 0.02 seconds
2022-02-08 09:57:54.465986 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 09:57:54.466599 (Thread-2): SQL status: DROP TABLE in 0.03 seconds
2022-02-08 09:57:54.467128 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:54.477046 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 09:57:54.477895 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 09:57:54.480581 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 09:57:54.485768 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 09:57:54.487087 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 09:57:54.487495 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-08 09:57:54.489719 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 09:57:54.490195 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 09:57:54.501465 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 09:57:54.502703 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 09:57:54.503125 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */


  create  table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp"
  as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );
2022-02-08 09:57:54.503655 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 09:57:54.513192 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 09:57:54.516169 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 09:57:54.517624 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 09:57:54.518101 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp125754335306"
    );
  
2022-02-08 09:57:54.521149 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 09:57:54.524008 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 09:57:54.524629 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 09:57:54.525109 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 09:57:54.529816 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 09:57:54.534249 (Thread-1): finished collecting timing info
2022-02-08 09:57:54.535175 (Thread-2): SQL status: SELECT 548 in 0.03 seconds
2022-02-08 09:57:54.535686 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-08 09:57:54.549593 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 09:57:54.553371 (Thread-1): 12:57:54 | 14 of 18 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.31s]
2022-02-08 09:57:54.553863 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd" rename to "dds_rate_gbp_usd__dbt_backup"
2022-02-08 09:57:54.554785 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 09:57:54.556052 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 09:57:54.560838 (Thread-1): 12:57:54 | 16 of 18 START table model public.dds_wheat_msk...................... [RUN]
2022-02-08 09:57:54.562174 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 09:57:54.563527 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 09:57:54.573089 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 09:57:54.573698 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-08 09:57:54.574256 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-08 09:57:54.594302 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 09:57:54.599374 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 09:57:54.601944 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 09:57:54.603156 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 09:57:54.603850 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 09:57:54.604343 (Thread-1): finished collecting timing info
2022-02-08 09:57:54.619234 (Thread-2): SQL status: COMMIT in 0.02 seconds
2022-02-08 09:57:54.624500 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 09:57:54.629503 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 09:57:54.630171 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-08 09:57:54.630658 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 09:57:54.631484 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 09:57:54.644349 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 09:57:54.648620 (Thread-2): finished collecting timing info
2022-02-08 09:57:54.649184 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-08 09:57:54.653502 (Thread-2): 12:57:54 | 15 of 18 OK created table model public.dds_rate_gbp_usd.............. [SELECT 548 in 0.27s]
2022-02-08 09:57:54.654759 (Thread-2): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 09:57:54.656760 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 09:57:54.659321 (Thread-2): 12:57:54 | 17 of 18 START table model public.dds_wheat_usa...................... [RUN]
2022-02-08 09:57:54.660395 (Thread-1): SQL status: DROP TABLE in 0.03 seconds
2022-02-08 09:57:54.661684 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 09:57:54.670064 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 09:57:54.670607 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_usa
2022-02-08 09:57:54.671377 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 09:57:54.692065 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 09:57:54.692423 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 09:57:54.696321 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 09:57:54.696789 (Thread-2): finished collecting timing info
2022-02-08 09:57:54.711797 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 09:57:54.712365 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 09:57:54.712805 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_tmp" cascade
2022-02-08 09:57:54.713345 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-08 09:57:54.713791 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 09:57:54.717113 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 09:57:54.717704 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 09:57:54.718266 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */


  create  table "postgres"."public"."dds_wheat_msk__dbt_tmp"
  as (
    with dds_wheat_msk as(
    select cast(su.tradedate as date) as tradedate
        ,date_trunc('month', cast(su.tradedate as date)) as trademonth
        ,date_trunc('year', cast(su.tradedate as date)) as tradeyear
        ,hu.date_pk
        ,case when su.value=0 and su.volume>0 then cast(su.volume*su.close as decimal(18,2))
            else cast(su.value as decimal(18,2))
            end as value_all
        ,cast(su.open as decimal(18,2)) as open
        ,cast(su.close as decimal(18,2)) as close
        ,cast(su.high as decimal(18,2)) as high
        ,cast(su.low as decimal(18,2)) as low
        ,cast(su.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hu
    left join "postgres"."public"."sat_wheat_msk_details" as su
    on hu.date_pk=su.date_pk
)
select * from dds_wheat_msk
  );
2022-02-08 09:57:54.733327 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 09:57:54.741403 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 09:57:54.741849 (Thread-1): SQL status: SELECT 216 in 0.02 seconds
2022-02-08 09:57:54.742325 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 09:57:54.754062 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 09:57:54.754500 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-08 09:57:54.756319 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 09:57:54.759645 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 09:57:54.760184 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 09:57:54.773967 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 09:57:54.774471 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-08 09:57:54.774965 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 09:57:54.775674 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: BEGIN
2022-02-08 09:57:54.778337 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 09:57:54.778799 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 09:57:54.779265 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 09:57:54.782110 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 09:57:54.782783 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */


  create  table "postgres"."public"."dds_wheat_usa__dbt_tmp"
  as (
    with usa as (
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,date_trunc('month', cast(to_date(su.tradedate, 'DD.MM.YYYY') as date)) as trademonth
        ,date_trunc('year', cast(to_date(su.tradedate, 'DD.MM.YYYY') as date)) as tradeyear
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0/2.7 as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_usa" as hu
    left join "postgres"."public"."sat_wheat_usa_details" as su
    on hu.date_pk=su.date_pk
)
select * from usa
  );
2022-02-08 09:57:54.783410 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 09:57:54.784213 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 09:57:54.789453 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 09:57:54.795554 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 09:57:54.795971 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 09:57:54.805949 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 09:57:54.812551 (Thread-1): finished collecting timing info
2022-02-08 09:57:54.813238 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-08 09:57:54.817992 (Thread-1): 12:57:54 | 16 of 18 OK created table model public.dds_wheat_msk................. [SELECT 216 in 0.25s]
2022-02-08 09:57:54.818433 (Thread-2): SQL status: SELECT 547 in 0.03 seconds
2022-02-08 09:57:54.819090 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 09:57:54.831037 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 09:57:54.835248 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 09:57:54.837871 (Thread-1): 12:57:54 | 18 of 18 START table model public.dds_wheat_gbp...................... [RUN]
2022-02-08 09:57:54.838808 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa" rename to "dds_wheat_usa__dbt_backup"
2022-02-08 09:57:54.840771 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 09:57:54.841887 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_gbp
2022-02-08 09:57:54.849731 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 09:57:54.868571 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 09:57:54.870759 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 09:57:54.871148 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa__dbt_tmp" rename to "dds_wheat_usa"
2022-02-08 09:57:54.872650 (Thread-1): finished collecting timing info
2022-02-08 09:57:54.880495 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 09:57:54.885173 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 09:57:54.887774 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 09:57:54.888474 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_tmp" cascade
2022-02-08 09:57:54.890151 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 09:57:54.890691 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 09:57:54.891232 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 09:57:54.897043 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 09:57:54.904638 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 09:57:54.905167 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 09:57:54.911323 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 09:57:54.916042 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 09:57:54.916415 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 09:57:54.916777 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 09:57:54.923107 (Thread-2): finished collecting timing info
2022-02-08 09:57:54.924427 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: Close
2022-02-08 09:57:54.930088 (Thread-2): 12:57:54 | 17 of 18 OK created table model public.dds_wheat_usa................. [SELECT 547 in 0.27s]
2022-02-08 09:57:54.930524 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 09:57:54.931066 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 09:57:54.934616 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 09:57:54.937421 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 09:57:54.937810 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: BEGIN
2022-02-08 09:57:54.940271 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 09:57:54.940838 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 09:57:54.941241 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */


  create  table "postgres"."public"."dds_wheat_gbp__dbt_tmp"
  as (
    with gbp as(
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,date_trunc('month', cast(to_date(su.tradedate, 'DD.MM.YYYY') as date)) as trademonth
        ,date_trunc('year', cast(to_date(su.tradedate, 'DD.MM.YYYY') as date)) as tradeyear
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0*rt.rate as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_gbp" as hu
    left join "postgres"."public"."sat_wheat_gbp_details" as su
    on hu.date_pk=su.date_pk
    left join "postgres"."public"."dds_rate_gbp_usd" as rt
    on hu.date_pk=rt.date_pk
)
select * from gbp
  );
2022-02-08 09:57:54.971794 (Thread-1): SQL status: SELECT 531 in 0.03 seconds
2022-02-08 09:57:54.978442 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 09:57:54.978732 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp" rename to "dds_wheat_gbp__dbt_backup"
2022-02-08 09:57:54.980902 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 09:57:54.988867 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 09:57:54.989287 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp__dbt_tmp" rename to "dds_wheat_gbp"
2022-02-08 09:57:54.992245 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 09:57:54.994195 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 09:57:54.994469 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 09:57:54.994571 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 09:57:54.998405 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 09:57:55.004078 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 09:57:55.004459 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 09:57:55.012797 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 09:57:55.022603 (Thread-1): finished collecting timing info
2022-02-08 09:57:55.023419 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: Close
2022-02-08 09:57:55.028423 (Thread-1): 12:57:55 | 18 of 18 OK created table model public.dds_wheat_gbp................. [SELECT 531 in 0.19s]
2022-02-08 09:57:55.029021 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 09:57:55.033949 (MainThread): Acquiring new postgres connection "master".
2022-02-08 09:57:55.034417 (MainThread): Using postgres connection "master".
2022-02-08 09:57:55.034804 (MainThread): On master: BEGIN
2022-02-08 09:57:55.035142 (MainThread): Opening a new connection, currently in state closed
2022-02-08 09:57:55.058910 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-08 09:57:55.059522 (MainThread): On master: COMMIT
2022-02-08 09:57:55.059975 (MainThread): Using postgres connection "master".
2022-02-08 09:57:55.060427 (MainThread): On master: COMMIT
2022-02-08 09:57:55.062918 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 09:57:55.063487 (MainThread): On master: Close
2022-02-08 09:57:55.065018 (MainThread): 12:57:55 | 
2022-02-08 09:57:55.065575 (MainThread): 12:57:55 | Finished running 4 view models, 6 table models, 8 incremental models in 4.65s.
2022-02-08 09:57:55.066073 (MainThread): Connection 'master' was properly closed.
2022-02-08 09:57:55.066495 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_gbp' was properly closed.
2022-02-08 09:57:55.066852 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_usa' was properly closed.
2022-02-08 09:57:55.301170 (MainThread): 
2022-02-08 09:57:55.302037 (MainThread): Completed successfully
2022-02-08 09:57:55.303529 (MainThread): 
Done. PASS=18 WARN=0 ERROR=0 SKIP=0 TOTAL=18
2022-02-08 09:57:55.305536 (MainThread): Flushing usage events
2022-02-08 10:05:50.562704 (MainThread): Running with dbt=0.19.0
2022-02-08 10:05:50.742977 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-08 10:05:50.745427 (MainThread): Tracking: do not track
2022-02-08 10:05:50.901087 (MainThread): Partial parsing not enabled
2022-02-08 10:05:50.903055 (MainThread): Parsing macros/adapters.sql
2022-02-08 10:05:50.942728 (MainThread): Parsing macros/catalog.sql
2022-02-08 10:05:50.946450 (MainThread): Parsing macros/relations.sql
2022-02-08 10:05:50.948611 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-08 10:05:50.953407 (MainThread): Parsing macros/core.sql
2022-02-08 10:05:50.959360 (MainThread): Parsing macros/adapters/common.sql
2022-02-08 10:05:51.049588 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-08 10:05:51.054275 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-08 10:05:51.058273 (MainThread): Parsing macros/etc/datetime.sql
2022-02-08 10:05:51.077831 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-08 10:05:51.080537 (MainThread): Parsing macros/etc/query.sql
2022-02-08 10:05:51.082297 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-08 10:05:51.083936 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-08 10:05:51.097165 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-08 10:05:51.129982 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-08 10:05:51.133668 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-08 10:05:51.189172 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-08 10:05:51.238223 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-08 10:05:51.256903 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-08 10:05:51.263780 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-08 10:05:51.287064 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-08 10:05:51.295608 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-08 10:05:51.306647 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-08 10:05:51.317576 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-08 10:05:51.320299 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-08 10:05:51.322740 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-08 10:05:51.325542 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-08 10:05:51.331643 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-08 10:05:51.334323 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-08 10:05:51.337459 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-08 10:05:51.339220 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-08 10:05:51.353647 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-08 10:05:51.356923 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-08 10:05:51.361073 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-08 10:05:51.368693 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-08 10:05:51.371245 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-08 10:05:51.377567 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-08 10:05:51.386091 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-08 10:05:51.391011 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-08 10:05:51.393954 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-08 10:05:51.397652 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-08 10:05:51.407682 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-08 10:05:51.412934 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-08 10:05:51.416750 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-08 10:05:51.418716 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-08 10:05:51.421428 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-08 10:05:51.423885 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-08 10:05:51.426123 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-08 10:05:51.434085 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-08 10:05:51.436077 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-08 10:05:51.438681 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-08 10:05:51.442135 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-08 10:05:51.446352 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-08 10:05:51.449007 (MainThread): Parsing macros/sql/star.sql
2022-02-08 10:05:51.455412 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-08 10:05:51.458729 (MainThread): Parsing macros/sql/pivot.sql
2022-02-08 10:05:51.465215 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-08 10:05:51.468017 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-08 10:05:51.480754 (MainThread): Parsing macros/sql/union.sql
2022-02-08 10:05:51.493688 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-08 10:05:51.496738 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-08 10:05:51.504012 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-08 10:05:51.510136 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-08 10:05:51.516240 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-08 10:05:51.535165 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-08 10:05:51.547654 (MainThread): Parsing macros/sql/groupby.sql
2022-02-08 10:05:51.551833 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-08 10:05:51.556526 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-08 10:05:51.562890 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-08 10:05:51.573321 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-08 10:05:51.577033 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-08 10:05:51.580618 (MainThread): Parsing macros/logger/log_info.sql
2022-02-08 10:05:51.584384 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-08 10:05:51.629232 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-08 10:05:51.638070 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-08 10:05:51.646474 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-08 10:05:51.652786 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-08 10:05:51.657923 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-08 10:05:51.668033 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-08 10:05:51.674162 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-08 10:05:51.678854 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-08 10:05:51.681782 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-08 10:05:51.684657 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-08 10:05:51.688267 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-08 10:05:51.694013 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-08 10:05:51.697426 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-08 10:05:51.706514 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-08 10:05:51.711229 (MainThread): Parsing macros/internal/alias.sql
2022-02-08 10:05:51.721472 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-08 10:05:51.724309 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-08 10:05:51.730283 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-08 10:05:51.735934 (MainThread): Parsing macros/internal/multikey.sql
2022-02-08 10:05:51.746179 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-08 10:05:51.761216 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-08 10:05:51.766418 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-08 10:05:51.767280 (MainThread): Parsing macros/tables/hub.sql
2022-02-08 10:05:51.783776 (MainThread): Parsing macros/tables/link.sql
2022-02-08 10:05:51.800565 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-08 10:05:51.819946 (MainThread): Parsing macros/tables/sat.sql
2022-02-08 10:05:51.834627 (MainThread): Parsing macros/tables/t_link.sql
2022-02-08 10:05:51.841816 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-08 10:05:51.870056 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-08 10:05:51.881991 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-08 10:05:51.912787 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-08 10:05:51.915319 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-08 10:05:51.947994 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-08 10:05:51.958277 (MainThread): Parsing macros/supporting/hash.sql
2022-02-08 10:05:51.969931 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-08 10:05:51.972324 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-08 10:05:51.982474 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-08 10:05:51.986398 (MainThread): Parsing macros/staging/stage.sql
2022-02-08 10:05:52.003193 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-08 10:05:52.018806 (MainThread): Partial parsing not enabled
2022-02-08 10:05:52.138985 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:05:52.513336 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:05:52.551604 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:05:52.590089 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:05:52.633638 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:05:52.710796 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:05:52.743956 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:05:52.791955 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:05:52.832529 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:05:53.013744 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:05:53.045083 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:05:53.074948 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:05:53.103855 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:05:53.120553 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:05:53.138906 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:05:53.158487 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:05:53.179590 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:05:53.227488 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:05:54.686862 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.raw_vault.links
- models.project_otus_dbt.report

2022-02-08 10:05:54.896004 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-08 10:05:54.898127 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-08 10:05:54.906769 (MainThread): 
2022-02-08 10:05:54.908924 (MainThread): Acquiring new postgres connection "master".
2022-02-08 10:05:54.970969 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-08 10:05:54.997967 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-08 10:05:54.998368 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-08 10:05:54.998784 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-08 10:05:55.055700 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.06 seconds
2022-02-08 10:05:55.059784 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-08 10:05:55.103674 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-08 10:05:55.113104 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 10:05:55.113422 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-08 10:05:55.113561 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-08 10:05:55.130381 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-02-08 10:05:55.130714 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 10:05:55.130831 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-08 10:05:55.143358 (ThreadPoolExecutor-1_0): SQL status: SELECT 25 in 0.01 seconds
2022-02-08 10:05:55.169424 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-08 10:05:55.171473 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-08 10:05:55.265284 (MainThread): Using postgres connection "master".
2022-02-08 10:05:55.265692 (MainThread): On master: BEGIN
2022-02-08 10:05:55.265884 (MainThread): Opening a new connection, currently in state init
2022-02-08 10:05:55.288280 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-08 10:05:55.288726 (MainThread): Using postgres connection "master".
2022-02-08 10:05:55.289024 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-08 10:05:55.897288 (MainThread): SQL status: SELECT 10 in 0.61 seconds
2022-02-08 10:05:55.929615 (MainThread): On master: ROLLBACK
2022-02-08 10:05:55.932041 (MainThread): Using postgres connection "master".
2022-02-08 10:05:55.932782 (MainThread): On master: BEGIN
2022-02-08 10:05:55.937426 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:05:55.938093 (MainThread): On master: COMMIT
2022-02-08 10:05:55.938732 (MainThread): Using postgres connection "master".
2022-02-08 10:05:55.939159 (MainThread): On master: COMMIT
2022-02-08 10:05:55.941316 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:05:55.941928 (MainThread): On master: Close
2022-02-08 10:05:55.943192 (MainThread): 13:05:55 | Concurrency: 2 threads (target='dev')
2022-02-08 10:05:55.943790 (MainThread): 13:05:55 | 
2022-02-08 10:05:55.954060 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 10:05:55.954515 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 10:05:55.956955 (Thread-1): 13:05:55 | 1 of 18 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-08 10:05:55.959278 (Thread-2): 13:05:55 | 2 of 18 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-08 10:05:55.960291 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:05:55.961393 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:05:55.961860 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 10:05:55.962300 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 10:05:56.059018 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:05:56.060446 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:05:56.060806 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-08 10:05:56.061154 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-08 10:05:56.061493 (Thread-2): Opening a new connection, currently in state init
2022-02-08 10:05:56.061813 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:05:56.081507 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-08 10:05:56.082016 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:05:56.082457 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:56.091022 (Thread-2): SQL status: BEGIN in 0.03 seconds
2022-02-08 10:05:56.091510 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:05:56.091883 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:56.104554 (Thread-1): SQL status: SELECT 6 in 0.02 seconds
2022-02-08 10:05:56.115086 (Thread-2): SQL status: SELECT 7 in 0.02 seconds
2022-02-08 10:05:56.236717 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:05:56.238679 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:05:56.239024 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:56.239403 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:56.264622 (Thread-1): SQL status: SELECT 6 in 0.02 seconds
2022-02-08 10:05:56.265177 (Thread-2): SQL status: SELECT 7 in 0.03 seconds
2022-02-08 10:05:56.284193 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 10:05:56.288572 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 10:05:56.289564 (Thread-1): finished collecting timing info
2022-02-08 10:05:56.295745 (Thread-2): finished collecting timing info
2022-02-08 10:05:56.384401 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:05:56.387650 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:05:56.388040 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 10:05:56.388417 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-08 10:05:56.391041 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:05:56.391484 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:05:56.396288 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:05:56.401477 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:05:56.402062 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 10:05:56.402499 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 10:05:56.406101 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:05:56.412077 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 10:05:56.416072 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 10:05:56.419789 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 10:05:56.421560 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:05:56.422025 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 10:05:56.422525 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:05:56.423205 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 10:05:56.439077 (Thread-2): SQL status: CREATE VIEW in 0.02 seconds
2022-02-08 10:05:56.467278 (Thread-1): SQL status: CREATE VIEW in 0.04 seconds
2022-02-08 10:05:56.470494 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:05:56.481785 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-08 10:05:56.481374 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:05:56.485080 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-08 10:05:56.488628 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 10:05:56.495913 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 10:05:56.496381 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:05:56.504174 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:05:56.504651 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-08 10:05:56.505263 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-08 10:05:56.508846 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:05:56.509413 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:05:56.536124 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 10:05:56.536988 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 10:05:56.537550 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:05:56.538122 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:05:56.538697 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 10:05:56.539319 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 10:05:56.571787 (Thread-1): SQL status: COMMIT in 0.03 seconds
2022-02-08 10:05:56.572148 (Thread-2): SQL status: COMMIT in 0.03 seconds
2022-02-08 10:05:56.584429 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:05:56.588635 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:05:56.589062 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 10:05:56.589391 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 10:05:56.596430 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 10:05:56.603089 (Thread-2): finished collecting timing info
2022-02-08 10:05:56.603788 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 10:05:56.604078 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-08 10:05:56.608074 (Thread-1): finished collecting timing info
2022-02-08 10:05:56.608836 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-08 10:05:56.611638 (Thread-2): 13:05:56 | 2 of 18 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.65s]
2022-02-08 10:05:56.615229 (Thread-1): 13:05:56 | 1 of 18 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.65s]
2022-02-08 10:05:56.615896 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 10:05:56.616910 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 10:05:56.617827 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 10:05:56.620091 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 10:05:56.624195 (Thread-2): 13:05:56 | 3 of 18 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-08 10:05:56.626773 (Thread-1): 13:05:56 | 4 of 18 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-08 10:05:56.627783 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:05:56.628757 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:05:56.629313 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 10:05:56.629908 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 10:05:56.679640 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:05:56.685111 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:05:56.685598 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-08 10:05:56.686089 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-08 10:05:56.686510 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:05:56.686931 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:05:56.707654 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-08 10:05:56.708065 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:05:56.708285 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:56.729147 (Thread-1): SQL status: BEGIN in 0.04 seconds
2022-02-08 10:05:56.729591 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:05:56.729948 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:56.772571 (Thread-2): SQL status: SELECT 18 in 0.06 seconds
2022-02-08 10:05:56.793987 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:05:56.794523 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:56.818961 (Thread-2): SQL status: SELECT 18 in 0.02 seconds
2022-02-08 10:05:56.834040 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 10:05:56.834989 (Thread-2): finished collecting timing info
2022-02-08 10:05:56.848596 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:05:56.848968 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-08 10:05:56.852717 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:05:56.857941 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:05:56.858262 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 10:05:56.860082 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:05:56.861971 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 10:05:56.863019 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:05:56.863518 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 10:05:56.868503 (Thread-1): SQL status: SELECT 7 in 0.14 seconds
2022-02-08 10:05:56.878106 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:05:56.878475 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:56.892624 (Thread-2): SQL status: CREATE VIEW in 0.03 seconds
2022-02-08 10:05:56.900795 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:05:56.901140 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-08 10:05:56.903981 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:05:56.908120 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:05:56.908631 (Thread-1): SQL status: SELECT 7 in 0.03 seconds
2022-02-08 10:05:56.909049 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-08 10:05:56.921846 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 10:05:56.922581 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:05:56.926538 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 10:05:56.927205 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:05:56.927778 (Thread-1): finished collecting timing info
2022-02-08 10:05:56.928743 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 10:05:56.943916 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:05:56.944235 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-08 10:05:56.946197 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:05:56.946683 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:05:56.951215 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:05:56.955860 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 10:05:56.955421 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:05:56.956271 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 10:05:56.957926 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:05:56.959978 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 10:05:56.960885 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:05:56.961168 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 10:05:56.966234 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 10:05:56.970200 (Thread-2): finished collecting timing info
2022-02-08 10:05:56.971011 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-08 10:05:56.974190 (Thread-2): 13:05:56 | 3 of 18 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.34s]
2022-02-08 10:05:56.974631 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 10:05:56.975096 (Thread-2): Began running node model.project_otus_dbt.dim_day
2022-02-08 10:05:56.978116 (Thread-2): 13:05:56 | 5 of 18 START table model public.dim_day............................. [RUN]
2022-02-08 10:05:56.979779 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:05:56.981402 (Thread-2): Compiling model.project_otus_dbt.dim_day
2022-02-08 10:05:56.987203 (Thread-1): SQL status: CREATE VIEW in 0.03 seconds
2022-02-08 10:05:56.998249 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 10:05:57.003854 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:05:57.004814 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-08 10:05:57.005347 (Thread-2): finished collecting timing info
2022-02-08 10:05:57.012908 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 10:05:57.034087 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:05:57.039743 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-08 10:05:57.054962 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 10:05:57.062536 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 10:05:57.068595 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:05:57.071442 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:05:57.071872 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 10:05:57.072248 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-08 10:05:57.072920 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:05:57.076079 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:05:57.082987 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:05:57.083452 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 10:05:57.091250 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 10:05:57.096539 (Thread-1): finished collecting timing info
2022-02-08 10:05:57.097040 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 10:05:57.097452 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-08 10:05:57.102542 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:05:57.103235 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 10:05:57.106168 (Thread-1): 13:05:57 | 4 of 18 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.48s]
2022-02-08 10:05:57.107593 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 10:05:57.108642 (Thread-1): Began running node model.project_otus_dbt.dim_week
2022-02-08 10:05:57.109647 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:05:57.113298 (Thread-1): 13:05:57 | 6 of 18 START table model public.dim_week............................ [RUN]
2022-02-08 10:05:57.130589 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:05:57.131080 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 10:05:57.131642 (Thread-1): Compiling model.project_otus_dbt.dim_week
2022-02-08 10:05:57.160507 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 10:05:57.161458 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:05:57.162131 (Thread-2): On model.project_otus_dbt.dim_day: BEGIN
2022-02-08 10:05:57.165294 (Thread-1): finished collecting timing info
2022-02-08 10:05:57.166246 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:05:57.177676 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:05:57.189019 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        date_trunc('week' , date) as first_day_week,
        extract('week' from date) as week_id,
        extract('year' from date)*100+extract('week' from date) as yearweek_id,

        to_char(date, 'MON') as day,
        extract('month' from date) as moth_id,
        extract('year' from date)*100+extract('month' from date) as yearmonth_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
    from generate_series(date '2012-01-01',
                         date '2025-12-31',
                         interval '1 day')
             as t(date)
)

select * from dim_day
order by date desc
  );
2022-02-08 10:05:57.197698 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:05:57.198217 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-08 10:05:57.198650 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:05:57.199137 (Thread-2): Postgres error: column "day" specified more than once

2022-02-08 10:05:57.200133 (Thread-2): On model.project_otus_dbt.dim_day: ROLLBACK
2022-02-08 10:05:57.202803 (Thread-2): finished collecting timing info
2022-02-08 10:05:57.204347 (Thread-2): On model.project_otus_dbt.dim_day: Close
2022-02-08 10:05:57.225876 (Thread-1): SQL status: DROP TABLE in 0.03 seconds
2022-02-08 10:05:57.234022 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:05:57.235384 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 10:05:57.238510 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:05:57.242431 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 10:05:57.243578 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:05:57.244188 (Thread-1): On model.project_otus_dbt.dim_week: BEGIN
2022-02-08 10:05:57.246514 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:05:57.206270 (Thread-2): Database Error in model dim_day (models/dim/dim_day.sql)
  column "day" specified more than once
  compiled SQL at target/run/project_otus_dbt/models/dim/dim_day.sql
Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.DuplicateColumn: column "day" specified more than once


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 63, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/rusedr/.local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model dim_day (models/dim/dim_day.sql)
  column "day" specified more than once
  compiled SQL at target/run/project_otus_dbt/models/dim/dim_day.sql
2022-02-08 10:05:57.247583 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:05:57.251280 (Thread-2): 13:05:57 | 5 of 18 ERROR creating table model public.dim_day.................... [ERROR in 0.27s]
2022-02-08 10:05:57.251923 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-08 10:05:57.252733 (Thread-2): Finished running node model.project_otus_dbt.dim_day
2022-02-08 10:05:57.254497 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 10:05:57.264904 (Thread-2): 13:05:57 | 7 of 18 START incremental model public.hub_wheat_gbp................. [RUN]
2022-02-08 10:05:57.268726 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:05:57.269432 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-08 10:05:57.299344 (Thread-1): SQL status: SELECT 731 in 0.05 seconds
2022-02-08 10:05:57.325920 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:05:57.331927 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-08 10:05:57.345874 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 10:05:57.350410 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 10:05:57.358407 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:05:57.359211 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-08 10:05:57.360052 (Thread-2): finished collecting timing info
2022-02-08 10:05:57.372474 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 10:05:57.376237 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 10:05:57.381953 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:05:57.387679 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 10:05:57.403615 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:05:57.420553 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:05:57.426147 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 10:05:57.442961 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:05:57.446212 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:05:57.450165 (Thread-1): finished collecting timing info
2022-02-08 10:05:57.450809 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp130557439416"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:05:57.451310 (Thread-1): On model.project_otus_dbt.dim_week: Close
2022-02-08 10:05:57.451715 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:05:57.456905 (Thread-1): 13:05:57 | 6 of 18 OK created table model public.dim_week....................... [SELECT 731 in 0.32s]
2022-02-08 10:05:57.457537 (Thread-1): Finished running node model.project_otus_dbt.dim_week
2022-02-08 10:05:57.458308 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 10:05:57.462341 (Thread-1): 13:05:57 | 8 of 18 START incremental model public.sat_wheat_gbp_details......... [RUN]
2022-02-08 10:05:57.463468 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:05:57.463927 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 10:05:57.497213 (Thread-2): SQL status: SELECT 0 in 0.05 seconds
2022-02-08 10:05:57.512340 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 10:05:57.513456 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:05:57.514395 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-08 10:05:57.515481 (Thread-1): finished collecting timing info
2022-02-08 10:05:57.522664 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 10:05:57.534056 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:05:57.540269 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp130557439416'
        
      order by ordinal_position

  
2022-02-08 10:05:57.555219 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:05:57.555781 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp130557548981"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:05:57.556154 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:05:57.602019 (Thread-2): SQL status: SELECT 4 in 0.06 seconds
2022-02-08 10:05:57.610130 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:05:57.610525 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:57.627931 (Thread-2): SQL status: SELECT 4 in 0.02 seconds
2022-02-08 10:05:57.645984 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:05:57.646369 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:57.654378 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:05:57.657583 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 10:05:57.658590 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:05:57.658949 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp130557439416"
    );
  
2022-02-08 10:05:57.661388 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:05:57.666780 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 10:05:57.667108 (Thread-1): SQL status: SELECT 0 in 0.11 seconds
2022-02-08 10:05:57.667363 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:05:57.673620 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:05:57.673996 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 10:05:57.674284 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-08 10:05:57.676116 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:05:57.676457 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:05:57.676640 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp130557548981'
        
      order by ordinal_position

  
2022-02-08 10:05:57.678674 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:05:57.681489 (Thread-2): finished collecting timing info
2022-02-08 10:05:57.681971 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-08 10:05:57.684505 (Thread-2): 13:05:57 | 7 of 18 OK created incremental model public.hub_wheat_gbp............ [INSERT 0 0 in 0.41s]
2022-02-08 10:05:57.684978 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 10:05:57.685348 (Thread-2): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 10:05:57.687959 (Thread-2): 13:05:57 | 9 of 18 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-08 10:05:57.689118 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:05:57.689811 (Thread-2): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 10:05:57.709035 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 10:05:57.709367 (Thread-1): SQL status: SELECT 11 in 0.03 seconds
2022-02-08 10:05:57.719535 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:05:57.720080 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:57.720538 (Thread-2): finished collecting timing info
2022-02-08 10:05:57.733055 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:05:57.733394 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:05:57.733620 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp130557730344"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:05:57.742211 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:05:57.742626 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:05:57.743014 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:57.753192 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:05:57.755610 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 10:05:57.756632 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:05:57.756862 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp130557548981"
    );
  
2022-02-08 10:05:57.758562 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:05:57.760426 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 10:05:57.760741 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:05:57.760856 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 10:05:57.764265 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:05:57.767412 (Thread-1): finished collecting timing info
2022-02-08 10:05:57.767911 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-08 10:05:57.770689 (Thread-1): 13:05:57 | 8 of 18 OK created incremental model public.sat_wheat_gbp_details.... [INSERT 0 0 in 0.31s]
2022-02-08 10:05:57.771186 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 10:05:57.771612 (Thread-1): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 10:05:57.774938 (Thread-1): 13:05:57 | 10 of 18 START incremental model public.sat_rate_gbp_usd_details..... [RUN]
2022-02-08 10:05:57.776117 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:05:57.776786 (Thread-1): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 10:05:57.786064 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 10:05:57.803462 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:05:57.809632 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-08 10:05:57.817185 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 10:05:57.817527 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:05:57.818081 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:05:57.818304 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp130557730344'
        
      order by ordinal_position

  
2022-02-08 10:05:57.818847 (Thread-1): finished collecting timing info
2022-02-08 10:05:57.832107 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:05:57.832489 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:05:57.832776 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp130557829556"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:05:57.840417 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:05:57.840820 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:05:57.841217 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:57.850314 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:05:57.866805 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:05:57.872221 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:57.885659 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:05:57.887809 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 10:05:57.889026 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:05:57.889541 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp130557730344"
    );
  
2022-02-08 10:05:57.891974 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:05:57.895638 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 10:05:57.897233 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:05:57.898232 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 10:05:57.905100 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:05:57.910022 (Thread-2): finished collecting timing info
2022-02-08 10:05:57.910749 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-08 10:05:57.911449 (Thread-1): SQL status: SELECT 0 in 0.07 seconds
2022-02-08 10:05:57.916498 (Thread-2): 13:05:57 | 9 of 18 OK created incremental model public.hub_rate_gbp_usd......... [INSERT 0 0 in 0.22s]
2022-02-08 10:05:57.926078 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:05:57.926744 (Thread-2): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 10:05:57.927148 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-08 10:05:57.927859 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 10:05:57.931334 (Thread-2): 13:05:57 | 11 of 18 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-08 10:05:57.931794 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:05:57.932875 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:05:57.933412 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:05:57.934077 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-08 10:05:57.934589 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp130557829556'
        
      order by ordinal_position

  
2022-02-08 10:05:57.956929 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 10:05:57.958562 (Thread-2): finished collecting timing info
2022-02-08 10:05:57.966778 (Thread-1): SQL status: SELECT 11 in 0.02 seconds
2022-02-08 10:05:57.985167 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:05:57.988095 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:05:57.988434 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:57.988766 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp130557981331"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:05:57.989317 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:05:57.997285 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:05:58.006902 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:05:58.007416 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:58.014354 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:05:58.017086 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 10:05:58.017891 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:05:58.018178 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp130557829556"
    );
  
2022-02-08 10:05:58.020017 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:05:58.022027 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 10:05:58.022333 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:05:58.022520 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 10:05:58.023207 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-08 10:05:58.029532 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:05:58.029909 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:05:58.030278 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-08 10:05:58.033975 (Thread-1): finished collecting timing info
2022-02-08 10:05:58.034811 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-08 10:05:58.037453 (Thread-1): 13:05:58 | 10 of 18 OK created incremental model public.sat_rate_gbp_usd_details [INSERT 0 0 in 0.26s]
2022-02-08 10:05:58.037799 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:05:58.038425 (Thread-1): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 10:05:58.038834 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:05:58.039404 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 10:05:58.040689 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp130557981331'
        
      order by ordinal_position

  
2022-02-08 10:05:58.043075 (Thread-1): 13:05:58 | 12 of 18 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-08 10:05:58.044263 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:05:58.044619 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 10:05:58.059147 (Thread-2): SQL status: SELECT 4 in 0.02 seconds
2022-02-08 10:05:58.076605 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:05:58.082253 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:58.086992 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 10:05:58.087988 (Thread-1): finished collecting timing info
2022-02-08 10:05:58.103719 (Thread-2): SQL status: SELECT 4 in 0.02 seconds
2022-02-08 10:05:58.107306 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:05:58.118976 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:05:58.119336 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp130558101336"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:05:58.119768 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:58.120209 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:05:58.127499 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:05:58.129795 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 10:05:58.131153 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:05:58.131587 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp130557981331"
    );
  
2022-02-08 10:05:58.134086 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:05:58.137261 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 10:05:58.137618 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:05:58.138136 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 10:05:58.142344 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:05:58.147240 (Thread-2): finished collecting timing info
2022-02-08 10:05:58.148150 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-08 10:05:58.152398 (Thread-2): 13:05:58 | 11 of 18 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.22s]
2022-02-08 10:05:58.153116 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 10:05:58.153860 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 10:05:58.159464 (Thread-2): 13:05:58 | 13 of 18 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-08 10:05:58.161547 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:05:58.162869 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-08 10:05:58.181475 (Thread-1): SQL status: SELECT 0 in 0.06 seconds
2022-02-08 10:05:58.197031 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 10:05:58.200455 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:05:58.201213 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-08 10:05:58.202074 (Thread-2): finished collecting timing info
2022-02-08 10:05:58.303998 (Thread-1): SQL status: BEGIN in 0.10 seconds
2022-02-08 10:05:58.309769 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:05:58.315442 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp130558101336'
        
      order by ordinal_position

  
2022-02-08 10:05:58.319318 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:05:58.319937 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp130558316354"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:05:58.320108 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:05:58.333627 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 10:05:58.342197 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:05:58.342557 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:58.349882 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 10:05:58.357367 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:05:58.357714 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:58.358087 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 10:05:58.365056 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:05:58.365435 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 10:05:58.365730 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-08 10:05:58.367649 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 10:05:58.368778 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:05:58.369076 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp130558101336"
    );
  
2022-02-08 10:05:58.369718 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:05:58.369986 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:05:58.370156 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp130558316354'
        
      order by ordinal_position

  
2022-02-08 10:05:58.371143 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:05:58.372957 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 10:05:58.373245 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:05:58.373350 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 10:05:58.376808 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:05:58.380297 (Thread-1): finished collecting timing info
2022-02-08 10:05:58.380999 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-08 10:05:58.384472 (Thread-1): 13:05:58 | 12 of 18 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.34s]
2022-02-08 10:05:58.385022 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 10:05:58.385475 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 10:05:58.388540 (Thread-1): 13:05:58 | 14 of 18 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-08 10:05:58.390124 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:05:58.390623 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 10:05:58.405461 (Thread-2): SQL status: SELECT 4 in 0.04 seconds
2022-02-08 10:05:58.424651 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:05:58.430339 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:58.431855 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 10:05:58.433118 (Thread-1): finished collecting timing info
2022-02-08 10:05:58.447502 (Thread-2): SQL status: SELECT 4 in 0.02 seconds
2022-02-08 10:05:58.464943 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:05:58.467367 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:05:58.467727 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp130558453412"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:05:58.468111 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:58.468827 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:05:58.476145 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:05:58.478593 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 10:05:58.480595 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:05:58.481131 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp130558316354"
    );
  
2022-02-08 10:05:58.483886 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:05:58.486591 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 10:05:58.487145 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:05:58.487447 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 10:05:58.491347 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:05:58.496040 (Thread-2): finished collecting timing info
2022-02-08 10:05:58.496588 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-08 10:05:58.502171 (Thread-2): 13:05:58 | 13 of 18 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.34s]
2022-02-08 10:05:58.503453 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 10:05:58.505006 (Thread-2): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 10:05:58.510191 (Thread-2): 13:05:58 | 15 of 18 START table model public.dds_rate_gbp_usd................... [RUN]
2022-02-08 10:05:58.511328 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:05:58.511854 (Thread-2): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 10:05:58.520124 (Thread-1): SQL status: SELECT 0 in 0.05 seconds
2022-02-08 10:05:58.537574 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:05:58.538811 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 10:05:58.539165 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-08 10:05:58.540850 (Thread-2): finished collecting timing info
2022-02-08 10:05:58.547263 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 10:05:58.553031 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:05:58.558594 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp130558453412'
        
      order by ordinal_position

  
2022-02-08 10:05:58.560540 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:05:58.561386 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 10:05:58.561932 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:05:58.576267 (Thread-1): SQL status: SELECT 11 in 0.02 seconds
2022-02-08 10:05:58.585359 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:05:58.585982 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:58.588601 (Thread-2): SQL status: DROP TABLE in 0.03 seconds
2022-02-08 10:05:58.595424 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:05:58.595753 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:05:58.595978 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 10:05:58.602526 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:05:58.603104 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:05:58.604530 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:05:58.606646 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 10:05:58.607335 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:05:58.607611 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-08 10:05:58.608535 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:05:58.610446 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 10:05:58.610809 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:05:58.611329 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:05:58.611615 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */


  create  table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp"
  as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );
2022-02-08 10:05:58.611960 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:05:58.612157 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp130558453412"
    );
  
2022-02-08 10:05:58.613824 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:05:58.615849 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 10:05:58.616148 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:05:58.616265 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 10:05:58.619492 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:05:58.622451 (Thread-1): finished collecting timing info
2022-02-08 10:05:58.622917 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-08 10:05:58.625568 (Thread-1): 13:05:58 | 14 of 18 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.23s]
2022-02-08 10:05:58.626000 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 10:05:58.626362 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 10:05:58.629044 (Thread-1): 13:05:58 | 16 of 18 START table model public.dds_wheat_msk...................... [RUN]
2022-02-08 10:05:58.630966 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:05:58.631550 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-08 10:05:58.638758 (Thread-2): SQL status: SELECT 548 in 0.03 seconds
2022-02-08 10:05:58.651768 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 10:05:58.653760 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:05:58.654254 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd" rename to "dds_rate_gbp_usd__dbt_backup"
2022-02-08 10:05:58.654650 (Thread-1): finished collecting timing info
2022-02-08 10:05:58.666900 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 10:05:58.668741 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:05:58.673551 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-08 10:05:58.673718 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:05:58.673099 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:05:58.674402 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-08 10:05:58.677369 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:05:58.680974 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 10:05:58.681637 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:05:58.682203 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 10:05:58.685584 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:05:58.689533 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:05:58.690225 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 10:05:58.693789 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 10:05:58.700897 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:05:58.701348 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:05:58.701702 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 10:05:58.705770 (Thread-2): finished collecting timing info
2022-02-08 10:05:58.706661 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-08 10:05:58.711280 (Thread-2): 13:05:58 | 15 of 18 OK created table model public.dds_rate_gbp_usd.............. [SELECT 548 in 0.20s]
2022-02-08 10:05:58.711728 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:05:58.712517 (Thread-2): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 10:05:58.715221 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 10:05:58.716125 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 10:05:58.719201 (Thread-2): 13:05:58 | 17 of 18 START table model public.dds_wheat_usa...................... [RUN]
2022-02-08 10:05:58.720394 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:05:58.720882 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:05:58.721213 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_usa
2022-02-08 10:05:58.721574 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-08 10:05:58.737905 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 10:05:58.738227 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 10:05:58.738988 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:05:58.739254 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */


  create  table "postgres"."public"."dds_wheat_msk__dbt_tmp"
  as (
    with dds_wheat_msk as(
    select cast(su.tradedate as date) as tradedate
        ,hu.date_pk
        ,case when su.value=0 and su.volume>0 then cast(su.volume*su.close as decimal(18,2))
            else cast(su.value as decimal(18,2))
            end as value_all
        ,cast(su.open as decimal(18,2)) as open
        ,cast(su.close as decimal(18,2)) as close
        ,cast(su.high as decimal(18,2)) as high
        ,cast(su.low as decimal(18,2)) as low
        ,cast(su.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hu
    left join "postgres"."public"."sat_wheat_msk_details" as su
    on hu.date_pk=su.date_pk
)
select * from dds_wheat_msk
  );
2022-02-08 10:05:58.739670 (Thread-2): finished collecting timing info
2022-02-08 10:05:58.759811 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:05:58.760150 (Thread-1): SQL status: SELECT 216 in 0.02 seconds
2022-02-08 10:05:58.760498 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_tmp" cascade
2022-02-08 10:05:58.768510 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:05:58.768887 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:05:58.769214 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-08 10:05:58.772076 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:05:58.781545 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:05:58.781958 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-08 10:05:58.784352 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:05:58.787190 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 10:05:58.787601 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:05:58.787917 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 10:05:58.788272 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 10:05:58.801180 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:05:58.801676 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:05:58.802133 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 10:05:58.809196 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:05:58.810044 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 10:05:58.811631 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:05:58.814843 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 10:05:58.815944 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:05:58.816374 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: BEGIN
2022-02-08 10:05:58.818427 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:05:58.820328 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:05:58.821788 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:05:58.831705 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */


  create  table "postgres"."public"."dds_wheat_usa__dbt_tmp"
  as (
    with usa as (
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0/2.7 as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_usa" as hu
    left join "postgres"."public"."sat_wheat_usa_details" as su
    on hu.date_pk=su.date_pk
)
select * from usa
  );
2022-02-08 10:05:58.830730 (Thread-1): finished collecting timing info
2022-02-08 10:05:58.835528 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-08 10:05:58.844226 (Thread-1): 13:05:58 | 16 of 18 OK created table model public.dds_wheat_msk................. [SELECT 216 in 0.21s]
2022-02-08 10:05:58.860106 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 10:05:58.860959 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 10:05:58.865197 (Thread-1): 13:05:58 | 18 of 18 START table model public.dds_wheat_gbp...................... [RUN]
2022-02-08 10:05:58.866969 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:05:58.867745 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_gbp
2022-02-08 10:05:58.894276 (Thread-2): SQL status: SELECT 547 in 0.06 seconds
2022-02-08 10:05:58.917630 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:05:58.923545 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa" rename to "dds_wheat_usa__dbt_backup"
2022-02-08 10:05:58.935386 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 10:05:58.935956 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 10:05:58.949716 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:05:58.950242 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa__dbt_tmp" rename to "dds_wheat_usa"
2022-02-08 10:05:58.950831 (Thread-1): finished collecting timing info
2022-02-08 10:05:58.958505 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 10:05:58.967558 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 10:05:58.968134 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:05:58.968630 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 10:05:58.979395 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:05:58.989032 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:05:58.991537 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:05:58.992004 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 10:05:58.992483 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_tmp" cascade
2022-02-08 10:05:58.993178 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:05:59.001868 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:05:59.009986 (Thread-2): finished collecting timing info
2022-02-08 10:05:59.011277 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: Close
2022-02-08 10:05:59.019835 (Thread-1): SQL status: DROP TABLE in 0.03 seconds
2022-02-08 10:05:59.019509 (Thread-2): 13:05:59 | 17 of 18 OK created table model public.dds_wheat_usa................. [SELECT 547 in 0.29s]
2022-02-08 10:05:59.026642 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:05:59.027292 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 10:05:59.027674 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 10:05:59.031354 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:05:59.034966 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 10:05:59.035691 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:05:59.035873 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: BEGIN
2022-02-08 10:05:59.037532 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:05:59.037864 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:05:59.038067 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */


  create  table "postgres"."public"."dds_wheat_gbp__dbt_tmp"
  as (
    with gbp as(
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0*rt.rate as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_gbp" as hu
    left join "postgres"."public"."sat_wheat_gbp_details" as su
    on hu.date_pk=su.date_pk
    left join "postgres"."public"."dds_rate_gbp_usd" as rt
    on hu.date_pk=rt.date_pk
)
select * from gbp
  );
2022-02-08 10:05:59.055270 (Thread-1): SQL status: SELECT 531 in 0.02 seconds
2022-02-08 10:05:59.062280 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:05:59.062641 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp" rename to "dds_wheat_gbp__dbt_backup"
2022-02-08 10:05:59.064612 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:05:59.070409 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:05:59.070787 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp__dbt_tmp" rename to "dds_wheat_gbp"
2022-02-08 10:05:59.072702 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:05:59.074718 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 10:05:59.075029 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:05:59.075186 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 10:05:59.078552 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:05:59.082093 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:05:59.082433 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 10:05:59.088308 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:05:59.092592 (Thread-1): finished collecting timing info
2022-02-08 10:05:59.093037 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: Close
2022-02-08 10:05:59.096186 (Thread-1): 13:05:59 | 18 of 18 OK created table model public.dds_wheat_gbp................. [SELECT 531 in 0.23s]
2022-02-08 10:05:59.096673 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 10:05:59.100672 (MainThread): Acquiring new postgres connection "master".
2022-02-08 10:05:59.101143 (MainThread): Using postgres connection "master".
2022-02-08 10:05:59.101410 (MainThread): On master: BEGIN
2022-02-08 10:05:59.101735 (MainThread): Opening a new connection, currently in state closed
2022-02-08 10:05:59.116132 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 10:05:59.116598 (MainThread): On master: COMMIT
2022-02-08 10:05:59.116903 (MainThread): Using postgres connection "master".
2022-02-08 10:05:59.117204 (MainThread): On master: COMMIT
2022-02-08 10:05:59.118940 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:05:59.119286 (MainThread): On master: Close
2022-02-08 10:05:59.120343 (MainThread): 13:05:59 | 
2022-02-08 10:05:59.120781 (MainThread): 13:05:59 | Finished running 4 view models, 6 table models, 8 incremental models in 4.21s.
2022-02-08 10:05:59.121142 (MainThread): Connection 'master' was properly closed.
2022-02-08 10:05:59.121383 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_gbp' was properly closed.
2022-02-08 10:05:59.121621 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_usa' was properly closed.
2022-02-08 10:05:59.374451 (MainThread): 
2022-02-08 10:05:59.375091 (MainThread): Completed with 1 error and 0 warnings:
2022-02-08 10:05:59.375620 (MainThread): 
2022-02-08 10:05:59.376156 (MainThread): Database Error in model dim_day (models/dim/dim_day.sql)
2022-02-08 10:05:59.376961 (MainThread):   column "day" specified more than once
2022-02-08 10:05:59.377578 (MainThread):   compiled SQL at target/run/project_otus_dbt/models/dim/dim_day.sql
2022-02-08 10:05:59.378335 (MainThread): 
Done. PASS=17 WARN=0 ERROR=1 SKIP=0 TOTAL=18
2022-02-08 10:05:59.379242 (MainThread): Flushing usage events
2022-02-08 10:06:33.748138 (MainThread): Running with dbt=0.19.0
2022-02-08 10:06:33.869316 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-08 10:06:33.870419 (MainThread): Tracking: do not track
2022-02-08 10:06:33.996048 (MainThread): Partial parsing not enabled
2022-02-08 10:06:33.997429 (MainThread): Parsing macros/adapters.sql
2022-02-08 10:06:34.034513 (MainThread): Parsing macros/catalog.sql
2022-02-08 10:06:34.038418 (MainThread): Parsing macros/relations.sql
2022-02-08 10:06:34.040696 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-08 10:06:34.044795 (MainThread): Parsing macros/core.sql
2022-02-08 10:06:34.051317 (MainThread): Parsing macros/adapters/common.sql
2022-02-08 10:06:34.124456 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-08 10:06:34.129696 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-08 10:06:34.134705 (MainThread): Parsing macros/etc/datetime.sql
2022-02-08 10:06:34.151430 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-08 10:06:34.154221 (MainThread): Parsing macros/etc/query.sql
2022-02-08 10:06:34.155940 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-08 10:06:34.157391 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-08 10:06:34.170535 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-08 10:06:34.213927 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-08 10:06:34.232890 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-08 10:06:34.305669 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-08 10:06:34.333400 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-08 10:06:34.345450 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-08 10:06:34.349998 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-08 10:06:34.402539 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-08 10:06:34.417178 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-08 10:06:34.429715 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-08 10:06:34.440769 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-08 10:06:34.444292 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-08 10:06:34.447341 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-08 10:06:34.452398 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-08 10:06:34.459613 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-08 10:06:34.462894 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-08 10:06:34.466712 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-08 10:06:34.469292 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-08 10:06:34.490031 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-08 10:06:34.493879 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-08 10:06:34.497692 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-08 10:06:34.502965 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-08 10:06:34.504950 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-08 10:06:34.508954 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-08 10:06:34.514661 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-08 10:06:34.517809 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-08 10:06:34.521168 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-08 10:06:34.525507 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-08 10:06:34.536852 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-08 10:06:34.542511 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-08 10:06:34.546649 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-08 10:06:34.548963 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-08 10:06:34.552041 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-08 10:06:34.554550 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-08 10:06:34.557003 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-08 10:06:34.565232 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-08 10:06:34.567280 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-08 10:06:34.569669 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-08 10:06:34.572753 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-08 10:06:34.577067 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-08 10:06:34.579836 (MainThread): Parsing macros/sql/star.sql
2022-02-08 10:06:34.585576 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-08 10:06:34.588366 (MainThread): Parsing macros/sql/pivot.sql
2022-02-08 10:06:34.595039 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-08 10:06:34.598510 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-08 10:06:34.611341 (MainThread): Parsing macros/sql/union.sql
2022-02-08 10:06:34.626205 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-08 10:06:34.632938 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-08 10:06:34.647258 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-08 10:06:34.657062 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-08 10:06:34.667275 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-08 10:06:34.684648 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-08 10:06:34.699532 (MainThread): Parsing macros/sql/groupby.sql
2022-02-08 10:06:34.703900 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-08 10:06:34.713620 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-08 10:06:34.718056 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-08 10:06:34.724928 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-08 10:06:34.727143 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-08 10:06:34.729423 (MainThread): Parsing macros/logger/log_info.sql
2022-02-08 10:06:34.731539 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-08 10:06:34.788751 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-08 10:06:34.795094 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-08 10:06:34.803923 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-08 10:06:34.808001 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-08 10:06:34.816865 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-08 10:06:34.836053 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-08 10:06:34.849573 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-08 10:06:34.854940 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-08 10:06:34.858689 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-08 10:06:34.862522 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-08 10:06:34.866319 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-08 10:06:34.872234 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-08 10:06:34.875713 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-08 10:06:34.893005 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-08 10:06:34.904933 (MainThread): Parsing macros/internal/alias.sql
2022-02-08 10:06:34.917490 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-08 10:06:34.919200 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-08 10:06:34.929160 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-08 10:06:34.947373 (MainThread): Parsing macros/internal/multikey.sql
2022-02-08 10:06:34.960569 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-08 10:06:34.988020 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-08 10:06:34.994066 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-08 10:06:34.995294 (MainThread): Parsing macros/tables/hub.sql
2022-02-08 10:06:35.018779 (MainThread): Parsing macros/tables/link.sql
2022-02-08 10:06:35.039368 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-08 10:06:35.063121 (MainThread): Parsing macros/tables/sat.sql
2022-02-08 10:06:35.084104 (MainThread): Parsing macros/tables/t_link.sql
2022-02-08 10:06:35.091501 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-08 10:06:35.118739 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-08 10:06:35.129784 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-08 10:06:35.158969 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-08 10:06:35.161144 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-08 10:06:35.197772 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-08 10:06:35.207095 (MainThread): Parsing macros/supporting/hash.sql
2022-02-08 10:06:35.217888 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-08 10:06:35.220099 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-08 10:06:35.229696 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-08 10:06:35.233564 (MainThread): Parsing macros/staging/stage.sql
2022-02-08 10:06:35.255354 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-08 10:06:35.317794 (MainThread): Partial parsing not enabled
2022-02-08 10:06:35.455028 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:06:35.660791 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:06:35.697105 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:06:35.730877 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:06:35.789020 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:06:35.841711 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:06:35.872540 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:06:35.910385 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:06:35.933450 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:06:36.113656 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:06:36.164436 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:06:36.197258 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:06:36.227449 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:06:36.244124 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:06:36.259348 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:06:36.278761 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:06:36.300345 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:06:36.320823 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:06:37.474881 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.report
- models.project_otus_dbt.raw_vault.links

2022-02-08 10:06:37.712052 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-08 10:06:37.713834 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-08 10:06:37.720841 (MainThread): 
2022-02-08 10:06:37.723884 (MainThread): Acquiring new postgres connection "master".
2022-02-08 10:06:37.795230 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-08 10:06:37.828547 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-08 10:06:37.829192 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-08 10:06:37.829493 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-08 10:06:37.891803 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.06 seconds
2022-02-08 10:06:37.896830 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-08 10:06:37.949160 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-08 10:06:37.960344 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 10:06:37.960623 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-08 10:06:37.960765 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-08 10:06:37.973795 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-08 10:06:37.974100 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 10:06:37.974209 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-08 10:06:37.979155 (ThreadPoolExecutor-1_0): SQL status: SELECT 25 in 0.00 seconds
2022-02-08 10:06:38.004044 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-08 10:06:38.006302 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-08 10:06:38.067980 (MainThread): Using postgres connection "master".
2022-02-08 10:06:38.068264 (MainThread): On master: BEGIN
2022-02-08 10:06:38.068387 (MainThread): Opening a new connection, currently in state init
2022-02-08 10:06:38.093940 (MainThread): SQL status: BEGIN in 0.03 seconds
2022-02-08 10:06:38.094450 (MainThread): Using postgres connection "master".
2022-02-08 10:06:38.094895 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-08 10:06:38.612419 (MainThread): SQL status: SELECT 10 in 0.52 seconds
2022-02-08 10:06:38.630818 (MainThread): On master: ROLLBACK
2022-02-08 10:06:38.633194 (MainThread): Using postgres connection "master".
2022-02-08 10:06:38.633691 (MainThread): On master: BEGIN
2022-02-08 10:06:38.636621 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:06:38.637071 (MainThread): On master: COMMIT
2022-02-08 10:06:38.637355 (MainThread): Using postgres connection "master".
2022-02-08 10:06:38.637629 (MainThread): On master: COMMIT
2022-02-08 10:06:38.639496 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:06:38.639817 (MainThread): On master: Close
2022-02-08 10:06:38.641164 (MainThread): 13:06:38 | Concurrency: 2 threads (target='dev')
2022-02-08 10:06:38.641860 (MainThread): 13:06:38 | 
2022-02-08 10:06:38.661535 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 10:06:38.661955 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 10:06:38.663949 (Thread-1): 13:06:38 | 1 of 18 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-08 10:06:38.666898 (Thread-2): 13:06:38 | 2 of 18 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-08 10:06:38.668174 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:06:38.669278 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:06:38.669691 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 10:06:38.670089 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 10:06:38.786506 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:06:38.794595 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:06:38.795015 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-08 10:06:38.795535 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-08 10:06:38.796043 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:06:38.796545 (Thread-2): Opening a new connection, currently in state init
2022-02-08 10:06:38.834094 (Thread-1): SQL status: BEGIN in 0.04 seconds
2022-02-08 10:06:38.834905 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:06:38.835375 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:38.861499 (Thread-2): SQL status: BEGIN in 0.06 seconds
2022-02-08 10:06:38.862156 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:06:38.862627 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:38.869201 (Thread-1): SQL status: SELECT 6 in 0.03 seconds
2022-02-08 10:06:38.988475 (Thread-2): SQL status: SELECT 7 in 0.13 seconds
2022-02-08 10:06:39.003138 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:06:39.008918 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:39.014306 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:06:39.015420 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:39.024242 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-08 10:06:39.031996 (Thread-2): SQL status: SELECT 7 in 0.02 seconds
2022-02-08 10:06:39.046497 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 10:06:39.057806 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 10:06:39.058370 (Thread-1): finished collecting timing info
2022-02-08 10:06:39.081146 (Thread-2): finished collecting timing info
2022-02-08 10:06:39.191347 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:06:39.193685 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:06:39.194208 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 10:06:39.194929 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-08 10:06:39.198277 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:06:39.207497 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 10:06:39.208876 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:06:39.215816 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:06:39.216277 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 10:06:39.216863 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 10:06:39.220044 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:06:39.220600 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:06:39.234431 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 10:06:39.231706 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 10:06:39.236040 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:06:39.236400 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 10:06:39.237444 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:06:39.238025 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 10:06:39.248977 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-08 10:06:39.255273 (Thread-2): SQL status: CREATE VIEW in 0.02 seconds
2022-02-08 10:06:39.279746 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:06:39.286090 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-08 10:06:39.287378 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:06:39.288213 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-08 10:06:39.291169 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:39.291744 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:39.298999 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:06:39.309652 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:06:39.310134 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-08 10:06:39.310696 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-08 10:06:39.315802 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:39.322288 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 10:06:39.348089 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 10:06:39.352022 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 10:06:39.352538 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:06:39.353113 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:06:39.353577 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 10:06:39.354144 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 10:06:39.361875 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:06:39.368700 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:06:39.373137 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:06:39.379832 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:06:39.380430 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 10:06:39.380988 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 10:06:39.387800 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 10:06:39.393570 (Thread-2): finished collecting timing info
2022-02-08 10:06:39.394230 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 10:06:39.394780 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-08 10:06:39.401452 (Thread-1): finished collecting timing info
2022-02-08 10:06:39.402742 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-08 10:06:39.406493 (Thread-2): 13:06:39 | 2 of 18 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.73s]
2022-02-08 10:06:39.410532 (Thread-1): 13:06:39 | 1 of 18 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.74s]
2022-02-08 10:06:39.411548 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 10:06:39.412605 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 10:06:39.413311 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 10:06:39.414640 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 10:06:39.418723 (Thread-2): 13:06:39 | 3 of 18 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-08 10:06:39.422418 (Thread-1): 13:06:39 | 4 of 18 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-08 10:06:39.423837 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:06:39.425224 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:06:39.425794 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 10:06:39.426457 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 10:06:39.487954 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:06:39.493995 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-08 10:06:39.498944 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:06:39.499558 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:06:39.500197 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-08 10:06:39.501369 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:06:39.521178 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-08 10:06:39.521786 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:06:39.522225 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:39.541901 (Thread-2): SQL status: SELECT 18 in 0.02 seconds
2022-02-08 10:06:39.567115 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:06:39.567641 (Thread-1): SQL status: BEGIN in 0.07 seconds
2022-02-08 10:06:39.568088 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:39.568610 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:06:39.569555 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:39.580427 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-08 10:06:39.597715 (Thread-1): SQL status: SELECT 7 in 0.03 seconds
2022-02-08 10:06:39.601291 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 10:06:39.616877 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:06:39.617340 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:39.618211 (Thread-2): finished collecting timing info
2022-02-08 10:06:39.633920 (Thread-1): SQL status: SELECT 7 in 0.02 seconds
2022-02-08 10:06:39.637665 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:06:39.649361 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-08 10:06:39.653780 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 10:06:39.655297 (Thread-1): finished collecting timing info
2022-02-08 10:06:39.656691 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:06:39.672260 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:06:39.677920 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 10:06:39.693650 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:06:39.694182 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 10:06:39.694921 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-08 10:06:39.697595 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 10:06:39.698900 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:06:39.699288 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 10:06:39.700303 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:06:39.705263 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:06:39.705570 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 10:06:39.707358 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-08 10:06:39.707727 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:06:39.714414 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:06:39.717323 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 10:06:39.717761 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-08 10:06:39.718639 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:06:39.718916 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 10:06:39.720688 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:39.725289 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:06:39.725591 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-08 10:06:39.725811 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-08 10:06:39.732785 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:06:39.733237 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-08 10:06:39.733645 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:39.736071 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 10:06:39.736404 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:39.736668 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:06:39.741081 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 10:06:39.740693 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:06:39.741428 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-08 10:06:39.743490 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:39.745601 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 10:06:39.745885 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:06:39.746155 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:06:39.749353 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:06:39.749919 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 10:06:39.750484 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 10:06:39.754029 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:06:39.757897 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:06:39.758207 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 10:06:39.758493 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 10:06:39.761964 (Thread-2): finished collecting timing info
2022-02-08 10:06:39.762961 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-08 10:06:39.766943 (Thread-2): 13:06:39 | 3 of 18 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.34s]
2022-02-08 10:06:39.767321 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:06:39.768059 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 10:06:39.772228 (Thread-1): finished collecting timing info
2022-02-08 10:06:39.773208 (Thread-2): Began running node model.project_otus_dbt.dim_day
2022-02-08 10:06:39.774345 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-08 10:06:39.776204 (Thread-2): 13:06:39 | 5 of 18 START table model public.dim_day............................. [RUN]
2022-02-08 10:06:39.779322 (Thread-1): 13:06:39 | 4 of 18 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.35s]
2022-02-08 10:06:39.780016 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:06:39.780613 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 10:06:39.781027 (Thread-2): Compiling model.project_otus_dbt.dim_day
2022-02-08 10:06:39.781616 (Thread-1): Began running node model.project_otus_dbt.dim_week
2022-02-08 10:06:39.795742 (Thread-1): 13:06:39 | 6 of 18 START table model public.dim_week............................ [RUN]
2022-02-08 10:06:39.797616 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 10:06:39.798540 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:06:39.799266 (Thread-1): Compiling model.project_otus_dbt.dim_week
2022-02-08 10:06:39.809003 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 10:06:39.809371 (Thread-2): finished collecting timing info
2022-02-08 10:06:39.837861 (Thread-1): finished collecting timing info
2022-02-08 10:06:39.843074 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:06:39.854505 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-08 10:06:39.855174 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:06:39.855766 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:06:39.856557 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-08 10:06:39.856772 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:06:39.875470 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 10:06:39.876201 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 10:06:39.884416 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:06:39.893898 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:06:39.894469 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 10:06:39.895145 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 10:06:39.897717 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:06:39.898342 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:06:39.908585 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 10:06:39.911819 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 10:06:39.913471 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:06:39.913900 (Thread-2): On model.project_otus_dbt.dim_day: BEGIN
2022-02-08 10:06:39.914402 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:06:39.915318 (Thread-1): On model.project_otus_dbt.dim_week: BEGIN
2022-02-08 10:06:39.917262 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:06:39.917839 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:06:39.918363 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:06:39.918919 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:06:39.919560 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        date_trunc('week' , date) as first_day_week,
        extract('week' from date) as week_id,
        extract('year' from date)*100+extract('week' from date) as yearweek_id,

        to_char(date, 'MON') as month,
        extract('month' from date) as moth_id,
        extract('year' from date)*100+extract('month' from date) as yearmonth_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
    from generate_series(date '2012-01-01',
                         date '2025-12-31',
                         interval '1 day')
             as t(date)
)

select * from dim_day
order by date desc
  );
2022-02-08 10:06:39.920064 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-08 10:06:39.943109 (Thread-1): SQL status: SELECT 731 in 0.02 seconds
2022-02-08 10:06:39.958834 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:06:39.959242 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-08 10:06:39.962534 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:39.969188 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:06:39.969631 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-08 10:06:39.972339 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:39.975279 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 10:06:39.975654 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:06:39.975896 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 10:06:39.980517 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:06:39.985967 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:06:39.986352 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 10:06:39.993988 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:06:40.001070 (Thread-1): finished collecting timing info
2022-02-08 10:06:40.001806 (Thread-1): On model.project_otus_dbt.dim_week: Close
2022-02-08 10:06:40.007117 (Thread-1): 13:06:40 | 6 of 18 OK created table model public.dim_week....................... [SELECT 731 in 0.20s]
2022-02-08 10:06:40.007796 (Thread-1): Finished running node model.project_otus_dbt.dim_week
2022-02-08 10:06:40.008452 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 10:06:40.011106 (Thread-1): 13:06:40 | 7 of 18 START incremental model public.hub_wheat_gbp................. [RUN]
2022-02-08 10:06:40.012471 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:06:40.013480 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-08 10:06:40.036769 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 10:06:40.037465 (Thread-1): finished collecting timing info
2022-02-08 10:06:40.049612 (Thread-2): SQL status: SELECT 5114 in 0.13 seconds
2022-02-08 10:06:40.067693 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:06:40.073335 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-08 10:06:40.085972 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 10:06:40.104777 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:06:40.107419 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:06:40.107834 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp130640088541"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:06:40.108266 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-08 10:06:40.108820 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:06:40.111340 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:40.114034 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 10:06:40.114449 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:06:40.114774 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 10:06:40.127844 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:06:40.132437 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:06:40.132819 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 10:06:40.139280 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:06:40.143672 (Thread-2): finished collecting timing info
2022-02-08 10:06:40.144120 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 10:06:40.144461 (Thread-2): On model.project_otus_dbt.dim_day: Close
2022-02-08 10:06:40.149634 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:06:40.150220 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-08 10:06:40.153426 (Thread-2): 13:06:40 | 5 of 18 OK created table model public.dim_day........................ [SELECT 5114 in 0.37s]
2022-02-08 10:06:40.153869 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:06:40.154531 (Thread-2): Finished running node model.project_otus_dbt.dim_day
2022-02-08 10:06:40.154951 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:06:40.155479 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 10:06:40.156125 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp130640088541'
        
      order by ordinal_position

  
2022-02-08 10:06:40.158069 (Thread-2): 13:06:40 | 8 of 18 START incremental model public.sat_wheat_gbp_details......... [RUN]
2022-02-08 10:06:40.159436 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:06:40.159786 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 10:06:40.181206 (Thread-1): SQL status: SELECT 4 in 0.02 seconds
2022-02-08 10:06:40.197329 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 10:06:40.198505 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:06:40.199062 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:40.199601 (Thread-2): finished collecting timing info
2022-02-08 10:06:40.210598 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:06:40.213597 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:06:40.226426 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:06:40.226883 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp130640211093"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:06:40.227235 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:40.227537 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:06:40.233555 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:06:40.235325 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 10:06:40.237062 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:06:40.237488 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp130640088541"
    );
  
2022-02-08 10:06:40.239938 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:06:40.241784 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 10:06:40.242355 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:06:40.242565 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 10:06:40.246418 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:06:40.249709 (Thread-1): finished collecting timing info
2022-02-08 10:06:40.250182 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-08 10:06:40.253010 (Thread-1): 13:06:40 | 7 of 18 OK created incremental model public.hub_wheat_gbp............ [INSERT 0 0 in 0.24s]
2022-02-08 10:06:40.253472 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 10:06:40.253890 (Thread-1): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 10:06:40.256230 (Thread-1): 13:06:40 | 9 of 18 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-08 10:06:40.257071 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:06:40.257704 (Thread-1): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 10:06:40.270072 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 10:06:40.285920 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 10:06:40.289637 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:06:40.290510 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-08 10:06:40.291302 (Thread-1): finished collecting timing info
2022-02-08 10:06:40.298589 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 10:06:40.304246 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:06:40.310028 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp130640211093'
        
      order by ordinal_position

  
2022-02-08 10:06:40.312462 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:06:40.313667 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp130640307335"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:06:40.314644 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:06:40.334822 (Thread-2): SQL status: SELECT 11 in 0.02 seconds
2022-02-08 10:06:40.342796 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:06:40.343130 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:40.350068 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 10:06:40.350498 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:06:40.357191 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:06:40.364321 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:06:40.364772 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-08 10:06:40.365191 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:40.367292 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:06:40.367695 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:06:40.367921 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp130640307335'
        
      order by ordinal_position

  
2022-02-08 10:06:40.372099 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:06:40.374058 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 10:06:40.375025 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:06:40.375445 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp130640211093"
    );
  
2022-02-08 10:06:40.377701 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:06:40.380479 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 10:06:40.380912 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:06:40.381246 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 10:06:40.381733 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:06:40.393236 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:06:40.393585 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:06:40.393848 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:40.399976 (Thread-2): finished collecting timing info
2022-02-08 10:06:40.400778 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-08 10:06:40.405755 (Thread-2): 13:06:40 | 8 of 18 OK created incremental model public.sat_wheat_gbp_details.... [INSERT 0 0 in 0.24s]
2022-02-08 10:06:40.406602 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 10:06:40.407592 (Thread-2): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 10:06:40.408816 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:06:40.411603 (Thread-2): 13:06:40 | 10 of 18 START incremental model public.sat_rate_gbp_usd_details..... [RUN]
2022-02-08 10:06:40.419685 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:06:40.420494 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:06:40.420947 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:40.421412 (Thread-2): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 10:06:40.437624 (Thread-1): SQL status: SELECT 4 in 0.02 seconds
2022-02-08 10:06:40.444444 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 10:06:40.454606 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 10:06:40.455566 (Thread-2): finished collecting timing info
2022-02-08 10:06:40.456415 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:06:40.467441 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp130640307335"
    );
  
2022-02-08 10:06:40.469315 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:06:40.469844 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp130640466708"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:06:40.470078 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:06:40.471753 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:06:40.473510 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 10:06:40.473801 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:06:40.473960 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 10:06:40.477122 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:06:40.479780 (Thread-1): finished collecting timing info
2022-02-08 10:06:40.480242 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-08 10:06:40.483302 (Thread-1): 13:06:40 | 9 of 18 OK created incremental model public.hub_rate_gbp_usd......... [INSERT 0 0 in 0.22s]
2022-02-08 10:06:40.483897 (Thread-1): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 10:06:40.484342 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 10:06:40.487202 (Thread-1): 13:06:40 | 11 of 18 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-08 10:06:40.488339 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:06:40.488698 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-08 10:06:40.508536 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 10:06:40.508872 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 10:06:40.514303 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:06:40.514947 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-08 10:06:40.515425 (Thread-1): finished collecting timing info
2022-02-08 10:06:40.522296 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 10:06:40.528089 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:06:40.530222 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:06:40.530777 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp130640466708'
        
      order by ordinal_position

  
2022-02-08 10:06:40.531173 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp130640527271"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:06:40.531747 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:06:40.541539 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:06:40.548712 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:06:40.549006 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:40.554731 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:06:40.560935 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:06:40.561282 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-08 10:06:40.561545 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:40.567285 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:06:40.568009 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-08 10:06:40.569556 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:06:40.569871 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:06:40.569984 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp130640527271'
        
      order by ordinal_position

  
2022-02-08 10:06:40.573492 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:06:40.575293 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 10:06:40.576045 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:06:40.576422 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp130640466708"
    );
  
2022-02-08 10:06:40.578438 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:06:40.580323 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 10:06:40.580644 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:06:40.580972 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:06:40.586972 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:06:40.587292 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 10:06:40.587623 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:40.591163 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:06:40.594231 (Thread-2): finished collecting timing info
2022-02-08 10:06:40.594979 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-08 10:06:40.598279 (Thread-2): 13:06:40 | 10 of 18 OK created incremental model public.sat_rate_gbp_usd_details [INSERT 0 0 in 0.18s]
2022-02-08 10:06:40.598670 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:06:40.599446 (Thread-2): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 10:06:40.609190 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:06:40.609842 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 10:06:40.610713 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:40.612910 (Thread-2): 13:06:40 | 12 of 18 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-08 10:06:40.613954 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:06:40.614261 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 10:06:40.623933 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:06:40.631008 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 10:06:40.655593 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:06:40.661200 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp130640527271"
    );
  
2022-02-08 10:06:40.662640 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 10:06:40.664192 (Thread-2): finished collecting timing info
2022-02-08 10:06:40.746243 (Thread-1): SQL status: INSERT 0 0 in 0.08 seconds
2022-02-08 10:06:40.754756 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 10:06:40.760398 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:06:40.765886 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 10:06:40.774198 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:06:40.774602 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp130640769020"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:06:40.774845 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:06:40.775389 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:06:40.778680 (Thread-1): finished collecting timing info
2022-02-08 10:06:40.779166 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-08 10:06:40.782031 (Thread-1): 13:06:40 | 11 of 18 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.29s]
2022-02-08 10:06:40.782539 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 10:06:40.782982 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 10:06:40.786838 (Thread-1): 13:06:40 | 13 of 18 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-08 10:06:40.787828 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:06:40.788208 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-08 10:06:40.815167 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 10:06:40.816268 (Thread-1): finished collecting timing info
2022-02-08 10:06:40.823032 (Thread-2): SQL status: SELECT 0 in 0.05 seconds
2022-02-08 10:06:40.841457 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:06:40.847309 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-08 10:06:40.848521 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:06:40.849189 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp130640843413"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:06:40.849724 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:06:40.850729 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:06:40.851037 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:06:40.851198 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp130640769020'
        
      order by ordinal_position

  
2022-02-08 10:06:40.869419 (Thread-2): SQL status: SELECT 12 in 0.02 seconds
2022-02-08 10:06:40.881063 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:06:40.881532 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-08 10:06:40.881954 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:40.889381 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:06:40.890040 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-08 10:06:40.892049 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:06:40.892506 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:06:40.893011 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp130640843413'
        
      order by ordinal_position

  
2022-02-08 10:06:40.900576 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 10:06:40.909580 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:06:40.909944 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:40.910669 (Thread-1): SQL status: SELECT 4 in 0.02 seconds
2022-02-08 10:06:40.916823 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:06:40.917139 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:40.919633 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 10:06:40.921725 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 10:06:40.922514 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:06:40.922739 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp130640769020"
    );
  
2022-02-08 10:06:40.925319 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:06:40.927381 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 10:06:40.927849 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:06:40.928217 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:06:40.938348 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:06:40.939274 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:40.938754 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 10:06:40.943900 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:06:40.948982 (Thread-2): finished collecting timing info
2022-02-08 10:06:40.949686 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:06:40.950118 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-08 10:06:40.952721 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 10:06:40.957834 (Thread-2): 13:06:40 | 12 of 18 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.34s]
2022-02-08 10:06:40.958677 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 10:06:40.959539 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:06:40.960342 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 10:06:40.961633 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp130640843413"
    );
  
2022-02-08 10:06:40.965750 (Thread-2): 13:06:40 | 14 of 18 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-08 10:06:40.967745 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:06:40.968439 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 10:06:40.975302 (Thread-1): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-08 10:06:40.985586 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 10:06:40.991653 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:06:40.997349 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 10:06:41.012832 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:06:41.022895 (Thread-1): finished collecting timing info
2022-02-08 10:06:41.029214 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-08 10:06:41.035223 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 10:06:41.039160 (Thread-1): 13:06:41 | 13 of 18 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.25s]
2022-02-08 10:06:41.040549 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 10:06:41.041619 (Thread-1): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 10:06:41.043228 (Thread-2): finished collecting timing info
2022-02-08 10:06:41.047970 (Thread-1): 13:06:41 | 15 of 18 START table model public.dds_rate_gbp_usd................... [RUN]
2022-02-08 10:06:41.065468 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:06:41.071196 (Thread-1): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 10:06:41.072998 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:06:41.079059 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp130641068710"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:06:41.085202 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:06:41.099825 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 10:06:41.101602 (Thread-1): finished collecting timing info
2022-02-08 10:06:41.123802 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:06:41.124245 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 10:06:41.124493 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:06:41.141778 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 10:06:41.148729 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:06:41.149184 (Thread-2): SQL status: SELECT 0 in 0.06 seconds
2022-02-08 10:06:41.149558 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 10:06:41.157391 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:06:41.158426 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-08 10:06:41.160049 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:06:41.163913 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 10:06:41.164413 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 10:06:41.165471 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:06:41.165939 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp130641068710'
        
      order by ordinal_position

  
2022-02-08 10:06:41.166919 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:06:41.167523 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-08 10:06:41.170323 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:06:41.170851 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:06:41.171301 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */


  create  table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp"
  as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );
2022-02-08 10:06:41.179916 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:06:41.191326 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:06:41.191660 (Thread-1): SQL status: SELECT 548 in 0.02 seconds
2022-02-08 10:06:41.191955 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:41.200813 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:06:41.201434 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd" rename to "dds_rate_gbp_usd__dbt_backup"
2022-02-08 10:06:41.203886 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:41.211234 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:06:41.211738 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:06:41.212071 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-08 10:06:41.224311 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:06:41.224693 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:06:41.225068 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:41.227480 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 10:06:41.227864 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:06:41.228097 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 10:06:41.231601 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:06:41.236251 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:06:41.236661 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:06:41.236940 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 10:06:41.239350 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 10:06:41.240737 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:06:41.241136 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp130641068710"
    );
  
2022-02-08 10:06:41.243378 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:06:41.246060 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 10:06:41.246449 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:06:41.246761 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:06:41.252099 (Thread-1): finished collecting timing info
2022-02-08 10:06:41.252996 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 10:06:41.253563 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-08 10:06:41.258429 (Thread-1): 13:06:41 | 15 of 18 OK created table model public.dds_rate_gbp_usd.............. [SELECT 548 in 0.19s]
2022-02-08 10:06:41.259187 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:06:41.259761 (Thread-1): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 10:06:41.263735 (Thread-2): finished collecting timing info
2022-02-08 10:06:41.264621 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 10:06:41.265608 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-08 10:06:41.268745 (Thread-1): 13:06:41 | 16 of 18 START table model public.dds_wheat_msk...................... [RUN]
2022-02-08 10:06:41.272802 (Thread-2): 13:06:41 | 14 of 18 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.30s]
2022-02-08 10:06:41.273659 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:06:41.274150 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 10:06:41.274556 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-08 10:06:41.275426 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 10:06:41.293852 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 10:06:41.295703 (Thread-2): 13:06:41 | 17 of 18 START table model public.dds_wheat_gbp...................... [RUN]
2022-02-08 10:06:41.297319 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:06:41.297788 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_gbp
2022-02-08 10:06:41.298241 (Thread-1): finished collecting timing info
2022-02-08 10:06:41.328921 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 10:06:41.331986 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:06:41.332783 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-08 10:06:41.333312 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:06:41.333991 (Thread-2): finished collecting timing info
2022-02-08 10:06:41.347086 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:06:41.347738 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_tmp" cascade
2022-02-08 10:06:41.348055 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:06:41.350338 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 10:06:41.355783 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:06:41.356081 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 10:06:41.357596 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:06:41.359767 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 10:06:41.360699 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:06:41.360986 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-08 10:06:41.362720 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:06:41.363038 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:06:41.368857 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:06:41.371385 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:06:41.371986 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */


  create  table "postgres"."public"."dds_wheat_msk__dbt_tmp"
  as (
    with dds_wheat_msk as(
    select cast(su.tradedate as date) as tradedate
        ,hu.date_pk
        ,case when su.value=0 and su.volume>0 then cast(su.volume*su.close as decimal(18,2))
            else cast(su.value as decimal(18,2))
            end as value_all
        ,cast(su.open as decimal(18,2)) as open
        ,cast(su.close as decimal(18,2)) as close
        ,cast(su.high as decimal(18,2)) as high
        ,cast(su.low as decimal(18,2)) as low
        ,cast(su.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hu
    left join "postgres"."public"."sat_wheat_msk_details" as su
    on hu.date_pk=su.date_pk
)
select * from dds_wheat_msk
  );
2022-02-08 10:06:41.372495 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 10:06:41.374609 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:06:41.377820 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 10:06:41.378638 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:06:41.378931 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: BEGIN
2022-02-08 10:06:41.380977 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:06:41.381389 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:06:41.381666 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */


  create  table "postgres"."public"."dds_wheat_gbp__dbt_tmp"
  as (
    with gbp as(
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0*rt.rate as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_gbp" as hu
    left join "postgres"."public"."sat_wheat_gbp_details" as su
    on hu.date_pk=su.date_pk
    left join "postgres"."public"."dds_rate_gbp_usd" as rt
    on hu.date_pk=rt.date_pk
)
select * from gbp
  );
2022-02-08 10:06:41.386209 (Thread-1): SQL status: SELECT 216 in 0.01 seconds
2022-02-08 10:06:41.392962 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:06:41.393269 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-08 10:06:41.395313 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:41.395634 (Thread-2): SQL status: SELECT 531 in 0.01 seconds
2022-02-08 10:06:41.401509 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:06:41.409746 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:06:41.410134 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-08 10:06:41.410536 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp" rename to "dds_wheat_gbp__dbt_backup"
2022-02-08 10:06:41.413193 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:41.413573 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:41.421367 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:06:41.423331 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 10:06:41.423817 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp__dbt_tmp" rename to "dds_wheat_gbp"
2022-02-08 10:06:41.424269 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:06:41.424909 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 10:06:41.426755 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:41.429413 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 10:06:41.429786 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:06:41.430145 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:06:41.434240 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:06:41.434826 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 10:06:41.435229 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 10:06:41.438756 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:06:41.444830 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:06:41.445350 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:06:41.445674 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 10:06:41.451105 (Thread-1): finished collecting timing info
2022-02-08 10:06:41.452325 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-08 10:06:41.457496 (Thread-1): 13:06:41 | 16 of 18 OK created table model public.dds_wheat_msk................. [SELECT 216 in 0.18s]
2022-02-08 10:06:41.457931 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:06:41.458488 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 10:06:41.463429 (Thread-2): finished collecting timing info
2022-02-08 10:06:41.464246 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 10:06:41.465035 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: Close
2022-02-08 10:06:41.466910 (Thread-1): 13:06:41 | 18 of 18 START table model public.dds_wheat_usa...................... [RUN]
2022-02-08 10:06:41.470987 (Thread-2): 13:06:41 | 17 of 18 OK created table model public.dds_wheat_gbp................. [SELECT 531 in 0.17s]
2022-02-08 10:06:41.472131 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:06:41.472701 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 10:06:41.473181 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_usa
2022-02-08 10:06:41.491598 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 10:06:41.492700 (Thread-1): finished collecting timing info
2022-02-08 10:06:41.517331 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:06:41.517750 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_tmp" cascade
2022-02-08 10:06:41.518040 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:06:41.535205 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 10:06:41.539956 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:06:41.540361 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 10:06:41.542455 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:06:41.544579 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 10:06:41.545613 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:06:41.545958 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: BEGIN
2022-02-08 10:06:41.547710 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:06:41.548116 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:06:41.548364 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */


  create  table "postgres"."public"."dds_wheat_usa__dbt_tmp"
  as (
    with usa as (
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0/2.7 as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_usa" as hu
    left join "postgres"."public"."sat_wheat_usa_details" as su
    on hu.date_pk=su.date_pk
)
select * from usa
  );
2022-02-08 10:06:41.565115 (Thread-1): SQL status: SELECT 547 in 0.02 seconds
2022-02-08 10:06:41.571813 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:06:41.572137 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa" rename to "dds_wheat_usa__dbt_backup"
2022-02-08 10:06:41.574186 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:41.581029 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:06:41.581352 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa__dbt_tmp" rename to "dds_wheat_usa"
2022-02-08 10:06:41.583370 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:06:41.585160 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 10:06:41.585404 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:06:41.585506 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 10:06:41.588890 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:06:41.592361 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:06:41.592623 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 10:06:41.597103 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:06:41.601097 (Thread-1): finished collecting timing info
2022-02-08 10:06:41.601583 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: Close
2022-02-08 10:06:41.604317 (Thread-1): 13:06:41 | 18 of 18 OK created table model public.dds_wheat_usa................. [SELECT 547 in 0.13s]
2022-02-08 10:06:41.604874 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 10:06:41.608326 (MainThread): Acquiring new postgres connection "master".
2022-02-08 10:06:41.608764 (MainThread): Using postgres connection "master".
2022-02-08 10:06:41.608876 (MainThread): On master: BEGIN
2022-02-08 10:06:41.609029 (MainThread): Opening a new connection, currently in state closed
2022-02-08 10:06:41.625462 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-08 10:06:41.625944 (MainThread): On master: COMMIT
2022-02-08 10:06:41.626247 (MainThread): Using postgres connection "master".
2022-02-08 10:06:41.626526 (MainThread): On master: COMMIT
2022-02-08 10:06:41.628498 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:06:41.629039 (MainThread): On master: Close
2022-02-08 10:06:41.630563 (MainThread): 13:06:41 | 
2022-02-08 10:06:41.631255 (MainThread): 13:06:41 | Finished running 4 view models, 6 table models, 8 incremental models in 3.91s.
2022-02-08 10:06:41.631818 (MainThread): Connection 'master' was properly closed.
2022-02-08 10:06:41.632244 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_usa' was properly closed.
2022-02-08 10:06:41.632608 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_gbp' was properly closed.
2022-02-08 10:06:41.843596 (MainThread): 
2022-02-08 10:06:41.844140 (MainThread): Completed successfully
2022-02-08 10:06:41.845134 (MainThread): 
Done. PASS=18 WARN=0 ERROR=0 SKIP=0 TOTAL=18
2022-02-08 10:06:41.846372 (MainThread): Flushing usage events
2022-02-08 10:38:43.137995 (MainThread): Running with dbt=0.19.0
2022-02-08 10:38:43.336256 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-08 10:38:43.338554 (MainThread): Tracking: do not track
2022-02-08 10:38:43.532260 (MainThread): Partial parsing not enabled
2022-02-08 10:38:43.534387 (MainThread): Parsing macros/adapters.sql
2022-02-08 10:38:43.581815 (MainThread): Parsing macros/catalog.sql
2022-02-08 10:38:43.586091 (MainThread): Parsing macros/relations.sql
2022-02-08 10:38:43.589048 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-08 10:38:43.595457 (MainThread): Parsing macros/core.sql
2022-02-08 10:38:43.604174 (MainThread): Parsing macros/adapters/common.sql
2022-02-08 10:38:43.681870 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-08 10:38:43.685795 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-08 10:38:43.688904 (MainThread): Parsing macros/etc/datetime.sql
2022-02-08 10:38:43.705104 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-08 10:38:43.708306 (MainThread): Parsing macros/etc/query.sql
2022-02-08 10:38:43.710290 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-08 10:38:43.711972 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-08 10:38:43.726256 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-08 10:38:43.761748 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-08 10:38:43.768218 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-08 10:38:43.841853 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-08 10:38:43.885105 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-08 10:38:43.894760 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-08 10:38:43.897749 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-08 10:38:43.919974 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-08 10:38:43.935475 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-08 10:38:43.946369 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-08 10:38:43.956744 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-08 10:38:43.959642 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-08 10:38:43.962112 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-08 10:38:43.965428 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-08 10:38:43.971395 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-08 10:38:43.974197 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-08 10:38:43.977563 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-08 10:38:43.979411 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-08 10:38:44.003198 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-08 10:38:44.008962 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-08 10:38:44.013869 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-08 10:38:44.020624 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-08 10:38:44.023216 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-08 10:38:44.028720 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-08 10:38:44.038776 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-08 10:38:44.043813 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-08 10:38:44.048847 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-08 10:38:44.055131 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-08 10:38:44.080533 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-08 10:38:44.092354 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-08 10:38:44.103418 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-08 10:38:44.105836 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-08 10:38:44.109826 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-08 10:38:44.113979 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-08 10:38:44.117759 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-08 10:38:44.130660 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-08 10:38:44.132658 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-08 10:38:44.135782 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-08 10:38:44.140120 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-08 10:38:44.146296 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-08 10:38:44.152147 (MainThread): Parsing macros/sql/star.sql
2022-02-08 10:38:44.160474 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-08 10:38:44.163412 (MainThread): Parsing macros/sql/pivot.sql
2022-02-08 10:38:44.170719 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-08 10:38:44.173786 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-08 10:38:44.189402 (MainThread): Parsing macros/sql/union.sql
2022-02-08 10:38:44.203466 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-08 10:38:44.206504 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-08 10:38:44.213791 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-08 10:38:44.221525 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-08 10:38:44.232728 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-08 10:38:44.254887 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-08 10:38:44.268457 (MainThread): Parsing macros/sql/groupby.sql
2022-02-08 10:38:44.272031 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-08 10:38:44.275503 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-08 10:38:44.280175 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-08 10:38:44.298385 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-08 10:38:44.300996 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-08 10:38:44.303687 (MainThread): Parsing macros/logger/log_info.sql
2022-02-08 10:38:44.307866 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-08 10:38:44.355892 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-08 10:38:44.359094 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-08 10:38:44.363167 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-08 10:38:44.366692 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-08 10:38:44.370545 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-08 10:38:44.381247 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-08 10:38:44.392764 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-08 10:38:44.413494 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-08 10:38:44.418809 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-08 10:38:44.423097 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-08 10:38:44.427830 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-08 10:38:44.433593 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-08 10:38:44.436798 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-08 10:38:44.449904 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-08 10:38:44.455703 (MainThread): Parsing macros/internal/alias.sql
2022-02-08 10:38:44.462541 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-08 10:38:44.464347 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-08 10:38:44.468967 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-08 10:38:44.474604 (MainThread): Parsing macros/internal/multikey.sql
2022-02-08 10:38:44.485046 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-08 10:38:44.501173 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-08 10:38:44.507094 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-08 10:38:44.508825 (MainThread): Parsing macros/tables/hub.sql
2022-02-08 10:38:44.533264 (MainThread): Parsing macros/tables/link.sql
2022-02-08 10:38:44.550556 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-08 10:38:44.571042 (MainThread): Parsing macros/tables/sat.sql
2022-02-08 10:38:44.584148 (MainThread): Parsing macros/tables/t_link.sql
2022-02-08 10:38:44.590907 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-08 10:38:44.618722 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-08 10:38:44.632125 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-08 10:38:44.676718 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-08 10:38:44.681422 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-08 10:38:44.734370 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-08 10:38:44.750432 (MainThread): Parsing macros/supporting/hash.sql
2022-02-08 10:38:44.771116 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-08 10:38:44.775553 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-08 10:38:44.794097 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-08 10:38:44.802564 (MainThread): Parsing macros/staging/stage.sql
2022-02-08 10:38:44.834201 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-08 10:38:44.877737 (MainThread): Partial parsing not enabled
2022-02-08 10:38:45.179822 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:38:45.433065 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:38:45.500096 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:38:45.562501 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:38:45.639022 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:38:45.755335 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:38:45.795555 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:38:45.828627 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:38:45.854103 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:38:46.156888 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:38:46.202350 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:38:46.247124 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:38:46.280395 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:38:46.299058 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:38:46.318185 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:38:46.339685 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:38:46.368054 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:38:46.392157 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:38:47.777113 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.project_otus_dbt.report
- models.project_otus_dbt.raw_vault.links

2022-02-08 10:38:47.997432 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-08 10:38:47.999483 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-08 10:38:48.002516 (MainThread): 
2022-02-08 10:38:48.003633 (MainThread): Acquiring new postgres connection "master".
2022-02-08 10:38:48.036638 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-08 10:38:48.059861 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-08 10:38:48.060157 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-08 10:38:48.060280 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-08 10:38:48.155972 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.10 seconds
2022-02-08 10:38:48.160077 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-08 10:38:48.216277 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-08 10:38:48.228566 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 10:38:48.228886 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-08 10:38:48.229104 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-08 10:38:48.249633 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-02-08 10:38:48.249963 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 10:38:48.250078 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-08 10:38:48.300660 (ThreadPoolExecutor-1_0): SQL status: SELECT 25 in 0.05 seconds
2022-02-08 10:38:48.348990 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-08 10:38:48.351421 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-08 10:38:48.446900 (MainThread): Using postgres connection "master".
2022-02-08 10:38:48.447359 (MainThread): On master: BEGIN
2022-02-08 10:38:48.447669 (MainThread): Opening a new connection, currently in state init
2022-02-08 10:38:48.472058 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-02-08 10:38:48.472548 (MainThread): Using postgres connection "master".
2022-02-08 10:38:48.472833 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-08 10:38:48.985995 (MainThread): SQL status: SELECT 10 in 0.51 seconds
2022-02-08 10:38:49.011800 (MainThread): On master: ROLLBACK
2022-02-08 10:38:49.014028 (MainThread): Using postgres connection "master".
2022-02-08 10:38:49.014293 (MainThread): On master: BEGIN
2022-02-08 10:38:49.017748 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:38:49.018215 (MainThread): On master: COMMIT
2022-02-08 10:38:49.018497 (MainThread): Using postgres connection "master".
2022-02-08 10:38:49.018810 (MainThread): On master: COMMIT
2022-02-08 10:38:49.020961 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:38:49.021529 (MainThread): On master: Close
2022-02-08 10:38:49.022989 (MainThread): 13:38:49 | Concurrency: 2 threads (target='dev')
2022-02-08 10:38:49.023715 (MainThread): 13:38:49 | 
2022-02-08 10:38:49.034463 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 10:38:49.035875 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 10:38:49.041896 (Thread-1): 13:38:49 | 1 of 18 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-08 10:38:49.045458 (Thread-2): 13:38:49 | 2 of 18 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-08 10:38:49.048441 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:38:49.050261 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:38:49.051064 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 10:38:49.051758 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 10:38:49.135338 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:38:49.138454 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-08 10:38:49.138114 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:38:49.138706 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:38:49.139053 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-08 10:38:49.139972 (Thread-2): Opening a new connection, currently in state init
2022-02-08 10:38:49.152902 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 10:38:49.153211 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:38:49.153324 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:49.182372 (Thread-2): SQL status: BEGIN in 0.04 seconds
2022-02-08 10:38:49.182686 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:38:49.182871 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:49.241704 (Thread-2): SQL status: SELECT 7 in 0.06 seconds
2022-02-08 10:38:49.242061 (Thread-1): SQL status: SELECT 6 in 0.09 seconds
2022-02-08 10:38:49.341276 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:38:49.346833 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:49.354920 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:38:49.355218 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:49.367936 (Thread-2): SQL status: SELECT 7 in 0.02 seconds
2022-02-08 10:38:49.379169 (Thread-1): SQL status: SELECT 6 in 0.02 seconds
2022-02-08 10:38:49.379801 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 10:38:49.395526 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 10:38:49.396750 (Thread-1): finished collecting timing info
2022-02-08 10:38:49.397465 (Thread-2): finished collecting timing info
2022-02-08 10:38:49.489213 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:38:49.491506 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:38:49.491854 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-08 10:38:49.492234 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 10:38:49.500107 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 10:38:49.500462 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 10:38:49.504972 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:38:49.511974 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:38:49.512341 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 10:38:49.512859 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 10:38:49.515402 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:38:49.515766 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:38:49.527915 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 10:38:49.530097 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 10:38:49.531653 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:38:49.532230 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 10:38:49.532798 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:38:49.533094 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 10:38:49.579003 (Thread-1): SQL status: CREATE VIEW in 0.05 seconds
2022-02-08 10:38:49.579460 (Thread-2): SQL status: CREATE VIEW in 0.05 seconds
2022-02-08 10:38:49.611854 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:38:49.616981 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:38:49.617557 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-08 10:38:49.618094 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-08 10:38:49.625069 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 10:38:49.634517 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:38:49.635061 (Thread-2): SQL status: ALTER TABLE in 0.02 seconds
2022-02-08 10:38:49.635524 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-08 10:38:49.646268 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:38:49.647413 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-08 10:38:49.651503 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:38:49.652008 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:38:49.674055 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 10:38:49.677196 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 10:38:49.677665 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:38:49.678093 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:38:49.678516 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 10:38:49.678920 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 10:38:49.686911 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:38:49.692690 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:38:49.693719 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 10:38:49.699158 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 10:38:49.699660 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 10:38:49.700197 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 10:38:49.717015 (Thread-2): SQL status: DROP VIEW in 0.02 seconds
2022-02-08 10:38:49.720801 (Thread-2): finished collecting timing info
2022-02-08 10:38:49.721321 (Thread-1): SQL status: DROP VIEW in 0.02 seconds
2022-02-08 10:38:49.721732 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-08 10:38:49.728844 (Thread-1): finished collecting timing info
2022-02-08 10:38:49.733045 (Thread-2): 13:38:49 | 2 of 18 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.68s]
2022-02-08 10:38:49.734572 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 10:38:49.733764 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-08 10:38:49.735097 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 10:38:49.739592 (Thread-1): 13:38:49 | 1 of 18 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.69s]
2022-02-08 10:38:49.743425 (Thread-2): 13:38:49 | 3 of 18 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-08 10:38:49.744986 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 10:38:49.746860 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:38:49.748017 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 10:38:49.750112 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 10:38:49.753866 (Thread-1): 13:38:49 | 4 of 18 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-08 10:38:49.766269 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:38:49.772053 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 10:38:49.818425 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:38:49.824394 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-08 10:38:49.830289 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:38:49.839157 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:38:49.840294 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-08 10:38:49.841131 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:38:49.862247 (Thread-2): SQL status: BEGIN in 0.03 seconds
2022-02-08 10:38:49.862748 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:38:49.863160 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:49.865920 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-08 10:38:49.866281 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:38:49.866426 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:49.881403 (Thread-2): SQL status: SELECT 18 in 0.02 seconds
2022-02-08 10:38:49.888063 (Thread-1): SQL status: SELECT 7 in 0.02 seconds
2022-02-08 10:38:49.902642 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:38:49.908151 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:49.915790 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:38:49.916316 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:49.923017 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-08 10:38:49.931388 (Thread-2): SQL status: SELECT 18 in 0.02 seconds
2022-02-08 10:38:49.935824 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 10:38:49.945198 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 10:38:49.946776 (Thread-1): finished collecting timing info
2022-02-08 10:38:49.958988 (Thread-2): finished collecting timing info
2022-02-08 10:38:49.981808 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:38:49.983392 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:38:49.983775 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-08 10:38:49.984177 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-08 10:38:49.987063 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:38:49.987922 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:38:49.993984 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:38:50.001555 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:38:50.001935 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 10:38:50.002441 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 10:38:50.005165 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:38:50.005678 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 10:38:50.007666 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 10:38:50.010589 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 10:38:50.012198 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:38:50.012679 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:38:50.013039 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 10:38:50.013537 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 10:38:50.022819 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-08 10:38:50.030488 (Thread-2): SQL status: CREATE VIEW in 0.02 seconds
2022-02-08 10:38:50.035632 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:38:50.043866 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:38:50.044252 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-08 10:38:50.044870 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-08 10:38:50.049293 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:38:50.049770 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:38:50.054236 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:38:50.061743 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:38:50.062112 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-08 10:38:50.062619 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-08 10:38:50.065837 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:38:50.066285 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:38:50.070139 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 10:38:50.074785 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 10:38:50.075286 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:38:50.075786 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:38:50.076173 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 10:38:50.076516 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 10:38:50.080766 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:38:50.084933 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 10:38:50.085244 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 10:38:50.085620 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:38:50.092694 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 10:38:50.093074 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 10:38:50.093431 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 10:38:50.097056 (Thread-1): finished collecting timing info
2022-02-08 10:38:50.098124 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-08 10:38:50.101838 (Thread-1): 13:38:50 | 4 of 18 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.33s]
2022-02-08 10:38:50.102399 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 10:38:50.102904 (Thread-1): Began running node model.project_otus_dbt.dim_day
2022-02-08 10:38:50.107693 (Thread-1): 13:38:50 | 5 of 18 START table model public.dim_day............................. [RUN]
2022-02-08 10:38:50.109524 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:38:50.110004 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 10:38:50.110529 (Thread-1): Compiling model.project_otus_dbt.dim_day
2022-02-08 10:38:50.114216 (Thread-2): finished collecting timing info
2022-02-08 10:38:50.126660 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-08 10:38:50.132133 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 10:38:50.137523 (Thread-2): 13:38:50 | 3 of 18 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.39s]
2022-02-08 10:38:50.138972 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 10:38:50.139507 (Thread-2): Began running node model.project_otus_dbt.dim_week
2022-02-08 10:38:50.143391 (Thread-2): 13:38:50 | 6 of 18 START table model public.dim_week............................ [RUN]
2022-02-08 10:38:50.144361 (Thread-1): finished collecting timing info
2022-02-08 10:38:50.145972 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:38:50.157210 (Thread-2): Compiling model.project_otus_dbt.dim_week
2022-02-08 10:38:50.196806 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 10:38:50.207832 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:38:50.208293 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-08 10:38:50.208616 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:38:50.209504 (Thread-2): finished collecting timing info
2022-02-08 10:38:50.223815 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:38:50.224272 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-08 10:38:50.224479 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:38:50.227496 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 10:38:50.232442 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:38:50.232734 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 10:38:50.234370 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:38:50.254069 (Thread-2): SQL status: DROP TABLE in 0.03 seconds
2022-02-08 10:38:50.254444 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 10:38:50.259069 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:38:50.259971 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 10:38:50.261189 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:38:50.261774 (Thread-1): On model.project_otus_dbt.dim_day: BEGIN
2022-02-08 10:38:50.262254 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:38:50.264526 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 10:38:50.265027 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:38:50.265759 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:38:50.266130 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        date_trunc('week' , date) as first_day_week,
        extract('week' from date) as week_id,
        extract('year' from date)*100+extract('week' from date) as yearweek_id,

        to_char(date, 'MON') as month,
        concat(to_char(date, 'MM'), to_char(date, 'MON')) as mm_month,
        extract('month' from date) as moth_id,
        extract('year' from date)*100+extract('month' from date) as yearmonth_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
    from generate_series(date '2012-01-01',
                         date '2025-12-31',
                         interval '1 day')
             as t(date)
)

select * from dim_day
order by date desc
  );
2022-02-08 10:38:50.266550 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:38:50.267089 (Thread-2): On model.project_otus_dbt.dim_week: BEGIN
2022-02-08 10:38:50.269062 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:38:50.269365 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:38:50.269470 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-08 10:38:50.300878 (Thread-2): SQL status: SELECT 731 in 0.03 seconds
2022-02-08 10:38:50.315120 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:38:50.315403 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-08 10:38:50.317787 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:38:50.322187 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:38:50.322497 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-08 10:38:50.324759 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:38:50.326585 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 10:38:50.326826 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:38:50.326925 (Thread-2): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 10:38:50.331695 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:38:50.337329 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 10:38:50.337608 (Thread-2): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 10:38:50.366913 (Thread-2): SQL status: DROP TABLE in 0.03 seconds
2022-02-08 10:38:50.371094 (Thread-2): finished collecting timing info
2022-02-08 10:38:50.371562 (Thread-2): On model.project_otus_dbt.dim_week: Close
2022-02-08 10:38:50.375637 (Thread-2): 13:38:50 | 6 of 18 OK created table model public.dim_week....................... [SELECT 731 in 0.23s]
2022-02-08 10:38:50.376218 (Thread-2): Finished running node model.project_otus_dbt.dim_week
2022-02-08 10:38:50.377041 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 10:38:50.379828 (Thread-2): 13:38:50 | 7 of 18 START incremental model public.hub_wheat_gbp................. [RUN]
2022-02-08 10:38:50.380776 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:38:50.381298 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-08 10:38:50.394814 (Thread-1): SQL status: SELECT 5114 in 0.13 seconds
2022-02-08 10:38:50.409559 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 10:38:50.412110 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:38:50.412686 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-08 10:38:50.413759 (Thread-2): finished collecting timing info
2022-02-08 10:38:50.426259 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 10:38:50.436160 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:38:50.443858 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-08 10:38:50.462813 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 10:38:50.472010 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 10:38:50.474466 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:38:50.474893 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:38:50.475252 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp133850464849"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:38:50.475510 (Thread-1): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 10:38:50.475825 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:38:50.481597 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:38:50.486870 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 10:38:50.487208 (Thread-1): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 10:38:50.496076 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:38:50.502038 (Thread-1): finished collecting timing info
2022-02-08 10:38:50.502581 (Thread-1): On model.project_otus_dbt.dim_day: Close
2022-02-08 10:38:50.506298 (Thread-1): 13:38:50 | 5 of 18 OK created table model public.dim_day........................ [SELECT 5114 in 0.39s]
2022-02-08 10:38:50.506822 (Thread-1): Finished running node model.project_otus_dbt.dim_day
2022-02-08 10:38:50.507331 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 10:38:50.510589 (Thread-1): 13:38:50 | 8 of 18 START incremental model public.sat_wheat_gbp_details......... [RUN]
2022-02-08 10:38:50.511967 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:38:50.512371 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 10:38:50.533179 (Thread-2): SQL status: SELECT 0 in 0.06 seconds
2022-02-08 10:38:50.551675 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:38:50.556973 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 10:38:50.557296 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-08 10:38:50.558209 (Thread-1): finished collecting timing info
2022-02-08 10:38:50.564659 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 10:38:50.570563 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:38:50.572330 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:38:50.572637 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp133850464849'
        
      order by ordinal_position

  
2022-02-08 10:38:50.573133 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp133850569633"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:38:50.573681 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:38:50.591274 (Thread-2): SQL status: SELECT 4 in 0.02 seconds
2022-02-08 10:38:50.598589 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:38:50.598923 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:50.604491 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:38:50.616759 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 10:38:50.619167 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:38:50.624171 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:38:50.625594 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-08 10:38:50.624903 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:50.627809 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:38:50.628153 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:38:50.628423 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp133850569633'
        
      order by ordinal_position

  
2022-02-08 10:38:50.632108 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:38:50.633598 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 10:38:50.634758 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:38:50.635109 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp133850464849"
    );
  
2022-02-08 10:38:50.639245 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:38:50.639710 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:38:50.641562 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 10:38:50.648569 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:38:50.648901 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 10:38:50.649244 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:50.649578 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 10:38:50.653294 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:38:50.656853 (Thread-2): finished collecting timing info
2022-02-08 10:38:50.657371 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:38:50.657715 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-08 10:38:50.664360 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:38:50.665085 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:50.667645 (Thread-2): 13:38:50 | 7 of 18 OK created incremental model public.hub_wheat_gbp............ [INSERT 0 0 in 0.29s]
2022-02-08 10:38:50.668377 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 10:38:50.668981 (Thread-2): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 10:38:50.671896 (Thread-2): 13:38:50 | 9 of 18 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-08 10:38:50.672938 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:38:50.673516 (Thread-2): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 10:38:50.681722 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:38:50.690104 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 10:38:50.697124 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 10:38:50.697788 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:38:50.698094 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp133850569633"
    );
  
2022-02-08 10:38:50.699040 (Thread-2): finished collecting timing info
2022-02-08 10:38:50.710656 (Thread-1): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-08 10:38:50.713799 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:38:50.715510 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 10:38:50.715901 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp133850711461"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:38:50.716223 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 10:38:50.716579 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:38:50.716910 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 10:38:50.721306 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:38:50.725537 (Thread-1): finished collecting timing info
2022-02-08 10:38:50.726024 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-08 10:38:50.730673 (Thread-1): 13:38:50 | 8 of 18 OK created incremental model public.sat_wheat_gbp_details.... [INSERT 0 0 in 0.22s]
2022-02-08 10:38:50.733278 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 10:38:50.733977 (Thread-1): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 10:38:50.737499 (Thread-1): 13:38:50 | 10 of 18 START incremental model public.sat_rate_gbp_usd_details..... [RUN]
2022-02-08 10:38:50.738479 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:38:50.738962 (Thread-1): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 10:38:50.764736 (Thread-2): SQL status: SELECT 0 in 0.05 seconds
2022-02-08 10:38:50.784060 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:38:50.787145 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 10:38:50.787573 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-08 10:38:50.789365 (Thread-1): finished collecting timing info
2022-02-08 10:38:50.790578 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:38:50.801583 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:38:50.806598 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:38:50.806961 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp133850711461'
        
      order by ordinal_position

  
2022-02-08 10:38:50.807320 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp133850803858"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:38:50.807833 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:38:50.820835 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:38:50.827381 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:38:50.827706 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:50.834123 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:38:50.840675 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:38:50.840961 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:50.845757 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 10:38:50.846474 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:38:50.854515 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:38:50.855920 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 10:38:50.856321 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-08 10:38:50.857379 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:38:50.857675 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp133850711461"
    );
  
2022-02-08 10:38:50.859038 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:38:50.859355 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:38:50.859554 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp133850803858'
        
      order by ordinal_position

  
2022-02-08 10:38:50.859868 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:38:50.862405 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 10:38:50.862836 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 10:38:50.863144 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 10:38:50.867414 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:38:50.872050 (Thread-2): finished collecting timing info
2022-02-08 10:38:50.872785 (Thread-2): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-08 10:38:50.876902 (Thread-2): 13:38:50 | 9 of 18 OK created incremental model public.hub_rate_gbp_usd......... [INSERT 0 0 in 0.20s]
2022-02-08 10:38:50.877442 (Thread-1): SQL status: SELECT 11 in 0.02 seconds
2022-02-08 10:38:50.878123 (Thread-2): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 10:38:50.889989 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 10:38:50.894180 (Thread-2): 13:38:50 | 11 of 18 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-08 10:38:50.897185 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:38:50.898177 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:38:50.898637 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:50.899223 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-08 10:38:50.911715 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:38:50.939679 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 10:38:50.947100 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:38:50.947775 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:50.948462 (Thread-2): finished collecting timing info
2022-02-08 10:38:50.960590 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:38:50.968142 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 10:38:50.972465 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:38:50.973157 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp133850969018"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:38:50.973353 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:38:50.974022 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:38:50.974283 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp133850803858"
    );
  
2022-02-08 10:38:50.976323 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:38:50.978463 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 10:38:50.978934 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 10:38:50.979285 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 10:38:50.982853 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:38:50.986722 (Thread-1): finished collecting timing info
2022-02-08 10:38:50.987353 (Thread-1): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-08 10:38:50.991401 (Thread-1): 13:38:50 | 10 of 18 OK created incremental model public.sat_rate_gbp_usd_details [INSERT 0 0 in 0.25s]
2022-02-08 10:38:50.991914 (Thread-1): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 10:38:50.992556 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 10:38:50.995904 (Thread-1): 13:38:50 | 12 of 18 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-08 10:38:50.997421 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:38:50.998022 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 10:38:51.032003 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 10:38:51.032771 (Thread-1): finished collecting timing info
2022-02-08 10:38:51.046176 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:38:51.046567 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp133851043537"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:38:51.046711 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:38:51.060620 (Thread-2): SQL status: SELECT 0 in 0.09 seconds
2022-02-08 10:38:51.066085 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:38:51.066404 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-08 10:38:51.068187 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:38:51.068584 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:38:51.068838 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp133850969018'
        
      order by ordinal_position

  
2022-02-08 10:38:51.173801 (Thread-2): SQL status: SELECT 4 in 0.10 seconds
2022-02-08 10:38:51.188207 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:38:51.188666 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:51.200055 (Thread-1): SQL status: SELECT 0 in 0.15 seconds
2022-02-08 10:38:51.290391 (Thread-2): SQL status: SELECT 4 in 0.10 seconds
2022-02-08 10:38:51.294004 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:38:51.301036 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:38:51.301414 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-08 10:38:51.301794 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:51.304049 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:38:51.304415 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:38:51.304638 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp133851043537'
        
      order by ordinal_position

  
2022-02-08 10:38:51.311132 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:38:51.313169 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 10:38:51.314632 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:38:51.315089 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp133850969018"
    );
  
2022-02-08 10:38:51.317497 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:38:51.319329 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 10:38:51.319634 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 10:38:51.319897 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 10:38:51.323654 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:38:51.326806 (Thread-2): finished collecting timing info
2022-02-08 10:38:51.327338 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-08 10:38:51.330817 (Thread-2): 13:38:51 | 11 of 18 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.43s]
2022-02-08 10:38:51.331600 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 10:38:51.334239 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 10:38:51.338037 (Thread-2): 13:38:51 | 13 of 18 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-08 10:38:51.339109 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:38:51.339600 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-08 10:38:51.362805 (Thread-1): SQL status: SELECT 11 in 0.06 seconds
2022-02-08 10:38:51.364347 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 10:38:51.370860 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:38:51.371486 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:51.372080 (Thread-2): finished collecting timing info
2022-02-08 10:38:51.384628 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:38:51.386399 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:38:51.395517 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:38:51.395853 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp133851383546"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:38:51.396162 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:51.396469 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:38:51.403995 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 10:38:51.405995 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 10:38:51.406834 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:38:51.407307 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp133851043537"
    );
  
2022-02-08 10:38:51.409413 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:38:51.411628 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 10:38:51.411928 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 10:38:51.412089 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 10:38:51.415701 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:38:51.418798 (Thread-1): finished collecting timing info
2022-02-08 10:38:51.419313 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-08 10:38:51.422454 (Thread-1): 13:38:51 | 12 of 18 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.42s]
2022-02-08 10:38:51.422946 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 10:38:51.423371 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 10:38:51.427267 (Thread-1): 13:38:51 | 14 of 18 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-08 10:38:51.428574 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:38:51.429089 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 10:38:51.435304 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 10:38:51.452542 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:38:51.458108 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-08 10:38:51.467008 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 10:38:51.467323 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:38:51.467826 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:38:51.468114 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp133851383546'
        
      order by ordinal_position

  
2022-02-08 10:38:51.468552 (Thread-1): finished collecting timing info
2022-02-08 10:38:51.481204 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:38:51.481609 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp133851478612"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 10:38:51.481940 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:38:51.482454 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:38:51.491393 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:38:51.491729 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:51.497232 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:38:51.505874 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:38:51.506228 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:51.511618 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 10:38:51.513034 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 10:38:51.514183 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:38:51.514411 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp133851383546"
    );
  
2022-02-08 10:38:51.516563 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:38:51.516883 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-08 10:38:51.518547 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 10:38:51.523904 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:38:51.524294 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 10:38:51.524618 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-08 10:38:51.524982 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 10:38:51.526997 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:38:51.527332 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:38:51.527513 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp133851478612'
        
      order by ordinal_position

  
2022-02-08 10:38:51.528792 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:38:51.531560 (Thread-2): finished collecting timing info
2022-02-08 10:38:51.532064 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-08 10:38:51.535553 (Thread-2): 13:38:51 | 13 of 18 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.19s]
2022-02-08 10:38:51.536742 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 10:38:51.538017 (Thread-2): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 10:38:51.541955 (Thread-2): 13:38:51 | 15 of 18 START table model public.dds_rate_gbp_usd................... [RUN]
2022-02-08 10:38:51.543098 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:38:51.543786 (Thread-1): SQL status: SELECT 12 in 0.02 seconds
2022-02-08 10:38:51.544236 (Thread-2): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 10:38:51.551958 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:38:51.563257 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:51.565661 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 10:38:51.566665 (Thread-2): finished collecting timing info
2022-02-08 10:38:51.580559 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 10:38:51.583297 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:38:51.590422 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:38:51.590853 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 10:38:51.591296 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 10:38:51.591741 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:38:51.601082 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 10:38:51.603868 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 10:38:51.604741 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:38:51.605053 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp133851478612"
    );
  
2022-02-08 10:38:51.607824 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 10:38:51.609920 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 10:38:51.610239 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 10:38:51.610518 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 10:38:51.614651 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:38:51.615547 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 10:38:51.615978 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 10:38:51.617940 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:38:51.620079 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 10:38:51.620425 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:38:51.623217 (Thread-1): finished collecting timing info
2022-02-08 10:38:51.623782 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-08 10:38:51.624167 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:38:51.627709 (Thread-1): 13:38:51 | 14 of 18 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.20s]
2022-02-08 10:38:51.628069 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-08 10:38:51.628629 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 10:38:51.629575 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 10:38:51.633831 (Thread-1): 13:38:51 | 16 of 18 START table model public.dds_wheat_usa...................... [RUN]
2022-02-08 10:38:51.634736 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 10:38:51.635881 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:38:51.636336 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:38:51.636889 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_usa
2022-02-08 10:38:51.637276 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */


  create  table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp"
  as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );
2022-02-08 10:38:51.652813 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 10:38:51.654251 (Thread-1): finished collecting timing info
2022-02-08 10:38:51.667683 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:38:51.668088 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_tmp" cascade
2022-02-08 10:38:51.668334 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:38:51.683043 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:38:51.687425 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:38:51.687749 (Thread-2): SQL status: SELECT 548 in 0.03 seconds
2022-02-08 10:38:51.688070 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 10:38:51.695752 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:38:51.696423 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd" rename to "dds_rate_gbp_usd__dbt_backup"
2022-02-08 10:38:51.697736 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:38:51.699860 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 10:38:51.700170 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:38:51.704964 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:38:51.705411 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-08 10:38:51.706082 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:38:51.706517 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: BEGIN
2022-02-08 10:38:51.708350 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:38:51.708690 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:38:51.710446 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 10:38:51.710896 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:38:51.711203 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:38:51.711516 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */


  create  table "postgres"."public"."dds_wheat_usa__dbt_tmp"
  as (
    with usa as (
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0/2.7 as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_usa" as hu
    left join "postgres"."public"."sat_wheat_usa_details" as su
    on hu.date_pk=su.date_pk
)
select * from usa
  );
2022-02-08 10:38:51.711848 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 10:38:51.716475 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:38:51.721275 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 10:38:51.721680 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 10:38:51.726835 (Thread-1): SQL status: SELECT 547 in 0.01 seconds
2022-02-08 10:38:51.733982 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:38:51.734373 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:38:51.734816 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa" rename to "dds_wheat_usa__dbt_backup"
2022-02-08 10:38:51.738448 (Thread-2): finished collecting timing info
2022-02-08 10:38:51.739437 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-08 10:38:51.742650 (Thread-2): 13:38:51 | 15 of 18 OK created table model public.dds_rate_gbp_usd.............. [SELECT 548 in 0.20s]
2022-02-08 10:38:51.743119 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:38:51.743764 (Thread-2): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 10:38:51.751953 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:38:51.752524 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 10:38:51.753450 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa__dbt_tmp" rename to "dds_wheat_usa"
2022-02-08 10:38:51.755634 (Thread-2): 13:38:51 | 17 of 18 START table model public.dds_wheat_msk...................... [RUN]
2022-02-08 10:38:51.757005 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:38:51.757512 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-08 10:38:51.769123 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 10:38:51.771628 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 10:38:51.773469 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 10:38:51.774329 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:38:51.774845 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 10:38:51.775747 (Thread-2): finished collecting timing info
2022-02-08 10:38:51.785550 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 10:38:51.790767 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:38:51.794107 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 10:38:51.794884 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-08 10:38:51.795322 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 10:38:51.795729 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 10:38:51.812296 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 10:38:51.817029 (Thread-1): finished collecting timing info
2022-02-08 10:38:51.817523 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 10:38:51.817806 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: Close
2022-02-08 10:38:51.822818 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:38:51.823375 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 10:38:51.827976 (Thread-1): 13:38:51 | 16 of 18 OK created table model public.dds_wheat_usa................. [SELECT 547 in 0.19s]
2022-02-08 10:38:51.829710 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 10:38:51.830408 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:38:51.831132 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 10:38:51.833731 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 10:38:51.836635 (Thread-1): 13:38:51 | 18 of 18 START table model public.dds_wheat_gbp...................... [RUN]
2022-02-08 10:38:51.839101 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:38:51.839703 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_gbp
2022-02-08 10:38:51.840108 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:38:51.851206 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-08 10:38:51.856980 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 10:38:51.858683 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:38:51.859024 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:38:51.859285 (Thread-1): finished collecting timing info
2022-02-08 10:38:51.859914 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */


  create  table "postgres"."public"."dds_wheat_msk__dbt_tmp"
  as (
    with dds_wheat_msk as(
    select cast(su.tradedate as date) as tradedate
        ,hu.date_pk
        ,case when su.value=0 and su.volume>0 then cast(su.volume*su.close as decimal(18,2))
            else cast(su.value as decimal(18,2))
            end as value_all
        ,cast(su.open as decimal(18,2)) as open
        ,cast(su.close as decimal(18,2)) as close
        ,cast(su.high as decimal(18,2)) as high
        ,cast(su.low as decimal(18,2)) as low
        ,cast(su.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hu
    left join "postgres"."public"."sat_wheat_msk_details" as su
    on hu.date_pk=su.date_pk
)
select * from dds_wheat_msk
  );
2022-02-08 10:38:51.875579 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:38:51.875959 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_tmp" cascade
2022-02-08 10:38:51.876119 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 10:38:51.888504 (Thread-2): SQL status: SELECT 216 in 0.02 seconds
2022-02-08 10:38:51.895393 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:38:51.895707 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 10:38:51.896004 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-08 10:38:51.900345 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:38:51.901244 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 10:38:51.902942 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:38:51.903277 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 10:38:51.907877 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:38:51.909858 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 10:38:51.910284 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-08 10:38:51.911415 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:38:51.911684 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: BEGIN
2022-02-08 10:38:51.913101 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:38:51.913465 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 10:38:51.915161 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 10:38:51.915554 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:38:51.915859 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:38:51.916194 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */


  create  table "postgres"."public"."dds_wheat_gbp__dbt_tmp"
  as (
    with gbp as(
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0*rt.rate as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_gbp" as hu
    left join "postgres"."public"."sat_wheat_gbp_details" as su
    on hu.date_pk=su.date_pk
    left join "postgres"."public"."dds_rate_gbp_usd" as rt
    on hu.date_pk=rt.date_pk
)
select * from gbp
  );
2022-02-08 10:38:51.916519 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 10:38:51.920230 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:38:51.924025 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 10:38:51.924318 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 10:38:51.930321 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:38:51.935496 (Thread-2): finished collecting timing info
2022-02-08 10:38:51.935962 (Thread-1): SQL status: SELECT 531 in 0.02 seconds
2022-02-08 10:38:51.936313 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-08 10:38:51.942620 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:38:51.943096 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp" rename to "dds_wheat_gbp__dbt_backup"
2022-02-08 10:38:51.945650 (Thread-2): 13:38:51 | 17 of 18 OK created table model public.dds_wheat_msk................. [SELECT 216 in 0.19s]
2022-02-08 10:38:51.946489 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 10:38:51.948311 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:38:51.956134 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:38:51.956631 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp__dbt_tmp" rename to "dds_wheat_gbp"
2022-02-08 10:38:51.958808 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 10:38:51.960555 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 10:38:51.960832 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:38:51.961037 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 10:38:51.965273 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:38:51.969023 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 10:38:51.969329 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 10:38:51.975058 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 10:38:51.981509 (Thread-1): finished collecting timing info
2022-02-08 10:38:51.982004 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: Close
2022-02-08 10:38:51.985378 (Thread-1): 13:38:51 | 18 of 18 OK created table model public.dds_wheat_gbp................. [SELECT 531 in 0.14s]
2022-02-08 10:38:51.985948 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 10:38:51.989747 (MainThread): Acquiring new postgres connection "master".
2022-02-08 10:38:51.990110 (MainThread): Using postgres connection "master".
2022-02-08 10:38:51.990263 (MainThread): On master: BEGIN
2022-02-08 10:38:51.990432 (MainThread): Opening a new connection, currently in state closed
2022-02-08 10:38:52.005124 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 10:38:52.005449 (MainThread): On master: COMMIT
2022-02-08 10:38:52.005554 (MainThread): Using postgres connection "master".
2022-02-08 10:38:52.005696 (MainThread): On master: COMMIT
2022-02-08 10:38:52.007109 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 10:38:52.007422 (MainThread): On master: Close
2022-02-08 10:38:52.008230 (MainThread): 13:38:52 | 
2022-02-08 10:38:52.008639 (MainThread): 13:38:52 | Finished running 4 view models, 6 table models, 8 incremental models in 4.00s.
2022-02-08 10:38:52.008950 (MainThread): Connection 'master' was properly closed.
2022-02-08 10:38:52.009150 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_gbp' was properly closed.
2022-02-08 10:38:52.009349 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_msk' was properly closed.
2022-02-08 10:38:52.174835 (MainThread): 
2022-02-08 10:38:52.175194 (MainThread): Completed successfully
2022-02-08 10:38:52.175503 (MainThread): 
Done. PASS=18 WARN=0 ERROR=0 SKIP=0 TOTAL=18
2022-02-08 10:38:52.175912 (MainThread): Flushing usage events
2022-02-08 12:22:48.063727 (MainThread): Running with dbt=0.19.0
2022-02-08 12:22:48.185762 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-02-08 12:22:48.188093 (MainThread): Tracking: do not track
2022-02-08 12:22:48.302076 (MainThread): Partial parsing not enabled
2022-02-08 12:22:48.304335 (MainThread): Parsing macros/adapters.sql
2022-02-08 12:22:48.329849 (MainThread): Parsing macros/catalog.sql
2022-02-08 12:22:48.333302 (MainThread): Parsing macros/relations.sql
2022-02-08 12:22:48.335866 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-08 12:22:48.340719 (MainThread): Parsing macros/core.sql
2022-02-08 12:22:48.345323 (MainThread): Parsing macros/adapters/common.sql
2022-02-08 12:22:48.385666 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-08 12:22:48.387930 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-08 12:22:48.389758 (MainThread): Parsing macros/etc/datetime.sql
2022-02-08 12:22:48.398620 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-08 12:22:48.400483 (MainThread): Parsing macros/etc/query.sql
2022-02-08 12:22:48.401956 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-08 12:22:48.403151 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-08 12:22:48.411771 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-08 12:22:48.431877 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-08 12:22:48.434061 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-08 12:22:48.472999 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-08 12:22:48.492258 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-08 12:22:48.499145 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-08 12:22:48.501414 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-08 12:22:48.516359 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-08 12:22:48.521812 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-08 12:22:48.528569 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-08 12:22:48.535284 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-08 12:22:48.537399 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-08 12:22:48.539581 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-08 12:22:48.541794 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-08 12:22:48.545807 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-08 12:22:48.547645 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-08 12:22:48.549709 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-08 12:22:48.550896 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-08 12:22:48.560584 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-08 12:22:48.562746 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-08 12:22:48.564499 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-08 12:22:48.567103 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-08 12:22:48.568063 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-08 12:22:48.570147 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-08 12:22:48.573113 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-08 12:22:48.574918 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-08 12:22:48.576918 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-08 12:22:48.579397 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-08 12:22:48.586069 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-08 12:22:48.589592 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-08 12:22:48.592095 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-08 12:22:48.593386 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-08 12:22:48.595229 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-08 12:22:48.596763 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-08 12:22:48.598200 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-08 12:22:48.603511 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-08 12:22:48.605447 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-08 12:22:48.607265 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-08 12:22:48.609451 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-08 12:22:48.612475 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-08 12:22:48.614380 (MainThread): Parsing macros/sql/star.sql
2022-02-08 12:22:48.618522 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-08 12:22:48.620785 (MainThread): Parsing macros/sql/pivot.sql
2022-02-08 12:22:48.625820 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-08 12:22:48.628234 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-08 12:22:48.637461 (MainThread): Parsing macros/sql/union.sql
2022-02-08 12:22:48.646964 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-08 12:22:48.649124 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-08 12:22:48.654199 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-08 12:22:48.657961 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-08 12:22:48.661750 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-08 12:22:48.668470 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-08 12:22:48.673334 (MainThread): Parsing macros/sql/groupby.sql
2022-02-08 12:22:48.675038 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-08 12:22:48.677098 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-08 12:22:48.679770 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-08 12:22:48.685926 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-08 12:22:48.687884 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-08 12:22:48.689391 (MainThread): Parsing macros/logger/log_info.sql
2022-02-08 12:22:48.690742 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-08 12:22:48.715418 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-08 12:22:48.717458 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-08 12:22:48.719951 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-08 12:22:48.722021 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-08 12:22:48.724035 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-08 12:22:48.730765 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-08 12:22:48.735047 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-08 12:22:48.737922 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-08 12:22:48.739696 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-08 12:22:48.741561 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-08 12:22:48.744179 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-08 12:22:48.747644 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-08 12:22:48.749615 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-08 12:22:48.767932 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-08 12:22:48.771615 (MainThread): Parsing macros/internal/alias.sql
2022-02-08 12:22:48.776268 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-08 12:22:48.777463 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-08 12:22:48.780100 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-08 12:22:48.783982 (MainThread): Parsing macros/internal/multikey.sql
2022-02-08 12:22:48.789359 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-08 12:22:48.799751 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-08 12:22:48.806816 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-08 12:22:48.808195 (MainThread): Parsing macros/tables/hub.sql
2022-02-08 12:22:48.820951 (MainThread): Parsing macros/tables/link.sql
2022-02-08 12:22:48.832326 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-08 12:22:48.845775 (MainThread): Parsing macros/tables/sat.sql
2022-02-08 12:22:48.854171 (MainThread): Parsing macros/tables/t_link.sql
2022-02-08 12:22:48.858860 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-08 12:22:48.874344 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-08 12:22:48.882086 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-08 12:22:48.900987 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-08 12:22:48.902589 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-08 12:22:48.926569 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-08 12:22:48.932685 (MainThread): Parsing macros/supporting/hash.sql
2022-02-08 12:22:48.940780 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-08 12:22:48.944063 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-08 12:22:48.952390 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-08 12:22:48.955371 (MainThread): Parsing macros/staging/stage.sql
2022-02-08 12:22:48.966779 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-08 12:22:48.976552 (MainThread): Partial parsing not enabled
2022-02-08 12:22:49.068575 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:22:49.159184 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:22:49.180662 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:22:49.200871 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:22:49.221599 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:22:49.252917 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:22:49.271930 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:22:49.292329 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:22:49.312357 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:22:49.409493 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:22:49.431113 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:22:49.450570 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:22:49.469460 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:22:49.480393 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:22:49.490490 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:22:49.514233 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:22:49.528279 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:22:49.540986 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:22:50.236035 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.raw_vault.links

2022-02-08 12:22:50.385908 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-08 12:22:50.387418 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-08 12:22:50.389447 (MainThread): 
2022-02-08 12:22:50.390039 (MainThread): Acquiring new postgres connection "master".
2022-02-08 12:22:50.395245 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-08 12:22:50.407975 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-08 12:22:50.408181 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-08 12:22:50.408273 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-08 12:22:50.504783 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.10 seconds
2022-02-08 12:22:50.509000 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-08 12:22:50.541634 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-08 12:22:50.549225 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 12:22:50.549416 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-08 12:22:50.549503 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-08 12:22:50.564582 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-02-08 12:22:50.564926 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 12:22:50.565139 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-08 12:22:50.589116 (ThreadPoolExecutor-1_0): SQL status: SELECT 25 in 0.02 seconds
2022-02-08 12:22:50.607151 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-08 12:22:50.608696 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-08 12:22:50.640169 (MainThread): Using postgres connection "master".
2022-02-08 12:22:50.640371 (MainThread): On master: BEGIN
2022-02-08 12:22:50.640460 (MainThread): Opening a new connection, currently in state init
2022-02-08 12:22:50.651843 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:22:50.652162 (MainThread): Using postgres connection "master".
2022-02-08 12:22:50.652313 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-08 12:22:50.951470 (MainThread): SQL status: SELECT 10 in 0.30 seconds
2022-02-08 12:22:50.961212 (MainThread): On master: ROLLBACK
2022-02-08 12:22:50.962503 (MainThread): Using postgres connection "master".
2022-02-08 12:22:50.962690 (MainThread): On master: BEGIN
2022-02-08 12:22:50.964684 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:22:50.964985 (MainThread): On master: COMMIT
2022-02-08 12:22:50.965173 (MainThread): Using postgres connection "master".
2022-02-08 12:22:50.965363 (MainThread): On master: COMMIT
2022-02-08 12:22:50.966531 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:22:50.966840 (MainThread): On master: Close
2022-02-08 12:22:50.967387 (MainThread): 15:22:50 | Concurrency: 2 threads (target='dev')
2022-02-08 12:22:50.967696 (MainThread): 15:22:50 | 
2022-02-08 12:22:50.973515 (Thread-1): Began running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-08 12:22:50.973823 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_gbp
2022-02-08 12:22:50.975252 (Thread-1): 15:22:50 | 1 of 4 START seed file public.source_rate_gbp_usd.................... [RUN]
2022-02-08 12:22:50.976692 (Thread-2): 15:22:50 | 2 of 4 START seed file public.source_wheat_gbp....................... [RUN]
2022-02-08 12:22:50.977301 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-08 12:22:50.978186 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-08 12:22:50.978477 (Thread-1): finished collecting timing info
2022-02-08 12:22:50.978969 (Thread-2): finished collecting timing info
2022-02-08 12:22:51.083311 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-08 12:22:51.088925 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: BEGIN
2022-02-08 12:22:51.149817 (Thread-2): Opening a new connection, currently in state init
2022-02-08 12:22:51.151400 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-08 12:22:51.152024 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: BEGIN
2022-02-08 12:22:51.152159 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:22:51.164882 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-08 12:22:51.165184 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-08 12:22:51.165369 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_gbp"} */
truncate table "postgres"."public"."source_wheat_gbp"
2022-02-08 12:22:51.165883 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:22:51.166069 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-08 12:22:51.166190 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_rate_gbp_usd"} */
truncate table "postgres"."public"."source_rate_gbp_usd"
2022-02-08 12:22:51.182834 (Thread-1): SQL status: TRUNCATE TABLE in 0.02 seconds
2022-02-08 12:22:51.183067 (Thread-2): SQL status: TRUNCATE TABLE in 0.02 seconds
2022-02-08 12:22:51.211257 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-08 12:22:51.211970 (Thread-2): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-08 12:22:51.225080 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-08 12:22:51.230609 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: 
            insert into "postgres"."public"."source_rate_gbp_usd" (TRADEDATE, PRICE, OPEN, HIGH, LOW, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s...
2022-02-08 12:22:51.246197 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-08 12:22:51.246512 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: 
            insert into "postgres"."public"."source_wheat_gbp" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-08 12:22:51.260771 (Thread-1): SQL status: INSERT 0 548 in 0.02 seconds
2022-02-08 12:22:51.265879 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_rate_gbp_usd"
2022-02-08 12:22:51.266216 (Thread-2): SQL status: INSERT 0 531 in 0.02 seconds
2022-02-08 12:22:51.267148 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_gbp"
2022-02-08 12:22:51.277947 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-08 12:22:51.281165 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-08 12:22:51.281424 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-08 12:22:51.281693 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-08 12:22:51.281944 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-08 12:22:51.282155 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-08 12:22:51.303778 (Thread-2): SQL status: COMMIT in 0.02 seconds
2022-02-08 12:22:51.304154 (Thread-1): SQL status: COMMIT in 0.02 seconds
2022-02-08 12:22:51.306785 (Thread-2): finished collecting timing info
2022-02-08 12:22:51.309675 (Thread-1): finished collecting timing info
2022-02-08 12:22:51.310231 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: Close
2022-02-08 12:22:51.310526 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: Close
2022-02-08 12:22:51.311659 (Thread-1): 15:22:51 | 1 of 4 OK loaded seed file public.source_rate_gbp_usd................ [INSERT 548 in 0.33s]
2022-02-08 12:22:51.312870 (Thread-2): 15:22:51 | 2 of 4 OK loaded seed file public.source_wheat_gbp................... [INSERT 531 in 0.33s]
2022-02-08 12:22:51.313453 (Thread-1): Finished running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-08 12:22:51.314265 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_gbp
2022-02-08 12:22:51.314911 (Thread-1): Began running node seed.project_otus_dbt.source_wheat_msk
2022-02-08 12:22:51.315621 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_usa
2022-02-08 12:22:51.317475 (Thread-1): 15:22:51 | 3 of 4 START seed file public.source_wheat_msk....................... [RUN]
2022-02-08 12:22:51.319053 (Thread-2): 15:22:51 | 4 of 4 START seed file public.source_wheat_usa....................... [RUN]
2022-02-08 12:22:51.319963 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-08 12:22:51.320969 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-08 12:22:51.321514 (Thread-1): finished collecting timing info
2022-02-08 12:22:51.322016 (Thread-2): finished collecting timing info
2022-02-08 12:22:51.387668 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-08 12:22:51.393233 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: BEGIN
2022-02-08 12:22:51.398768 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:22:51.401878 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-08 12:22:51.402354 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: BEGIN
2022-02-08 12:22:51.402453 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:22:51.419841 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-08 12:22:51.420087 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-08 12:22:51.420214 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_msk"} */
truncate table "postgres"."public"."source_wheat_msk"
2022-02-08 12:22:51.426757 (Thread-1): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-08 12:22:51.440164 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-08 12:22:51.440477 (Thread-2): SQL status: BEGIN in 0.04 seconds
2022-02-08 12:22:51.440714 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: 
            insert into "postgres"."public"."source_wheat_msk" (BOARDID, SECID, TRADEDATE, SHORTNAME, NAME, CLOSE, OPEN, HIGH, LOW, VALUE, DURATION, YIELD, DECIMALS, CAPITALIZATION, CURRENCYID, DIVISOR, TRADINGSESSION, VOLUME) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%...
2022-02-08 12:22:51.440985 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-08 12:22:51.445247 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_usa"} */
truncate table "postgres"."public"."source_wheat_usa"
2022-02-08 12:22:51.462971 (Thread-2): SQL status: TRUNCATE TABLE in 0.02 seconds
2022-02-08 12:22:51.478394 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-08 12:22:51.478663 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: 
            insert into "postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-08 12:22:51.498872 (Thread-1): SQL status: INSERT 0 216 in 0.06 seconds
2022-02-08 12:22:51.499786 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_msk"
2022-02-08 12:22:51.506107 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-08 12:22:51.506387 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-08 12:22:51.506562 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-08 12:22:51.512515 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:22:51.514998 (Thread-1): finished collecting timing info
2022-02-08 12:22:51.515522 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: Close
2022-02-08 12:22:51.518480 (Thread-1): 15:22:51 | 3 of 4 OK loaded seed file public.source_wheat_msk................... [INSERT 216 in 0.20s]
2022-02-08 12:22:51.519018 (Thread-1): Finished running node seed.project_otus_dbt.source_wheat_msk
2022-02-08 12:22:51.548606 (Thread-2): SQL status: INSERT 0 547 in 0.07 seconds
2022-02-08 12:22:51.549381 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_usa"
2022-02-08 12:22:51.554204 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-08 12:22:51.554402 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-08 12:22:51.554478 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-08 12:22:51.558476 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:22:51.562111 (Thread-2): finished collecting timing info
2022-02-08 12:22:51.562517 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: Close
2022-02-08 12:22:51.563526 (Thread-2): 15:22:51 | 4 of 4 OK loaded seed file public.source_wheat_usa................... [INSERT 547 in 0.24s]
2022-02-08 12:22:51.563847 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_usa
2022-02-08 12:22:51.566958 (MainThread): Acquiring new postgres connection "master".
2022-02-08 12:22:51.567239 (MainThread): Using postgres connection "master".
2022-02-08 12:22:51.567372 (MainThread): On master: BEGIN
2022-02-08 12:22:51.567515 (MainThread): Opening a new connection, currently in state closed
2022-02-08 12:22:51.578459 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:22:51.578724 (MainThread): On master: COMMIT
2022-02-08 12:22:51.578870 (MainThread): Using postgres connection "master".
2022-02-08 12:22:51.578986 (MainThread): On master: COMMIT
2022-02-08 12:22:51.580229 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:22:51.580543 (MainThread): On master: Close
2022-02-08 12:22:51.581352 (MainThread): 15:22:51 | 
2022-02-08 12:22:51.581812 (MainThread): 15:22:51 | Finished running 4 seeds in 1.19s.
2022-02-08 12:22:51.582114 (MainThread): Connection 'master' was properly closed.
2022-02-08 12:22:51.582347 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_msk' was properly closed.
2022-02-08 12:22:51.582753 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_usa' was properly closed.
2022-02-08 12:22:51.717002 (MainThread): 
2022-02-08 12:22:51.717214 (MainThread): Completed successfully
2022-02-08 12:22:51.717398 (MainThread): 
Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
2022-02-08 12:22:51.717698 (MainThread): Flushing usage events
2022-02-08 12:24:09.435074 (MainThread): Running with dbt=0.19.0
2022-02-08 12:24:09.507461 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-08 12:24:09.508971 (MainThread): Tracking: do not track
2022-02-08 12:24:09.579006 (MainThread): Partial parsing not enabled
2022-02-08 12:24:09.579966 (MainThread): Parsing macros/adapters.sql
2022-02-08 12:24:09.604304 (MainThread): Parsing macros/catalog.sql
2022-02-08 12:24:09.607144 (MainThread): Parsing macros/relations.sql
2022-02-08 12:24:09.608772 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-08 12:24:09.611645 (MainThread): Parsing macros/core.sql
2022-02-08 12:24:09.616829 (MainThread): Parsing macros/adapters/common.sql
2022-02-08 12:24:09.661441 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-08 12:24:09.663605 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-08 12:24:09.665421 (MainThread): Parsing macros/etc/datetime.sql
2022-02-08 12:24:09.674410 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-08 12:24:09.677435 (MainThread): Parsing macros/etc/query.sql
2022-02-08 12:24:09.679434 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-08 12:24:09.681064 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-08 12:24:09.690341 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-08 12:24:09.710827 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-08 12:24:09.712913 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-08 12:24:09.744318 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-08 12:24:09.761526 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-08 12:24:09.767576 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-08 12:24:09.769645 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-08 12:24:09.782996 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-08 12:24:09.788153 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-08 12:24:09.794724 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-08 12:24:09.801384 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-08 12:24:09.803322 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-08 12:24:09.804974 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-08 12:24:09.806881 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-08 12:24:09.810831 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-08 12:24:09.812656 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-08 12:24:09.814754 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-08 12:24:09.815964 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-08 12:24:09.825645 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-08 12:24:09.827871 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-08 12:24:09.829684 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-08 12:24:09.832344 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-08 12:24:09.833304 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-08 12:24:09.837665 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-08 12:24:09.843854 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-08 12:24:09.846933 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-08 12:24:09.849451 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-08 12:24:09.852271 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-08 12:24:09.859601 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-08 12:24:09.863253 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-08 12:24:09.866734 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-08 12:24:09.869123 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-08 12:24:09.871856 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-08 12:24:09.873551 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-08 12:24:09.875226 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-08 12:24:09.880753 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-08 12:24:09.882195 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-08 12:24:09.883880 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-08 12:24:09.886063 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-08 12:24:09.888902 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-08 12:24:09.890816 (MainThread): Parsing macros/sql/star.sql
2022-02-08 12:24:09.894560 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-08 12:24:09.896606 (MainThread): Parsing macros/sql/pivot.sql
2022-02-08 12:24:09.901127 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-08 12:24:09.903126 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-08 12:24:09.910821 (MainThread): Parsing macros/sql/union.sql
2022-02-08 12:24:09.920437 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-08 12:24:09.922652 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-08 12:24:09.927718 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-08 12:24:09.932014 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-08 12:24:09.936177 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-08 12:24:09.943585 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-08 12:24:09.951701 (MainThread): Parsing macros/sql/groupby.sql
2022-02-08 12:24:09.953595 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-08 12:24:09.955732 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-08 12:24:09.958667 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-08 12:24:09.966778 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-08 12:24:09.968429 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-08 12:24:09.970306 (MainThread): Parsing macros/logger/log_info.sql
2022-02-08 12:24:09.971854 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-08 12:24:10.004179 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-08 12:24:10.007242 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-08 12:24:10.011259 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-08 12:24:10.014300 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-08 12:24:10.017583 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-08 12:24:10.026321 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-08 12:24:10.031316 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-08 12:24:10.034813 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-08 12:24:10.037069 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-08 12:24:10.039911 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-08 12:24:10.043127 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-08 12:24:10.047313 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-08 12:24:10.049916 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-08 12:24:10.057048 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-08 12:24:10.060702 (MainThread): Parsing macros/internal/alias.sql
2022-02-08 12:24:10.067628 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-08 12:24:10.068931 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-08 12:24:10.072251 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-08 12:24:10.078162 (MainThread): Parsing macros/internal/multikey.sql
2022-02-08 12:24:10.084661 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-08 12:24:10.097400 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-08 12:24:10.102200 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-08 12:24:10.103186 (MainThread): Parsing macros/tables/hub.sql
2022-02-08 12:24:10.118187 (MainThread): Parsing macros/tables/link.sql
2022-02-08 12:24:10.133237 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-08 12:24:10.150357 (MainThread): Parsing macros/tables/sat.sql
2022-02-08 12:24:10.162491 (MainThread): Parsing macros/tables/t_link.sql
2022-02-08 12:24:10.168443 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-08 12:24:10.183833 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-08 12:24:10.191014 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-08 12:24:10.209678 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-08 12:24:10.211294 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-08 12:24:10.230468 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-08 12:24:10.236414 (MainThread): Parsing macros/supporting/hash.sql
2022-02-08 12:24:10.243638 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-08 12:24:10.245369 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-08 12:24:10.253500 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-08 12:24:10.256400 (MainThread): Parsing macros/staging/stage.sql
2022-02-08 12:24:10.267545 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-08 12:24:10.277520 (MainThread): Partial parsing not enabled
2022-02-08 12:24:10.364015 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:24:10.468823 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:24:10.490824 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:24:10.512919 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:24:10.533754 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:24:10.566010 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:24:10.583534 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:24:10.599314 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:24:10.614495 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:24:10.712405 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:24:10.734396 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:24:10.755998 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:24:10.780035 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:24:10.792535 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:24:10.803812 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:24:10.816616 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:24:10.830032 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:24:10.843186 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:24:11.514258 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.raw_vault.links

2022-02-08 12:24:11.633047 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-08 12:24:11.633601 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-08 12:24:11.635528 (MainThread): 
2022-02-08 12:24:11.636022 (MainThread): Acquiring new postgres connection "master".
2022-02-08 12:24:11.656493 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-08 12:24:11.668955 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-08 12:24:11.669166 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-08 12:24:11.669257 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-08 12:24:11.684997 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.02 seconds
2022-02-08 12:24:11.687696 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-08 12:24:11.714367 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-08 12:24:11.723422 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 12:24:11.723636 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-08 12:24:11.723728 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-08 12:24:11.738733 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:24:11.739035 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 12:24:11.739165 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-08 12:24:11.745408 (ThreadPoolExecutor-1_0): SQL status: SELECT 25 in 0.01 seconds
2022-02-08 12:24:11.764490 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-08 12:24:11.766569 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-08 12:24:11.797716 (MainThread): Using postgres connection "master".
2022-02-08 12:24:11.798382 (MainThread): On master: BEGIN
2022-02-08 12:24:11.798504 (MainThread): Opening a new connection, currently in state init
2022-02-08 12:24:11.809908 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:24:11.810158 (MainThread): Using postgres connection "master".
2022-02-08 12:24:11.810341 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-08 12:24:12.078365 (MainThread): SQL status: SELECT 10 in 0.27 seconds
2022-02-08 12:24:12.088983 (MainThread): On master: ROLLBACK
2022-02-08 12:24:12.090345 (MainThread): Using postgres connection "master".
2022-02-08 12:24:12.090549 (MainThread): On master: BEGIN
2022-02-08 12:24:12.092269 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:24:12.092499 (MainThread): On master: COMMIT
2022-02-08 12:24:12.092610 (MainThread): Using postgres connection "master".
2022-02-08 12:24:12.092711 (MainThread): On master: COMMIT
2022-02-08 12:24:12.093752 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:24:12.093989 (MainThread): On master: Close
2022-02-08 12:24:12.094520 (MainThread): 15:24:12 | Concurrency: 2 threads (target='dev')
2022-02-08 12:24:12.094836 (MainThread): 15:24:12 | 
2022-02-08 12:24:12.098546 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 12:24:12.098829 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 12:24:12.100219 (Thread-1): 15:24:12 | 1 of 18 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-08 12:24:12.101664 (Thread-2): 15:24:12 | 2 of 18 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-08 12:24:12.102221 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:24:12.102801 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:24:12.103049 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 12:24:12.103277 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 12:24:12.163722 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:24:12.165754 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:24:12.166013 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-08 12:24:12.166255 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-08 12:24:12.166483 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:24:12.166711 (Thread-2): Opening a new connection, currently in state init
2022-02-08 12:24:12.179211 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:24:12.179476 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:24:12.179699 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:12.181398 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:24:12.181658 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:24:12.181803 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:12.233916 (Thread-1): SQL status: SELECT 6 in 0.05 seconds
2022-02-08 12:24:12.299677 (Thread-2): SQL status: SELECT 7 in 0.12 seconds
2022-02-08 12:24:12.305136 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:24:12.314578 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:24:12.314980 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:12.315313 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:12.320540 (Thread-2): SQL status: SELECT 7 in 0.00 seconds
2022-02-08 12:24:12.320801 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-08 12:24:12.326504 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 12:24:12.333159 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 12:24:12.334301 (Thread-2): finished collecting timing info
2022-02-08 12:24:12.345735 (Thread-1): finished collecting timing info
2022-02-08 12:24:12.389802 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:24:12.394292 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:24:12.394537 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-08 12:24:12.395027 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 12:24:12.400223 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:24:12.400527 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 12:24:12.404136 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:24:12.408079 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:24:12.408488 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:24:12.408752 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 12:24:12.412877 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:24:12.413162 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:24:12.419295 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 12:24:12.421326 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 12:24:12.422577 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:24:12.422994 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:24:12.423598 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:24:12.423957 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:24:12.468613 (Thread-2): SQL status: CREATE VIEW in 0.04 seconds
2022-02-08 12:24:12.477526 (Thread-1): SQL status: CREATE VIEW in 0.05 seconds
2022-02-08 12:24:12.479714 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:24:12.484550 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:24:12.485019 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-08 12:24:12.485273 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-08 12:24:12.489706 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:12.490021 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:12.493538 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:24:12.497264 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:24:12.497620 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-08 12:24:12.497888 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-08 12:24:12.500680 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:12.500996 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:12.509979 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 12:24:12.511696 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 12:24:12.511977 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:24:12.512236 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:24:12.512434 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 12:24:12.512661 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 12:24:12.517283 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:24:12.524791 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:24:12.525199 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:24:12.525490 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:24:12.529096 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:24:12.529625 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 12:24:12.541092 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 12:24:12.541405 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 12:24:12.544324 (Thread-1): finished collecting timing info
2022-02-08 12:24:12.548254 (Thread-2): finished collecting timing info
2022-02-08 12:24:12.548780 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-08 12:24:12.549112 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-08 12:24:12.552384 (Thread-1): 15:24:12 | 1 of 18 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.45s]
2022-02-08 12:24:12.554881 (Thread-2): 15:24:12 | 2 of 18 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.45s]
2022-02-08 12:24:12.555277 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 12:24:12.555694 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 12:24:12.556031 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 12:24:12.556854 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 12:24:12.560357 (Thread-1): 15:24:12 | 3 of 18 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-08 12:24:12.563042 (Thread-2): 15:24:12 | 4 of 18 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-08 12:24:12.563835 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:24:12.564593 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:24:12.564998 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 12:24:12.565341 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 12:24:12.592303 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:24:12.597815 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-08 12:24:12.598116 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:24:12.598375 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:24:12.598781 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-08 12:24:12.599558 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:24:12.610842 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:24:12.611083 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:24:12.611225 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:12.622522 (Thread-1): SQL status: SELECT 18 in 0.01 seconds
2022-02-08 12:24:12.631578 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:24:12.631830 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:12.636969 (Thread-1): SQL status: SELECT 18 in 0.00 seconds
2022-02-08 12:24:12.642583 (Thread-2): SQL status: BEGIN in 0.04 seconds
2022-02-08 12:24:12.644002 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 12:24:12.644319 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:24:12.644975 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:12.646647 (Thread-1): finished collecting timing info
2022-02-08 12:24:12.655964 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:24:12.656214 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-08 12:24:12.656384 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-08 12:24:12.662729 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:24:12.663080 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:12.664250 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:24:12.667551 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:24:12.667813 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 12:24:12.668272 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-08 12:24:12.673385 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 12:24:12.673608 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 12:24:12.675832 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 12:24:12.676418 (Thread-2): finished collecting timing info
2022-02-08 12:24:12.684936 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:24:12.685239 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-08 12:24:12.685573 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:24:12.685844 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:24:12.686754 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:24:12.691598 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:24:12.691836 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 12:24:12.693143 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:24:12.695450 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 12:24:12.696133 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:24:12.696321 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:24:12.703549 (Thread-1): SQL status: CREATE VIEW in 0.02 seconds
2022-02-08 12:24:12.703834 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-08 12:24:12.709332 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:24:12.714269 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:24:12.714663 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-08 12:24:12.714957 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-08 12:24:12.718660 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:12.718953 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:12.722155 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:24:12.726127 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:24:12.726443 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-08 12:24:12.726649 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-08 12:24:12.728886 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:12.729193 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:12.730700 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 12:24:12.732046 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 12:24:12.732332 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:24:12.732554 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:24:12.732745 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 12:24:12.732941 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 12:24:12.735820 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:24:12.739042 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:24:12.739286 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:24:12.739474 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 12:24:12.742656 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:24:12.743256 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 12:24:12.748740 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 12:24:12.751728 (Thread-2): finished collecting timing info
2022-02-08 12:24:12.752043 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 12:24:12.752267 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-08 12:24:12.755548 (Thread-1): finished collecting timing info
2022-02-08 12:24:12.756111 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-08 12:24:12.758531 (Thread-2): 15:24:12 | 4 of 18 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.19s]
2022-02-08 12:24:12.760984 (Thread-1): 15:24:12 | 3 of 18 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.20s]
2022-02-08 12:24:12.761472 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 12:24:12.761980 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 12:24:12.762503 (Thread-2): Began running node model.project_otus_dbt.dim_day
2022-02-08 12:24:12.763347 (Thread-1): Began running node model.project_otus_dbt.dim_week
2022-02-08 12:24:12.766060 (Thread-2): 15:24:12 | 5 of 18 START table model public.dim_day............................. [RUN]
2022-02-08 12:24:12.767861 (Thread-1): 15:24:12 | 6 of 18 START table model public.dim_week............................ [RUN]
2022-02-08 12:24:12.768948 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:24:12.769911 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:24:12.770354 (Thread-2): Compiling model.project_otus_dbt.dim_day
2022-02-08 12:24:12.770892 (Thread-1): Compiling model.project_otus_dbt.dim_week
2022-02-08 12:24:12.778765 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 12:24:12.787701 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 12:24:12.788703 (Thread-2): finished collecting timing info
2022-02-08 12:24:12.799897 (Thread-1): finished collecting timing info
2022-02-08 12:24:12.818110 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:24:12.822867 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:24:12.823131 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-08 12:24:12.823402 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-08 12:24:12.823672 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:24:12.823887 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:24:12.836768 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:24:12.837040 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:24:12.840050 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:24:12.843642 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:24:12.844015 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 12:24:12.844241 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 12:24:12.845922 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:24:12.846159 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:24:12.854151 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 12:24:12.855971 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 12:24:12.856759 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:24:12.856925 (Thread-1): On model.project_otus_dbt.dim_week: BEGIN
2022-02-08 12:24:12.857163 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:24:12.857377 (Thread-2): On model.project_otus_dbt.dim_day: BEGIN
2022-02-08 12:24:12.858396 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:24:12.858660 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:24:12.858852 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:24:12.859047 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-08 12:24:12.859252 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:24:12.859542 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        date_trunc('week' , date) as first_day_week,
        extract('week' from date) as week_id,
        extract('year' from date)*100+extract('week' from date) as yearweek_id,

        to_char(date, 'MON') as month,
        concat(to_char(date, 'MM'), to_char(date, 'MON')) as mm_month,
        extract('month' from date) as moth_id,
        extract('year' from date)*100+extract('month' from date) as yearmonth_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
    from generate_series(date '2012-01-01',
                         date '2025-12-31',
                         interval '1 day')
             as t(date)
)

select * from dim_day
order by date desc
  );
2022-02-08 12:24:12.880742 (Thread-1): SQL status: SELECT 731 in 0.02 seconds
2022-02-08 12:24:12.886932 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:24:12.887168 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-08 12:24:12.889791 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:12.893394 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:24:12.893601 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-08 12:24:12.895224 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:12.896748 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 12:24:12.896986 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:24:12.897121 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 12:24:12.900456 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:24:12.903285 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:24:12.903488 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 12:24:12.910196 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:24:12.913834 (Thread-1): finished collecting timing info
2022-02-08 12:24:12.914199 (Thread-1): On model.project_otus_dbt.dim_week: Close
2022-02-08 12:24:12.916234 (Thread-1): 15:24:12 | 6 of 18 OK created table model public.dim_week....................... [SELECT 731 in 0.15s]
2022-02-08 12:24:12.916590 (Thread-1): Finished running node model.project_otus_dbt.dim_week
2022-02-08 12:24:12.916858 (Thread-1): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 12:24:12.919195 (Thread-1): 15:24:12 | 7 of 18 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-08 12:24:12.919942 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:24:12.920307 (Thread-1): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 12:24:12.936959 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 12:24:12.938089 (Thread-1): finished collecting timing info
2022-02-08 12:24:12.963086 (Thread-2): SQL status: SELECT 5114 in 0.10 seconds
2022-02-08 12:24:12.973632 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:24:12.980524 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:24:12.980728 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-08 12:24:12.980934 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp152412976197"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:24:12.981364 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:24:12.983489 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:12.988140 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:24:12.988381 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-08 12:24:12.989677 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:12.991097 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 12:24:12.991436 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:24:12.991622 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 12:24:12.998546 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:24:13.002983 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:24:13.003297 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 12:24:13.012302 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:24:13.015689 (Thread-2): finished collecting timing info
2022-02-08 12:24:13.016031 (Thread-2): On model.project_otus_dbt.dim_day: Close
2022-02-08 12:24:13.017797 (Thread-2): 15:24:13 | 5 of 18 OK created table model public.dim_day........................ [SELECT 5114 in 0.25s]
2022-02-08 12:24:13.018057 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 12:24:13.018624 (Thread-2): Finished running node model.project_otus_dbt.dim_day
2022-02-08 12:24:13.023450 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:24:13.023945 (Thread-2): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 12:24:13.024628 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-08 12:24:13.026544 (Thread-2): 15:24:13 | 8 of 18 START incremental model public.sat_rate_gbp_usd_details...... [RUN]
2022-02-08 12:24:13.027715 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:24:13.028313 (Thread-2): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 12:24:13.028566 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:24:13.039448 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:24:13.045017 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp152412976197'
        
      order by ordinal_position

  
2022-02-08 12:24:13.049721 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 12:24:13.051303 (Thread-2): finished collecting timing info
2022-02-08 12:24:13.062500 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:24:13.062754 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp152413060380"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:24:13.062946 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:24:13.063328 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:24:13.068564 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:24:13.068779 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.073728 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 12:24:13.083502 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:24:13.083759 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.089231 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:24:13.090602 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 12:24:13.091296 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:24:13.091516 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp152412976197"
    );
  
2022-02-08 12:24:13.093208 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:24:13.094793 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 12:24:13.095025 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:24:13.095218 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 12:24:13.097693 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:24:13.100392 (Thread-1): finished collecting timing info
2022-02-08 12:24:13.100763 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-08 12:24:13.102870 (Thread-1): 15:24:13 | 7 of 18 OK created incremental model public.hub_rate_gbp_usd......... [INSERT 0 0 in 0.18s]
2022-02-08 12:24:13.103248 (Thread-1): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 12:24:13.103701 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 12:24:13.106234 (Thread-1): 15:24:13 | 9 of 18 START incremental model public.hub_wheat_gbp................. [RUN]
2022-02-08 12:24:13.107098 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:24:13.107702 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-08 12:24:13.123965 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 12:24:13.124214 (Thread-2): SQL status: SELECT 0 in 0.06 seconds
2022-02-08 12:24:13.129374 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:24:13.129691 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-08 12:24:13.129990 (Thread-1): finished collecting timing info
2022-02-08 12:24:13.136367 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:24:13.140535 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:24:13.140837 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:24:13.141191 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp152413138605"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:24:13.141478 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp152413060380'
        
      order by ordinal_position

  
2022-02-08 12:24:13.141733 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:24:13.191826 (Thread-2): SQL status: SELECT 11 in 0.05 seconds
2022-02-08 12:24:13.198069 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:24:13.198472 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.204631 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:24:13.211744 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:24:13.212035 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.216925 (Thread-1): SQL status: SELECT 0 in 0.08 seconds
2022-02-08 12:24:13.217233 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:24:13.222064 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:24:13.223857 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 12:24:13.224276 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-08 12:24:13.225728 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:24:13.226119 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp152413060380"
    );
  
2022-02-08 12:24:13.226765 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:24:13.227157 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:24:13.227474 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp152413138605'
        
      order by ordinal_position

  
2022-02-08 12:24:13.228249 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:24:13.230074 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 12:24:13.230376 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:24:13.230513 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 12:24:13.233429 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:24:13.235895 (Thread-2): finished collecting timing info
2022-02-08 12:24:13.236307 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-08 12:24:13.238560 (Thread-2): 15:24:13 | 8 of 18 OK created incremental model public.sat_rate_gbp_usd_details. [INSERT 0 0 in 0.21s]
2022-02-08 12:24:13.239509 (Thread-2): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 12:24:13.239934 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 12:24:13.242698 (Thread-2): 15:24:13 | 10 of 18 START incremental model public.sat_wheat_gbp_details........ [RUN]
2022-02-08 12:24:13.244193 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:24:13.244626 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 12:24:13.278069 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 12:24:13.278356 (Thread-1): SQL status: SELECT 4 in 0.05 seconds
2022-02-08 12:24:13.283733 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:24:13.283981 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.284362 (Thread-2): finished collecting timing info
2022-02-08 12:24:13.294402 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:24:13.294945 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:24:13.295198 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp152413292740"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:24:13.302751 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:24:13.303011 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:24:13.303275 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.309391 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:24:13.310880 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 12:24:13.311839 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:24:13.312084 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp152413138605"
    );
  
2022-02-08 12:24:13.313839 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:24:13.315611 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 12:24:13.315876 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:24:13.316017 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 12:24:13.318729 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:24:13.321535 (Thread-1): finished collecting timing info
2022-02-08 12:24:13.321936 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-08 12:24:13.324860 (Thread-1): 15:24:13 | 9 of 18 OK created incremental model public.hub_wheat_gbp............ [INSERT 0 0 in 0.22s]
2022-02-08 12:24:13.325280 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 12:24:13.325820 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 12:24:13.329594 (Thread-1): 15:24:13 | 11 of 18 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-08 12:24:13.330377 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:24:13.330853 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-08 12:24:13.349484 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 12:24:13.350036 (Thread-1): finished collecting timing info
2022-02-08 12:24:13.359931 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:24:13.360229 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp152413357786"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:24:13.360464 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:24:13.361072 (Thread-2): SQL status: SELECT 0 in 0.06 seconds
2022-02-08 12:24:13.368513 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:24:13.368834 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-08 12:24:13.370458 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:24:13.370768 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:24:13.370934 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp152413292740'
        
      order by ordinal_position

  
2022-02-08 12:24:13.420764 (Thread-2): SQL status: SELECT 11 in 0.05 seconds
2022-02-08 12:24:13.426664 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:24:13.426895 (Thread-1): SQL status: SELECT 0 in 0.07 seconds
2022-02-08 12:24:13.427125 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.431273 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:24:13.431782 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-08 12:24:13.432987 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:24:13.433269 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:24:13.433427 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp152413357786'
        
      order by ordinal_position

  
2022-02-08 12:24:13.441180 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:24:13.446734 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:24:13.446975 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.451473 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-08 12:24:13.453124 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 12:24:13.454410 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:24:13.454726 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp152413292740"
    );
  
2022-02-08 12:24:13.456329 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:24:13.457869 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 12:24:13.458181 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:24:13.458339 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 12:24:13.461614 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:24:13.464297 (Thread-2): finished collecting timing info
2022-02-08 12:24:13.465165 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-08 12:24:13.468911 (Thread-2): 15:24:13 | 10 of 18 OK created incremental model public.sat_wheat_gbp_details... [INSERT 0 0 in 0.22s]
2022-02-08 12:24:13.469380 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 12:24:13.469813 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 12:24:13.472327 (Thread-2): 15:24:13 | 12 of 18 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-08 12:24:13.472677 (Thread-1): SQL status: SELECT 4 in 0.04 seconds
2022-02-08 12:24:13.473595 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:24:13.481164 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:24:13.481462 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 12:24:13.481793 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.503209 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 12:24:13.503824 (Thread-2): finished collecting timing info
2022-02-08 12:24:13.518407 (Thread-1): SQL status: SELECT 4 in 0.02 seconds
2022-02-08 12:24:13.521712 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:24:13.530425 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:24:13.530728 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp152413519194"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:24:13.531100 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.531438 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:24:13.537064 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:24:13.538800 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 12:24:13.539527 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:24:13.539756 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp152413357786"
    );
  
2022-02-08 12:24:13.541366 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:24:13.543338 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 12:24:13.543761 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:24:13.544009 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 12:24:13.546449 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:24:13.549272 (Thread-1): finished collecting timing info
2022-02-08 12:24:13.549737 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-08 12:24:13.552421 (Thread-1): 15:24:13 | 11 of 18 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.22s]
2022-02-08 12:24:13.552900 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 12:24:13.553781 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 12:24:13.558139 (Thread-1): 15:24:13 | 13 of 18 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-08 12:24:13.559218 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:24:13.559651 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-08 12:24:13.634179 (Thread-2): SQL status: SELECT 0 in 0.10 seconds
2022-02-08 12:24:13.644214 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:24:13.649676 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-08 12:24:13.650939 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 12:24:13.651922 (Thread-1): finished collecting timing info
2022-02-08 12:24:13.652704 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:24:13.662961 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:24:13.663251 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:24:13.663514 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp152413661186"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:24:13.663750 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp152413519194'
        
      order by ordinal_position

  
2022-02-08 12:24:13.663984 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:24:13.673095 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:24:13.677758 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:24:13.678196 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.684464 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:24:13.689756 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:24:13.689983 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.694551 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-08 12:24:13.695989 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 12:24:13.696627 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:24:13.696826 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp152413519194"
    );
  
2022-02-08 12:24:13.698483 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:24:13.699875 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 12:24:13.700113 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:24:13.700203 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 12:24:13.703464 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:24:13.706080 (Thread-2): finished collecting timing info
2022-02-08 12:24:13.706446 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-08 12:24:13.708479 (Thread-2): 15:24:13 | 12 of 18 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.23s]
2022-02-08 12:24:13.708834 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 12:24:13.709197 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 12:24:13.711721 (Thread-2): 15:24:13 | 14 of 18 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-08 12:24:13.713208 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:24:13.713684 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 12:24:13.739336 (Thread-1): SQL status: SELECT 0 in 0.08 seconds
2022-02-08 12:24:13.739939 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 12:24:13.744236 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:24:13.744983 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-08 12:24:13.745686 (Thread-2): finished collecting timing info
2022-02-08 12:24:13.751987 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:24:13.755433 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:24:13.755662 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:24:13.755890 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp152413753740"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:24:13.756200 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp152413661186'
        
      order by ordinal_position

  
2022-02-08 12:24:13.756655 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:24:13.766628 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:24:13.772302 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:24:13.772648 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.777926 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:24:13.785551 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:24:13.785846 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.789131 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-08 12:24:13.795665 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:24:13.795921 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:24:13.796139 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-08 12:24:13.797336 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 12:24:13.798867 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:24:13.799231 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:24:13.799451 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp152413661186"
    );
  
2022-02-08 12:24:13.799732 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:24:13.800192 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp152413753740'
        
      order by ordinal_position

  
2022-02-08 12:24:13.801682 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:24:13.803565 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 12:24:13.803857 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:24:13.804067 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 12:24:13.806713 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:24:13.809390 (Thread-1): finished collecting timing info
2022-02-08 12:24:13.809815 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-08 12:24:13.812791 (Thread-1): 15:24:13 | 13 of 18 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.25s]
2022-02-08 12:24:13.813274 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 12:24:13.813692 (Thread-1): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 12:24:13.816607 (Thread-1): 15:24:13 | 15 of 18 START table model public.dds_rate_gbp_usd................... [RUN]
2022-02-08 12:24:13.817814 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:24:13.818453 (Thread-1): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 12:24:13.835772 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 12:24:13.836311 (Thread-2): SQL status: SELECT 12 in 0.04 seconds
2022-02-08 12:24:13.843217 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:24:13.843551 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.843966 (Thread-1): finished collecting timing info
2022-02-08 12:24:13.854564 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 12:24:13.857512 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:24:13.863286 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:24:13.863546 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 12:24:13.863839 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:24:13.864109 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:24:13.870338 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 12:24:13.871957 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 12:24:13.872886 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:24:13.873186 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp152413753740"
    );
  
2022-02-08 12:24:13.875019 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:24:13.876846 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 12:24:13.877195 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:24:13.877470 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 12:24:13.879650 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 12:24:13.883847 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:24:13.884162 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:24:13.884421 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:24:13.886920 (Thread-2): finished collecting timing info
2022-02-08 12:24:13.887684 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-08 12:24:13.890689 (Thread-2): 15:24:13 | 14 of 18 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.18s]
2022-02-08 12:24:13.890952 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:24:13.891373 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 12:24:13.895123 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 12:24:13.895847 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 12:24:13.899237 (Thread-2): 15:24:13 | 16 of 18 START table model public.dds_wheat_usa...................... [RUN]
2022-02-08 12:24:13.900131 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:24:13.900901 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:24:13.901314 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-08 12:24:13.901920 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_usa
2022-02-08 12:24:13.909165 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:24:13.916613 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:24:13.918442 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 12:24:13.918688 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */


  create  table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp"
  as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );
2022-02-08 12:24:13.919580 (Thread-2): finished collecting timing info
2022-02-08 12:24:13.931009 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:24:13.931386 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_tmp" cascade
2022-02-08 12:24:13.931678 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:24:13.944227 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:24:13.948390 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:24:13.948622 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 12:24:13.950012 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:24:13.950324 (Thread-1): SQL status: SELECT 548 in 0.03 seconds
2022-02-08 12:24:13.951907 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 12:24:13.958384 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:24:13.959020 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd" rename to "dds_rate_gbp_usd__dbt_backup"
2022-02-08 12:24:13.959826 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:24:13.960148 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: BEGIN
2022-02-08 12:24:13.961203 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:13.965583 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:24:13.965857 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:24:13.966047 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-08 12:24:13.966348 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:24:13.966783 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */


  create  table "postgres"."public"."dds_wheat_usa__dbt_tmp"
  as (
    with usa as (
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0/2.7 as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_usa" as hu
    left join "postgres"."public"."sat_wheat_usa_details" as su
    on hu.date_pk=su.date_pk
)
select * from usa
  );
2022-02-08 12:24:13.968122 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:13.969647 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 12:24:13.969891 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:24:13.970036 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 12:24:13.973612 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:24:13.977000 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:24:13.977242 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:24:13.984208 (Thread-2): SQL status: SELECT 547 in 0.02 seconds
2022-02-08 12:24:13.989750 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:24:13.989979 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:24:13.990225 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa" rename to "dds_wheat_usa__dbt_backup"
2022-02-08 12:24:13.992690 (Thread-1): finished collecting timing info
2022-02-08 12:24:13.993232 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-08 12:24:13.995155 (Thread-1): 15:24:13 | 15 of 18 OK created table model public.dds_rate_gbp_usd.............. [SELECT 548 in 0.18s]
2022-02-08 12:24:13.995511 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:13.996065 (Thread-1): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 12:24:14.000590 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:24:14.001017 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 12:24:14.001469 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa__dbt_tmp" rename to "dds_wheat_usa"
2022-02-08 12:24:14.005201 (Thread-1): 15:24:14 | 17 of 18 START table model public.dds_wheat_msk...................... [RUN]
2022-02-08 12:24:14.006064 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:24:14.006405 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-08 12:24:14.012548 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 12:24:14.016405 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 12:24:14.017959 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 12:24:14.018600 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:24:14.018804 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 12:24:14.019126 (Thread-1): finished collecting timing info
2022-02-08 12:24:14.027109 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:24:14.029409 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:24:14.032472 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:24:14.032814 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-08 12:24:14.033015 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 12:24:14.033254 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:24:14.041869 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:24:14.045727 (Thread-2): finished collecting timing info
2022-02-08 12:24:14.046111 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: Close
2022-02-08 12:24:14.048377 (Thread-2): 15:24:14 | 16 of 18 OK created table model public.dds_wheat_usa................. [SELECT 547 in 0.15s]
2022-02-08 12:24:14.048710 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 12:24:14.049017 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 12:24:14.053615 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:24:14.054092 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 12:24:14.054696 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 12:24:14.056385 (Thread-2): 15:24:14 | 18 of 18 START table model public.dds_wheat_gbp...................... [RUN]
2022-02-08 12:24:14.057462 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:24:14.057801 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_gbp
2022-02-08 12:24:14.068457 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:24:14.069296 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 12:24:14.071109 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 12:24:14.072405 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:24:14.072890 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-08 12:24:14.073491 (Thread-2): finished collecting timing info
2022-02-08 12:24:14.079744 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:24:14.084367 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:24:14.084629 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:24:14.084942 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_tmp" cascade
2022-02-08 12:24:14.085225 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */


  create  table "postgres"."public"."dds_wheat_msk__dbt_tmp"
  as (
    with dds_wheat_msk as(
    select cast(su.tradedate as date) as tradedate
        ,hu.date_pk
        ,case when su.value=0 and su.volume>0 then cast(su.volume*su.close as decimal(18,2))
            else cast(su.value as decimal(18,2))
            end as value_all
        ,cast(su.open as decimal(18,2)) as open
        ,cast(su.close as decimal(18,2)) as close
        ,cast(su.high as decimal(18,2)) as high
        ,cast(su.low as decimal(18,2)) as low
        ,cast(su.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hu
    left join "postgres"."public"."sat_wheat_msk_details" as su
    on hu.date_pk=su.date_pk
)
select * from dds_wheat_msk
  );
2022-02-08 12:24:14.085548 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:24:14.098078 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:24:14.101896 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:24:14.102132 (Thread-1): SQL status: SELECT 216 in 0.02 seconds
2022-02-08 12:24:14.102405 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 12:24:14.108087 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:24:14.108555 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-08 12:24:14.109547 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:24:14.111288 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 12:24:14.111486 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:14.115427 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:24:14.115720 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-08 12:24:14.116104 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:24:14.116351 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: BEGIN
2022-02-08 12:24:14.117403 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:14.117688 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:24:14.119111 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 12:24:14.119380 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:24:14.119607 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:24:14.119844 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */


  create  table "postgres"."public"."dds_wheat_gbp__dbt_tmp"
  as (
    with gbp as(
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0*rt.rate as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_gbp" as hu
    left join "postgres"."public"."sat_wheat_gbp_details" as su
    on hu.date_pk=su.date_pk
    left join "postgres"."public"."dds_rate_gbp_usd" as rt
    on hu.date_pk=rt.date_pk
)
select * from gbp
  );
2022-02-08 12:24:14.120070 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 12:24:14.122873 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:24:14.126749 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:24:14.126978 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 12:24:14.133493 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:24:14.136840 (Thread-1): finished collecting timing info
2022-02-08 12:24:14.137254 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-08 12:24:14.139116 (Thread-1): 15:24:14 | 17 of 18 OK created table model public.dds_wheat_msk................. [SELECT 216 in 0.13s]
2022-02-08 12:24:14.139357 (Thread-2): SQL status: SELECT 531 in 0.02 seconds
2022-02-08 12:24:14.139749 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 12:24:14.146739 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:24:14.147449 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp" rename to "dds_wheat_gbp__dbt_backup"
2022-02-08 12:24:14.149326 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:14.153159 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:24:14.153376 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp__dbt_tmp" rename to "dds_wheat_gbp"
2022-02-08 12:24:14.154869 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:24:14.156447 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 12:24:14.156639 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:24:14.156768 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 12:24:14.159662 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:24:14.162547 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:24:14.162748 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 12:24:14.168048 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:24:14.171423 (Thread-2): finished collecting timing info
2022-02-08 12:24:14.171750 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: Close
2022-02-08 12:24:14.173559 (Thread-2): 15:24:14 | 18 of 18 OK created table model public.dds_wheat_gbp................. [SELECT 531 in 0.12s]
2022-02-08 12:24:14.173884 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 12:24:14.177132 (MainThread): Acquiring new postgres connection "master".
2022-02-08 12:24:14.177509 (MainThread): Using postgres connection "master".
2022-02-08 12:24:14.177647 (MainThread): On master: BEGIN
2022-02-08 12:24:14.177795 (MainThread): Opening a new connection, currently in state closed
2022-02-08 12:24:14.191179 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:24:14.191550 (MainThread): On master: COMMIT
2022-02-08 12:24:14.191674 (MainThread): Using postgres connection "master".
2022-02-08 12:24:14.191783 (MainThread): On master: COMMIT
2022-02-08 12:24:14.193139 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:24:14.193505 (MainThread): On master: Close
2022-02-08 12:24:14.194625 (MainThread): 15:24:14 | 
2022-02-08 12:24:14.195192 (MainThread): 15:24:14 | Finished running 4 view models, 6 table models, 8 incremental models in 2.56s.
2022-02-08 12:24:14.195479 (MainThread): Connection 'master' was properly closed.
2022-02-08 12:24:14.195704 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_msk' was properly closed.
2022-02-08 12:24:14.195965 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_gbp' was properly closed.
2022-02-08 12:24:14.355184 (MainThread): 
2022-02-08 12:24:14.355440 (MainThread): Completed successfully
2022-02-08 12:24:14.355639 (MainThread): 
Done. PASS=18 WARN=0 ERROR=0 SKIP=0 TOTAL=18
2022-02-08 12:24:14.355935 (MainThread): Flushing usage events
2022-02-08 12:37:34.583503 (MainThread): Running with dbt=0.19.0
2022-02-08 12:37:34.720413 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-08 12:37:34.721793 (MainThread): Tracking: do not track
2022-02-08 12:37:34.827762 (MainThread): Partial parsing not enabled
2022-02-08 12:37:34.829883 (MainThread): Parsing macros/adapters.sql
2022-02-08 12:37:34.866547 (MainThread): Parsing macros/catalog.sql
2022-02-08 12:37:34.870405 (MainThread): Parsing macros/relations.sql
2022-02-08 12:37:34.873055 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-08 12:37:34.878403 (MainThread): Parsing macros/core.sql
2022-02-08 12:37:34.883191 (MainThread): Parsing macros/adapters/common.sql
2022-02-08 12:37:34.957326 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-08 12:37:34.960821 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-08 12:37:34.964161 (MainThread): Parsing macros/etc/datetime.sql
2022-02-08 12:37:34.979567 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-08 12:37:34.982703 (MainThread): Parsing macros/etc/query.sql
2022-02-08 12:37:34.984659 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-08 12:37:34.986756 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-08 12:37:34.996759 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-08 12:37:35.023214 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-08 12:37:35.025446 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-08 12:37:35.054649 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-08 12:37:35.071897 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-08 12:37:35.077887 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-08 12:37:35.079891 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-08 12:37:35.092988 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-08 12:37:35.098181 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-08 12:37:35.107627 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-08 12:37:35.114375 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-08 12:37:35.116519 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-08 12:37:35.118205 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-08 12:37:35.120801 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-08 12:37:35.127286 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-08 12:37:35.129191 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-08 12:37:35.131424 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-08 12:37:35.132711 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-08 12:37:35.143193 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-08 12:37:35.146326 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-08 12:37:35.148673 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-08 12:37:35.151492 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-08 12:37:35.152404 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-08 12:37:35.154450 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-08 12:37:35.157518 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-08 12:37:35.159218 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-08 12:37:35.161086 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-08 12:37:35.163532 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-08 12:37:35.170092 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-08 12:37:35.173557 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-08 12:37:35.176009 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-08 12:37:35.177349 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-08 12:37:35.180513 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-08 12:37:35.183028 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-08 12:37:35.185128 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-08 12:37:35.190637 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-08 12:37:35.191957 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-08 12:37:35.193599 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-08 12:37:35.195915 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-08 12:37:35.198768 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-08 12:37:35.200553 (MainThread): Parsing macros/sql/star.sql
2022-02-08 12:37:35.204244 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-08 12:37:35.206157 (MainThread): Parsing macros/sql/pivot.sql
2022-02-08 12:37:35.210377 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-08 12:37:35.212391 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-08 12:37:35.219902 (MainThread): Parsing macros/sql/union.sql
2022-02-08 12:37:35.228588 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-08 12:37:35.230553 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-08 12:37:35.235071 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-08 12:37:35.238775 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-08 12:37:35.242461 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-08 12:37:35.249458 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-08 12:37:35.257743 (MainThread): Parsing macros/sql/groupby.sql
2022-02-08 12:37:35.260465 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-08 12:37:35.263183 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-08 12:37:35.266394 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-08 12:37:35.270244 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-08 12:37:35.271588 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-08 12:37:35.272980 (MainThread): Parsing macros/logger/log_info.sql
2022-02-08 12:37:35.274454 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-08 12:37:35.301839 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-08 12:37:35.303834 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-08 12:37:35.306369 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-08 12:37:35.308691 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-08 12:37:35.310771 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-08 12:37:35.317128 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-08 12:37:35.321140 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-08 12:37:35.324720 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-08 12:37:35.326881 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-08 12:37:35.329489 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-08 12:37:35.333238 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-08 12:37:35.338865 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-08 12:37:35.342189 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-08 12:37:35.351294 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-08 12:37:35.355356 (MainThread): Parsing macros/internal/alias.sql
2022-02-08 12:37:35.364219 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-08 12:37:35.366203 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-08 12:37:35.370565 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-08 12:37:35.375621 (MainThread): Parsing macros/internal/multikey.sql
2022-02-08 12:37:35.383610 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-08 12:37:35.397050 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-08 12:37:35.402976 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-08 12:37:35.404250 (MainThread): Parsing macros/tables/hub.sql
2022-02-08 12:37:35.417096 (MainThread): Parsing macros/tables/link.sql
2022-02-08 12:37:35.434560 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-08 12:37:35.452608 (MainThread): Parsing macros/tables/sat.sql
2022-02-08 12:37:35.466490 (MainThread): Parsing macros/tables/t_link.sql
2022-02-08 12:37:35.475805 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-08 12:37:35.496303 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-08 12:37:35.506545 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-08 12:37:35.527504 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-08 12:37:35.530340 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-08 12:37:35.555096 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-08 12:37:35.565596 (MainThread): Parsing macros/supporting/hash.sql
2022-02-08 12:37:35.573225 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-08 12:37:35.576516 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-08 12:37:35.583390 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-08 12:37:35.586180 (MainThread): Parsing macros/staging/stage.sql
2022-02-08 12:37:35.597590 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-08 12:37:35.607455 (MainThread): Partial parsing not enabled
2022-02-08 12:37:35.699742 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:35.793180 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:35.814323 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:35.834205 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:35.856183 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:35.889679 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:35.905863 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:35.927467 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:35.953731 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:36.096717 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:36.115397 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:36.137345 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:36.159337 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:36.170514 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:36.180318 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:36.195971 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:36.212798 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:36.225224 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:36.930570 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.raw_vault.links

2022-02-08 12:37:37.078003 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-08 12:37:37.078870 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-08 12:37:37.081181 (MainThread): 
2022-02-08 12:37:37.081858 (MainThread): Acquiring new postgres connection "master".
2022-02-08 12:37:37.104629 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-08 12:37:37.116719 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-08 12:37:37.116989 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-08 12:37:37.117083 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-08 12:37:37.214957 (ThreadPoolExecutor-0_0): SQL status: SELECT 18 in 0.10 seconds
2022-02-08 12:37:37.218574 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-08 12:37:37.245147 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-08 12:37:37.254312 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 12:37:37.254566 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-08 12:37:37.254732 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-08 12:37:37.273061 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-02-08 12:37:37.273313 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 12:37:37.273435 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-08 12:37:37.301606 (ThreadPoolExecutor-1_0): SQL status: SELECT 23 in 0.03 seconds
2022-02-08 12:37:37.318532 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-08 12:37:37.319918 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-08 12:37:37.352958 (MainThread): Using postgres connection "master".
2022-02-08 12:37:37.353242 (MainThread): On master: BEGIN
2022-02-08 12:37:37.353375 (MainThread): Opening a new connection, currently in state init
2022-02-08 12:37:37.366833 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:37.367097 (MainThread): Using postgres connection "master".
2022-02-08 12:37:37.367236 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-08 12:37:37.671697 (MainThread): SQL status: SELECT 10 in 0.30 seconds
2022-02-08 12:37:37.685035 (MainThread): On master: ROLLBACK
2022-02-08 12:37:37.686923 (MainThread): Using postgres connection "master".
2022-02-08 12:37:37.687171 (MainThread): On master: BEGIN
2022-02-08 12:37:37.689567 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:37.689885 (MainThread): On master: COMMIT
2022-02-08 12:37:37.690049 (MainThread): Using postgres connection "master".
2022-02-08 12:37:37.690198 (MainThread): On master: COMMIT
2022-02-08 12:37:37.691341 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:37.691625 (MainThread): On master: Close
2022-02-08 12:37:37.692303 (MainThread): 15:37:37 | Concurrency: 2 threads (target='dev')
2022-02-08 12:37:37.692780 (MainThread): 15:37:37 | 
2022-02-08 12:37:37.700430 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 12:37:37.700759 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 12:37:37.702096 (Thread-1): 15:37:37 | 1 of 18 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-08 12:37:37.703667 (Thread-2): 15:37:37 | 2 of 18 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-08 12:37:37.704569 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:37.705796 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:37.706340 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 12:37:37.706781 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 12:37:37.764392 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:37.769831 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-08 12:37:37.772514 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:37.772978 (Thread-2): Opening a new connection, currently in state init
2022-02-08 12:37:37.773440 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-08 12:37:37.774115 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:37.786259 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:37.786663 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:37.786867 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:37.788688 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:37.788995 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:37.789178 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:37.835933 (Thread-2): SQL status: SELECT 7 in 0.05 seconds
2022-02-08 12:37:37.836242 (Thread-1): SQL status: SELECT 6 in 0.05 seconds
2022-02-08 12:37:37.911638 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:37.914209 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:37.914483 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:37.914815 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:37.922433 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-08 12:37:37.939671 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 12:37:37.940393 (Thread-2): finished collecting timing info
2022-02-08 12:37:37.952787 (Thread-1): SQL status: SELECT 6 in 0.04 seconds
2022-02-08 12:37:37.979703 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 12:37:37.987358 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:37.987825 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-08 12:37:37.988634 (Thread-1): finished collecting timing info
2022-02-08 12:37:38.000768 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 12:37:38.000986 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:38.005282 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:38.005693 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 12:37:38.006074 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 12:37:38.008118 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:38.008379 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:38.012461 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:38.020355 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 12:37:38.020672 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:37:38.021459 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:38.021696 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:37:38.022696 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:38.024059 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 12:37:38.024763 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:38.026416 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:37:38.066663 (Thread-1): SQL status: CREATE VIEW in 0.04 seconds
2022-02-08 12:37:38.066935 (Thread-2): SQL status: CREATE VIEW in 0.05 seconds
2022-02-08 12:37:38.083662 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:38.087098 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:38.087457 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-08 12:37:38.087792 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-08 12:37:38.092742 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:38.096490 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:38.096763 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 12:37:38.096993 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-08 12:37:38.100689 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:38.101270 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-08 12:37:38.103311 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:38.109048 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 12:37:38.112546 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 12:37:38.114074 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 12:37:38.114451 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:38.114759 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:38.115059 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 12:37:38.115344 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 12:37:38.127106 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:37:38.127497 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:37:38.135870 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:38.138899 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:38.139258 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 12:37:38.139549 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:37:38.156349 (Thread-1): SQL status: DROP VIEW in 0.02 seconds
2022-02-08 12:37:38.156684 (Thread-2): SQL status: DROP VIEW in 0.02 seconds
2022-02-08 12:37:38.159558 (Thread-1): finished collecting timing info
2022-02-08 12:37:38.162747 (Thread-2): finished collecting timing info
2022-02-08 12:37:38.163248 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-08 12:37:38.163673 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-08 12:37:38.166549 (Thread-1): 15:37:38 | 1 of 18 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.46s]
2022-02-08 12:37:38.169359 (Thread-2): 15:37:38 | 2 of 18 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.46s]
2022-02-08 12:37:38.169941 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 12:37:38.170480 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 12:37:38.171228 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 12:37:38.172288 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 12:37:38.174630 (Thread-1): 15:37:38 | 3 of 18 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-08 12:37:38.177100 (Thread-2): 15:37:38 | 4 of 18 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-08 12:37:38.178066 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:38.178563 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 12:37:38.179470 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:38.190599 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 12:37:38.205326 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:38.210970 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-08 12:37:38.216571 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:38.220517 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:38.221085 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-08 12:37:38.221321 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:38.238214 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-08 12:37:38.238507 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-08 12:37:38.238729 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:38.238976 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:38.239505 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:38.239730 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:38.278549 (Thread-2): SQL status: SELECT 7 in 0.04 seconds
2022-02-08 12:37:38.288415 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:38.288681 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:38.307395 (Thread-2): SQL status: SELECT 7 in 0.02 seconds
2022-02-08 12:37:38.317667 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 12:37:38.318943 (Thread-2): finished collecting timing info
2022-02-08 12:37:38.330441 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:38.330747 (Thread-1): SQL status: SELECT 18 in 0.09 seconds
2022-02-08 12:37:38.330972 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-08 12:37:38.337751 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:38.338119 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:38.339470 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:38.342824 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:38.343044 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 12:37:38.344615 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:38.346381 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 12:37:38.347603 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:38.347841 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:37:38.359906 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-08 12:37:38.365022 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:38.365245 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-08 12:37:38.368394 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:38.371830 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:38.372060 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-08 12:37:38.374342 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:38.375855 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 12:37:38.376170 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:38.376414 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 12:37:38.380140 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:38.382640 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:38.382867 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 12:37:38.390285 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 12:37:38.393540 (Thread-2): finished collecting timing info
2022-02-08 12:37:38.393900 (Thread-1): SQL status: SELECT 18 in 0.06 seconds
2022-02-08 12:37:38.394397 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-08 12:37:38.413049 (Thread-2): 15:37:38 | 4 of 18 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.23s]
2022-02-08 12:37:38.415596 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 12:37:38.416031 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 12:37:38.416682 (Thread-2): Began running node model.project_otus_dbt.dim_day
2022-02-08 12:37:38.420018 (Thread-2): 15:37:38 | 5 of 18 START table model public.dim_day............................. [RUN]
2022-02-08 12:37:38.421178 (Thread-1): finished collecting timing info
2022-02-08 12:37:38.422257 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:38.432154 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:38.432487 (Thread-2): Compiling model.project_otus_dbt.dim_day
2022-02-08 12:37:38.432744 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-08 12:37:38.442303 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 12:37:38.443386 (Thread-2): finished collecting timing info
2022-02-08 12:37:38.449451 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 12:37:38.459501 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:38.465073 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 12:37:38.474966 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:38.475211 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:38.475381 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-08 12:37:38.476914 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 12:37:38.477242 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:38.478232 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:38.478454 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:37:38.491253 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:37:38.495513 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:38.495781 (Thread-1): SQL status: CREATE VIEW in 0.02 seconds
2022-02-08 12:37:38.495961 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 12:37:38.502123 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:38.502530 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-08 12:37:38.504090 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:38.511018 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 12:37:38.512756 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 12:37:38.516643 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:38.517332 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-08 12:37:38.517850 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:38.518078 (Thread-2): On model.project_otus_dbt.dim_day: BEGIN
2022-02-08 12:37:38.519424 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:38.519900 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:38.520109 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:38.521352 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 12:37:38.521677 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        date_trunc('week' , date) as first_day_week,
        extract('week' from date) as week_id,
        extract('year' from date)*100+extract('week' from date) as yearweek_id,

        to_char(date, 'MON') as month,
        concat(to_char(date, 'MM'), to_char(date, 'MON')) as mm_month,
        extract('month' from date) as moth_id,
        extract('year' from date)*100+extract('month' from date) as yearmonth_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
    from generate_series(date '2012-01-01',
                         date '2025-12-31',
                         interval '1 day')
             as t(date)
)

select * from dim_day
order by date desc
  );
2022-02-08 12:37:38.521946 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:38.522327 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 12:37:38.524797 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:38.527950 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:38.528209 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 12:37:38.534466 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 12:37:38.538400 (Thread-1): finished collecting timing info
2022-02-08 12:37:38.538762 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-08 12:37:38.540731 (Thread-1): 15:37:38 | 3 of 18 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.36s]
2022-02-08 12:37:38.541078 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 12:37:38.541386 (Thread-1): Began running node model.project_otus_dbt.dim_week
2022-02-08 12:37:38.544387 (Thread-1): 15:37:38 | 6 of 18 START table model public.dim_week............................ [RUN]
2022-02-08 12:37:38.545690 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:38.546231 (Thread-1): Compiling model.project_otus_dbt.dim_week
2022-02-08 12:37:38.555754 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 12:37:38.556568 (Thread-1): finished collecting timing info
2022-02-08 12:37:38.570246 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:38.570543 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-08 12:37:38.570782 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:38.588205 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 12:37:38.593475 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:38.593851 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 12:37:38.595979 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:38.598451 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 12:37:38.599417 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:38.599670 (Thread-1): On model.project_otus_dbt.dim_week: BEGIN
2022-02-08 12:37:38.601348 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:38.601656 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:38.601850 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-08 12:37:38.626886 (Thread-1): SQL status: SELECT 731 in 0.02 seconds
2022-02-08 12:37:38.635370 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:38.635782 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-08 12:37:38.642412 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 12:37:38.655863 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:38.656142 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-08 12:37:38.658130 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:38.659935 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 12:37:38.660193 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:38.660337 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 12:37:38.678048 (Thread-1): SQL status: COMMIT in 0.02 seconds
2022-02-08 12:37:38.682209 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:38.682562 (Thread-2): SQL status: SELECT 5114 in 0.16 seconds
2022-02-08 12:37:38.682809 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 12:37:38.689967 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:38.690555 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-08 12:37:38.692961 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:38.697786 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:38.698089 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-08 12:37:38.700236 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:38.702562 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 12:37:38.702990 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:38.703372 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 12:37:38.715421 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:37:38.718822 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:38.719074 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 12:37:38.728585 (Thread-1): SQL status: DROP TABLE in 0.04 seconds
2022-02-08 12:37:38.732203 (Thread-1): finished collecting timing info
2022-02-08 12:37:38.732579 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:37:38.732809 (Thread-1): On model.project_otus_dbt.dim_week: Close
2022-02-08 12:37:38.736824 (Thread-2): finished collecting timing info
2022-02-08 12:37:38.737674 (Thread-2): On model.project_otus_dbt.dim_day: Close
2022-02-08 12:37:38.740230 (Thread-1): 15:37:38 | 6 of 18 OK created table model public.dim_week....................... [SELECT 731 in 0.19s]
2022-02-08 12:37:38.743029 (Thread-2): 15:37:38 | 5 of 18 OK created table model public.dim_day........................ [SELECT 5114 in 0.32s]
2022-02-08 12:37:38.743444 (Thread-1): Finished running node model.project_otus_dbt.dim_week
2022-02-08 12:37:38.744179 (Thread-2): Finished running node model.project_otus_dbt.dim_day
2022-02-08 12:37:38.744704 (Thread-1): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 12:37:38.745657 (Thread-2): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 12:37:38.748064 (Thread-1): 15:37:38 | 7 of 18 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-08 12:37:38.749922 (Thread-2): 15:37:38 | 8 of 18 START incremental model public.sat_rate_gbp_usd_details...... [RUN]
2022-02-08 12:37:38.750767 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:38.751550 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:38.751885 (Thread-1): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 12:37:38.752346 (Thread-2): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 12:37:38.790092 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 12:37:38.806744 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 12:37:38.807542 (Thread-1): finished collecting timing info
2022-02-08 12:37:38.818955 (Thread-2): finished collecting timing info
2022-02-08 12:37:38.873521 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:38.877188 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:38.877484 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp153738863204"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:38.877755 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp153738875557"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:38.878029 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:38.878364 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:38.950524 (Thread-2): SQL status: SELECT 0 in 0.07 seconds
2022-02-08 12:37:38.954807 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:38.955035 (Thread-1): SQL status: SELECT 0 in 0.08 seconds
2022-02-08 12:37:38.955263 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-08 12:37:38.959102 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:38.959618 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-08 12:37:38.960859 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:38.961089 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:38.961289 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:38.961532 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:38.961740 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp153738875557'
        
      order by ordinal_position

  
2022-02-08 12:37:38.961942 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp153738863204'
        
      order by ordinal_position

  
2022-02-08 12:37:39.009613 (Thread-2): SQL status: SELECT 11 in 0.05 seconds
2022-02-08 12:37:39.016052 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:39.016329 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.028723 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:37:39.038360 (Thread-1): SQL status: SELECT 4 in 0.08 seconds
2022-02-08 12:37:39.039120 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:39.044132 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:39.044497 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.044764 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.049427 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-08 12:37:39.050677 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 12:37:39.051442 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:39.051626 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp153738875557"
    );
  
2022-02-08 12:37:39.055127 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:37:39.056616 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 12:37:39.056856 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:39.057000 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 12:37:39.059463 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:39.062102 (Thread-2): finished collecting timing info
2022-02-08 12:37:39.062476 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-08 12:37:39.064437 (Thread-2): 15:37:39 | 8 of 18 OK created incremental model public.sat_rate_gbp_usd_details. [INSERT 0 0 in 0.31s]
2022-02-08 12:37:39.064823 (Thread-2): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 12:37:39.065158 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 12:37:39.067916 (Thread-2): 15:37:39 | 9 of 18 START incremental model public.hub_wheat_gbp................. [RUN]
2022-02-08 12:37:39.068804 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:39.069380 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-08 12:37:39.080493 (Thread-1): SQL status: SELECT 4 in 0.04 seconds
2022-02-08 12:37:39.085476 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 12:37:39.091032 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:39.091597 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.092138 (Thread-2): finished collecting timing info
2022-02-08 12:37:39.101396 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:39.101671 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:37:39.101953 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp153739099908"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:39.103384 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 12:37:39.103729 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:39.104810 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:39.105119 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp153738863204"
    );
  
2022-02-08 12:37:39.106986 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:37:39.109625 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 12:37:39.109948 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:39.110043 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 12:37:39.113528 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:39.116037 (Thread-1): finished collecting timing info
2022-02-08 12:37:39.116559 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-08 12:37:39.118685 (Thread-1): 15:37:39 | 7 of 18 OK created incremental model public.hub_rate_gbp_usd......... [INSERT 0 0 in 0.37s]
2022-02-08 12:37:39.119051 (Thread-1): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 12:37:39.119407 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 12:37:39.122047 (Thread-1): 15:37:39 | 10 of 18 START incremental model public.sat_wheat_gbp_details........ [RUN]
2022-02-08 12:37:39.123287 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:39.123751 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 12:37:39.137065 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-08 12:37:39.147343 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:39.152848 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-08 12:37:39.154421 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 12:37:39.155314 (Thread-1): finished collecting timing info
2022-02-08 12:37:39.161201 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:39.165204 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:39.165580 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:39.165872 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp153739162819"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:39.166154 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp153739099908'
        
      order by ordinal_position

  
2022-02-08 12:37:39.166504 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:39.175855 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:37:39.180135 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:39.180397 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.184948 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 12:37:39.190613 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:39.190879 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.195495 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 12:37:39.196866 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 12:37:39.197798 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:39.198009 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp153739099908"
    );
  
2022-02-08 12:37:39.199589 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:37:39.201279 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 12:37:39.201536 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 12:37:39.201735 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:39.206167 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:39.206553 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 12:37:39.206778 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-08 12:37:39.208358 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:39.208607 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:39.208732 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp153739162819'
        
      order by ordinal_position

  
2022-02-08 12:37:39.209612 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:39.211537 (Thread-2): finished collecting timing info
2022-02-08 12:37:39.211869 (Thread-2): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-08 12:37:39.213553 (Thread-2): 15:37:39 | 9 of 18 OK created incremental model public.hub_wheat_gbp............ [INSERT 0 0 in 0.14s]
2022-02-08 12:37:39.213864 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 12:37:39.214145 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 12:37:39.216567 (Thread-2): 15:37:39 | 11 of 18 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-08 12:37:39.217770 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:39.218419 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-08 12:37:39.224521 (Thread-1): SQL status: SELECT 11 in 0.02 seconds
2022-02-08 12:37:39.234387 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:39.238418 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 12:37:39.238748 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.239856 (Thread-2): finished collecting timing info
2022-02-08 12:37:39.250428 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:39.250714 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:37:39.251056 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp153739248919"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:39.258133 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:39.258425 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:39.258667 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.263200 (Thread-1): SQL status: SELECT 11 in 0.00 seconds
2022-02-08 12:37:39.264493 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 12:37:39.265209 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:39.265365 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp153739162819"
    );
  
2022-02-08 12:37:39.266971 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:37:39.268569 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 12:37:39.268827 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:39.268961 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 12:37:39.271447 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:39.274121 (Thread-1): finished collecting timing info
2022-02-08 12:37:39.274574 (Thread-1): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-08 12:37:39.276727 (Thread-1): 15:37:39 | 10 of 18 OK created incremental model public.sat_wheat_gbp_details... [INSERT 0 0 in 0.15s]
2022-02-08 12:37:39.277122 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 12:37:39.277452 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 12:37:39.279936 (Thread-1): 15:37:39 | 12 of 18 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-08 12:37:39.281065 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:39.281665 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 12:37:39.289627 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-08 12:37:39.305316 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:39.310777 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-08 12:37:39.312389 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 12:37:39.313052 (Thread-1): finished collecting timing info
2022-02-08 12:37:39.319348 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:39.325337 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:39.325609 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:39.325870 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp153739323131"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:39.326142 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp153739248919'
        
      order by ordinal_position

  
2022-02-08 12:37:39.326403 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:39.334944 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:37:39.340345 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:39.340657 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.345853 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 12:37:39.404571 (Thread-1): SQL status: SELECT 0 in 0.08 seconds
2022-02-08 12:37:39.408225 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:39.412905 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:39.413265 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.413475 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-08 12:37:39.415318 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:39.415883 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:39.416140 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp153739323131'
        
      order by ordinal_position

  
2022-02-08 12:37:39.418067 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 12:37:39.419120 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 12:37:39.419681 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:39.419884 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp153739248919"
    );
  
2022-02-08 12:37:39.421370 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:37:39.422867 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 12:37:39.423105 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:39.423237 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 12:37:39.424180 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:37:39.429221 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:39.429461 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:37:39.429657 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.432307 (Thread-2): finished collecting timing info
2022-02-08 12:37:39.432862 (Thread-2): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-08 12:37:39.435591 (Thread-2): 15:37:39 | 11 of 18 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.22s]
2022-02-08 12:37:39.436058 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 12:37:39.436584 (Thread-2): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 12:37:39.439888 (Thread-2): 15:37:39 | 13 of 18 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-08 12:37:39.440254 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:37:39.440935 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:39.446552 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:39.446852 (Thread-2): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-08 12:37:39.447066 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.459970 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 12:37:39.461078 (Thread-2): finished collecting timing info
2022-02-08 12:37:39.473449 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:39.473791 (Thread-1): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:37:39.474073 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp153739470773"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:39.475307 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 12:37:39.475670 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:39.476552 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:39.476786 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp153739323131"
    );
  
2022-02-08 12:37:39.478754 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:37:39.480413 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 12:37:39.480661 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:39.480755 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 12:37:39.483010 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:39.485267 (Thread-1): finished collecting timing info
2022-02-08 12:37:39.485613 (Thread-1): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-08 12:37:39.487910 (Thread-1): 15:37:39 | 12 of 18 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.21s]
2022-02-08 12:37:39.488342 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 12:37:39.488750 (Thread-1): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 12:37:39.491846 (Thread-1): 15:37:39 | 14 of 18 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-08 12:37:39.493421 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:39.493905 (Thread-1): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 12:37:39.513089 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 12:37:39.525687 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 12:37:39.526910 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:39.527436 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-08 12:37:39.527857 (Thread-1): finished collecting timing info
2022-02-08 12:37:39.534523 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:39.538190 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:39.538508 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:39.538843 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp153739536550"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:39.539153 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp153739470773'
        
      order by ordinal_position

  
2022-02-08 12:37:39.539519 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:39.549493 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:37:39.555184 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:39.555574 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.560888 (Thread-2): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:37:39.566825 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:39.567134 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.571948 (Thread-2): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 12:37:39.573156 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 12:37:39.573770 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:39.573948 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp153739470773"
    );
  
2022-02-08 12:37:39.575496 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:37:39.576963 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 12:37:39.577180 (Thread-2): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:39.577297 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 12:37:39.579808 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:39.582130 (Thread-2): finished collecting timing info
2022-02-08 12:37:39.582476 (Thread-2): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-08 12:37:39.584377 (Thread-2): 15:37:39 | 13 of 18 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.14s]
2022-02-08 12:37:39.584751 (Thread-2): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 12:37:39.585062 (Thread-2): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 12:37:39.586975 (Thread-2): 15:37:39 | 15 of 18 START table model public.dds_rate_gbp_usd................... [RUN]
2022-02-08 12:37:39.587726 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:39.588140 (Thread-2): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 12:37:39.598792 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 12:37:39.600358 (Thread-2): finished collecting timing info
2022-02-08 12:37:39.607651 (Thread-1): SQL status: SELECT 0 in 0.07 seconds
2022-02-08 12:37:39.611776 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:39.616178 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:39.616685 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 12:37:39.616957 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-08 12:37:39.617229 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:39.618720 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:39.618951 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:39.619178 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp153739536550'
        
      order by ordinal_position

  
2022-02-08 12:37:39.627058 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 12:37:39.634925 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:39.635239 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.637710 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 12:37:39.641701 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:39.641940 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 12:37:39.642158 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:37:39.648691 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:39.649152 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:39.650182 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:39.651727 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 12:37:39.652476 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:39.652725 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-08 12:37:39.654145 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:39.654447 (Thread-1): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 12:37:39.654629 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:39.656087 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 12:37:39.656445 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */


  create  table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp"
  as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );
2022-02-08 12:37:39.657344 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:39.657625 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp153739536550"
    );
  
2022-02-08 12:37:39.659095 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:37:39.660369 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 12:37:39.660615 (Thread-1): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:39.660746 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 12:37:39.663429 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:39.666047 (Thread-1): finished collecting timing info
2022-02-08 12:37:39.666564 (Thread-1): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-08 12:37:39.669407 (Thread-1): 15:37:39 | 14 of 18 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.17s]
2022-02-08 12:37:39.669873 (Thread-1): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 12:37:39.670365 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 12:37:39.679034 (Thread-1): 15:37:39 | 16 of 18 START table model public.dds_wheat_usa...................... [RUN]
2022-02-08 12:37:39.679350 (Thread-2): SQL status: SELECT 548 in 0.02 seconds
2022-02-08 12:37:39.680376 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:39.685343 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:39.686054 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_usa
2022-02-08 12:37:39.686452 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd" rename to "dds_rate_gbp_usd__dbt_backup"
2022-02-08 12:37:39.698003 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 12:37:39.699003 (Thread-1): finished collecting timing info
2022-02-08 12:37:39.705280 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 12:37:39.709978 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:39.713761 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:39.714102 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_tmp" cascade
2022-02-08 12:37:39.714320 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-08 12:37:39.714568 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:39.716495 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:39.719073 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 12:37:39.719414 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:39.719666 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 12:37:39.722491 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:39.725966 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:39.726302 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:37:39.728837 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:37:39.733243 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:39.733516 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:37:39.733761 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 12:37:39.737607 (Thread-2): finished collecting timing info
2022-02-08 12:37:39.738402 (Thread-2): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-08 12:37:39.742144 (Thread-2): 15:37:39 | 15 of 18 OK created table model public.dds_rate_gbp_usd.............. [SELECT 548 in 0.15s]
2022-02-08 12:37:39.742592 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:39.743150 (Thread-2): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 12:37:39.746212 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 12:37:39.747010 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 12:37:39.750901 (Thread-2): 15:37:39 | 17 of 18 START table model public.dds_wheat_msk...................... [RUN]
2022-02-08 12:37:39.751638 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:39.752387 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:39.752678 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: BEGIN
2022-02-08 12:37:39.753025 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-08 12:37:39.760074 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:39.765787 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:39.768292 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 12:37:39.768576 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */


  create  table "postgres"."public"."dds_wheat_usa__dbt_tmp"
  as (
    with usa as (
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0/2.7 as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_usa" as hu
    left join "postgres"."public"."sat_wheat_usa_details" as su
    on hu.date_pk=su.date_pk
)
select * from usa
  );
2022-02-08 12:37:39.769540 (Thread-2): finished collecting timing info
2022-02-08 12:37:39.784901 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:39.785226 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-08 12:37:39.785415 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:39.789458 (Thread-1): SQL status: SELECT 547 in 0.02 seconds
2022-02-08 12:37:39.796407 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:39.796772 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa" rename to "dds_wheat_usa__dbt_backup"
2022-02-08 12:37:39.798766 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:37:39.799082 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:39.803008 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:39.807222 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:39.807632 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 12:37:39.807884 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa__dbt_tmp" rename to "dds_wheat_usa"
2022-02-08 12:37:39.809530 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:39.809890 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:39.811809 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 12:37:39.813988 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 12:37:39.814617 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:39.815022 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 12:37:39.815453 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:39.815751 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-08 12:37:39.817427 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:39.817718 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:39.817891 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */


  create  table "postgres"."public"."dds_wheat_msk__dbt_tmp"
  as (
    with dds_wheat_msk as(
    select cast(su.tradedate as date) as tradedate
        ,hu.date_pk
        ,case when su.value=0 and su.volume>0 then cast(su.volume*su.close as decimal(18,2))
            else cast(su.value as decimal(18,2))
            end as value_all
        ,cast(su.open as decimal(18,2)) as open
        ,cast(su.close as decimal(18,2)) as close
        ,cast(su.high as decimal(18,2)) as high
        ,cast(su.low as decimal(18,2)) as low
        ,cast(su.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hu
    left join "postgres"."public"."sat_wheat_msk_details" as su
    on hu.date_pk=su.date_pk
)
select * from dds_wheat_msk
  );
2022-02-08 12:37:39.818242 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:39.821295 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:39.821581 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 12:37:39.828987 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:37:39.832851 (Thread-1): finished collecting timing info
2022-02-08 12:37:39.833290 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: Close
2022-02-08 12:37:39.835583 (Thread-1): 15:37:39 | 16 of 18 OK created table model public.dds_wheat_usa................. [SELECT 547 in 0.15s]
2022-02-08 12:37:39.835854 (Thread-2): SQL status: SELECT 216 in 0.02 seconds
2022-02-08 12:37:39.836283 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 12:37:39.844484 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:39.844941 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 12:37:39.845521 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-08 12:37:39.847336 (Thread-1): 15:37:39 | 18 of 18 START table model public.dds_wheat_gbp...................... [RUN]
2022-02-08 12:37:39.848638 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:39.849311 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_gbp
2022-02-08 12:37:39.857908 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 12:37:39.874403 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:39.876194 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 12:37:39.876511 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-08 12:37:39.877713 (Thread-1): finished collecting timing info
2022-02-08 12:37:39.883888 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 12:37:39.891270 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 12:37:39.891606 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:39.891845 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:39.892054 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_tmp" cascade
2022-02-08 12:37:39.892240 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 12:37:39.892449 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:39.895128 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:39.898850 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:39.899128 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 12:37:39.903785 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:39.907616 (Thread-2): finished collecting timing info
2022-02-08 12:37:39.908038 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-08 12:37:39.911082 (Thread-2): 15:37:39 | 17 of 18 OK created table model public.dds_wheat_msk................. [SELECT 216 in 0.16s]
2022-02-08 12:37:39.911522 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 12:37:39.912049 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 12:37:39.916697 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:39.917669 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 12:37:39.919363 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:39.921048 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 12:37:39.921767 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:39.921993 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: BEGIN
2022-02-08 12:37:39.923561 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:39.923850 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:39.924009 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */


  create  table "postgres"."public"."dds_wheat_gbp__dbt_tmp"
  as (
    with gbp as(
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0*rt.rate as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_gbp" as hu
    left join "postgres"."public"."sat_wheat_gbp_details" as su
    on hu.date_pk=su.date_pk
    left join "postgres"."public"."dds_rate_gbp_usd" as rt
    on hu.date_pk=rt.date_pk
)
select * from gbp
  );
2022-02-08 12:37:39.939814 (Thread-1): SQL status: SELECT 531 in 0.02 seconds
2022-02-08 12:37:39.945239 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:39.945447 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp" rename to "dds_wheat_gbp__dbt_backup"
2022-02-08 12:37:39.947033 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:39.950047 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:39.950255 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp__dbt_tmp" rename to "dds_wheat_gbp"
2022-02-08 12:37:39.951952 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:39.953516 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 12:37:39.953675 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:39.953779 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 12:37:39.956752 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:39.961476 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:39.961703 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 12:37:39.968457 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:37:39.973433 (Thread-1): finished collecting timing info
2022-02-08 12:37:39.973942 (Thread-1): On model.project_otus_dbt.dds_wheat_gbp: Close
2022-02-08 12:37:39.978140 (Thread-1): 15:37:39 | 18 of 18 OK created table model public.dds_wheat_gbp................. [SELECT 531 in 0.13s]
2022-02-08 12:37:39.978685 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 12:37:39.982674 (MainThread): Acquiring new postgres connection "master".
2022-02-08 12:37:39.983021 (MainThread): Using postgres connection "master".
2022-02-08 12:37:39.983154 (MainThread): On master: BEGIN
2022-02-08 12:37:39.983299 (MainThread): Opening a new connection, currently in state closed
2022-02-08 12:37:39.994582 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:39.994916 (MainThread): On master: COMMIT
2022-02-08 12:37:39.995051 (MainThread): Using postgres connection "master".
2022-02-08 12:37:39.995179 (MainThread): On master: COMMIT
2022-02-08 12:37:39.996304 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:39.996567 (MainThread): On master: Close
2022-02-08 12:37:39.997208 (MainThread): 15:37:39 | 
2022-02-08 12:37:39.997515 (MainThread): 15:37:39 | Finished running 4 view models, 6 table models, 8 incremental models in 2.92s.
2022-02-08 12:37:39.997774 (MainThread): Connection 'master' was properly closed.
2022-02-08 12:37:39.997942 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_gbp' was properly closed.
2022-02-08 12:37:39.998108 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_msk' was properly closed.
2022-02-08 12:37:40.126500 (MainThread): 
2022-02-08 12:37:40.127055 (MainThread): Completed successfully
2022-02-08 12:37:40.127461 (MainThread): 
Done. PASS=18 WARN=0 ERROR=0 SKIP=0 TOTAL=18
2022-02-08 12:37:40.128028 (MainThread): Flushing usage events
2022-02-08 12:37:44.414009 (MainThread): Running with dbt=0.19.0
2022-02-08 12:37:44.508673 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-02-08 12:37:44.509708 (MainThread): Tracking: do not track
2022-02-08 12:37:44.602323 (MainThread): Partial parsing not enabled
2022-02-08 12:37:44.603323 (MainThread): Parsing macros/adapters.sql
2022-02-08 12:37:44.625293 (MainThread): Parsing macros/catalog.sql
2022-02-08 12:37:44.627651 (MainThread): Parsing macros/relations.sql
2022-02-08 12:37:44.629049 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-08 12:37:44.635581 (MainThread): Parsing macros/core.sql
2022-02-08 12:37:44.643011 (MainThread): Parsing macros/adapters/common.sql
2022-02-08 12:37:44.715715 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-08 12:37:44.718155 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-08 12:37:44.720161 (MainThread): Parsing macros/etc/datetime.sql
2022-02-08 12:37:44.730150 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-08 12:37:44.732279 (MainThread): Parsing macros/etc/query.sql
2022-02-08 12:37:44.733918 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-08 12:37:44.735682 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-08 12:37:44.746081 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-08 12:37:44.766617 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-08 12:37:44.768634 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-08 12:37:44.815082 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-08 12:37:44.838866 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-08 12:37:44.848584 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-08 12:37:44.851359 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-08 12:37:44.871192 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-08 12:37:44.878815 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-08 12:37:44.888952 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-08 12:37:44.899114 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-08 12:37:44.902090 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-08 12:37:44.904641 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-08 12:37:44.907637 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-08 12:37:44.913972 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-08 12:37:44.916879 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-08 12:37:44.920278 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-08 12:37:44.922158 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-08 12:37:44.936468 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-08 12:37:44.939474 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-08 12:37:44.941926 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-08 12:37:44.945855 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-08 12:37:44.947064 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-08 12:37:44.949304 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-08 12:37:44.954072 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-08 12:37:44.956157 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-08 12:37:44.958114 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-08 12:37:44.960878 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-08 12:37:44.967639 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-08 12:37:44.971379 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-08 12:37:44.973902 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-08 12:37:44.975201 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-08 12:37:44.977077 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-08 12:37:44.978640 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-08 12:37:44.980077 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-08 12:37:44.985319 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-08 12:37:44.986574 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-08 12:37:44.988359 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-08 12:37:44.990404 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-08 12:37:44.993258 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-08 12:37:44.995069 (MainThread): Parsing macros/sql/star.sql
2022-02-08 12:37:44.998771 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-08 12:37:45.000644 (MainThread): Parsing macros/sql/pivot.sql
2022-02-08 12:37:45.004842 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-08 12:37:45.006665 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-08 12:37:45.018576 (MainThread): Parsing macros/sql/union.sql
2022-02-08 12:37:45.030501 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-08 12:37:45.033583 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-08 12:37:45.040736 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-08 12:37:45.045411 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-08 12:37:45.049327 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-08 12:37:45.056067 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-08 12:37:45.060937 (MainThread): Parsing macros/sql/groupby.sql
2022-02-08 12:37:45.062512 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-08 12:37:45.064296 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-08 12:37:45.066806 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-08 12:37:45.070590 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-08 12:37:45.072150 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-08 12:37:45.073777 (MainThread): Parsing macros/logger/log_info.sql
2022-02-08 12:37:45.075252 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-08 12:37:45.100179 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-08 12:37:45.102209 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-08 12:37:45.104783 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-08 12:37:45.106906 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-08 12:37:45.108904 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-08 12:37:45.115136 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-08 12:37:45.119545 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-08 12:37:45.124456 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-08 12:37:45.126674 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-08 12:37:45.128593 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-08 12:37:45.130880 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-08 12:37:45.134114 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-08 12:37:45.136303 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-08 12:37:45.141917 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-08 12:37:45.144556 (MainThread): Parsing macros/internal/alias.sql
2022-02-08 12:37:45.148230 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-08 12:37:45.149125 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-08 12:37:45.151829 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-08 12:37:45.155294 (MainThread): Parsing macros/internal/multikey.sql
2022-02-08 12:37:45.160369 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-08 12:37:45.171899 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-08 12:37:45.176344 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-08 12:37:45.177263 (MainThread): Parsing macros/tables/hub.sql
2022-02-08 12:37:45.189438 (MainThread): Parsing macros/tables/link.sql
2022-02-08 12:37:45.200071 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-08 12:37:45.212053 (MainThread): Parsing macros/tables/sat.sql
2022-02-08 12:37:45.220701 (MainThread): Parsing macros/tables/t_link.sql
2022-02-08 12:37:45.224916 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-08 12:37:45.243548 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-08 12:37:45.255465 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-08 12:37:45.274369 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-08 12:37:45.275780 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-08 12:37:45.308546 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-08 12:37:45.317333 (MainThread): Parsing macros/supporting/hash.sql
2022-02-08 12:37:45.324932 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-08 12:37:45.327819 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-08 12:37:45.335032 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-08 12:37:45.338128 (MainThread): Parsing macros/staging/stage.sql
2022-02-08 12:37:45.351318 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-08 12:37:45.363237 (MainThread): Partial parsing not enabled
2022-02-08 12:37:45.460485 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:45.571945 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:45.610928 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:45.643739 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:45.679292 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:45.722175 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:45.740815 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:45.760941 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:45.776580 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:45.884985 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:45.910634 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:45.940551 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:45.969448 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:45.984525 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:46.000441 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:46.019056 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:46.040275 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:46.055237 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:46.769384 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.raw_vault.links

2022-02-08 12:37:46.905428 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-08 12:37:46.906082 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-08 12:37:46.908154 (MainThread): 
2022-02-08 12:37:46.908950 (MainThread): Acquiring new postgres connection "master".
2022-02-08 12:37:46.916492 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-08 12:37:46.929031 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-08 12:37:46.929343 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-08 12:37:46.929448 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-08 12:37:46.942658 (ThreadPoolExecutor-0_0): SQL status: SELECT 20 in 0.01 seconds
2022-02-08 12:37:46.945806 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-08 12:37:46.977774 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-08 12:37:46.986090 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 12:37:46.986296 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-08 12:37:46.986382 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-08 12:37:46.998516 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:46.998738 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 12:37:46.998842 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-08 12:37:47.003278 (ThreadPoolExecutor-1_0): SQL status: SELECT 23 in 0.00 seconds
2022-02-08 12:37:47.018970 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-08 12:37:47.020247 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-08 12:37:47.054538 (MainThread): Using postgres connection "master".
2022-02-08 12:37:47.054773 (MainThread): On master: BEGIN
2022-02-08 12:37:47.054980 (MainThread): Opening a new connection, currently in state init
2022-02-08 12:37:47.067015 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:47.067280 (MainThread): Using postgres connection "master".
2022-02-08 12:37:47.067418 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-08 12:37:47.383420 (MainThread): SQL status: SELECT 10 in 0.32 seconds
2022-02-08 12:37:47.395069 (MainThread): On master: ROLLBACK
2022-02-08 12:37:47.396504 (MainThread): Using postgres connection "master".
2022-02-08 12:37:47.396740 (MainThread): On master: BEGIN
2022-02-08 12:37:47.398692 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:47.398984 (MainThread): On master: COMMIT
2022-02-08 12:37:47.399132 (MainThread): Using postgres connection "master".
2022-02-08 12:37:47.399270 (MainThread): On master: COMMIT
2022-02-08 12:37:47.400354 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:47.400570 (MainThread): On master: Close
2022-02-08 12:37:47.401005 (MainThread): 15:37:47 | Concurrency: 2 threads (target='dev')
2022-02-08 12:37:47.401263 (MainThread): 15:37:47 | 
2022-02-08 12:37:47.407315 (Thread-1): Began running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-08 12:37:47.407681 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_gbp
2022-02-08 12:37:47.409325 (Thread-1): 15:37:47 | 1 of 4 START seed file public.source_rate_gbp_usd.................... [RUN]
2022-02-08 12:37:47.410616 (Thread-2): 15:37:47 | 2 of 4 START seed file public.source_wheat_gbp....................... [RUN]
2022-02-08 12:37:47.411153 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-08 12:37:47.411966 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-08 12:37:47.412338 (Thread-1): finished collecting timing info
2022-02-08 12:37:47.413126 (Thread-2): finished collecting timing info
2022-02-08 12:37:47.584803 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-08 12:37:47.585941 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-08 12:37:47.586299 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: BEGIN
2022-02-08 12:37:47.586663 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: BEGIN
2022-02-08 12:37:47.587032 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:47.587313 (Thread-2): Opening a new connection, currently in state init
2022-02-08 12:37:47.601847 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:47.602152 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-08 12:37:47.602346 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_gbp"} */
truncate table "postgres"."public"."source_wheat_gbp"
2022-02-08 12:37:47.603027 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-08 12:37:47.603428 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-08 12:37:47.603653 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_rate_gbp_usd"} */
truncate table "postgres"."public"."source_rate_gbp_usd"
2022-02-08 12:37:47.609812 (Thread-2): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-08 12:37:47.610120 (Thread-1): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-08 12:37:47.641304 (Thread-2): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-08 12:37:47.643916 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-08 12:37:47.671695 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-08 12:37:47.676707 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-08 12:37:47.676970 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: 
            insert into "postgres"."public"."source_wheat_gbp" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-08 12:37:47.677204 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: 
            insert into "postgres"."public"."source_rate_gbp_usd" (TRADEDATE, PRICE, OPEN, HIGH, LOW, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s...
2022-02-08 12:37:47.695522 (Thread-2): SQL status: INSERT 0 531 in 0.02 seconds
2022-02-08 12:37:47.701516 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_gbp"
2022-02-08 12:37:47.701875 (Thread-1): SQL status: INSERT 0 548 in 0.02 seconds
2022-02-08 12:37:47.703008 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_rate_gbp_usd"
2022-02-08 12:37:47.714268 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-08 12:37:47.714848 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-08 12:37:47.714997 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-08 12:37:47.718287 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-08 12:37:47.718782 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-08 12:37:47.718880 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-08 12:37:47.724080 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:37:47.724298 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:37:47.726787 (Thread-2): finished collecting timing info
2022-02-08 12:37:47.729806 (Thread-1): finished collecting timing info
2022-02-08 12:37:47.730305 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: Close
2022-02-08 12:37:47.730598 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: Close
2022-02-08 12:37:47.731774 (Thread-1): 15:37:47 | 1 of 4 OK loaded seed file public.source_rate_gbp_usd................ [INSERT 548 in 0.32s]
2022-02-08 12:37:47.732863 (Thread-2): 15:37:47 | 2 of 4 OK loaded seed file public.source_wheat_gbp................... [INSERT 531 in 0.32s]
2022-02-08 12:37:47.733260 (Thread-1): Finished running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-08 12:37:47.733924 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_gbp
2022-02-08 12:37:47.734534 (Thread-1): Began running node seed.project_otus_dbt.source_wheat_msk
2022-02-08 12:37:47.736126 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_usa
2022-02-08 12:37:47.739229 (Thread-1): 15:37:47 | 3 of 4 START seed file public.source_wheat_msk....................... [RUN]
2022-02-08 12:37:47.741150 (Thread-2): 15:37:47 | 4 of 4 START seed file public.source_wheat_usa....................... [RUN]
2022-02-08 12:37:47.741988 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-08 12:37:47.742694 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-08 12:37:47.743000 (Thread-1): finished collecting timing info
2022-02-08 12:37:47.743711 (Thread-2): finished collecting timing info
2022-02-08 12:37:47.790434 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-08 12:37:47.796269 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-08 12:37:47.796599 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: BEGIN
2022-02-08 12:37:47.796895 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: BEGIN
2022-02-08 12:37:47.797274 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:47.797543 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:47.808343 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:47.808611 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-08 12:37:47.808834 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_msk"} */
truncate table "postgres"."public"."source_wheat_msk"
2022-02-08 12:37:47.809530 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:47.809774 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-08 12:37:47.809902 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_usa"} */
truncate table "postgres"."public"."source_wheat_usa"
2022-02-08 12:37:47.814929 (Thread-1): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-08 12:37:47.822345 (Thread-2): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-08 12:37:47.829670 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-08 12:37:47.835442 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: 
            insert into "postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s)
        ...
2022-02-08 12:37:47.836144 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-08 12:37:47.836630 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: 
            insert into "postgres"."public"."source_wheat_msk" (BOARDID, SECID, TRADEDATE, SHORTNAME, NAME, CLOSE, OPEN, HIGH, LOW, VALUE, DURATION, YIELD, DECIMALS, CAPITALIZATION, CURRENCYID, DIVISOR, TRADINGSESSION, VOLUME) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%...
2022-02-08 12:37:47.841837 (Thread-2): SQL status: INSERT 0 1 in 0.01 seconds
2022-02-08 12:37:47.842718 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_usa"
2022-02-08 12:37:47.848247 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-08 12:37:47.848631 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-08 12:37:47.848855 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-08 12:37:47.852692 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:47.856217 (Thread-2): finished collecting timing info
2022-02-08 12:37:47.856805 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: Close
2022-02-08 12:37:47.857968 (Thread-2): 15:37:47 | 4 of 4 OK loaded seed file public.source_wheat_usa................... [INSERT 1 in 0.11s]
2022-02-08 12:37:47.858514 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_usa
2022-02-08 12:37:47.859122 (Thread-1): SQL status: INSERT 0 216 in 0.02 seconds
2022-02-08 12:37:47.860619 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_msk"
2022-02-08 12:37:47.865868 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-08 12:37:47.866190 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-08 12:37:47.866432 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-08 12:37:47.870366 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:47.874842 (Thread-1): finished collecting timing info
2022-02-08 12:37:47.875331 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: Close
2022-02-08 12:37:47.876426 (Thread-1): 15:37:47 | 3 of 4 OK loaded seed file public.source_wheat_msk................... [INSERT 216 in 0.13s]
2022-02-08 12:37:47.876845 (Thread-1): Finished running node seed.project_otus_dbt.source_wheat_msk
2022-02-08 12:37:47.880693 (MainThread): Acquiring new postgres connection "master".
2022-02-08 12:37:47.881146 (MainThread): Using postgres connection "master".
2022-02-08 12:37:47.881315 (MainThread): On master: BEGIN
2022-02-08 12:37:47.881456 (MainThread): Opening a new connection, currently in state closed
2022-02-08 12:37:47.893919 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:47.894219 (MainThread): On master: COMMIT
2022-02-08 12:37:47.894359 (MainThread): Using postgres connection "master".
2022-02-08 12:37:47.894478 (MainThread): On master: COMMIT
2022-02-08 12:37:47.895852 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:47.896277 (MainThread): On master: Close
2022-02-08 12:37:47.897332 (MainThread): 15:37:47 | 
2022-02-08 12:37:47.897760 (MainThread): 15:37:47 | Finished running 4 seeds in 0.99s.
2022-02-08 12:37:47.898217 (MainThread): Connection 'master' was properly closed.
2022-02-08 12:37:47.898566 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_msk' was properly closed.
2022-02-08 12:37:47.898732 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_usa' was properly closed.
2022-02-08 12:37:48.025009 (MainThread): 
2022-02-08 12:37:48.025330 (MainThread): Completed successfully
2022-02-08 12:37:48.025624 (MainThread): 
Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
2022-02-08 12:37:48.026029 (MainThread): Flushing usage events
2022-02-08 12:37:52.243543 (MainThread): Running with dbt=0.19.0
2022-02-08 12:37:52.355787 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-08 12:37:52.356843 (MainThread): Tracking: do not track
2022-02-08 12:37:52.426842 (MainThread): Partial parsing not enabled
2022-02-08 12:37:52.427794 (MainThread): Parsing macros/adapters.sql
2022-02-08 12:37:52.447736 (MainThread): Parsing macros/catalog.sql
2022-02-08 12:37:52.450166 (MainThread): Parsing macros/relations.sql
2022-02-08 12:37:52.451595 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-08 12:37:52.454093 (MainThread): Parsing macros/core.sql
2022-02-08 12:37:52.458032 (MainThread): Parsing macros/adapters/common.sql
2022-02-08 12:37:52.499175 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-08 12:37:52.501259 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-08 12:37:52.502961 (MainThread): Parsing macros/etc/datetime.sql
2022-02-08 12:37:52.513851 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-08 12:37:52.516556 (MainThread): Parsing macros/etc/query.sql
2022-02-08 12:37:52.517753 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-08 12:37:52.518760 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-08 12:37:52.527705 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-08 12:37:52.555968 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-08 12:37:52.560240 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-08 12:37:52.607190 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-08 12:37:52.638585 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-08 12:37:52.646833 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-08 12:37:52.649631 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-08 12:37:52.667091 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-08 12:37:52.674264 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-08 12:37:52.681809 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-08 12:37:52.689110 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-08 12:37:52.691306 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-08 12:37:52.693035 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-08 12:37:52.695058 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-08 12:37:52.699069 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-08 12:37:52.700857 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-08 12:37:52.702987 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-08 12:37:52.704110 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-08 12:37:52.713475 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-08 12:37:52.715578 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-08 12:37:52.717259 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-08 12:37:52.719913 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-08 12:37:52.720852 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-08 12:37:52.723233 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-08 12:37:52.727532 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-08 12:37:52.729952 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-08 12:37:52.732313 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-08 12:37:52.734982 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-08 12:37:52.742649 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-08 12:37:52.746402 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-08 12:37:52.749086 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-08 12:37:52.750455 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-08 12:37:52.752352 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-08 12:37:52.754059 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-08 12:37:52.755739 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-08 12:37:52.761513 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-08 12:37:52.762884 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-08 12:37:52.764550 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-08 12:37:52.766699 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-08 12:37:52.769875 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-08 12:37:52.771975 (MainThread): Parsing macros/sql/star.sql
2022-02-08 12:37:52.776224 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-08 12:37:52.778290 (MainThread): Parsing macros/sql/pivot.sql
2022-02-08 12:37:52.782842 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-08 12:37:52.784862 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-08 12:37:52.792845 (MainThread): Parsing macros/sql/union.sql
2022-02-08 12:37:52.801229 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-08 12:37:52.803308 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-08 12:37:52.807842 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-08 12:37:52.811494 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-08 12:37:52.815190 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-08 12:37:52.822361 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-08 12:37:52.827549 (MainThread): Parsing macros/sql/groupby.sql
2022-02-08 12:37:52.829224 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-08 12:37:52.831206 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-08 12:37:52.833963 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-08 12:37:52.838027 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-08 12:37:52.839494 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-08 12:37:52.841013 (MainThread): Parsing macros/logger/log_info.sql
2022-02-08 12:37:52.842381 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-08 12:37:52.868982 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-08 12:37:52.871171 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-08 12:37:52.873641 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-08 12:37:52.875790 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-08 12:37:52.877809 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-08 12:37:52.884337 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-08 12:37:52.888356 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-08 12:37:52.891168 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-08 12:37:52.892865 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-08 12:37:52.894644 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-08 12:37:52.897200 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-08 12:37:52.900864 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-08 12:37:52.902933 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-08 12:37:52.908986 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-08 12:37:52.911853 (MainThread): Parsing macros/internal/alias.sql
2022-02-08 12:37:52.916349 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-08 12:37:52.917404 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-08 12:37:52.920113 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-08 12:37:52.923561 (MainThread): Parsing macros/internal/multikey.sql
2022-02-08 12:37:52.929363 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-08 12:37:52.939830 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-08 12:37:52.943286 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-08 12:37:52.943840 (MainThread): Parsing macros/tables/hub.sql
2022-02-08 12:37:52.957501 (MainThread): Parsing macros/tables/link.sql
2022-02-08 12:37:52.973058 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-08 12:37:52.987088 (MainThread): Parsing macros/tables/sat.sql
2022-02-08 12:37:52.996491 (MainThread): Parsing macros/tables/t_link.sql
2022-02-08 12:37:53.001139 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-08 12:37:53.020467 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-08 12:37:53.027980 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-08 12:37:53.046665 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-08 12:37:53.048105 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-08 12:37:53.067572 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-08 12:37:53.074765 (MainThread): Parsing macros/supporting/hash.sql
2022-02-08 12:37:53.081800 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-08 12:37:53.083299 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-08 12:37:53.091703 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-08 12:37:53.095965 (MainThread): Parsing macros/staging/stage.sql
2022-02-08 12:37:53.108379 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-08 12:37:53.119287 (MainThread): Partial parsing not enabled
2022-02-08 12:37:53.238593 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:53.353551 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:53.385795 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:53.412330 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:53.440888 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:53.474477 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:53.495364 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:53.510983 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:53.525926 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:53.625507 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:53.648556 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:53.667455 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:53.687515 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:53.698500 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:53.708620 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:53.722362 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:53.737426 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:53.749722 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:54.433309 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.raw_vault.links

2022-02-08 12:37:54.547634 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-08 12:37:54.548242 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-08 12:37:54.550687 (MainThread): 
2022-02-08 12:37:54.551539 (MainThread): Acquiring new postgres connection "master".
2022-02-08 12:37:54.582640 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-08 12:37:54.597413 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-08 12:37:54.597663 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-08 12:37:54.597853 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-08 12:37:54.611823 (ThreadPoolExecutor-0_0): SQL status: SELECT 20 in 0.01 seconds
2022-02-08 12:37:54.615016 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-08 12:37:54.649436 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-08 12:37:54.656724 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 12:37:54.656995 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-08 12:37:54.657159 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-08 12:37:54.669231 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:54.669493 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 12:37:54.669665 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-08 12:37:54.673646 (ThreadPoolExecutor-1_0): SQL status: SELECT 23 in 0.00 seconds
2022-02-08 12:37:54.690684 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-08 12:37:54.691991 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-08 12:37:54.729026 (MainThread): Using postgres connection "master".
2022-02-08 12:37:54.729241 (MainThread): On master: BEGIN
2022-02-08 12:37:54.729329 (MainThread): Opening a new connection, currently in state init
2022-02-08 12:37:54.740808 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:54.741029 (MainThread): Using postgres connection "master".
2022-02-08 12:37:54.741106 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-08 12:37:54.986214 (MainThread): SQL status: SELECT 10 in 0.24 seconds
2022-02-08 12:37:54.995626 (MainThread): On master: ROLLBACK
2022-02-08 12:37:54.997120 (MainThread): Using postgres connection "master".
2022-02-08 12:37:54.997419 (MainThread): On master: BEGIN
2022-02-08 12:37:54.999421 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:54.999648 (MainThread): On master: COMMIT
2022-02-08 12:37:54.999755 (MainThread): Using postgres connection "master".
2022-02-08 12:37:54.999853 (MainThread): On master: COMMIT
2022-02-08 12:37:55.000946 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:55.001146 (MainThread): On master: Close
2022-02-08 12:37:55.001559 (MainThread): 15:37:54 | Concurrency: 2 threads (target='dev')
2022-02-08 12:37:55.001821 (MainThread): 15:37:54 | 
2022-02-08 12:37:55.008240 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 12:37:55.008569 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 12:37:55.010073 (Thread-1): 15:37:55 | 1 of 18 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-08 12:37:55.012042 (Thread-2): 15:37:55 | 2 of 18 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-08 12:37:55.012844 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:55.013776 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:55.014131 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 12:37:55.014494 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 12:37:55.076880 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:55.079182 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:55.079460 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-08 12:37:55.079778 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-08 12:37:55.080139 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:55.080490 (Thread-2): Opening a new connection, currently in state init
2022-02-08 12:37:55.094164 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:55.094454 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:55.094854 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:55.095177 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:55.095606 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:55.095857 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:55.104700 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-08 12:37:55.174457 (Thread-2): SQL status: SELECT 7 in 0.08 seconds
2022-02-08 12:37:55.178056 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:55.186086 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:55.186346 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:55.186665 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:55.192304 (Thread-2): SQL status: SELECT 7 in 0.00 seconds
2022-02-08 12:37:55.192590 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-08 12:37:55.198643 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 12:37:55.203848 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 12:37:55.205150 (Thread-1): finished collecting timing info
2022-02-08 12:37:55.205706 (Thread-2): finished collecting timing info
2022-02-08 12:37:55.273869 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:55.276133 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:55.276387 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-08 12:37:55.276658 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 12:37:55.278333 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:55.278642 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:55.282211 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:55.286963 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:55.287354 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:37:55.287608 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 12:37:55.289400 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:55.289623 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:55.295163 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 12:37:55.296927 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 12:37:55.297635 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:55.297826 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:55.297993 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:37:55.298196 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:37:55.303669 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-08 12:37:55.303922 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-08 12:37:55.313857 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:55.319980 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:55.320197 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-08 12:37:55.320407 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-08 12:37:55.322168 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:55.322408 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:55.325339 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:55.328714 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:55.329049 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-08 12:37:55.329249 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-08 12:37:55.332054 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:55.332276 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:55.341239 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 12:37:55.343037 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 12:37:55.343451 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:55.343818 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:55.344169 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 12:37:55.344516 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 12:37:55.347726 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:55.352911 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:37:55.353229 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:37:55.353490 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:37:55.357005 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:37:55.357545 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 12:37:55.360877 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:55.363777 (Thread-2): finished collecting timing info
2022-02-08 12:37:55.364105 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 12:37:55.364420 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-08 12:37:55.368166 (Thread-1): finished collecting timing info
2022-02-08 12:37:55.370556 (Thread-2): 15:37:55 | 2 of 18 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.36s]
2022-02-08 12:37:55.370846 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-08 12:37:55.371404 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 12:37:55.374085 (Thread-1): 15:37:55 | 1 of 18 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.36s]
2022-02-08 12:37:55.374623 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 12:37:55.376387 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 12:37:55.378667 (Thread-2): 15:37:55 | 3 of 18 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-08 12:37:55.379111 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 12:37:55.380426 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:55.381985 (Thread-1): 15:37:55 | 4 of 18 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-08 12:37:55.382397 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 12:37:55.382996 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:55.394020 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 12:37:55.408263 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:55.413825 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-08 12:37:55.419370 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:55.422350 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:55.422818 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-08 12:37:55.422945 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:55.433891 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:55.434150 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:55.434343 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:55.434636 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-08 12:37:55.434914 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:55.435150 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:55.443913 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-02-08 12:37:55.444150 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-08 12:37:55.451734 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:55.459685 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:55.459942 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:55.460205 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:55.465078 (Thread-1): SQL status: SELECT 7 in 0.00 seconds
2022-02-08 12:37:55.471300 (Thread-2): SQL status: SELECT 18 in 0.01 seconds
2022-02-08 12:37:55.472108 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 12:37:55.480091 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 12:37:55.480888 (Thread-1): finished collecting timing info
2022-02-08 12:37:55.486673 (Thread-2): finished collecting timing info
2022-02-08 12:37:55.490653 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:55.499472 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:55.499798 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-08 12:37:55.500090 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-08 12:37:55.502271 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:55.502553 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:55.506603 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:55.510389 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:55.510831 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 12:37:55.511131 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 12:37:55.512998 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:55.513238 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:55.514495 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 12:37:55.515794 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 12:37:55.516710 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:55.516985 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:55.517268 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:37:55.517569 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:37:55.524066 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-08 12:37:55.530105 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-08 12:37:55.530912 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:55.535868 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:55.536228 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-08 12:37:55.536535 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-08 12:37:55.538392 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:55.538645 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:55.542677 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:55.546577 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:55.546940 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-08 12:37:55.547241 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-08 12:37:55.549529 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:55.549825 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:55.551180 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 12:37:55.552550 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 12:37:55.552830 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:55.553066 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:55.553281 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 12:37:55.553497 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 12:37:55.556652 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:55.559667 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:37:55.559867 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:37:55.560027 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 12:37:55.562701 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:37:55.563157 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 12:37:55.566521 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:37:55.569530 (Thread-2): finished collecting timing info
2022-02-08 12:37:55.569844 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 12:37:55.570128 (Thread-2): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-08 12:37:55.573655 (Thread-1): finished collecting timing info
2022-02-08 12:37:55.574342 (Thread-1): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-08 12:37:55.576727 (Thread-2): 15:37:55 | 3 of 18 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.19s]
2022-02-08 12:37:55.579326 (Thread-1): 15:37:55 | 4 of 18 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.19s]
2022-02-08 12:37:55.579993 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 12:37:55.580405 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 12:37:55.580871 (Thread-2): Began running node model.project_otus_dbt.dim_day
2022-02-08 12:37:55.581717 (Thread-1): Began running node model.project_otus_dbt.dim_week
2022-02-08 12:37:55.583880 (Thread-2): 15:37:55 | 5 of 18 START table model public.dim_day............................. [RUN]
2022-02-08 12:37:55.586112 (Thread-1): 15:37:55 | 6 of 18 START table model public.dim_week............................ [RUN]
2022-02-08 12:37:55.586777 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:55.587554 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:55.587880 (Thread-2): Compiling model.project_otus_dbt.dim_day
2022-02-08 12:37:55.588250 (Thread-1): Compiling model.project_otus_dbt.dim_week
2022-02-08 12:37:55.597082 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 12:37:55.604525 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 12:37:55.605399 (Thread-2): finished collecting timing info
2022-02-08 12:37:55.616834 (Thread-1): finished collecting timing info
2022-02-08 12:37:55.648619 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:55.650495 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:55.650912 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-08 12:37:55.651516 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-08 12:37:55.652182 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:55.652710 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:55.671223 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 12:37:55.677798 (Thread-2): SQL status: DROP TABLE in 0.03 seconds
2022-02-08 12:37:55.677598 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:55.683480 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:55.683958 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 12:37:55.684325 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 12:37:55.686131 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:55.686509 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:55.695324 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 12:37:55.697421 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 12:37:55.698545 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:55.698905 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:55.699128 (Thread-1): On model.project_otus_dbt.dim_week: BEGIN
2022-02-08 12:37:55.699378 (Thread-2): On model.project_otus_dbt.dim_day: BEGIN
2022-02-08 12:37:55.700770 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:55.701056 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:55.701261 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:55.701520 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:55.701774 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-08 12:37:55.702042 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        date_trunc('week' , date) as first_day_week,
        extract('week' from date) as week_id,
        extract('year' from date)*100+extract('week' from date) as yearweek_id,

        to_char(date, 'MON') as month,
        concat(to_char(date, 'MM'), to_char(date, 'MON')) as mm_month,
        extract('month' from date) as moth_id,
        extract('year' from date)*100+extract('month' from date) as yearmonth_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
    from generate_series(date '2012-01-01',
                         date '2025-12-31',
                         interval '1 day')
             as t(date)
)

select * from dim_day
order by date desc
  );
2022-02-08 12:37:55.714386 (Thread-1): SQL status: SELECT 731 in 0.01 seconds
2022-02-08 12:37:55.722158 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:55.722451 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-08 12:37:55.724625 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:55.730020 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:55.730312 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-08 12:37:55.732487 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:55.734616 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 12:37:55.734993 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:55.735166 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 12:37:55.737889 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:55.741374 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:37:55.741598 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 12:37:55.746210 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:55.749988 (Thread-1): finished collecting timing info
2022-02-08 12:37:55.750367 (Thread-1): On model.project_otus_dbt.dim_week: Close
2022-02-08 12:37:55.753119 (Thread-1): 15:37:55 | 6 of 18 OK created table model public.dim_week....................... [SELECT 731 in 0.16s]
2022-02-08 12:37:55.753555 (Thread-1): Finished running node model.project_otus_dbt.dim_week
2022-02-08 12:37:55.754049 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 12:37:55.756364 (Thread-1): 15:37:55 | 7 of 18 START incremental model public.hub_wheat_gbp................. [RUN]
2022-02-08 12:37:55.757289 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:55.757865 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-08 12:37:55.776483 (Thread-2): SQL status: SELECT 5114 in 0.07 seconds
2022-02-08 12:37:55.791158 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 12:37:55.794199 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:55.794865 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-08 12:37:55.795330 (Thread-1): finished collecting timing info
2022-02-08 12:37:55.801928 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 12:37:55.812365 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:55.817991 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-08 12:37:55.830581 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 12:37:55.843047 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 12:37:55.845622 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:55.845901 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:55.846178 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp153755836430"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:55.846458 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 12:37:55.846835 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:55.852947 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:37:55.856073 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:37:55.856428 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 12:37:55.860813 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:55.865328 (Thread-2): finished collecting timing info
2022-02-08 12:37:55.865779 (Thread-2): On model.project_otus_dbt.dim_day: Close
2022-02-08 12:37:55.868406 (Thread-2): 15:37:55 | 5 of 18 OK created table model public.dim_day........................ [SELECT 5114 in 0.28s]
2022-02-08 12:37:55.868708 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-02-08 12:37:55.869265 (Thread-2): Finished running node model.project_otus_dbt.dim_day
2022-02-08 12:37:55.875272 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:55.875583 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 12:37:55.876049 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-08 12:37:55.877767 (Thread-2): 15:37:55 | 8 of 18 START incremental model public.sat_wheat_gbp_details......... [RUN]
2022-02-08 12:37:55.878940 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:55.879370 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 12:37:55.879588 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:55.890382 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:55.896179 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp153755836430'
        
      order by ordinal_position

  
2022-02-08 12:37:55.900861 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 12:37:55.901566 (Thread-2): finished collecting timing info
2022-02-08 12:37:55.912090 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:55.912514 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:37:55.912829 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp153755908990"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:55.919351 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:55.919784 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:55.920112 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:55.927258 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:37:55.938335 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:55.938594 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:55.942792 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 12:37:55.944401 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 12:37:55.945129 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:55.945317 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp153755836430"
    );
  
2022-02-08 12:37:55.946699 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:37:55.948325 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 12:37:55.948610 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-08 12:37:55.948864 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:37:55.952500 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:55.952834 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 12:37:55.953040 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-08 12:37:55.954615 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:55.955003 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:55.955121 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp153755908990'
        
      order by ordinal_position

  
2022-02-08 12:37:55.955763 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:55.958075 (Thread-1): finished collecting timing info
2022-02-08 12:37:55.958466 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-08 12:37:55.960388 (Thread-1): 15:37:55 | 7 of 18 OK created incremental model public.hub_wheat_gbp............ [INSERT 0 0 in 0.20s]
2022-02-08 12:37:55.960748 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 12:37:55.961081 (Thread-1): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 12:37:55.963881 (Thread-1): 15:37:55 | 9 of 18 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-08 12:37:55.964949 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:55.965397 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:37:55.965717 (Thread-1): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 12:37:55.971001 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:55.982099 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:55.987073 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 12:37:55.987742 (Thread-1): finished collecting timing info
2022-02-08 12:37:55.996757 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:55.997139 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:37:55.997380 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp153755994946"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:56.003157 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:56.003387 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:56.003635 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:56.008548 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-08 12:37:56.009953 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 12:37:56.010528 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:56.010696 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp153755908990"
    );
  
2022-02-08 12:37:56.012285 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:37:56.013850 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 12:37:56.014156 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:37:56.014420 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 12:37:56.016599 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:56.018966 (Thread-2): finished collecting timing info
2022-02-08 12:37:56.019378 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-08 12:37:56.021329 (Thread-2): 15:37:56 | 8 of 18 OK created incremental model public.sat_wheat_gbp_details.... [INSERT 0 0 in 0.14s]
2022-02-08 12:37:56.021712 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 12:37:56.022158 (Thread-2): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 12:37:56.024470 (Thread-2): 15:37:56 | 10 of 18 START incremental model public.sat_rate_gbp_usd_details..... [RUN]
2022-02-08 12:37:56.025513 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:56.025889 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-02-08 12:37:56.026293 (Thread-2): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 12:37:56.031578 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:56.042723 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-08 12:37:56.056739 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 12:37:56.057488 (Thread-2): finished collecting timing info
2022-02-08 12:37:56.063961 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:56.068217 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:56.068486 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:56.068774 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp153756066570"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:56.069178 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp153755994946'
        
      order by ordinal_position

  
2022-02-08 12:37:56.069504 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:56.078455 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:37:56.084625 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:56.085014 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:56.090102 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 12:37:56.094848 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:56.095082 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-08 12:37:56.095322 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:56.099494 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:56.099971 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-08 12:37:56.101516 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:56.101769 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:56.101900 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp153756066570'
        
      order by ordinal_position

  
2022-02-08 12:37:56.104850 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 12:37:56.106488 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 12:37:56.107245 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:56.107466 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp153755994946"
    );
  
2022-02-08 12:37:56.109036 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:37:56.110812 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 12:37:56.111092 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:37:56.111270 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 12:37:56.111762 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:37:56.116840 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:56.117099 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:37:56.117412 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:56.120028 (Thread-1): finished collecting timing info
2022-02-08 12:37:56.120665 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-08 12:37:56.123555 (Thread-1): 15:37:56 | 9 of 18 OK created incremental model public.hub_rate_gbp_usd......... [INSERT 0 0 in 0.16s]
2022-02-08 12:37:56.124047 (Thread-1): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 12:37:56.124479 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 12:37:56.127334 (Thread-1): 15:37:56 | 11 of 18 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-08 12:37:56.127749 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:37:56.128851 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:56.133977 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:56.134381 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-08 12:37:56.134610 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:56.151129 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 12:37:56.151421 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:37:56.153180 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 12:37:56.153777 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:56.154017 (Thread-1): finished collecting timing info
2022-02-08 12:37:56.154455 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp153756066570"
    );
  
2022-02-08 12:37:56.166273 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:56.166603 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp153756163441"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:56.166783 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:56.167501 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:37:56.169550 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 12:37:56.169802 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:37:56.169963 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 12:37:56.172132 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:56.174259 (Thread-2): finished collecting timing info
2022-02-08 12:37:56.174772 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-08 12:37:56.177216 (Thread-2): 15:37:56 | 10 of 18 OK created incremental model public.sat_rate_gbp_usd_details [INSERT 0 0 in 0.15s]
2022-02-08 12:37:56.177792 (Thread-2): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 12:37:56.178388 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 12:37:56.182279 (Thread-2): 15:37:56 | 12 of 18 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-08 12:37:56.183413 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:56.183666 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 12:37:56.193954 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-08 12:37:56.209019 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:56.210379 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 12:37:56.210624 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-08 12:37:56.211372 (Thread-2): finished collecting timing info
2022-02-08 12:37:56.218016 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:56.221817 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:56.222044 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:56.222262 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp153756220080"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:56.222515 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp153756163441'
        
      order by ordinal_position

  
2022-02-08 12:37:56.222740 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:56.232272 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:37:56.239068 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:56.239272 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:56.243797 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 12:37:56.297314 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:56.297556 (Thread-2): SQL status: SELECT 0 in 0.07 seconds
2022-02-08 12:37:56.297790 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:56.303491 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:56.303906 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-08 12:37:56.305400 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:56.305654 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:56.305753 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp153756220080'
        
      order by ordinal_position

  
2022-02-08 12:37:56.309894 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:37:56.311311 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 12:37:56.311820 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:56.312006 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp153756163441"
    );
  
2022-02-08 12:37:56.313703 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:37:56.315261 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 12:37:56.315573 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 12:37:56.315858 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:37:56.322123 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:56.322501 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 12:37:56.322844 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:56.325917 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:56.328386 (Thread-1): finished collecting timing info
2022-02-08 12:37:56.328832 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 12:37:56.329060 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-08 12:37:56.335270 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:56.335625 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:56.338143 (Thread-1): 15:37:56 | 11 of 18 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.21s]
2022-02-08 12:37:56.338882 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 12:37:56.339376 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 12:37:56.342370 (Thread-1): 15:37:56 | 13 of 18 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-08 12:37:56.343591 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:56.344159 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-08 12:37:56.350493 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 12:37:56.357457 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 12:37:56.361304 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 12:37:56.362390 (Thread-1): finished collecting timing info
2022-02-08 12:37:56.362964 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:56.373812 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp153756220080"
    );
  
2022-02-08 12:37:56.374380 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:56.375059 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp153756372262"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:56.375359 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:56.376613 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:37:56.378410 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 12:37:56.378698 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:37:56.378787 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 12:37:56.381058 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:56.383295 (Thread-2): finished collecting timing info
2022-02-08 12:37:56.383654 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-08 12:37:56.386052 (Thread-2): 15:37:56 | 12 of 18 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.20s]
2022-02-08 12:37:56.386504 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 12:37:56.386954 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 12:37:56.389682 (Thread-2): 15:37:56 | 14 of 18 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-08 12:37:56.390920 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:56.391493 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 12:37:56.401483 (Thread-1): SQL status: SELECT 1 in 0.03 seconds
2022-02-08 12:37:56.417282 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:56.417973 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 12:37:56.418189 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-08 12:37:56.418838 (Thread-2): finished collecting timing info
2022-02-08 12:37:56.425408 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:56.430651 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:56.430950 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:56.431223 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp153756428682"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:37:56.431476 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp153756372262'
        
      order by ordinal_position

  
2022-02-08 12:37:56.431750 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:56.441059 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:37:56.446860 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:56.447112 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:56.449588 (Thread-2): SQL status: SELECT 1 in 0.02 seconds
2022-02-08 12:37:56.455581 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:56.455844 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:37:56.456070 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-08 12:37:56.461213 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:56.461832 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:56.463150 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:56.463427 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:56.463579 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp153756428682'
        
      order by ordinal_position

  
2022-02-08 12:37:56.467492 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:37:56.468860 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 12:37:56.469559 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:56.469815 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp153756372262"
    );
  
2022-02-08 12:37:56.471639 (Thread-1): SQL status: INSERT 0 1 in 0.00 seconds
2022-02-08 12:37:56.473364 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 12:37:56.473695 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:37:56.473916 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:37:56.474146 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 12:37:56.479213 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:56.479922 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:56.482948 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:56.485624 (Thread-1): finished collecting timing info
2022-02-08 12:37:56.486110 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-08 12:37:56.486333 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:37:56.494272 (Thread-1): 15:37:56 | 13 of 18 OK created incremental model public.hub_wheat_usa........... [INSERT 0 1 in 0.15s]
2022-02-08 12:37:56.495925 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:56.496681 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 12:37:56.497089 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:37:56.497673 (Thread-1): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 12:37:56.501042 (Thread-1): 15:37:56 | 15 of 18 START table model public.dds_rate_gbp_usd................... [RUN]
2022-02-08 12:37:56.501982 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:56.502389 (Thread-1): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 12:37:56.509791 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:37:56.517673 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 12:37:56.520998 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 12:37:56.521876 (Thread-1): finished collecting timing info
2022-02-08 12:37:56.527980 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:56.533486 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp153756428682"
    );
  
2022-02-08 12:37:56.534448 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:56.534956 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 12:37:56.535157 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:56.537171 (Thread-2): SQL status: INSERT 0 1 in 0.00 seconds
2022-02-08 12:37:56.539230 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 12:37:56.539521 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:37:56.539703 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 12:37:56.542471 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:56.545785 (Thread-2): finished collecting timing info
2022-02-08 12:37:56.546324 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-08 12:37:56.549604 (Thread-2): 15:37:56 | 14 of 18 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 1 in 0.16s]
2022-02-08 12:37:56.549906 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:37:56.550446 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 12:37:56.556741 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:56.557195 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 12:37:56.557886 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:37:56.560243 (Thread-2): 15:37:56 | 16 of 18 START table model public.dds_wheat_msk...................... [RUN]
2022-02-08 12:37:56.561730 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:56.562220 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-08 12:37:56.569017 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:37:56.578106 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 12:37:56.588022 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 12:37:56.588967 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:56.593932 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-08 12:37:56.596337 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:56.596813 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:56.597237 (Thread-2): finished collecting timing info
2022-02-08 12:37:56.597847 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */


  create  table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp"
  as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );
2022-02-08 12:37:56.613507 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:56.614128 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-08 12:37:56.614563 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:56.626918 (Thread-1): SQL status: SELECT 548 in 0.02 seconds
2022-02-08 12:37:56.633560 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:56.633881 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 12:37:56.634133 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd" rename to "dds_rate_gbp_usd__dbt_backup"
2022-02-08 12:37:56.638693 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:56.639233 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 12:37:56.640355 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:56.640606 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:56.642088 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 12:37:56.646077 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:56.646649 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-08 12:37:56.647147 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:56.647385 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-08 12:37:56.648268 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:56.648525 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:56.650040 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 12:37:56.650297 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:56.650527 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:56.650732 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */


  create  table "postgres"."public"."dds_wheat_msk__dbt_tmp"
  as (
    with dds_wheat_msk as(
    select cast(su.tradedate as date) as tradedate
        ,hu.date_pk
        ,case when su.value=0 and su.volume>0 then cast(su.volume*su.close as decimal(18,2))
            else cast(su.value as decimal(18,2))
            end as value_all
        ,cast(su.open as decimal(18,2)) as open
        ,cast(su.close as decimal(18,2)) as close
        ,cast(su.high as decimal(18,2)) as high
        ,cast(su.low as decimal(18,2)) as low
        ,cast(su.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hu
    left join "postgres"."public"."sat_wheat_msk_details" as su
    on hu.date_pk=su.date_pk
)
select * from dds_wheat_msk
  );
2022-02-08 12:37:56.650919 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 12:37:56.653948 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:56.657737 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:37:56.657971 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:37:56.661963 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:56.662326 (Thread-2): SQL status: SELECT 216 in 0.01 seconds
2022-02-08 12:37:56.665890 (Thread-1): finished collecting timing info
2022-02-08 12:37:56.672197 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:56.672586 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-08 12:37:56.672856 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-08 12:37:56.675525 (Thread-1): 15:37:56 | 15 of 18 OK created table model public.dds_rate_gbp_usd.............. [SELECT 548 in 0.17s]
2022-02-08 12:37:56.675783 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:56.676240 (Thread-1): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 12:37:56.683147 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:56.683573 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 12:37:56.684146 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-08 12:37:56.686135 (Thread-1): 15:37:56 | 17 of 18 START table model public.dds_wheat_usa...................... [RUN]
2022-02-08 12:37:56.687535 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:56.688030 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_usa
2022-02-08 12:37:56.694063 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 12:37:56.701133 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 12:37:56.702006 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 12:37:56.702429 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:56.703114 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 12:37:56.703922 (Thread-1): finished collecting timing info
2022-02-08 12:37:56.711758 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:37:56.714494 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:56.717947 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:37:56.718446 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_tmp" cascade
2022-02-08 12:37:56.718785 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 12:37:56.719102 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:37:56.723838 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:56.728074 (Thread-2): finished collecting timing info
2022-02-08 12:37:56.728712 (Thread-2): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-08 12:37:56.732568 (Thread-2): 15:37:56 | 16 of 18 OK created table model public.dds_wheat_msk................. [SELECT 216 in 0.17s]
2022-02-08 12:37:56.733234 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 12:37:56.733823 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 12:37:56.738600 (Thread-2): 15:37:56 | 18 of 18 START table model public.dds_wheat_gbp...................... [RUN]
2022-02-08 12:37:56.738848 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 12:37:56.739655 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:56.745491 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:56.745810 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_gbp
2022-02-08 12:37:56.746067 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 12:37:56.758466 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 12:37:56.759343 (Thread-2): finished collecting timing info
2022-02-08 12:37:56.765494 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:37:56.772660 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 12:37:56.772934 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:56.773329 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_tmp" cascade
2022-02-08 12:37:56.773607 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:37:56.774126 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:56.774399 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: BEGIN
2022-02-08 12:37:56.775894 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:56.776211 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:56.776369 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */


  create  table "postgres"."public"."dds_wheat_usa__dbt_tmp"
  as (
    with usa as (
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0/2.7 as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_usa" as hu
    left join "postgres"."public"."sat_wheat_usa_details" as su
    on hu.date_pk=su.date_pk
)
select * from usa
  );
2022-02-08 12:37:56.785522 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:37:56.790208 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:56.790433 (Thread-1): SQL status: SELECT 548 in 0.01 seconds
2022-02-08 12:37:56.790600 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 12:37:56.795300 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:56.795777 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa" rename to "dds_wheat_usa__dbt_backup"
2022-02-08 12:37:56.796976 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:56.798978 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 12:37:56.799195 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:56.802586 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:56.802873 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa__dbt_tmp" rename to "dds_wheat_usa"
2022-02-08 12:37:56.803114 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:56.803280 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: BEGIN
2022-02-08 12:37:56.804566 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:37:56.804829 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:56.805047 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:56.806559 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 12:37:56.806917 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */


  create  table "postgres"."public"."dds_wheat_gbp__dbt_tmp"
  as (
    with gbp as(
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0*rt.rate as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_gbp" as hu
    left join "postgres"."public"."sat_wheat_gbp_details" as su
    on hu.date_pk=su.date_pk
    left join "postgres"."public"."dds_rate_gbp_usd" as rt
    on hu.date_pk=rt.date_pk
)
select * from gbp
  );
2022-02-08 12:37:56.807187 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:56.807568 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 12:37:56.810325 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:56.813934 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:37:56.814177 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 12:37:56.818274 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:56.821845 (Thread-1): finished collecting timing info
2022-02-08 12:37:56.822277 (Thread-2): SQL status: SELECT 531 in 0.01 seconds
2022-02-08 12:37:56.822525 (Thread-1): On model.project_otus_dbt.dds_wheat_usa: Close
2022-02-08 12:37:56.828203 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:56.828526 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp" rename to "dds_wheat_gbp__dbt_backup"
2022-02-08 12:37:56.831056 (Thread-1): 15:37:56 | 17 of 18 OK created table model public.dds_wheat_usa................. [SELECT 548 in 0.14s]
2022-02-08 12:37:56.831691 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 12:37:56.833973 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:56.838614 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:56.838856 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp__dbt_tmp" rename to "dds_wheat_gbp"
2022-02-08 12:37:56.840439 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:37:56.842246 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 12:37:56.842569 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:56.842802 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 12:37:56.845874 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:56.850109 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:37:56.850347 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 12:37:56.854038 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:37:56.857208 (Thread-2): finished collecting timing info
2022-02-08 12:37:56.857565 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: Close
2022-02-08 12:37:56.859408 (Thread-2): 15:37:56 | 18 of 18 OK created table model public.dds_wheat_gbp................. [SELECT 531 in 0.12s]
2022-02-08 12:37:56.859777 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 12:37:56.863567 (MainThread): Acquiring new postgres connection "master".
2022-02-08 12:37:56.864000 (MainThread): Using postgres connection "master".
2022-02-08 12:37:56.864180 (MainThread): On master: BEGIN
2022-02-08 12:37:56.864339 (MainThread): Opening a new connection, currently in state closed
2022-02-08 12:37:56.876597 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:37:56.876963 (MainThread): On master: COMMIT
2022-02-08 12:37:56.877187 (MainThread): Using postgres connection "master".
2022-02-08 12:37:56.877380 (MainThread): On master: COMMIT
2022-02-08 12:37:56.878674 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:37:56.879024 (MainThread): On master: Close
2022-02-08 12:37:56.879959 (MainThread): 15:37:56 | 
2022-02-08 12:37:56.880255 (MainThread): 15:37:56 | Finished running 4 view models, 6 table models, 8 incremental models in 2.33s.
2022-02-08 12:37:56.880500 (MainThread): Connection 'master' was properly closed.
2022-02-08 12:37:56.880666 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_usa' was properly closed.
2022-02-08 12:37:56.880795 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_gbp' was properly closed.
2022-02-08 12:37:57.003676 (MainThread): 
2022-02-08 12:37:57.003931 (MainThread): Completed successfully
2022-02-08 12:37:57.004127 (MainThread): 
Done. PASS=18 WARN=0 ERROR=0 SKIP=0 TOTAL=18
2022-02-08 12:37:57.004448 (MainThread): Flushing usage events
2022-02-08 12:43:55.083135 (MainThread): Running with dbt=0.19.0
2022-02-08 12:43:55.209547 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-02-08 12:43:55.210464 (MainThread): Tracking: do not track
2022-02-08 12:43:55.310868 (MainThread): Partial parsing not enabled
2022-02-08 12:43:55.312459 (MainThread): Parsing macros/adapters.sql
2022-02-08 12:43:55.345034 (MainThread): Parsing macros/catalog.sql
2022-02-08 12:43:55.347620 (MainThread): Parsing macros/relations.sql
2022-02-08 12:43:55.349316 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-08 12:43:55.353373 (MainThread): Parsing macros/core.sql
2022-02-08 12:43:55.359493 (MainThread): Parsing macros/adapters/common.sql
2022-02-08 12:43:55.414290 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-08 12:43:55.418028 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-08 12:43:55.421224 (MainThread): Parsing macros/etc/datetime.sql
2022-02-08 12:43:55.432032 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-08 12:43:55.434423 (MainThread): Parsing macros/etc/query.sql
2022-02-08 12:43:55.437315 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-08 12:43:55.439379 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-08 12:43:55.454320 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-08 12:43:55.491699 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-08 12:43:55.495263 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-08 12:43:55.545530 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-08 12:43:55.578485 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-08 12:43:55.590374 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-08 12:43:55.593809 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-08 12:43:55.611239 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-08 12:43:55.616434 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-08 12:43:55.623008 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-08 12:43:55.629510 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-08 12:43:55.631925 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-08 12:43:55.636886 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-08 12:43:55.640384 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-08 12:43:55.649185 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-08 12:43:55.652207 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-08 12:43:55.654632 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-08 12:43:55.655917 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-08 12:43:55.666035 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-08 12:43:55.668325 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-08 12:43:55.670207 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-08 12:43:55.672946 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-08 12:43:55.673924 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-08 12:43:55.676390 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-08 12:43:55.679829 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-08 12:43:55.681777 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-08 12:43:55.683826 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-08 12:43:55.686621 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-08 12:43:55.695097 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-08 12:43:55.698725 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-08 12:43:55.701374 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-08 12:43:55.702776 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-08 12:43:55.704800 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-08 12:43:55.706662 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-08 12:43:55.708487 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-08 12:43:55.714114 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-08 12:43:55.715643 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-08 12:43:55.717899 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-08 12:43:55.720290 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-08 12:43:55.723621 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-08 12:43:55.727387 (MainThread): Parsing macros/sql/star.sql
2022-02-08 12:43:55.731691 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-08 12:43:55.734078 (MainThread): Parsing macros/sql/pivot.sql
2022-02-08 12:43:55.742089 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-08 12:43:55.744254 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-08 12:43:55.752952 (MainThread): Parsing macros/sql/union.sql
2022-02-08 12:43:55.765046 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-08 12:43:55.767356 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-08 12:43:55.772253 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-08 12:43:55.776319 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-08 12:43:55.780299 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-08 12:43:55.787258 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-08 12:43:55.792242 (MainThread): Parsing macros/sql/groupby.sql
2022-02-08 12:43:55.793987 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-08 12:43:55.795977 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-08 12:43:55.798663 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-08 12:43:55.802831 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-08 12:43:55.804478 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-08 12:43:55.806309 (MainThread): Parsing macros/logger/log_info.sql
2022-02-08 12:43:55.808662 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-08 12:43:55.837712 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-08 12:43:55.840558 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-08 12:43:55.844229 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-08 12:43:55.849889 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-08 12:43:55.854860 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-08 12:43:55.867983 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-08 12:43:55.874474 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-08 12:43:55.877790 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-08 12:43:55.880170 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-08 12:43:55.883149 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-08 12:43:55.887598 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-08 12:43:55.892449 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-08 12:43:55.894655 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-08 12:43:55.901772 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-08 12:43:55.904536 (MainThread): Parsing macros/internal/alias.sql
2022-02-08 12:43:55.908845 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-08 12:43:55.910222 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-08 12:43:55.913359 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-08 12:43:55.917615 (MainThread): Parsing macros/internal/multikey.sql
2022-02-08 12:43:55.925330 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-08 12:43:55.936742 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-08 12:43:55.940062 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-08 12:43:55.940997 (MainThread): Parsing macros/tables/hub.sql
2022-02-08 12:43:55.952573 (MainThread): Parsing macros/tables/link.sql
2022-02-08 12:43:55.963112 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-08 12:43:55.975713 (MainThread): Parsing macros/tables/sat.sql
2022-02-08 12:43:55.988810 (MainThread): Parsing macros/tables/t_link.sql
2022-02-08 12:43:55.994038 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-08 12:43:56.013827 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-08 12:43:56.029519 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-08 12:43:56.064345 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-08 12:43:56.067077 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-08 12:43:56.108157 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-08 12:43:56.121922 (MainThread): Parsing macros/supporting/hash.sql
2022-02-08 12:43:56.139344 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-08 12:43:56.143031 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-08 12:43:56.158690 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-08 12:43:56.163418 (MainThread): Parsing macros/staging/stage.sql
2022-02-08 12:43:56.177302 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-08 12:43:56.192194 (MainThread): Partial parsing not enabled
2022-02-08 12:43:56.307455 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:43:56.419062 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:43:56.442837 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:43:56.470618 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:43:56.498887 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:43:56.540024 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:43:56.556284 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:43:56.575258 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:43:56.596236 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:43:56.727571 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:43:56.767467 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:43:56.802734 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:43:56.838816 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:43:56.855521 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:43:56.866431 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:43:56.883317 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:43:56.899876 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:43:56.912609 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:43:57.656877 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.raw_vault.links

2022-02-08 12:43:57.791251 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-08 12:43:57.792647 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-08 12:43:57.795045 (MainThread): 
2022-02-08 12:43:57.795791 (MainThread): Acquiring new postgres connection "master".
2022-02-08 12:43:57.803282 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-08 12:43:57.820189 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-08 12:43:57.820486 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-08 12:43:57.820647 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-08 12:43:57.890582 (ThreadPoolExecutor-0_0): SQL status: SELECT 20 in 0.07 seconds
2022-02-08 12:43:57.894635 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-08 12:43:57.921779 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-08 12:43:57.930338 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 12:43:57.930549 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-08 12:43:57.930639 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-08 12:43:57.948228 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-02-08 12:43:57.948471 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 12:43:57.948585 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-08 12:43:57.965559 (ThreadPoolExecutor-1_0): SQL status: SELECT 23 in 0.02 seconds
2022-02-08 12:43:57.981728 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-08 12:43:57.983000 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-08 12:43:58.020934 (MainThread): Using postgres connection "master".
2022-02-08 12:43:58.021217 (MainThread): On master: BEGIN
2022-02-08 12:43:58.021390 (MainThread): Opening a new connection, currently in state init
2022-02-08 12:43:58.033435 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:43:58.033736 (MainThread): Using postgres connection "master".
2022-02-08 12:43:58.033900 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-08 12:43:58.305963 (MainThread): SQL status: SELECT 10 in 0.27 seconds
2022-02-08 12:43:58.316948 (MainThread): On master: ROLLBACK
2022-02-08 12:43:58.318534 (MainThread): Using postgres connection "master".
2022-02-08 12:43:58.318892 (MainThread): On master: BEGIN
2022-02-08 12:43:58.321791 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:43:58.322104 (MainThread): On master: COMMIT
2022-02-08 12:43:58.322267 (MainThread): Using postgres connection "master".
2022-02-08 12:43:58.322421 (MainThread): On master: COMMIT
2022-02-08 12:43:58.323554 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:43:58.323896 (MainThread): On master: Close
2022-02-08 12:43:58.324807 (MainThread): 15:43:58 | Concurrency: 2 threads (target='dev')
2022-02-08 12:43:58.325170 (MainThread): 15:43:58 | 
2022-02-08 12:43:58.333090 (Thread-1): Began running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-08 12:43:58.333605 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_gbp
2022-02-08 12:43:58.336135 (Thread-1): 15:43:58 | 1 of 4 START seed file public.source_rate_gbp_usd.................... [RUN]
2022-02-08 12:43:58.339566 (Thread-2): 15:43:58 | 2 of 4 START seed file public.source_wheat_gbp....................... [RUN]
2022-02-08 12:43:58.340695 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-08 12:43:58.341690 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-08 12:43:58.342034 (Thread-1): finished collecting timing info
2022-02-08 12:43:58.342777 (Thread-2): finished collecting timing info
2022-02-08 12:43:58.563821 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-08 12:43:58.565296 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-08 12:43:58.565503 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: BEGIN
2022-02-08 12:43:58.565758 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: BEGIN
2022-02-08 12:43:58.565987 (Thread-2): Opening a new connection, currently in state init
2022-02-08 12:43:58.566207 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:43:58.577947 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:43:58.578225 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-08 12:43:58.578389 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_rate_gbp_usd"} */
truncate table "postgres"."public"."source_rate_gbp_usd"
2022-02-08 12:43:58.579662 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:43:58.580119 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-08 12:43:58.580365 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_gbp"} */
truncate table "postgres"."public"."source_wheat_gbp"
2022-02-08 12:43:58.591430 (Thread-2): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-08 12:43:58.598057 (Thread-1): SQL status: TRUNCATE TABLE in 0.02 seconds
2022-02-08 12:43:58.607662 (Thread-2): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-08 12:43:58.609737 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-02-08 12:43:58.640208 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-08 12:43:58.645925 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: 
            insert into "postgres"."public"."source_wheat_gbp" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%...
2022-02-08 12:43:58.649153 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-08 12:43:58.655087 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: 
            insert into "postgres"."public"."source_rate_gbp_usd" (TRADEDATE, PRICE, OPEN, HIGH, LOW, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s...
2022-02-08 12:43:58.678709 (Thread-2): SQL status: INSERT 0 531 in 0.03 seconds
2022-02-08 12:43:58.690251 (Thread-1): SQL status: INSERT 0 548 in 0.03 seconds
2022-02-08 12:43:58.691262 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_gbp"
2022-02-08 12:43:58.692464 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_rate_gbp_usd"
2022-02-08 12:43:58.719173 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-08 12:43:58.719897 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-08 12:43:58.720157 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_gbp".
2022-02-08 12:43:58.720465 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_rate_gbp_usd".
2022-02-08 12:43:58.720718 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: COMMIT
2022-02-08 12:43:58.720947 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: COMMIT
2022-02-08 12:43:58.727642 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:43:58.730820 (Thread-1): finished collecting timing info
2022-02-08 12:43:58.731301 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:43:58.731630 (Thread-1): On seed.project_otus_dbt.source_rate_gbp_usd: Close
2022-02-08 12:43:58.735268 (Thread-2): finished collecting timing info
2022-02-08 12:43:58.736100 (Thread-2): On seed.project_otus_dbt.source_wheat_gbp: Close
2022-02-08 12:43:58.737378 (Thread-1): 15:43:58 | 1 of 4 OK loaded seed file public.source_rate_gbp_usd................ [INSERT 548 in 0.40s]
2022-02-08 12:43:58.738963 (Thread-2): 15:43:58 | 2 of 4 OK loaded seed file public.source_wheat_gbp................... [INSERT 531 in 0.40s]
2022-02-08 12:43:58.739540 (Thread-1): Finished running node seed.project_otus_dbt.source_rate_gbp_usd
2022-02-08 12:43:58.740211 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_gbp
2022-02-08 12:43:58.740802 (Thread-1): Began running node seed.project_otus_dbt.source_wheat_msk
2022-02-08 12:43:58.741802 (Thread-2): Began running node seed.project_otus_dbt.source_wheat_usa
2022-02-08 12:43:58.744726 (Thread-1): 15:43:58 | 3 of 4 START seed file public.source_wheat_msk....................... [RUN]
2022-02-08 12:43:58.746705 (Thread-2): 15:43:58 | 4 of 4 START seed file public.source_wheat_usa....................... [RUN]
2022-02-08 12:43:58.747775 (Thread-1): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-08 12:43:58.748601 (Thread-2): Acquiring new postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-08 12:43:58.748944 (Thread-1): finished collecting timing info
2022-02-08 12:43:58.749570 (Thread-2): finished collecting timing info
2022-02-08 12:43:58.765650 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-08 12:43:58.771200 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: BEGIN
2022-02-08 12:43:58.776668 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:43:58.800674 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-08 12:43:58.800973 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: BEGIN
2022-02-08 12:43:58.801140 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:43:58.803670 (Thread-2): SQL status: BEGIN in 0.03 seconds
2022-02-08 12:43:58.803950 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-08 12:43:58.804103 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_usa"} */
truncate table "postgres"."public"."source_wheat_usa"
2022-02-08 12:43:58.811508 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:43:58.811814 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-08 12:43:58.811992 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.project_otus_dbt.source_wheat_msk"} */
truncate table "postgres"."public"."source_wheat_msk"
2022-02-08 12:43:58.812190 (Thread-2): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-08 12:43:58.815028 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-08 12:43:58.815286 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: 
            insert into "postgres"."public"."source_wheat_usa" (TRADEDATE, PRICE, OPEN, HIGH, LOW, VOLUME, CHANGEPERC) values
            (%s,%s,%s,%s,%s,%s,%s)
        ...
2022-02-08 12:43:58.817694 (Thread-2): SQL status: INSERT 0 1 in 0.00 seconds
2022-02-08 12:43:58.817905 (Thread-1): SQL status: TRUNCATE TABLE in 0.01 seconds
2022-02-08 12:43:58.818333 (Thread-2): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_usa"
2022-02-08 12:43:58.830515 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-08 12:43:58.831071 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: 
            insert into "postgres"."public"."source_wheat_msk" (BOARDID, SECID, TRADEDATE, SHORTNAME, NAME, CLOSE, OPEN, HIGH, LOW, VALUE, DURATION, YIELD, DECIMALS, CAPITALIZATION, CURRENCYID, DIVISOR, TRADINGSESSION, VOLUME) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%...
2022-02-08 12:43:58.840294 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-08 12:43:58.840570 (Thread-2): Using postgres connection "seed.project_otus_dbt.source_wheat_usa".
2022-02-08 12:43:58.840667 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: COMMIT
2022-02-08 12:43:58.845001 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:43:58.848192 (Thread-2): finished collecting timing info
2022-02-08 12:43:58.848582 (Thread-2): On seed.project_otus_dbt.source_wheat_usa: Close
2022-02-08 12:43:58.849765 (Thread-2): 15:43:58 | 4 of 4 OK loaded seed file public.source_wheat_usa................... [INSERT 1 in 0.10s]
2022-02-08 12:43:58.850131 (Thread-2): Finished running node seed.project_otus_dbt.source_wheat_usa
2022-02-08 12:43:58.854190 (Thread-1): SQL status: INSERT 0 216 in 0.02 seconds
2022-02-08 12:43:58.855266 (Thread-1): Writing runtime SQL for node "seed.project_otus_dbt.source_wheat_msk"
2022-02-08 12:43:58.860161 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-08 12:43:58.860396 (Thread-1): Using postgres connection "seed.project_otus_dbt.source_wheat_msk".
2022-02-08 12:43:58.860485 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: COMMIT
2022-02-08 12:43:58.864634 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:43:58.868294 (Thread-1): finished collecting timing info
2022-02-08 12:43:58.868672 (Thread-1): On seed.project_otus_dbt.source_wheat_msk: Close
2022-02-08 12:43:58.869773 (Thread-1): 15:43:58 | 3 of 4 OK loaded seed file public.source_wheat_msk................... [INSERT 216 in 0.12s]
2022-02-08 12:43:58.870120 (Thread-1): Finished running node seed.project_otus_dbt.source_wheat_msk
2022-02-08 12:43:58.872722 (MainThread): Acquiring new postgres connection "master".
2022-02-08 12:43:58.873028 (MainThread): Using postgres connection "master".
2022-02-08 12:43:58.873161 (MainThread): On master: BEGIN
2022-02-08 12:43:58.873287 (MainThread): Opening a new connection, currently in state closed
2022-02-08 12:43:58.887561 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:43:58.887883 (MainThread): On master: COMMIT
2022-02-08 12:43:58.888058 (MainThread): Using postgres connection "master".
2022-02-08 12:43:58.888221 (MainThread): On master: COMMIT
2022-02-08 12:43:58.889549 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:43:58.889863 (MainThread): On master: Close
2022-02-08 12:43:58.890514 (MainThread): 15:43:58 | 
2022-02-08 12:43:58.890843 (MainThread): 15:43:58 | Finished running 4 seeds in 1.09s.
2022-02-08 12:43:58.891060 (MainThread): Connection 'master' was properly closed.
2022-02-08 12:43:58.891217 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_msk' was properly closed.
2022-02-08 12:43:58.891405 (MainThread): Connection 'seed.project_otus_dbt.source_wheat_usa' was properly closed.
2022-02-08 12:43:59.002918 (MainThread): 
2022-02-08 12:43:59.003187 (MainThread): Completed successfully
2022-02-08 12:43:59.003397 (MainThread): 
Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
2022-02-08 12:43:59.003691 (MainThread): Flushing usage events
2022-02-08 12:44:01.320295 (MainThread): Running with dbt=0.19.0
2022-02-08 12:44:01.386672 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/rusedr/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-02-08 12:44:01.387388 (MainThread): Tracking: do not track
2022-02-08 12:44:01.458733 (MainThread): Partial parsing not enabled
2022-02-08 12:44:01.459733 (MainThread): Parsing macros/adapters.sql
2022-02-08 12:44:01.479208 (MainThread): Parsing macros/catalog.sql
2022-02-08 12:44:01.481880 (MainThread): Parsing macros/relations.sql
2022-02-08 12:44:01.483436 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-02-08 12:44:01.485895 (MainThread): Parsing macros/core.sql
2022-02-08 12:44:01.489694 (MainThread): Parsing macros/adapters/common.sql
2022-02-08 12:44:01.548603 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-02-08 12:44:01.551329 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-02-08 12:44:01.553516 (MainThread): Parsing macros/etc/datetime.sql
2022-02-08 12:44:01.563766 (MainThread): Parsing macros/etc/is_incremental.sql
2022-02-08 12:44:01.566013 (MainThread): Parsing macros/etc/query.sql
2022-02-08 12:44:01.567461 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-02-08 12:44:01.568568 (MainThread): Parsing macros/materializations/helpers.sql
2022-02-08 12:44:01.577315 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-02-08 12:44:01.607504 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-08 12:44:01.610856 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-08 12:44:01.654469 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-02-08 12:44:01.683663 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-02-08 12:44:01.691141 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-02-08 12:44:01.693717 (MainThread): Parsing macros/materializations/common/merge.sql
2022-02-08 12:44:01.717359 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-08 12:44:01.728908 (MainThread): Parsing macros/materializations/view/view.sql
2022-02-08 12:44:01.741987 (MainThread): Parsing macros/materializations/table/table.sql
2022-02-08 12:44:01.748992 (MainThread): Parsing macros/schema_tests/unique.sql
2022-02-08 12:44:01.750814 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-02-08 12:44:01.752518 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-02-08 12:44:01.754580 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-02-08 12:44:01.758736 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-02-08 12:44:01.760614 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-02-08 12:44:01.762869 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-02-08 12:44:01.764070 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-02-08 12:44:01.776528 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-08 12:44:01.778924 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-08 12:44:01.780996 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-02-08 12:44:01.784120 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-08 12:44:01.785093 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-08 12:44:01.787265 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-02-08 12:44:01.790242 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-02-08 12:44:01.791964 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-02-08 12:44:01.793776 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-02-08 12:44:01.796115 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-02-08 12:44:01.802710 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-08 12:44:01.806140 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-02-08 12:44:01.808699 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-08 12:44:01.810055 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-02-08 12:44:01.811830 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-02-08 12:44:01.813248 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-02-08 12:44:01.814662 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-08 12:44:01.820016 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-02-08 12:44:01.821363 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-02-08 12:44:01.822966 (MainThread): Parsing macros/web/get_url_host.sql
2022-02-08 12:44:01.824947 (MainThread): Parsing macros/web/get_url_path.sql
2022-02-08 12:44:01.827638 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-02-08 12:44:01.829393 (MainThread): Parsing macros/sql/star.sql
2022-02-08 12:44:01.833057 (MainThread): Parsing macros/sql/safe_add.sql
2022-02-08 12:44:01.835189 (MainThread): Parsing macros/sql/pivot.sql
2022-02-08 12:44:01.839362 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-02-08 12:44:01.841200 (MainThread): Parsing macros/sql/unpivot.sql
2022-02-08 12:44:01.848737 (MainThread): Parsing macros/sql/union.sql
2022-02-08 12:44:01.857409 (MainThread): Parsing macros/sql/nullcheck.sql
2022-02-08 12:44:01.859423 (MainThread): Parsing macros/sql/generate_series.sql
2022-02-08 12:44:01.863920 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-08 12:44:01.867749 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-02-08 12:44:01.871434 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-08 12:44:01.877947 (MainThread): Parsing macros/sql/get_column_values.sql
2022-02-08 12:44:01.884334 (MainThread): Parsing macros/sql/groupby.sql
2022-02-08 12:44:01.886382 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-08 12:44:01.888877 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-08 12:44:01.894782 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-08 12:44:01.899785 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-02-08 12:44:01.901292 (MainThread): Parsing macros/logger/pretty_time.sql
2022-02-08 12:44:01.902789 (MainThread): Parsing macros/logger/log_info.sql
2022-02-08 12:44:01.904128 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-08 12:44:01.934883 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-02-08 12:44:01.939154 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-08 12:44:01.945191 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-08 12:44:01.948812 (MainThread): Parsing macros/schema_tests/recency.sql
2022-02-08 12:44:01.951628 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-08 12:44:01.959563 (MainThread): Parsing macros/schema_tests/equality.sql
2022-02-08 12:44:01.965843 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-02-08 12:44:01.970017 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-02-08 12:44:01.972991 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-02-08 12:44:01.975490 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-02-08 12:44:01.978582 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-08 12:44:01.982973 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-08 12:44:01.986314 (MainThread): Parsing macros/datetime/date_spine.sql
2022-02-08 12:44:01.996716 (MainThread): Parsing macros/internal/alias_all.sql
2022-02-08 12:44:02.001892 (MainThread): Parsing macros/internal/alias.sql
2022-02-08 12:44:02.006585 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-02-08 12:44:02.008599 (MainThread): Parsing macros/internal/as_constant.sql
2022-02-08 12:44:02.014939 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-02-08 12:44:02.023024 (MainThread): Parsing macros/internal/multikey.sql
2022-02-08 12:44:02.032980 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-02-08 12:44:02.045962 (MainThread): Parsing macros/internal/is_checks.sql
2022-02-08 12:44:02.050302 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-02-08 12:44:02.051266 (MainThread): Parsing macros/tables/hub.sql
2022-02-08 12:44:02.065199 (MainThread): Parsing macros/tables/link.sql
2022-02-08 12:44:02.085388 (MainThread): Parsing macros/tables/eff_sat.sql
2022-02-08 12:44:02.100704 (MainThread): Parsing macros/tables/sat.sql
2022-02-08 12:44:02.109528 (MainThread): Parsing macros/tables/t_link.sql
2022-02-08 12:44:02.113741 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-02-08 12:44:02.137430 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-02-08 12:44:02.145702 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-02-08 12:44:02.163948 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-02-08 12:44:02.165438 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-02-08 12:44:02.187948 (MainThread): Parsing macros/supporting/prefix.sql
2022-02-08 12:44:02.193701 (MainThread): Parsing macros/supporting/hash.sql
2022-02-08 12:44:02.200593 (MainThread): Parsing macros/staging/source_columns.sql
2022-02-08 12:44:02.202052 (MainThread): Parsing macros/staging/derive_columns.sql
2022-02-08 12:44:02.208174 (MainThread): Parsing macros/staging/rank_columns.sql
2022-02-08 12:44:02.210615 (MainThread): Parsing macros/staging/stage.sql
2022-02-08 12:44:02.221401 (MainThread): Parsing macros/staging/hash_columns.sql
2022-02-08 12:44:02.230732 (MainThread): Partial parsing not enabled
2022-02-08 12:44:02.313305 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:44:02.455063 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:44:02.493210 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:44:02.525240 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:44:02.550074 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:44:02.582991 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:44:02.599297 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:44:02.619506 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:44:02.637769 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:44:02.751373 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:44:02.770328 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:44:02.789281 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:44:02.807984 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:44:02.818920 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:44:02.831880 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:44:02.847988 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:44:02.866184 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:44:02.886286 (MainThread): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:44:03.634151 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.project_otus_dbt.raw_vault.links

2022-02-08 12:44:03.791637 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-02-08 12:44:03.792931 (MainThread): Found 18 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 4 seed files, 4 sources, 0 exposures
2022-02-08 12:44:03.796029 (MainThread): 
2022-02-08 12:44:03.796823 (MainThread): Acquiring new postgres connection "master".
2022-02-08 12:44:03.822762 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-02-08 12:44:03.835169 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-02-08 12:44:03.835394 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-02-08 12:44:03.835485 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-02-08 12:44:03.849627 (ThreadPoolExecutor-0_0): SQL status: SELECT 20 in 0.01 seconds
2022-02-08 12:44:03.852681 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-02-08 12:44:03.877360 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_public".
2022-02-08 12:44:03.885642 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 12:44:03.885852 (ThreadPoolExecutor-1_0): On list_postgres_public: BEGIN
2022-02-08 12:44:03.885941 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-02-08 12:44:03.897013 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:44:03.897253 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_public".
2022-02-08 12:44:03.897418 (ThreadPoolExecutor-1_0): On list_postgres_public: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2022-02-08 12:44:03.902424 (ThreadPoolExecutor-1_0): SQL status: SELECT 23 in 0.00 seconds
2022-02-08 12:44:03.919874 (ThreadPoolExecutor-1_0): On list_postgres_public: ROLLBACK
2022-02-08 12:44:03.921419 (ThreadPoolExecutor-1_0): On list_postgres_public: Close
2022-02-08 12:44:03.950352 (MainThread): Using postgres connection "master".
2022-02-08 12:44:03.950562 (MainThread): On master: BEGIN
2022-02-08 12:44:03.950646 (MainThread): Opening a new connection, currently in state init
2022-02-08 12:44:03.961336 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:44:03.961562 (MainThread): Using postgres connection "master".
2022-02-08 12:44:03.961674 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-02-08 12:44:04.227741 (MainThread): SQL status: SELECT 10 in 0.27 seconds
2022-02-08 12:44:04.242726 (MainThread): On master: ROLLBACK
2022-02-08 12:44:04.244265 (MainThread): Using postgres connection "master".
2022-02-08 12:44:04.244642 (MainThread): On master: BEGIN
2022-02-08 12:44:04.255470 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:44:04.255814 (MainThread): On master: COMMIT
2022-02-08 12:44:04.256034 (MainThread): Using postgres connection "master".
2022-02-08 12:44:04.256237 (MainThread): On master: COMMIT
2022-02-08 12:44:04.257611 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:44:04.257903 (MainThread): On master: Close
2022-02-08 12:44:04.258453 (MainThread): 15:44:04 | Concurrency: 2 threads (target='dev')
2022-02-08 12:44:04.258848 (MainThread): 15:44:04 | 
2022-02-08 12:44:04.265918 (Thread-1): Began running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 12:44:04.266352 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 12:44:04.268217 (Thread-1): 15:44:04 | 1 of 18 START view model public.v_stg_rate_gbp_usd................... [RUN]
2022-02-08 12:44:04.269704 (Thread-2): 15:44:04 | 2 of 18 START view model public.v_stg_wheat_gbp...................... [RUN]
2022-02-08 12:44:04.270571 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:44:04.271799 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:44:04.272228 (Thread-1): Compiling model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 12:44:04.272739 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 12:44:04.355092 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:44:04.355351 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:44:04.355693 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: BEGIN
2022-02-08 12:44:04.355999 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: BEGIN
2022-02-08 12:44:04.356365 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:44:04.356697 (Thread-2): Opening a new connection, currently in state init
2022-02-08 12:44:04.371981 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-02-08 12:44:04.372301 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:44:04.372564 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:04.372854 (Thread-2): SQL status: BEGIN in 0.02 seconds
2022-02-08 12:44:04.373001 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:44:04.373117 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:04.403543 (Thread-1): SQL status: SELECT 6 in 0.03 seconds
2022-02-08 12:44:04.403920 (Thread-2): SQL status: SELECT 7 in 0.03 seconds
2022-02-08 12:44:04.479552 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:44:04.479851 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:04.482322 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:44:04.482805 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:04.489099 (Thread-1): SQL status: SELECT 6 in 0.01 seconds
2022-02-08 12:44:04.494845 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-08 12:44:04.494538 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 12:44:04.500745 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 12:44:04.501737 (Thread-2): finished collecting timing info
2022-02-08 12:44:04.512867 (Thread-1): finished collecting timing info
2022-02-08 12:44:04.547046 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:44:04.548731 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:44:04.548954 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" cascade
2022-02-08 12:44:04.549209 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 12:44:04.554282 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:44:04.554547 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 12:44:04.558978 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:44:04.563524 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:44:04.563886 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:44:04.564150 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 12:44:04.566230 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:44:04.566462 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:44:04.570918 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_gbp"
2022-02-08 12:44:04.572765 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_rate_gbp_usd"
2022-02-08 12:44:04.574477 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:44:04.574818 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */

  create view "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc

    FROM "postgres"."public"."source_rate_gbp_usd"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_RATE_GBP_USD'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:44:04.575624 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:44:04.575883 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */

  create view "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_gbp"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_GBP'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:44:04.603140 (Thread-2): SQL status: CREATE VIEW in 0.03 seconds
2022-02-08 12:44:04.603391 (Thread-1): SQL status: CREATE VIEW in 0.03 seconds
2022-02-08 12:44:04.614505 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:44:04.619425 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:44:04.619822 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp" rename to "v_stg_wheat_gbp__dbt_backup"
2022-02-08 12:44:04.620066 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd" rename to "v_stg_rate_gbp_usd__dbt_backup"
2022-02-08 12:44:04.624930 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:04.625403 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:04.629225 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:44:04.633154 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:44:04.633520 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
alter table "postgres"."public"."v_stg_wheat_gbp__dbt_tmp" rename to "v_stg_wheat_gbp"
2022-02-08 12:44:04.633752 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
alter table "postgres"."public"."v_stg_rate_gbp_usd__dbt_tmp" rename to "v_stg_rate_gbp_usd"
2022-02-08 12:44:04.635974 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:04.636225 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:04.646093 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 12:44:04.647661 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 12:44:04.648087 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:44:04.648338 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:44:04.648575 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: COMMIT
2022-02-08 12:44:04.648795 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: COMMIT
2022-02-08 12:44:04.653953 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:44:04.658929 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_gbp".
2022-02-08 12:44:04.659160 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:44:04.659345 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_gbp"} */
drop view if exists "postgres"."public"."v_stg_wheat_gbp__dbt_backup" cascade
2022-02-08 12:44:04.662332 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_rate_gbp_usd".
2022-02-08 12:44:04.662780 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_rate_gbp_usd"} */
drop view if exists "postgres"."public"."v_stg_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:44:04.672489 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 12:44:04.676307 (Thread-1): finished collecting timing info
2022-02-08 12:44:04.676758 (Thread-2): SQL status: DROP VIEW in 0.01 seconds
2022-02-08 12:44:04.677084 (Thread-1): On model.project_otus_dbt.v_stg_rate_gbp_usd: Close
2022-02-08 12:44:04.680273 (Thread-2): finished collecting timing info
2022-02-08 12:44:04.681073 (Thread-2): On model.project_otus_dbt.v_stg_wheat_gbp: Close
2022-02-08 12:44:04.683413 (Thread-1): 15:44:04 | 1 of 18 OK created view model public.v_stg_rate_gbp_usd.............. [CREATE VIEW in 0.41s]
2022-02-08 12:44:04.685851 (Thread-2): 15:44:04 | 2 of 18 OK created view model public.v_stg_wheat_gbp................. [CREATE VIEW in 0.41s]
2022-02-08 12:44:04.686271 (Thread-1): Finished running node model.project_otus_dbt.v_stg_rate_gbp_usd
2022-02-08 12:44:04.687224 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_gbp
2022-02-08 12:44:04.687793 (Thread-1): Began running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 12:44:04.688852 (Thread-2): Began running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 12:44:04.691222 (Thread-1): 15:44:04 | 3 of 18 START view model public.v_stg_wheat_msk...................... [RUN]
2022-02-08 12:44:04.693159 (Thread-2): 15:44:04 | 4 of 18 START view model public.v_stg_wheat_usa...................... [RUN]
2022-02-08 12:44:04.694112 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:44:04.694969 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:44:04.695333 (Thread-1): Compiling model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 12:44:04.695741 (Thread-2): Compiling model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 12:44:04.722808 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:44:04.728399 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: BEGIN
2022-02-08 12:44:04.730391 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:44:04.731020 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:44:04.731433 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: BEGIN
2022-02-08 12:44:04.732194 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:44:04.742225 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:44:04.742505 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:44:04.742660 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:04.744432 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:44:04.744769 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:44:04.744941 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:04.752688 (Thread-1): SQL status: SELECT 18 in 0.01 seconds
2022-02-08 12:44:04.758742 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-08 12:44:04.762541 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:44:04.768714 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:44:04.768944 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:04.769158 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:04.774405 (Thread-1): SQL status: SELECT 18 in 0.00 seconds
2022-02-08 12:44:04.780805 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 12:44:04.781065 (Thread-2): SQL status: SELECT 7 in 0.01 seconds
2022-02-08 12:44:04.788581 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 12:44:04.789091 (Thread-1): finished collecting timing info
2022-02-08 12:44:04.799811 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:44:04.800086 (Thread-2): finished collecting timing info
2022-02-08 12:44:04.800459 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_tmp" cascade
2022-02-08 12:44:04.809240 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:44:04.809636 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_tmp" cascade
2022-02-08 12:44:04.811178 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:44:04.811452 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:44:04.815319 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:44:04.820148 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:44:04.820555 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 12:44:04.820810 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 12:44:04.822417 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:44:04.822666 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:44:04.824100 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_usa"
2022-02-08 12:44:04.825640 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.v_stg_wheat_msk"
2022-02-08 12:44:04.826800 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:44:04.827079 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */

  create view "postgres"."public"."v_stg_wheat_msk__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume

    FROM "postgres"."public"."source_wheat_msk"
),

derived_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_MSK'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CLOSE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(NAME AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VALUE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    boardid,
    secid,
    tradedate,
    shortname,
    name,
    close,
    open,
    high,
    low,
    value,
    duration,
    yield,
    decimals,
    capitalization,
    currencyid,
    divisor,
    tradingsession,
    volume,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:44:04.827283 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:44:04.827571 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */

  create view "postgres"."public"."v_stg_wheat_usa__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc

    FROM "postgres"."public"."source_wheat_usa"
),

derived_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    TRADEDATE::TEXT AS DATE_KEY,
    'CSV_WHEAT_USA'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(TRADEDATE AS VARCHAR))), ''))) AS TEXT) AS DATE_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(CHANGEPERC AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(HIGH AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(LOW AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(OPEN AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(PRICE AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(VOLUME AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS DATE_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    tradedate,
    price,
    open,
    high,
    low,
    volume,
    changeperc,
    DATE_KEY,
    RECORD_SOURCE,
    DATE_PK,
    DATE_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-02-08 12:44:04.834951 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2022-02-08 12:44:04.840954 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:44:04.841231 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-02-08 12:44:04.841438 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa" rename to "v_stg_wheat_usa__dbt_backup"
2022-02-08 12:44:04.846499 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:44:04.846983 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk" rename to "v_stg_wheat_msk__dbt_backup"
2022-02-08 12:44:04.849347 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:04.849616 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:04.852885 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:44:04.856397 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:44:04.856727 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
alter table "postgres"."public"."v_stg_wheat_usa__dbt_tmp" rename to "v_stg_wheat_usa"
2022-02-08 12:44:04.856931 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
alter table "postgres"."public"."v_stg_wheat_msk__dbt_tmp" rename to "v_stg_wheat_msk"
2022-02-08 12:44:04.858913 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:04.859242 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:04.860570 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 12:44:04.862005 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 12:44:04.862278 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:44:04.862492 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:44:04.862684 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: COMMIT
2022-02-08 12:44:04.862890 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: COMMIT
2022-02-08 12:44:04.866599 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:44:04.869595 (Thread-2): Using postgres connection "model.project_otus_dbt.v_stg_wheat_usa".
2022-02-08 12:44:04.869864 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_usa"} */
drop view if exists "postgres"."public"."v_stg_wheat_usa__dbt_backup" cascade
2022-02-08 12:44:04.870056 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:44:04.873087 (Thread-1): Using postgres connection "model.project_otus_dbt.v_stg_wheat_msk".
2022-02-08 12:44:04.873316 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.v_stg_wheat_msk"} */
drop view if exists "postgres"."public"."v_stg_wheat_msk__dbt_backup" cascade
2022-02-08 12:44:04.874547 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:44:04.877803 (Thread-2): finished collecting timing info
2022-02-08 12:44:04.878197 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-02-08 12:44:04.878419 (Thread-2): On model.project_otus_dbt.v_stg_wheat_usa: Close
2022-02-08 12:44:04.881248 (Thread-1): finished collecting timing info
2022-02-08 12:44:04.881791 (Thread-1): On model.project_otus_dbt.v_stg_wheat_msk: Close
2022-02-08 12:44:04.884293 (Thread-2): 15:44:04 | 4 of 18 OK created view model public.v_stg_wheat_usa................. [CREATE VIEW in 0.19s]
2022-02-08 12:44:04.886827 (Thread-1): 15:44:04 | 3 of 18 OK created view model public.v_stg_wheat_msk................. [CREATE VIEW in 0.19s]
2022-02-08 12:44:04.887218 (Thread-2): Finished running node model.project_otus_dbt.v_stg_wheat_usa
2022-02-08 12:44:04.887519 (Thread-1): Finished running node model.project_otus_dbt.v_stg_wheat_msk
2022-02-08 12:44:04.888193 (Thread-2): Began running node model.project_otus_dbt.dim_day
2022-02-08 12:44:04.889273 (Thread-1): Began running node model.project_otus_dbt.dim_week
2022-02-08 12:44:04.891727 (Thread-2): 15:44:04 | 5 of 18 START table model public.dim_day............................. [RUN]
2022-02-08 12:44:04.894044 (Thread-1): 15:44:04 | 6 of 18 START table model public.dim_week............................ [RUN]
2022-02-08 12:44:04.895162 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:44:04.896186 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:44:04.896632 (Thread-2): Compiling model.project_otus_dbt.dim_day
2022-02-08 12:44:04.897113 (Thread-1): Compiling model.project_otus_dbt.dim_week
2022-02-08 12:44:04.928453 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 12:44:04.927207 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 12:44:04.930459 (Thread-1): finished collecting timing info
2022-02-08 12:44:04.931436 (Thread-2): finished collecting timing info
2022-02-08 12:44:04.985031 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:44:04.990544 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_tmp" cascade
2022-02-08 12:44:04.991002 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:44:04.991204 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:44:04.991412 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_tmp" cascade
2022-02-08 12:44:04.991841 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:44:05.003313 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:44:05.008127 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:44:05.008386 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 12:44:05.008593 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 12:44:05.012489 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:44:05.012973 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 12:44:05.014091 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:44:05.014352 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:44:05.022472 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dim_day"
2022-02-08 12:44:05.024563 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dim_week"
2022-02-08 12:44:05.026012 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:44:05.026306 (Thread-1): On model.project_otus_dbt.dim_week: BEGIN
2022-02-08 12:44:05.026993 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:44:05.027757 (Thread-2): On model.project_otus_dbt.dim_day: BEGIN
2022-02-08 12:44:05.028361 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:44:05.028734 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:44:05.029070 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */


  create  table "postgres"."public"."dim_week__dbt_tmp"
  as (
    with dim_week as (
    select
        extract('year' from date) as year,
        extract('week' from date) as week,
        extract('year' from date)*100+extract('week' from date) as week_id

        from generate_series(date '2012-01-01',
            date '2025-12-31',
            interval '1 week')
        as t(date)
)

select * from dim_week
  );
2022-02-08 12:44:05.029488 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:44:05.029709 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:44:05.029916 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */


  create  table "postgres"."public"."dim_day__dbt_tmp"
  as (
    with dim_day as (
    select date::date,
        extract('isodow' from date) as dow,
        to_char(date, 'dy') as day,
        date_trunc('week' , date) as first_day_week,
        extract('week' from date) as week_id,
        extract('year' from date)*100+extract('week' from date) as yearweek_id,

        to_char(date, 'MON') as month,
        concat(to_char(date, 'MM'), to_char(date, 'MON')) as mm_month,
        extract('month' from date) as moth_id,
        extract('year' from date)*100+extract('month' from date) as yearmonth_id,
        extract('year' from date) as year,
        extract('day' from (date + interval '2 month - 1 day')) = 29 as leap
    from generate_series(date '2012-01-01',
                         date '2025-12-31',
                         interval '1 day')
             as t(date)
)

select * from dim_day
order by date desc
  );
2022-02-08 12:44:05.051648 (Thread-1): SQL status: SELECT 731 in 0.02 seconds
2022-02-08 12:44:05.058202 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:44:05.058488 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week" rename to "dim_week__dbt_backup"
2022-02-08 12:44:05.060656 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:05.066842 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:44:05.067263 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
alter table "postgres"."public"."dim_week__dbt_tmp" rename to "dim_week"
2022-02-08 12:44:05.070243 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:05.074008 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 12:44:05.074500 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:44:05.074977 (Thread-1): On model.project_otus_dbt.dim_week: COMMIT
2022-02-08 12:44:05.081634 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:44:05.085604 (Thread-1): Using postgres connection "model.project_otus_dbt.dim_week".
2022-02-08 12:44:05.085999 (Thread-1): On model.project_otus_dbt.dim_week: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_week"} */
drop table if exists "postgres"."public"."dim_week__dbt_backup" cascade
2022-02-08 12:44:05.092308 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:44:05.096416 (Thread-1): finished collecting timing info
2022-02-08 12:44:05.096929 (Thread-1): On model.project_otus_dbt.dim_week: Close
2022-02-08 12:44:05.099729 (Thread-1): 15:44:05 | 6 of 18 OK created table model public.dim_week....................... [SELECT 731 in 0.20s]
2022-02-08 12:44:05.100205 (Thread-1): Finished running node model.project_otus_dbt.dim_week
2022-02-08 12:44:05.100732 (Thread-1): Began running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 12:44:05.104496 (Thread-1): 15:44:05 | 7 of 18 START incremental model public.hub_rate_gbp_usd.............. [RUN]
2022-02-08 12:44:05.106176 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:44:05.106893 (Thread-1): Compiling model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 12:44:05.133320 (Thread-2): SQL status: SELECT 5114 in 0.10 seconds
2022-02-08 12:44:05.146679 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 12:44:05.147721 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:44:05.148322 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day" rename to "dim_day__dbt_backup"
2022-02-08 12:44:05.150091 (Thread-1): finished collecting timing info
2022-02-08 12:44:05.150935 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:05.166334 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:44:05.172328 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
alter table "postgres"."public"."dim_day__dbt_tmp" rename to "dim_day"
2022-02-08 12:44:05.186570 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 12:44:05.193615 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 12:44:05.199332 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:44:05.205869 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:44:05.206127 (Thread-2): On model.project_otus_dbt.dim_day: COMMIT
2022-02-08 12:44:05.206365 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

    

  create temporary table "hub_rate_gbp_usd__dbt_tmp154405201759"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_rate_gbp_usd"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_rate_gbp_usd" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:44:05.206706 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:44:05.213581 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:44:05.217334 (Thread-2): Using postgres connection "model.project_otus_dbt.dim_day".
2022-02-08 12:44:05.217640 (Thread-2): On model.project_otus_dbt.dim_day: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dim_day"} */
drop table if exists "postgres"."public"."dim_day__dbt_backup" cascade
2022-02-08 12:44:05.225342 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:44:05.229227 (Thread-2): finished collecting timing info
2022-02-08 12:44:05.229698 (Thread-2): On model.project_otus_dbt.dim_day: Close
2022-02-08 12:44:05.232050 (Thread-2): 15:44:05 | 5 of 18 OK created table model public.dim_day........................ [SELECT 5114 in 0.34s]
2022-02-08 12:44:05.232466 (Thread-2): Finished running node model.project_otus_dbt.dim_day
2022-02-08 12:44:05.232905 (Thread-2): Began running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 12:44:05.235710 (Thread-2): 15:44:05 | 8 of 18 START incremental model public.sat_rate_gbp_usd_details...... [RUN]
2022-02-08 12:44:05.236710 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:44:05.237148 (Thread-2): Compiling model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 12:44:05.244884 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 12:44:05.254111 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:44:05.259594 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: BEGIN
2022-02-08 12:44:05.269655 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 12:44:05.269928 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:44:05.270391 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:44:05.270566 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd__dbt_tmp154405201759'
        
      order by ordinal_position

  
2022-02-08 12:44:05.271237 (Thread-2): finished collecting timing info
2022-02-08 12:44:05.284108 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:44:05.284418 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:44:05.284612 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

    

  create temporary table "sat_rate_gbp_usd_details__dbt_tmp154405281163"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_rate_gbp_usd" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.CHANGEPERC, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_rate_gbp_usd_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.CHANGEPERC, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:44:05.289850 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:44:05.290284 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:44:05.290569 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:05.296244 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:44:05.307975 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:44:05.308353 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_rate_gbp_usd'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:05.312789 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-02-08 12:44:05.314037 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_rate_gbp_usd"
2022-02-08 12:44:05.314877 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:44:05.315130 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_rate_gbp_usd"} */

      

    insert into "postgres"."public"."hub_rate_gbp_usd" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_rate_gbp_usd__dbt_tmp154405201759"
    );
  
2022-02-08 12:44:05.316620 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:44:05.317902 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 12:44:05.318224 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_rate_gbp_usd".
2022-02-08 12:44:05.318347 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: COMMIT
2022-02-08 12:44:05.321416 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:44:05.323543 (Thread-1): finished collecting timing info
2022-02-08 12:44:05.323880 (Thread-1): On model.project_otus_dbt.hub_rate_gbp_usd: Close
2022-02-08 12:44:05.325926 (Thread-1): 15:44:05 | 7 of 18 OK created incremental model public.hub_rate_gbp_usd......... [INSERT 0 0 in 0.22s]
2022-02-08 12:44:05.326276 (Thread-1): Finished running node model.project_otus_dbt.hub_rate_gbp_usd
2022-02-08 12:44:05.326571 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 12:44:05.330233 (Thread-1): 15:44:05 | 9 of 18 START incremental model public.hub_wheat_gbp................. [RUN]
2022-02-08 12:44:05.330722 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 12:44:05.332009 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:44:05.337200 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:44:05.337648 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_gbp
2022-02-08 12:44:05.337947 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: BEGIN
2022-02-08 12:44:05.351386 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 12:44:05.351617 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:44:05.351950 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:44:05.352234 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details__dbt_tmp154405281163'
        
      order by ordinal_position

  
2022-02-08 12:44:05.352598 (Thread-1): finished collecting timing info
2022-02-08 12:44:05.366030 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:44:05.368189 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:44:05.376835 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:44:05.377086 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

    

  create temporary table "hub_wheat_gbp__dbt_tmp154405364875"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_gbp"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_gbp" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:44:05.377550 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:05.377899 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:44:05.385560 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:44:05.395154 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:44:05.396216 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_rate_gbp_usd_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:05.404170 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:44:05.406050 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_rate_gbp_usd_details"
2022-02-08 12:44:05.407304 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:44:05.407655 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_rate_gbp_usd_details"} */

      

    insert into "postgres"."public"."sat_rate_gbp_usd_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "changeperc", "effective_from", "load_date", "record_source"
       from "sat_rate_gbp_usd_details__dbt_tmp154405281163"
    );
  
2022-02-08 12:44:05.410050 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:44:05.412114 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 12:44:05.412473 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_rate_gbp_usd_details".
2022-02-08 12:44:05.412789 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: COMMIT
2022-02-08 12:44:05.413156 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 12:44:05.419020 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:44:05.419291 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:44:05.419567 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: BEGIN
2022-02-08 12:44:05.422487 (Thread-2): finished collecting timing info
2022-02-08 12:44:05.423262 (Thread-2): On model.project_otus_dbt.sat_rate_gbp_usd_details: Close
2022-02-08 12:44:05.426152 (Thread-2): 15:44:05 | 8 of 18 OK created incremental model public.sat_rate_gbp_usd_details. [INSERT 0 0 in 0.19s]
2022-02-08 12:44:05.426479 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:44:05.428000 (Thread-2): Finished running node model.project_otus_dbt.sat_rate_gbp_usd_details
2022-02-08 12:44:05.428699 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:44:05.429836 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 12:44:05.431124 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp__dbt_tmp154405364875'
        
      order by ordinal_position

  
2022-02-08 12:44:05.434199 (Thread-2): 15:44:05 | 10 of 18 START incremental model public.sat_wheat_gbp_details........ [RUN]
2022-02-08 12:44:05.436781 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:44:05.437394 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 12:44:05.450862 (Thread-1): SQL status: SELECT 4 in 0.02 seconds
2022-02-08 12:44:05.467969 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:44:05.473574 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:05.477622 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 12:44:05.479105 (Thread-2): finished collecting timing info
2022-02-08 12:44:05.495042 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:44:05.495358 (Thread-1): SQL status: SELECT 4 in 0.02 seconds
2022-02-08 12:44:05.495599 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

    

  create temporary table "sat_wheat_gbp_details__dbt_tmp154405492143"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_gbp" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_gbp_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:44:05.502173 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:44:05.502540 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:44:05.502942 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_gbp'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:05.509410 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:44:05.510807 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_gbp"
2022-02-08 12:44:05.511973 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:44:05.512214 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_gbp"} */

      

    insert into "postgres"."public"."hub_wheat_gbp" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_gbp__dbt_tmp154405364875"
    );
  
2022-02-08 12:44:05.513918 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:44:05.515956 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 12:44:05.516303 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_gbp".
2022-02-08 12:44:05.516516 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: COMMIT
2022-02-08 12:44:05.519072 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:44:05.521886 (Thread-1): finished collecting timing info
2022-02-08 12:44:05.522262 (Thread-1): On model.project_otus_dbt.hub_wheat_gbp: Close
2022-02-08 12:44:05.524478 (Thread-1): 15:44:05 | 9 of 18 OK created incremental model public.hub_wheat_gbp............ [INSERT 0 0 in 0.19s]
2022-02-08 12:44:05.524918 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_gbp
2022-02-08 12:44:05.525199 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 12:44:05.527712 (Thread-1): 15:44:05 | 11 of 18 START incremental model public.hub_wheat_usa................ [RUN]
2022-02-08 12:44:05.528861 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:44:05.529515 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_usa
2022-02-08 12:44:05.542241 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 12:44:05.542496 (Thread-2): SQL status: SELECT 0 in 0.04 seconds
2022-02-08 12:44:05.548763 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:44:05.549225 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: BEGIN
2022-02-08 12:44:05.549682 (Thread-1): finished collecting timing info
2022-02-08 12:44:05.556477 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:44:05.562103 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:44:05.567114 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:44:05.567418 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details__dbt_tmp154405492143'
        
      order by ordinal_position

  
2022-02-08 12:44:05.567685 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

    

  create temporary table "hub_wheat_usa__dbt_tmp154405564342"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_usa"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_usa" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:44:05.568038 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:44:05.577571 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:44:05.582413 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:44:05.582812 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:05.589288 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:44:05.596058 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:44:05.596282 (Thread-1): SQL status: SELECT 0 in 0.03 seconds
2022-02-08 12:44:05.596504 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_gbp_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:05.600028 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:44:05.600503 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: BEGIN
2022-02-08 12:44:05.601640 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:44:05.601943 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:44:05.602115 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa__dbt_tmp154405564342'
        
      order by ordinal_position

  
2022-02-08 12:44:05.605239 (Thread-2): SQL status: SELECT 11 in 0.00 seconds
2022-02-08 12:44:05.606921 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_gbp_details"
2022-02-08 12:44:05.607686 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:44:05.607876 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_gbp_details"} */

      

    insert into "postgres"."public"."sat_wheat_gbp_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_gbp_details__dbt_tmp154405492143"
    );
  
2022-02-08 12:44:05.609449 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:44:05.611519 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 12:44:05.611792 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:44:05.612056 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_gbp_details".
2022-02-08 12:44:05.616352 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:44:05.616728 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: COMMIT
2022-02-08 12:44:05.616957 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:05.619719 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:44:05.622222 (Thread-2): finished collecting timing info
2022-02-08 12:44:05.622608 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:44:05.622865 (Thread-2): On model.project_otus_dbt.sat_wheat_gbp_details: Close
2022-02-08 12:44:05.630351 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:44:05.635017 (Thread-2): 15:44:05 | 10 of 18 OK created incremental model public.sat_wheat_gbp_details... [INSERT 0 0 in 0.20s]
2022-02-08 12:44:05.635343 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_usa'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:05.635790 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_gbp_details
2022-02-08 12:44:05.636518 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 12:44:05.640019 (Thread-2): 15:44:05 | 12 of 18 START incremental model public.sat_wheat_usa_details........ [RUN]
2022-02-08 12:44:05.640768 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:44:05.641138 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 12:44:05.647835 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:44:05.655208 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_usa"
2022-02-08 12:44:05.667302 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 12:44:05.668021 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:44:05.668368 (Thread-2): finished collecting timing info
2022-02-08 12:44:05.669526 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_usa"} */

      

    insert into "postgres"."public"."hub_wheat_usa" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_usa__dbt_tmp154405564342"
    );
  
2022-02-08 12:44:05.740658 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:44:05.740940 (Thread-1): SQL status: INSERT 0 0 in 0.01 seconds
2022-02-08 12:44:05.741208 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

    

  create temporary table "sat_wheat_usa_details__dbt_tmp154405738586"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_usa" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.PRICE, a.OPEN, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_usa_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.PRICE, e.OPEN, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:44:05.742729 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 12:44:05.743109 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:44:05.743349 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_usa".
2022-02-08 12:44:05.743813 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: COMMIT
2022-02-08 12:44:05.746715 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:44:05.749146 (Thread-1): finished collecting timing info
2022-02-08 12:44:05.749609 (Thread-1): On model.project_otus_dbt.hub_wheat_usa: Close
2022-02-08 12:44:05.751980 (Thread-1): 15:44:05 | 11 of 18 OK created incremental model public.hub_wheat_usa........... [INSERT 0 0 in 0.22s]
2022-02-08 12:44:05.752307 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_usa
2022-02-08 12:44:05.752587 (Thread-1): Began running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 12:44:05.754652 (Thread-1): 15:44:05 | 13 of 18 START incremental model public.hub_wheat_msk................ [RUN]
2022-02-08 12:44:05.756097 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:44:05.757083 (Thread-1): Compiling model.project_otus_dbt.hub_wheat_msk
2022-02-08 12:44:05.771910 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 12:44:05.772183 (Thread-2): SQL status: SELECT 0 in 0.03 seconds
2022-02-08 12:44:05.776767 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:44:05.777040 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: BEGIN
2022-02-08 12:44:05.777334 (Thread-1): finished collecting timing info
2022-02-08 12:44:05.783690 (Thread-2): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:44:05.789383 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:44:05.792687 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:44:05.793173 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details__dbt_tmp154405738586'
        
      order by ordinal_position

  
2022-02-08 12:44:05.793697 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

    

  create temporary table "hub_wheat_msk__dbt_tmp154405788082"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT DATE_PK, DATE_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY DATE_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."public"."v_stg_wheat_msk"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.DATE_PK, a.DATE_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."public"."hub_wheat_msk" AS d
    ON a.DATE_PK = d.DATE_PK
    WHERE d.DATE_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:44:05.794463 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:44:05.806311 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:44:05.815262 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:44:05.815573 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:05.818829 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-02-08 12:44:05.825322 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:44:05.825588 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:44:05.825861 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: BEGIN
2022-02-08 12:44:05.832759 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:44:05.833410 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_usa_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:05.834413 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:44:05.834777 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:44:05.835019 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk__dbt_tmp154405788082'
        
      order by ordinal_position

  
2022-02-08 12:44:05.839041 (Thread-2): SQL status: SELECT 11 in 0.01 seconds
2022-02-08 12:44:05.840626 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_usa_details"
2022-02-08 12:44:05.841884 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:44:05.842185 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_usa_details"} */

      

    insert into "postgres"."public"."sat_wheat_usa_details" ("date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "price", "open", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_usa_details__dbt_tmp154405738586"
    );
  
2022-02-08 12:44:05.843965 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:44:05.846484 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 12:44:05.846846 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:44:05.847160 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_usa_details".
2022-02-08 12:44:05.853935 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:44:05.854323 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: COMMIT
2022-02-08 12:44:05.854640 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:05.859144 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:44:05.862587 (Thread-2): finished collecting timing info
2022-02-08 12:44:05.863205 (Thread-2): On model.project_otus_dbt.sat_wheat_usa_details: Close
2022-02-08 12:44:05.863496 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:44:05.866880 (Thread-2): 15:44:05 | 12 of 18 OK created incremental model public.sat_wheat_usa_details... [INSERT 0 0 in 0.22s]
2022-02-08 12:44:05.874506 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:44:05.875122 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_usa_details
2022-02-08 12:44:05.875487 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_wheat_msk'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:05.876366 (Thread-2): Began running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 12:44:05.881152 (Thread-2): 15:44:05 | 14 of 18 START incremental model public.sat_wheat_msk_details........ [RUN]
2022-02-08 12:44:05.882053 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:44:05.882603 (Thread-2): Compiling model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 12:44:05.889296 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-02-08 12:44:05.896332 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.hub_wheat_msk"
2022-02-08 12:44:05.928181 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 12:44:05.928661 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:44:05.929419 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.hub_wheat_msk"} */

      

    insert into "postgres"."public"."hub_wheat_msk" ("date_pk", "date_key", "load_date", "record_source")
    (
       select "date_pk", "date_key", "load_date", "record_source"
       from "hub_wheat_msk__dbt_tmp154405788082"
    );
  
2022-02-08 12:44:05.930700 (Thread-2): finished collecting timing info
2022-02-08 12:44:05.931494 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:44:05.944847 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 12:44:05.950539 (Thread-1): Using postgres connection "model.project_otus_dbt.hub_wheat_msk".
2022-02-08 12:44:05.956017 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: COMMIT
2022-02-08 12:44:05.956699 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:44:05.957230 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

    

  create temporary table "sat_wheat_msk_details__dbt_tmp154405954014"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."v_stg_wheat_msk" AS a
),

update_records AS (
    SELECT a.DATE_PK, a.DATE_HASHDIFF, a.TRADEDATE, a.VALUE, a.OPEN, a.CLOSE, a.HIGH, a.LOW, a.VOLUME, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."public"."sat_wheat_msk_details" as a
    JOIN source_data as b
    ON a.DATE_PK = b.DATE_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.DATE_PK, c.DATE_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.DATE_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.DATE_PK, e.DATE_HASHDIFF, e.TRADEDATE, e.VALUE, e.OPEN, e.CLOSE, e.HIGH, e.LOW, e.VOLUME, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.DATE_HASHDIFF = e.DATE_HASHDIFF
    WHERE latest_records.DATE_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-02-08 12:44:05.957596 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:44:05.959459 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:44:05.961891 (Thread-1): finished collecting timing info
2022-02-08 12:44:05.962288 (Thread-1): On model.project_otus_dbt.hub_wheat_msk: Close
2022-02-08 12:44:05.965377 (Thread-1): 15:44:05 | 13 of 18 OK created incremental model public.hub_wheat_msk........... [INSERT 0 0 in 0.21s]
2022-02-08 12:44:05.965759 (Thread-1): Finished running node model.project_otus_dbt.hub_wheat_msk
2022-02-08 12:44:05.966215 (Thread-1): Began running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 12:44:05.970054 (Thread-1): 15:44:05 | 15 of 18 START table model public.dds_rate_gbp_usd................... [RUN]
2022-02-08 12:44:05.971497 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:44:05.972209 (Thread-1): Compiling model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 12:44:05.988124 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 12:44:05.990324 (Thread-1): finished collecting timing info
2022-02-08 12:44:06.002212 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:44:06.002500 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" cascade
2022-02-08 12:44:06.002623 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:44:06.015486 (Thread-2): SQL status: SELECT 0 in 0.06 seconds
2022-02-08 12:44:06.021410 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:44:06.021652 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: BEGIN
2022-02-08 12:44:06.023006 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:44:06.023248 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:44:06.023371 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details__dbt_tmp154405954014'
        
      order by ordinal_position

  
2022-02-08 12:44:06.046548 (Thread-1): SQL status: DROP TABLE in 0.04 seconds
2022-02-08 12:44:06.051223 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:44:06.051512 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:44:06.053187 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:44:06.055107 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_rate_gbp_usd"
2022-02-08 12:44:06.056179 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:44:06.056590 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: BEGIN
2022-02-08 12:44:06.058108 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:44:06.058409 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:44:06.058512 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */


  create  table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp"
  as (
    with rate as(
    select to_date(su.tradedate, 'DD.MM.YYYY') as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/10000.0 as rate
        ,cast(su.open as decimal(18,2))/10000.0 as open
        ,cast(su.high as decimal(18,2))/10000.0 as high
        ,cast(su.low as decimal(18,2))/10000.0 as low
    from "postgres"."public"."hub_rate_gbp_usd" as hu
    left join "postgres"."public"."sat_rate_gbp_usd_details" as su
    on hu.date_pk=su.date_pk
)
select * from rate
  );
2022-02-08 12:44:06.071286 (Thread-2): SQL status: SELECT 12 in 0.05 seconds
2022-02-08 12:44:06.076829 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:44:06.077064 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:06.085928 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 12:44:06.093437 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:44:06.093694 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_wheat_msk_details'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
2022-02-08 12:44:06.097867 (Thread-1): SQL status: SELECT 548 in 0.04 seconds
2022-02-08 12:44:06.104064 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:44:06.104367 (Thread-2): SQL status: SELECT 12 in 0.01 seconds
2022-02-08 12:44:06.104584 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd" rename to "dds_rate_gbp_usd__dbt_backup"
2022-02-08 12:44:06.106436 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.sat_wheat_msk_details"
2022-02-08 12:44:06.107594 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:44:06.107864 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.sat_wheat_msk_details"} */

      

    insert into "postgres"."public"."sat_wheat_msk_details" ("date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source")
    (
       select "date_pk", "date_hashdiff", "tradedate", "value", "open", "close", "high", "low", "volume", "effective_from", "load_date", "record_source"
       from "sat_wheat_msk_details__dbt_tmp154405954014"
    );
  
2022-02-08 12:44:06.108568 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:06.112691 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:44:06.112984 (Thread-2): SQL status: INSERT 0 0 in 0.00 seconds
2022-02-08 12:44:06.113182 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
alter table "postgres"."public"."dds_rate_gbp_usd__dbt_tmp" rename to "dds_rate_gbp_usd"
2022-02-08 12:44:06.114621 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 12:44:06.115159 (Thread-2): Using postgres connection "model.project_otus_dbt.sat_wheat_msk_details".
2022-02-08 12:44:06.115350 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: COMMIT
2022-02-08 12:44:06.116506 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:06.117946 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 12:44:06.118171 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:44:06.118291 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: COMMIT
2022-02-08 12:44:06.121536 (Thread-2): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:44:06.124402 (Thread-2): finished collecting timing info
2022-02-08 12:44:06.124834 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:44:06.125138 (Thread-2): On model.project_otus_dbt.sat_wheat_msk_details: Close
2022-02-08 12:44:06.127935 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_rate_gbp_usd".
2022-02-08 12:44:06.128461 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_rate_gbp_usd"} */
drop table if exists "postgres"."public"."dds_rate_gbp_usd__dbt_backup" cascade
2022-02-08 12:44:06.130948 (Thread-2): 15:44:06 | 14 of 18 OK created incremental model public.sat_wheat_msk_details... [INSERT 0 0 in 0.25s]
2022-02-08 12:44:06.131524 (Thread-2): Finished running node model.project_otus_dbt.sat_wheat_msk_details
2022-02-08 12:44:06.131922 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 12:44:06.135756 (Thread-2): 15:44:06 | 16 of 18 START table model public.dds_wheat_usa...................... [RUN]
2022-02-08 12:44:06.137133 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:44:06.137592 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_usa
2022-02-08 12:44:06.143411 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:44:06.153240 (Thread-1): finished collecting timing info
2022-02-08 12:44:06.156530 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 12:44:06.156848 (Thread-1): On model.project_otus_dbt.dds_rate_gbp_usd: Close
2022-02-08 12:44:06.160434 (Thread-1): 15:44:06 | 15 of 18 OK created table model public.dds_rate_gbp_usd.............. [SELECT 548 in 0.19s]
2022-02-08 12:44:06.160975 (Thread-2): finished collecting timing info
2022-02-08 12:44:06.161548 (Thread-1): Finished running node model.project_otus_dbt.dds_rate_gbp_usd
2022-02-08 12:44:06.172459 (Thread-1): Began running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 12:44:06.173564 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:44:06.175130 (Thread-1): 15:44:06 | 17 of 18 START table model public.dds_wheat_msk...................... [RUN]
2022-02-08 12:44:06.175494 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_tmp" cascade
2022-02-08 12:44:06.175962 (Thread-1): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:44:06.176159 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:44:06.176473 (Thread-1): Compiling model.project_otus_dbt.dds_wheat_msk
2022-02-08 12:44:06.191580 (Thread-1): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 12:44:06.192554 (Thread-1): finished collecting timing info
2022-02-08 12:44:06.199413 (Thread-2): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 12:44:06.203968 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:44:06.207362 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:44:06.207692 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_tmp" cascade
2022-02-08 12:44:06.207913 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 12:44:06.208255 (Thread-1): Opening a new connection, currently in state closed
2022-02-08 12:44:06.209721 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:44:06.211730 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_usa"
2022-02-08 12:44:06.212691 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:44:06.212962 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: BEGIN
2022-02-08 12:44:06.214373 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:44:06.214845 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:44:06.215131 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */


  create  table "postgres"."public"."dds_wheat_usa__dbt_tmp"
  as (
    with usa as (
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0/2.7 as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_usa" as hu
    left join "postgres"."public"."sat_wheat_usa_details" as su
    on hu.date_pk=su.date_pk
)
select * from usa
  );
2022-02-08 12:44:06.225365 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-02-08 12:44:06.228761 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:44:06.228990 (Thread-2): SQL status: SELECT 548 in 0.01 seconds
2022-02-08 12:44:06.229170 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 12:44:06.235888 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:44:06.236308 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa" rename to "dds_wheat_usa__dbt_backup"
2022-02-08 12:44:06.237255 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:44:06.238653 (Thread-1): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_msk"
2022-02-08 12:44:06.238861 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:06.242962 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:44:06.243291 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
alter table "postgres"."public"."dds_wheat_usa__dbt_tmp" rename to "dds_wheat_usa"
2022-02-08 12:44:06.243756 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:44:06.244253 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: BEGIN
2022-02-08 12:44:06.245045 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:06.246677 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 12:44:06.246921 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:44:06.247118 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:44:06.247339 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:44:06.247566 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: COMMIT
2022-02-08 12:44:06.247778 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */


  create  table "postgres"."public"."dds_wheat_msk__dbt_tmp"
  as (
    with dds_wheat_msk as(
    select cast(su.tradedate as date) as tradedate
        ,hu.date_pk
        ,case when su.value=0 and su.volume>0 then cast(su.volume*su.close as decimal(18,2))
            else cast(su.value as decimal(18,2))
            end as value_all
        ,cast(su.open as decimal(18,2)) as open
        ,cast(su.close as decimal(18,2)) as close
        ,cast(su.high as decimal(18,2)) as high
        ,cast(su.low as decimal(18,2)) as low
        ,cast(su.volume as decimal(18,2)) as volume
    from "postgres"."public"."hub_wheat_msk" as hu
    left join "postgres"."public"."sat_wheat_msk_details" as su
    on hu.date_pk=su.date_pk
)
select * from dds_wheat_msk
  );
2022-02-08 12:44:06.250558 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:44:06.254916 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_usa".
2022-02-08 12:44:06.255159 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_usa"} */
drop table if exists "postgres"."public"."dds_wheat_usa__dbt_backup" cascade
2022-02-08 12:44:06.260033 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:44:06.263174 (Thread-2): finished collecting timing info
2022-02-08 12:44:06.263524 (Thread-1): SQL status: SELECT 216 in 0.02 seconds
2022-02-08 12:44:06.263739 (Thread-2): On model.project_otus_dbt.dds_wheat_usa: Close
2022-02-08 12:44:06.269839 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:44:06.270251 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk" rename to "dds_wheat_msk__dbt_backup"
2022-02-08 12:44:06.273841 (Thread-2): 15:44:06 | 16 of 18 OK created table model public.dds_wheat_usa................. [SELECT 548 in 0.13s]
2022-02-08 12:44:06.274807 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_usa
2022-02-08 12:44:06.275388 (Thread-2): Began running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 12:44:06.277617 (Thread-2): 15:44:06 | 18 of 18 START table model public.dds_wheat_gbp...................... [RUN]
2022-02-08 12:44:06.277904 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:06.278808 (Thread-2): Acquiring new postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:44:06.282775 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:44:06.283168 (Thread-2): Compiling model.project_otus_dbt.dds_wheat_gbp
2022-02-08 12:44:06.283388 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
alter table "postgres"."public"."dds_wheat_msk__dbt_tmp" rename to "dds_wheat_msk"
2022-02-08 12:44:06.300504 (Thread-2): Writing injected SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 12:44:06.300783 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2022-02-08 12:44:06.302502 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 12:44:06.302865 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:44:06.303247 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: COMMIT
2022-02-08 12:44:06.303672 (Thread-2): finished collecting timing info
2022-02-08 12:44:06.312231 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-02-08 12:44:06.320746 (Thread-1): Using postgres connection "model.project_otus_dbt.dds_wheat_msk".
2022-02-08 12:44:06.324048 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:44:06.324378 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_msk"} */
drop table if exists "postgres"."public"."dds_wheat_msk__dbt_backup" cascade
2022-02-08 12:44:06.324845 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_tmp" cascade
2022-02-08 12:44:06.325296 (Thread-2): Opening a new connection, currently in state closed
2022-02-08 12:44:06.331012 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:44:06.335348 (Thread-1): finished collecting timing info
2022-02-08 12:44:06.335904 (Thread-1): On model.project_otus_dbt.dds_wheat_msk: Close
2022-02-08 12:44:06.339698 (Thread-1): 15:44:06 | 17 of 18 OK created table model public.dds_wheat_msk................. [SELECT 216 in 0.16s]
2022-02-08 12:44:06.340492 (Thread-1): Finished running node model.project_otus_dbt.dds_wheat_msk
2022-02-08 12:44:06.397069 (Thread-2): SQL status: DROP TABLE in 0.07 seconds
2022-02-08 12:44:06.402656 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:44:06.403007 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 12:44:06.404801 (Thread-2): SQL status: DROP TABLE in 0.00 seconds
2022-02-08 12:44:06.407979 (Thread-2): Writing runtime SQL for node "model.project_otus_dbt.dds_wheat_gbp"
2022-02-08 12:44:06.409080 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:44:06.409371 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: BEGIN
2022-02-08 12:44:06.411456 (Thread-2): SQL status: BEGIN in 0.00 seconds
2022-02-08 12:44:06.411792 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:44:06.412030 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */


  create  table "postgres"."public"."dds_wheat_gbp__dbt_tmp"
  as (
    with gbp as(
    select cast(to_date(su.tradedate, 'DD.MM.YYYY') as date) as tradedate
        ,hu.date_pk
        ,cast(su.price as decimal(18,2))/100.0*rt.rate as price
        ,cast(su.open as decimal(18,2))/100.0 as open
        ,cast(su.high as decimal(18,2))/100.0 as high
        ,cast(su.low as decimal(18,2))/100.0 as low
        ,cast(su.volume as varchar(50)) as volume
    from "postgres"."public"."hub_wheat_gbp" as hu
    left join "postgres"."public"."sat_wheat_gbp_details" as su
    on hu.date_pk=su.date_pk
    left join "postgres"."public"."dds_rate_gbp_usd" as rt
    on hu.date_pk=rt.date_pk
)
select * from gbp
  );
2022-02-08 12:44:06.427307 (Thread-2): SQL status: SELECT 531 in 0.01 seconds
2022-02-08 12:44:06.433313 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:44:06.433572 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp" rename to "dds_wheat_gbp__dbt_backup"
2022-02-08 12:44:06.435683 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:06.440427 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:44:06.440711 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
alter table "postgres"."public"."dds_wheat_gbp__dbt_tmp" rename to "dds_wheat_gbp"
2022-02-08 12:44:06.442343 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2022-02-08 12:44:06.444135 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 12:44:06.444399 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:44:06.444606 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: COMMIT
2022-02-08 12:44:06.447992 (Thread-2): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:44:06.455331 (Thread-2): Using postgres connection "model.project_otus_dbt.dds_wheat_gbp".
2022-02-08 12:44:06.455600 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.project_otus_dbt.dds_wheat_gbp"} */
drop table if exists "postgres"."public"."dds_wheat_gbp__dbt_backup" cascade
2022-02-08 12:44:06.461836 (Thread-2): SQL status: DROP TABLE in 0.01 seconds
2022-02-08 12:44:06.465459 (Thread-2): finished collecting timing info
2022-02-08 12:44:06.465876 (Thread-2): On model.project_otus_dbt.dds_wheat_gbp: Close
2022-02-08 12:44:06.467966 (Thread-2): 15:44:06 | 18 of 18 OK created table model public.dds_wheat_gbp................. [SELECT 531 in 0.19s]
2022-02-08 12:44:06.468383 (Thread-2): Finished running node model.project_otus_dbt.dds_wheat_gbp
2022-02-08 12:44:06.471135 (MainThread): Acquiring new postgres connection "master".
2022-02-08 12:44:06.471469 (MainThread): Using postgres connection "master".
2022-02-08 12:44:06.471617 (MainThread): On master: BEGIN
2022-02-08 12:44:06.471721 (MainThread): Opening a new connection, currently in state closed
2022-02-08 12:44:06.483495 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-02-08 12:44:06.483774 (MainThread): On master: COMMIT
2022-02-08 12:44:06.483926 (MainThread): Using postgres connection "master".
2022-02-08 12:44:06.484054 (MainThread): On master: COMMIT
2022-02-08 12:44:06.485214 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-02-08 12:44:06.485453 (MainThread): On master: Close
2022-02-08 12:44:06.486004 (MainThread): 15:44:06 | 
2022-02-08 12:44:06.486271 (MainThread): 15:44:06 | Finished running 4 view models, 6 table models, 8 incremental models in 2.69s.
2022-02-08 12:44:06.486459 (MainThread): Connection 'master' was properly closed.
2022-02-08 12:44:06.486626 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_msk' was properly closed.
2022-02-08 12:44:06.486704 (MainThread): Connection 'model.project_otus_dbt.dds_wheat_gbp' was properly closed.
2022-02-08 12:44:06.613499 (MainThread): 
2022-02-08 12:44:06.613725 (MainThread): Completed successfully
2022-02-08 12:44:06.613890 (MainThread): 
Done. PASS=18 WARN=0 ERROR=0 SKIP=0 TOTAL=18
2022-02-08 12:44:06.614184 (MainThread): Flushing usage events
